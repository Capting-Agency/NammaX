var l=(e,o,t)=>new Promise((a,r)=>{var _=n=>{try{i(t.next(n))}catch(c){r(c)}},s=n=>{try{i(t.throw(n))}catch(c){r(c)}},i=n=>n.done?a(n.value):Promise.resolve(n.value).then(_,s);i((t=t.apply(e,o)).next())});function m(e,o="GET",t=!1,a=!1,r=!1,_=!0){try{let s={"Content-Type":"application/json"};r&&(s={}),a&&(s.Authorization=`Bearer ${a}`);let i={method:o,headers:s};return t&&(_?i.body=JSON.stringify(t):i.body=t),fetch(e,i).then(n=>n.ok?n.json():n.json().then(c=>(Promise.reject(c.message),{isFetchOk:!1,status:n.status,message:c.message,payload:c&&c.payload?c.payload:null}))).then(n=>n).catch(n=>(console.error("Error in fetch",n),n))}catch(s){return console.error("Error!: "+s),s}}function p(e="nammax_auth"){let t=`; ${document.cookie}`.split(`; ${e}=`);return t.length===2?t.pop().split(";").shift():null}function h(e="/",o=2e3){setTimeout(()=>{window.location.href=e},o)}function d(e=1e3){setTimeout(()=>{window.location.reload()},e)}function x(e="/sign-in"){window.localStorage.removeItem("auth"),h(`${e}`)}function A(){let e=document.getElementById("loading-screen");e?e.remove():console.log("did not find loading screen")}var f=Webflow||[];var N="/coach/sign-in";var u="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/coach/account",E="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/coach/upload/image";window.onload=function(){return l(this,null,function*(){let e=document.querySelector("#navbar-logout-btn");e&&(e.onclick=()=>{x(N)});let o=p();if(o){let t=yield m(u,"GET",!1,o);if(t.isFetchOk!==void 0&&!t.isFetchOk){console.error(t.message);return}g(t)}})};function g(e){return l(this,null,function*(){$("#account-submit-btn").prop("disabled",!0),R(e),O(),A()})}function R(e){e.profile_picture&&(document.getElementById("profile_avatar").style.backgroundImage=`url(${e.profile_picture.url})`);let o=e.name.split(new RegExp("(?<=^\\S+)\\s"));document.getElementById("coach_full_name").innerText=e.name||"",document.getElementById("coach_firstname").value=o[0]||"",document.getElementById("coach_lastname").value=o[1]||"",document.getElementById("coach_email").value=e.email||"",document.getElementById("coach_phone_number").value=e.phone_number||""}function O(){let e=document.getElementById("pfp_input"),o=document.getElementById("profile_avatar");e.addEventListener("change",function(t){t.target&&t.target.files.length>0&&t.target.files[0]&&(o.style.backgroundImage=`url(${URL.createObjectURL(t.target.files[0])})`,$("#wf-form-user-data").data("changed",!0),$("#account-submit-btn").prop("disabled",!1),$("#account-submit-btn").removeClass("disabled"))})}function I(e,o){return l(this,null,function*(){let t=document.getElementById("pfp_input"),a=t.files[0];if(a!==void 0){if(a.size>2097152){alert("File too big. Max size is 2MB");return}if(a.type!=="image/jpg"&&a.type!=="image/jpeg"&&a.type!=="image/png"){alert("Incorrect file type. Acceptable types: .png, .jpg, .jpeg");return}let r=new FormData;r.append("content",a);let _=yield m(E,"POST",r,e,!0,!1);if(_.isFetchOk!==void 0&&!_.isFetchOk){console.error(_.message),o.siblings(".w-form-done").hide().siblings(".w-form-fail").show();let s=document.getElementById("account-submit-btn");s&&(s.disabled=!1);return}t.value="",document.getElementById("profile_avatar").style.backgroundImage=`url(https://xoxo-jnzf-s0on.m2.xano.io${_.path})`}return!0})}var S=f||[];S.push(function(){$(document).off("submit"),$("form").on("change",function(){$("#account-submit-btn").prop("disabled",!1),$("#account-submit-btn").removeClass("disabled"),$("form").data("changed",!0)}),$("form").submit(function(e){return l(this,null,function*(){e.preventDefault();let o=document.getElementById("account-submit-btn");o&&(o.disabled=!0);let t=$(this);if(!t.data("changed")&&document.getElementById("pfp_input").files[0]===void 0){o&&(o.disabled=!1);return}let a=p();if(a){let r=!1;if(t.data("changed")){let s={name:document.getElementById("coach_firstname").value+" "+document.getElementById("coach_lastname").value,email:document.getElementById("coach_email").value,phone_number:document.getElementById("coach_phone_number").value.replace("+","")},i=yield m(u,"POST",s,a);i.isFetchOk!==void 0&&!i.isFetchOk?(t.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("There was an error updating your account details - Err:",i.message),o&&(o.disabled=!1)):t.siblings(".w-form-done").show().siblings(".w-form-fail").hide().text("Your account has been updated successfully"),r=!0}let _=I(a,t);r&&_&&d(2e3)}})})});
