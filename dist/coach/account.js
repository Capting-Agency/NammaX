var c=(t,n,e)=>new Promise((a,r)=>{var l=o=>{try{s(e.next(o))}catch(_){r(_)}},i=o=>{try{s(e.throw(o))}catch(_){r(_)}},s=o=>o.done?a(o.value):Promise.resolve(o.value).then(l,i);s((e=e.apply(t,n)).next())});function m(t,n="GET",e=!1,a=!1,r=!1,l=!0){try{let i={"Content-Type":"application/json"};r&&(i={}),a&&(i.Authorization=`Bearer ${a}`);let s={method:n,headers:i};return e&&(l?s.body=JSON.stringify(e):s.body=e),fetch(t,s).then(o=>o.ok?o.json():o.json().then(_=>(Promise.reject(_.message),{isFetchOk:!1,status:o.status,message:_.message,payload:_&&_.payload?_.payload:null}))).then(o=>o).catch(o=>(console.error("Error in fetch",o),o))}catch(i){return console.error("Error!: "+i),i}}function p(t="nammax_auth"){let e=`; ${document.cookie}`.split(`; ${t}=`);return e.length===2?e.pop().split(";").shift():null}function h(t="/",n=2e3){setTimeout(()=>{window.location.href=t},n)}function d(t=1e3){setTimeout(()=>{window.location.reload()},t)}function A(t="/sign-in"){window.localStorage.removeItem("auth"),h(`${t}`)}function x(){let t=document.getElementById("loading-screen");t?t.remove():console.log("did not find loading screen")}var N=Webflow||[];var E="/coach/sign-in";var u="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/coach/account",f="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/coach/upload/image";window.onload=function(){return c(this,null,function*(){let t=document.querySelector("#navbar-logout-btn");t&&(t.onclick=()=>{A(E)});let n=p();if(n){let e=yield m(u,"GET",!1,n);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message);return}g(e)}})};function g(t){return c(this,null,function*(){$("#account-submit-btn").prop("disabled",!0),R(t),O(),x()})}function R(t){t.profile_picture&&(document.getElementById("profile_avatar").style.backgroundImage=`url(${t.profile_picture.url})`);let n=t.name.split(new RegExp("(?<=^\\S+)\\s"));document.getElementById("coach_full_name").innerText=t.name||"",document.getElementById("coach_firstname").value=n[0]||"",document.getElementById("coach_lastname").value=n[1]||"",document.getElementById("coach_email").value=t.email||"",document.getElementById("coach_phone_number").value=t.phone_number||""}function O(){let t=document.getElementById("pfp_input"),n=document.getElementById("profile_avatar");t.addEventListener("change",function(e){e.target&&e.target.files.length>0&&e.target.files[0]&&(n.style.backgroundImage=`url(${URL.createObjectURL(e.target.files[0])})`,$("#wf-form-user-data").data("changed",!0),$("#account-submit-btn").prop("disabled",!1),$("#account-submit-btn").removeClass("disabled"))})}function I(t,n){return c(this,null,function*(){let e=document.getElementById("pfp_input"),a=e.files[0];if(a!==void 0){if(a.size>2097152){alert("File too big. Max size is 2MB");return}if(a.type!=="image/jpg"&&a.type!=="image/jpeg"&&a.type!=="image/png"){alert("Incorrect file type. Acceptable types: .png, .jpg, .jpeg");return}let r=new FormData;r.append("content",a);let l=yield m(f,"POST",r,t,!0,!1);if(l.isFetchOk!==void 0&&!l.isFetchOk){console.error(l.message),n.siblings(".w-form-done").hide().siblings(".w-form-fail").show();let i=document.getElementById("account-submit-btn");i&&(i.disabled=!1);return}e.value="",document.getElementById("profile_avatar").style.backgroundImage=`url(https://x8ki-letl-twmt.n7.xano.io${l.path})`}return!0})}var S=N||[];S.push(function(){$(document).off("submit"),$("form").on("change",function(){$("#account-submit-btn").prop("disabled",!1),$("#account-submit-btn").removeClass("disabled"),$("form").data("changed",!0)}),$("form").submit(function(t){return c(this,null,function*(){t.preventDefault();let n=document.getElementById("account-submit-btn");n&&(n.disabled=!0);let e=$(this);if(!e.data("changed")&&document.getElementById("pfp_input").files[0]===void 0){n&&(n.disabled=!1);return}let a=p();if(a){let r=!1;if(e.data("changed")){let i={name:document.getElementById("coach_firstname").value+" "+document.getElementById("coach_lastname").value,email:document.getElementById("coach_email").value,phone_number:document.getElementById("coach_phone_number").value.replace("+","")},s=yield m(u,"POST",i,a);s.isFetchOk!==void 0&&!s.isFetchOk?(e.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("There was an error updating your account details - Err:",s.message),n&&(n.disabled=!1)):e.siblings(".w-form-done").show().siblings(".w-form-fail").hide().text("Your account has been updated successfully"),r=!0}let l=I(a,e);r&&l&&d(2e3)}})})});
