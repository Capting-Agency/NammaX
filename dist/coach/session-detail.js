var A=(t,s,e)=>new Promise((a,r)=>{var n=o=>{try{i(e.next(o))}catch(l){r(l)}},c=o=>{try{i(e.throw(o))}catch(l){r(l)}},i=o=>o.done?a(o.value):Promise.resolve(o.value).then(n,c);i((e=e.apply(t,s)).next())});function x(t,s="GET",e=!1,a=!1,r=!1,n=!0){try{let c={"Content-Type":"application/json"};r&&(c={}),a&&(c.Authorization=`Bearer ${a}`);let i={method:s,headers:c};return e&&(n?i.body=JSON.stringify(e):i.body=e),fetch(t,i).then(o=>o.ok?o.json():o.json().then(l=>(Promise.reject(l.message),{isFetchOk:!1,status:o.status,message:l.message,payload:l&&l.payload?l.payload:null}))).then(o=>o).catch(o=>(console.error("Error in fetch",o),o))}catch(c){return console.error("Error!: "+c),c}}function f(t="nammax_auth"){let e=`; ${document.cookie}`.split(`; ${t}=`);return e.length===2?e.pop().split(";").shift():null}function _(t="/",s=2e3){setTimeout(()=>{window.location.href=t},s)}function I(t=1e3){setTimeout(()=>{window.location.reload()},t)}function R(t=null,s=!1,e=!1,a=!1){if(t==null)return"NaN";let r=new Date,n=new Date(t),c=n.getHours(),i="";if(a||(i=c>=12?"PM":"AM",c=c%12||12),s){let o=n.getMinutes();return o=o<10?`0${o}`:o,e?`${r.getDate()===n.getDate()?"Today At":r.getDate()+1===n.getDate()?"Tomorrow At":r.getDate()+2===n.getDate()?"Day After Tomorrow At":h(t)} ${c}:${o} ${i}`:`${c}:${o} ${i}`}else return e?`${r.getDate()===n.getDate()?"Today At":r.getDate()+1===n.getDate()?"Tomorrow At":r.getDate()+2===n.getDate()?"Day After Tomorrow At":h(t)} ${c} ${i}`:`${h(t)} ${c} ${i}`}function h(t=null){if(t==null)return"NaN";let s=new Date(t);return`${s.getDate()}/${s.getMonth()+1}/${s.getFullYear()}`}function y(t=null){if(t==null)return"NaN";t=t*60;let s=`${t/60^0}`.slice(-2),e=("0"+t%60).slice(-2);return s!="0"?e!="00"?`${s} HR ${e} M`:s+" HR":e+" Mins"}function D(){let t=document.getElementById("loading-screen");t?t.remove():console.error("did not find loading screen")}function O(t){let s=new Date(t);return s.setMinutes(s.getMinutes()-s.getTimezoneOffset()),s}function S(t,s,e=!1){let a=864e5;return Math.round((O(s)-O(t))/a)}function U({single:t=!0,baseElement:s="",TriggerBtn:e="jsModalOpen",_modalWindow:a="jsModal"},r){if(t){var n=s.querySelector("#"+e);n.onclick=function(){var o=document.getElementById(a);r&&r(),o.classList?o.classList.add("open"):o.className+=" open"}}else for(var c=document.getElementsByClassName(e),i=0;i<c.length;i++)c[i].onclick=function(){var o=this.getAttribute("href").substr(1),l=document.getElementById(o);l.classList?l.classList.add("open"):l.className+=" open"}}function T({TriggerBtn:t="jsModalClose",_modalWindow:s="jsModal"},e){var a=document.getElementById(t),r=document.getElementById(s);a.onclick=function(){r.classList?r.classList.remove("open"):r.className=r.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," ")},e&&e()}var L=Webflow||[];var p="/coach/sign-in",C="/coach/dashboard";var b="/coach/session-summary/";var B="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/coach/session_summary/search/";var g="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/coach/sessions/attendence/",M="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/coach/sessions/attendence/add_walkins/";var z="https://www.nammacrossfit.com",w=z;var te=`${w}/sign-up-2`;var ne=`${w}/user/dashboard`;var d=[],u={},N,j;window.onload=function(){let t=f();t?(H(t),D()):_(`${p}?reason=NOT_SIGNED_IN`)};function H(t){return A(this,null,function*(){if(N=new URL(document.location.href).searchParams.get("session"),!N){_(C);return}let e=document.getElementById("submit-attendence-btn");e&&(e.disabled=!0);try{let a=yield x(g+N,"GET",!1,t);if(a.isFetchOk!==void 0&&!a.isFetchOk){console.error(a.message),_(`${p}?reason=NOT_SIGNED_IN`);return}a&&a.length>0&&(j=a[0].gym_id),a.some(r=>r.status==="COMPLETED"?(console.error("Session is already completed"),_(`/coach/session-summary?session=${r.id}`),!1):r.status==="IN PROGRESS"?(k(r),G(r.users,t),W(r,t),K(r.users),!0):(console.error("Session either unknown or not in progress"),_(`/coach/session-summary?session=${r.id}`),!1))}catch(a){console.error("Error fetching session data:",a)}})}function K(t){U({baseElement:document.getElementById("btn-container"),TriggerBtn:"edit-users-btn",_modalWindow:"edit-user-popout"},()=>{d=t,E(t)}),T({TriggerBtn:"close-edit-user-btn",_modalWindow:"edit-user-popout"})}function E(t){let s=document.getElementById("session-current-user-container"),e=s.querySelector("#session-current-user-item");s.querySelectorAll(".summary-user-details").forEach((r,n)=>{n!==0&&r.remove()}),t.forEach(r=>{let n=e.cloneNode(!0);n.setAttribute("id",""),n.style.display="flex",r.attended||(n.style.backgroundColor="#ff634e",n.querySelector("#session-current-user-delete-btn").style.filter="grayscale(1)"),r.profile_picture&&(n.querySelector("#session-current-user-pfp").style.backgroundImage=`url(${r.profile_picture.url})`),n.querySelector("#session-current-user-name").innerText=r.name,n.querySelector("#session-current-user-delete-btn").onclick=()=>{d=d.filter(c=>c.user_id!==r.user_id),E(d)},s.append(n)}),e.style.display="none"}function P(t){let e=document.getElementById("edit-user-popout").querySelector("#search-item-container"),a=e.querySelector("#search-item");function r(n){if(e.querySelectorAll(".summary-user-details.search-item").forEach((i,o)=>{o!==0&&i.remove()}),n.length===0){let i=document.createElement("p");i.style.color="black",i.innerText="No users with this name found",i.classList.add("summary-user-details","search-item"),i.style.display="flex",e.append(i)}else n.forEach(i=>{let o=a.cloneNode(!0);o.setAttribute("id",""),o.style.display="flex",i.profile_picture&&(o.querySelector("#search-item-pfp").style.backgroundImage=`url(${i.profile_picture.url})`),o.querySelector("#search-item-name").innerText=i.name,o.onclick=()=>{let l;d.some((X,v)=>{if(X.user_id===i.user_id)return l=v,!0})?(d[l].attended=!0,E(d)):(i.attended=!0,d.push(i),E(d)),o.remove()},e.append(o)})}r(t),a.style.display="none"}function k(t){if(!t){console.error("Session object is missing or invalid.");return}let s=document.getElementById("header-container");if(!s){console.error("Header container not found.");return}let{session_name:e,time:a,location:r,duration:n}=t,c=s.querySelector("#session-name"),i=s.querySelector("#time"),o=s.querySelector("#date"),l=s.querySelector("#gym-location"),m=s.querySelector("#duration");e&&(c.innerText=e),a&&(i.innerText=R(a,!0),o.innerText=new Date(a).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"})),r&&(l.innerText=r),n&&(m.innerText=y(n))}function G(t){let s=document.getElementById("attendence-container"),e=s.querySelector("#attendence-item");t.forEach((a,r)=>{let n=e.cloneNode(!0);if(n.setAttribute("id",""),n.querySelector("#index").innerText=r+1,a.profile_picture&&n.querySelector("#profile-pic").setAttribute("src",a.profile_picture.url),a.membership_end_date){let l=new Date(a.membership_end_date),m=new Date;(a==null?void 0:a.session_ledger)!==void 0&&a.session_ledger.length<=3?n.querySelector("#profile-pic").style.border="3px solid #009ca1":S(m,l,!0)<=3?n.querySelector("#profile-pic").style.border="3px solid red":S(m,l,!0)<=7&&(n.querySelector("#profile-pic").style.border="3px solid orange")}n.querySelector("#user-name").innerText=a.name,n.querySelector("#user-level").innerText=a.level,n.querySelector("#user-injury").innerText=a.injury;let c=n.querySelector("#attendence-checkmarks"),i=c.querySelector("#did-attend"),o=c.querySelector("#did-not-attend");o.classList.add("is-true"),i.onclick=()=>{i.classList.add("is-true"),o.classList.remove("is-true"),u[a.user_id]={attended:!0}},o.onclick=()=>{o.classList.add("is-true"),i.classList.remove("is-true"),u[a.user_id]={attended:!1}},u[a.user_id]={attended:!1},s.append(n)}),e.remove()}function W(t,s){let e=document.getElementById("submit-attendence-btn");e&&(e.disabled=!1),e.onclick=()=>A(this,null,function*(){e.disabled=!0;let a=e.value;e.value="Submitting";let r=[];Object.keys(u).forEach(i=>r.push({user_id:parseInt(i),attended:u[i].attended}));let n={allUsersAttendence:r,gym_id:j,session_id:parseInt(t.id)||t.id||""},c=yield x(g+t.id,"POST",n,s);if(c.isFetchOk!==void 0&&!c.isFetchOk){console.error(c.message),_(`${p}?reason=NOT_SIGNED_IN`),e.disabled=!1,e.value=a;return}_(`${b}?session=${t.id}`)})}var F=L||[];F.push(function(){$(document).off("submit"),$("form").on("submit",function(t){return A(this,null,function*(){t.preventDefault();let s=$(this);if(s.attr("id")==="search-form-block"){let e=f();if(e){let n=document.getElementById("edit-user-popout").querySelector("#search-input").value;if(n.length===0)return;let c={search_query:`${n}:*`},i=yield x(B+n,"POST",c,e);if(i.isFetchOk!==void 0&&!i.isFetchOk){console.error(i.message),s.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Oops, that user may not exist! Just to be safe, please try again after refreshing your browser.");return}P(i)}else _(`${p}?reason=NOT_SIGNED_IN`)}else if(s.attr("id")==="update-session-form-block"){let e=document.getElementById("update-session-btn"),a;e&&(e.disabled=!0,a=e.innerText,e.innerText="Confirming...");let r=f();if(r){let n=[];for(let l=0;l<d.length;l++){let m=d[l];m.user_id in u||n.push(m.user_id)}let c=[];Object.keys(u).forEach(l=>c.push({user_id:parseInt(l),attended:u[l].attended})),n.map(l=>c.push({user_id:parseInt(l),attended:!1}));let i={items:{}};i.items.allData=[...c.map(l=>({user_id:l.user_id,attended:!1}))],i.items.newUsers=[...n.map(l=>({user_id:l,attended:!1}))];let o=yield x(M+N,"POST",i,r);if(o.isFetchOk!==void 0&&!o.isFetchOk){console.error(o.message),s.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text(`There was an error trying to update the session. Please refresh your browser and try again. ${"message"in o&&`Error: ${o.message}`}`),e&&(e.disabled=!1,e.innerText=a);return}s.hide().siblings(".w-form-done").show().siblings(".w-form-fail").hide(),I()}else _(`${p}?reason=NOT_SIGNED_IN`)}})})});
