var N=(t,a,e)=>new Promise((s,n)=>{var o=l=>{try{r(e.next(l))}catch(c){n(c)}},i=l=>{try{r(e.throw(l))}catch(c){n(c)}},r=l=>l.done?s(l.value):Promise.resolve(l.value).then(o,i);r((e=e.apply(t,a)).next())});function _(t,a="GET",e=!1,s=!1,n=!1,o=!0){try{let i={"Content-Type":"application/json"};n&&(i={}),s&&(i.Authorization=`Bearer ${s}`);let r={method:a,headers:i};return e&&(o?r.body=JSON.stringify(e):r.body=e),fetch(t,r).then(l=>l.ok?l.json():l.json().then(c=>(Promise.reject(c.message),{isFetchOk:!1,status:l.status,message:c.message,payload:c&&c.payload?c.payload:null}))).then(l=>l).catch(l=>(console.error("Error in fetch",l),l))}catch(i){return console.error("Error!: "+i),i}}function p(t="nammax_auth"){let e=`; ${document.cookie}`.split(`; ${t}=`);return e.length===2?e.pop().split(";").shift():null}function m(t="/",a=2e3){setTimeout(()=>{window.location.href=t},a)}function x(t=1e3){setTimeout(()=>{window.location.reload()},t)}function g(t=null,a=!1,e=!1,s=!1){if(t==null)return"NaN";let n=new Date,o=new Date(t),i=o.getHours(),r="";if(s||(r=i>=12?"PM":"AM",i=i%12||12),a){let l=o.getMinutes();return l=l<10?`0${l}`:l,e?`${n.getDate()===o.getDate()?"Today":n.getDate()+1===o.getDate()?"Tomorrow":n.getDate()+2===o.getDate()?"Day After Tomorrow":""} ${i}:${l} ${r}`:`${i}:${l} ${r}`}else return e?`${n.getDate()===o.getDate()?"Today":n.getDate()+1===o.getDate()?"Tomorrow":n.getDate()+2===o.getDate()?"Day After Tomorrow":""} ${i} ${r}`:`${i} ${r}`}function S(t=null){if(t==null)return"NaN";t=t*60;let a=`${t/60^0}`.slice(-2),e=("0"+t%60).slice(-2);return a!="0"?e!="00"?`${a} HR ${e} M`:a+" HR":e+" Mins"}function y(t,a=null){if(t!=null){var e,s=t.options.length-1;for(e=s;e>=0;e--)e!==a&&t.remove(e)}}function R(){let t=document.getElementById("loading-screen");t?t.remove():console.log("did not find loading screen")}function f({single:t=!0,baseElement:a="",TriggerBtn:e="jsModalOpen",_modalWindow:s="jsModal"},n){if(t){var o=a.querySelector("#"+e);o.onclick=function(){var l=document.getElementById(s);n&&n(),l.classList?l.classList.add("open"):l.className+=" open"}}else for(var i=document.getElementsByClassName(e),r=0;r<i.length;r++)i[r].onclick=function(){var l=this.getAttribute("href").substr(1),c=document.getElementById(l);c.classList?c.classList.add("open"):c.className+=" open"}}function h({TriggerBtn:t="jsModalClose",_modalWindow:a="jsModal"},e){var s=document.getElementById(t),n=document.getElementById(a);s.onclick=function(){n.classList?n.classList.remove("open"):n.className=n.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," ")},e&&e()}var D=Webflow||[];var u="/coach/sign-in",O="/coach/dashboard";var w="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/coach/all_coaches",I="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/coach/session_summary/",T="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/coach/session_summary/search/",U="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/coach/session_summary/comments/",C="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/coach/session_summary/update_coach/";var A,d=[];window.onload=function(){let t=p();t?(B(t),R()):m(`${u}?reason=NOT_SIGNED_IN`)};function B(t){return N(this,null,function*(){var o;var a=new URL(document.location.href);A=a.searchParams.get("session"),A||m(O);let e=yield _(I+A,"GET",!1,t);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message);return}if(e.status!=="COMPLETED"){console.error("Session hasnt been completed yet!"),m(O);return}let s=[],n=[];(o=e==null?void 0:e.users)==null||o.forEach(i=>{i.attended?s.push(i):n.push(i)}),k(e,s.length),M(s),X(n),v(e.users),K(e.secondary_coach,t),P(e.comments,t)})}function k(t,a){var o,i,r;let e=document.getElementById("header-container");e.querySelector("#session-name").innerText=t.session_name,e.querySelector("#start-time").innerText=(o=g(t.start_time,!0))!=null?o:"NaN",e.querySelector("#date").innerText=new Date(t.time).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"}),e.querySelector("#gym-location").innerText=t.location,e.querySelector("#duration").innerText=S(t.duration);let s=new Date(t.end_time).getHours()-new Date(t.start_time).getHours(),n=(new Date(t.end_time).getMinutes()-new Date(t.start_time).getMinutes())/60;e.querySelector("#actual-duration").innerText=S(parseFloat(s)+parseFloat(n)),e.querySelector("#users-attended").innerText=a,e.querySelector("#users-missed").innerText=((i=t==null?void 0:t.users)==null?void 0:i.length)-a,e.querySelector("#end-time").innerText=(r=g(t.end_time,!0))!=null?r:"NaN"}function M(t){let a=document.getElementById("attended-container"),e=a.querySelector("#attended-item");if(t.length===0){let s=document.createElement("p");s.style.color="black",s.innerText="All users missed this session",a.append(s)}else t.forEach(s=>{let n=e.cloneNode(!0);n.setAttribute("id",""),n.style.display="flex",n.querySelector("#attended-name").innerText=s.name,a.append(n)});e.remove()}function X(t){let a=document.getElementById("missed-container"),e=a.querySelector("#missed-item");if(t.length===0){let s=document.createElement("p");s.style.color="black",s.innerText="No users missed this session",a.append(s)}else t.forEach(s=>{let n=e.cloneNode(!0);n.setAttribute("id",""),n.style.display="flex",n.querySelector("#missed-name").innerText=s.name,a.append(n)});e.remove()}function v(t){f({baseElement:document.getElementById("btn-container"),TriggerBtn:"edit-users-btn",_modalWindow:"edit-user-popout"},()=>{d=t,E(t)}),h({TriggerBtn:"close-edit-user-btn",_modalWindow:"edit-user-popout"})}function E(t){let a=document.getElementById("session-current-user-container"),e=a.querySelector("#session-current-user-item");a.querySelectorAll(".summary-user-details.selected").forEach((n,o)=>{o!==0&&n.remove()}),t.forEach(n=>{let o=e.cloneNode(!0);o.setAttribute("id",""),o.style.display="flex",n.attended||(o.style.backgroundColor="#ff634e",o.querySelector("#session-current-user-delete-btn").style.filter="grayscale(1)"),n.profile_picture&&(o.querySelector("#session-current-user-pfp").style.backgroundImage=`url(${n.profile_picture.url})`),o.querySelector("#session-current-user-name").innerText=n.name,o.querySelector("#session-current-user-delete-btn").onclick=()=>{d=d.filter(i=>i.user_id!==n.user_id),E(d)},a.append(o)}),e.style.display="none"}function H(t){let e=document.getElementById("edit-user-popout").querySelector("#search-item-container"),s=e.querySelector("#search-item");function n(o){if(e.querySelectorAll(".summary-user-details.search-item").forEach((r,l)=>{l!==0&&r.remove()}),o.length===0){let r=document.createElement("p");r.style.color="black",r.innerText="No users with this name found",r.classList.add("summary-user-details","search-item"),r.style.display="flex",e.append(r)}else o.forEach(r=>{let l=s.cloneNode(!0);l.setAttribute("id",""),l.style.display="flex",r.profile_picture&&(l.querySelector("#search-item-pfp").style.backgroundImage=`url(${r.profile_picture.url})`),l.querySelector("#search-item-name").innerText=r.name,l.onclick=()=>{let c;d.some((L,b)=>{if(L.user_id===r.user_id)return c=b,!0})?(d[c].attended=!0,E(d)):(r.attended=!0,d.push(r),E(d)),l.remove()},e.append(l)})}n(t),s.style.display="none"}function K(t,a){f({baseElement:document.getElementById("btn-container"),TriggerBtn:"add-coach-btn",_modalWindow:"add-coach-popout"},()=>{let e=document.getElementById("coach-form-block"),s=e.querySelector("#second-coach-select");if(t.team_id){let o=e.querySelector("#coach-already-added-text");o.innerText=`Coach ${t.name} already added`,o.classList.remove("hide")}function n(){return N(this,null,function*(){let o=yield _(w,"GET",!1,a);if(o.isFetchOk!==void 0&&!o.isFetchOk){console.error(o.message),m(`${u}?reason=NOT_SIGNED_IN`);return}y(s),o.forEach(i=>{var r=document.createElement("option");r.value=i.id,r.innerHTML=i.name,s.appendChild(r)}),s.removeEventListener("focus",n)})}s.addEventListener("focus",n)}),h({TriggerBtn:"close-add-coach-btn",_modalWindow:"add-coach-popout"})}function P(t){f({baseElement:document.getElementById("btn-container"),TriggerBtn:"add-notes-btn",_modalWindow:"add-notes-popout"},()=>{F(t)}),h({TriggerBtn:"close-add-notes-btn",_modalWindow:"add-notes-popout"})}function F(t){let a=document.getElementById("comments");t&&(a.value=t)}var G=D||[];G.push(function(){$(document).off("submit"),$("form").on("submit",function(t){return N(this,null,function*(){t.preventDefault();let a=$(this);if(a.attr("id")==="coach-form-block"){let e=document.getElementById("second-coach-submit-btn");e&&(e.disabled=!0);let s=p();if(s){let n=document.getElementById("second-coach-select"),o={name:n.options[n.selectedIndex].text,coach_id:parseInt(n.value)},i=yield _(C+A,"POST",o,s);if(i.isFetchOk!==void 0&&!i.isFetchOk){console.error(i.message),a.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("There was an error trying to add the second coach. Please refresh your browser and try again."),e&&(e.disabled=!1);return}a.hide().siblings(".w-form-done").show().siblings(".w-form-fail").hide(),x()}else m(`${u}?reason=NOT_SIGNED_IN`)}else if(a.attr("id")==="notes-form-block"){let e=document.getElementById("submit-comments-btn");e&&(e.disabled=!0);let s=p();if(s){let o={comment:document.getElementById("comments").value},i=yield _(U+A,"POST",o,s);if(i.isFetchOk!==void 0&&!i.isFetchOk){console.error(i.message),a.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Failed to add comment. Please refresh your browser and try again."),e&&(e.disabled=!1);return}x()}else m(`${u}?reason=NOT_SIGNED_IN`)}else if(a.attr("id")==="search-form-block"){let e=p();if(e){let o=document.getElementById("edit-user-popout").querySelector("#search-input").value;if(o.length===0)return;let i={search_query:`${o}:*`},r=yield _(T+o,"POST",i,e);if(r.isFetchOk!==void 0&&!r.isFetchOk){console.error(r.message),a.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Oops, that user may not exist! Just to be safe, please try again after refreshing your browser.");return}H(r)}else m(`${u}?reason=NOT_SIGNED_IN`)}else if(a.attr("id")==="update-session-form-block"){let e=document.getElementById("update-session-btn");e&&(e.disabled=!0);let s=p();if(s){let n={};n.items=[...d.map(i=>({user_id:i.user_id,attended:i.attended}))];let o=yield _(I+A,"POST",n,s);if(o.isFetchOk!==void 0&&!o.isFetchOk){console.error(o.message),a.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("There was an error trying to update the session. Please refresh your browser and try again."),e&&(e.disabled=!1);return}a.hide().siblings(".w-form-done").show().siblings(".w-form-fail").hide(),x()}else m(`${u}?reason=NOT_SIGNED_IN`)}})})});
