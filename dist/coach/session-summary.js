var A=(t,o,e)=>new Promise((a,s)=>{var n=r=>{try{i(e.next(r))}catch(c){s(c)}},l=r=>{try{i(e.throw(r))}catch(c){s(c)}},i=r=>r.done?a(r.value):Promise.resolve(r.value).then(n,l);i((e=e.apply(t,o)).next())});function m(t,o="GET",e=!1,a=!1,s=!1,n=!0){try{let l={"Content-Type":"application/json"};s&&(l={}),a&&(l.Authorization=`Bearer ${a}`);let i={method:o,headers:l};return e&&(n?i.body=JSON.stringify(e):i.body=e),fetch(t,i).then(r=>r.ok?r.json():r.json().then(c=>(Promise.reject(c.message),{isFetchOk:!1,status:r.status,message:c.message,payload:c&&c.payload?c.payload:null}))).then(r=>r).catch(r=>(console.error("Error in fetch",r),r))}catch(l){return console.error("Error!: "+l),l}}function _(t="nammax_auth"){let e=`; ${document.cookie}`.split(`; ${t}=`);return e.length===2?e.pop().split(";").shift():null}function u(t="/",o=0){setTimeout(()=>{window.location.href=t},o)}function E(t=null,o=!1){if(t==null)return"NaN";var e=new Date(t),a=e.getHours(),s=a>=12?"PM":"AM";if(a=a%12||12,o){var n=e.getMinutes();return n=n<10?`0${n}`:n,`${a}:${n} ${s}`}else return`${a} ${s}`}function g(t=null){if(t==null)return"NaN";t=t*60;let o=`${t/60^0}`.slice(-2),e=("0"+t%60).slice(-2);return o!="0"?e!="00"?`${o} HR ${e} M`:o+" HR":e+" Mins"}function R(t,o=null){if(t!=null){var e,a=t.options.length-1;for(e=a;e>=0;e--)e!==o&&t.remove(e)}}function x({single:t=!0,baseElement:o="",TriggerBtn:e="jsModalOpen",_modalWindow:a="jsModal"},s){if(t){var n=o.querySelector("#"+e);n.onclick=function(){var r=document.getElementById(a);s&&s(),r.classList?r.classList.add("open"):r.className+=" open"}}else for(var l=document.getElementsByClassName(e),i=0;i<l.length;i++)l[i].onclick=function(){var r=this.getAttribute("href").substr(1),c=document.getElementById(r);c.classList?c.classList.add("open"):c.className+=" open"}}function N({TriggerBtn:t="jsModalClose",_modalWindow:o="jsModal"},e){var a=document.getElementById(t),s=document.getElementById(o);a.onclick=function(){s.classList?s.classList.remove("open"):s.className=s.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," ")},e&&e()}var h="/coach/sign-in",S="/coach/dashboard";var y="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/coach/all_coaches",O="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/coach/session_summary/",I="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/coach/session_summary/search/",w="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/coach/session_summary/comments/",U="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/coach/session_summary/update_coach/";var p,d=[];window.onload=function(){let t=_();t?L(t):u(`${h}?reason=NOT_SIGNED_IN`)};function L(t){return A(this,null,function*(){var n;var o=new URL(document.location.href);p=o.searchParams.get("session"),p||u(S);let e=yield m(O+p,"GET",!1,t);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message);return}if(e.status!=="COMPLETED"){console.error("Session hasnt been completed yet!"),u(S);return}let a=[],s=[];(n=e==null?void 0:e.users)==null||n.forEach(l=>{l.attended?a.push(l):s.push(l)}),b(e,a.length),B(a),M(s),k(e.users),X(e.secondary_coach,t),H(e.comments,t)})}function b(t,o){var n,l,i;let e=document.getElementById("header-container");e.querySelector("#session-name").innerText=t.session_name,e.querySelector("#start-time").innerText=(n=E(t.start_time,!0))!=null?n:"NaN",e.querySelector("#date").innerText=new Date(t.time).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"}),e.querySelector("#gym-location").innerText=t.location,e.querySelector("#duration").innerText=g(t.duration);let a=new Date(t.end_time).getHours()-new Date(t.start_time).getHours(),s=(new Date(t.end_time).getMinutes()-new Date(t.start_time).getMinutes())/60;e.querySelector("#actual-duration").innerText=g(parseFloat(a)+parseFloat(s)),e.querySelector("#users-attended").innerText=o,e.querySelector("#users-missed").innerText=((l=t==null?void 0:t.users)==null?void 0:l.length)-o,e.querySelector("#end-time").innerText=(i=E(t.end_time,!0))!=null?i:"NaN"}function B(t){let o=document.getElementById("attended-container"),e=o.querySelector("#attended-item");if(t.length===0){let a=document.createElement("p");a.style.color="black",a.innerText="All users missed this session",o.append(a)}else t.forEach(a=>{let s=e.cloneNode(!0);s.setAttribute("id",""),s.style.display="flex",s.querySelector("#attended-name").innerText=a.name,o.append(s)});e.remove()}function M(t){let o=document.getElementById("missed-container"),e=o.querySelector("#missed-item");if(t.length===0){let a=document.createElement("p");a.style.color="black",a.innerText="No users missed this session",o.append(a)}else t.forEach(a=>{let s=e.cloneNode(!0);s.setAttribute("id",""),s.style.display="flex",s.querySelector("#missed-name").innerText=a.name,o.append(s)});e.remove()}function k(t){x({baseElement:document.getElementById("btn-container"),TriggerBtn:"edit-users-btn",_modalWindow:"edit-user-popout"},()=>{d=t,f(t)}),N({TriggerBtn:"close-edit-user-btn",_modalWindow:"edit-user-popout"})}function f(t){let o=document.getElementById("session-current-user-container"),e=o.querySelector("#session-current-user-item");o.querySelectorAll(".summary-user-details.selected").forEach((s,n)=>{n!==0&&s.remove()}),t.forEach(s=>{let n=e.cloneNode(!0);n.setAttribute("id",""),n.style.display="flex",s.attended||(n.style.backgroundColor="#ff634e",n.querySelector("#session-current-user-delete-btn").style.filter="grayscale(1)"),s.profile_picture&&(n.querySelector("#session-current-user-pfp").style.backgroundImage=`url(${s.profile_picture.url})`),n.querySelector("#session-current-user-name").innerText=s.name,n.querySelector("#session-current-user-delete-btn").onclick=()=>{d=d.filter(l=>l.user_id!==s.user_id),f(d)},o.append(n)}),e.style.display="none"}function v(t){let e=document.getElementById("edit-user-popout").querySelector("#search-item-container"),a=e.querySelector("#search-item");function s(n){if(e.querySelectorAll(".summary-user-details.search-item").forEach((i,r)=>{r!==0&&i.remove()}),n.length===0){let i=document.createElement("p");i.style.color="black",i.innerText="No users with this name found",i.classList.add("summary-user-details","search-item"),i.style.display="flex",e.append(i)}else n.forEach(i=>{let r=a.cloneNode(!0);r.setAttribute("id",""),r.style.display="flex",i.profile_picture&&(r.querySelector("#search-item-pfp").style.backgroundImage=`url(${i.profile_picture.url})`),r.querySelector("#search-item-name").innerText=i.name,r.onclick=()=>{let c;d.some((T,D)=>{if(T.user_id===i.user_id)return c=D,!0})?(d[c].attended=!0,f(d)):(i.attended=!0,d.push(i),f(d)),r.remove()},e.append(r)})}s(t),a.style.display="none"}function X(t,o){x({baseElement:document.getElementById("btn-container"),TriggerBtn:"add-coach-btn",_modalWindow:"add-coach-popout"},()=>{let e=document.getElementById("coach-form-block"),a=e.querySelector("#second-coach-select");if(t.team_id){let n=e.querySelector("#coach-already-added-text");n.innerText=`Coach ${t.name} already added`,n.classList.remove("hide")}function s(){return A(this,null,function*(){let n=yield m(y,"GET",!1,o);if(n.isFetchOk!==void 0&&!n.isFetchOk){console.error(n.message),u(`${h}?reason=NOT_SIGNED_IN`);return}R(a),n.forEach(l=>{var i=document.createElement("option");i.value=l.id,i.innerHTML=l.name,a.appendChild(i)}),a.removeEventListener("focus",s)})}a.addEventListener("focus",s)}),N({TriggerBtn:"close-add-coach-btn",_modalWindow:"add-coach-popout"})}function H(t){x({baseElement:document.getElementById("btn-container"),TriggerBtn:"add-notes-btn",_modalWindow:"add-notes-popout"},()=>{P(t)}),N({TriggerBtn:"close-add-notes-btn",_modalWindow:"add-notes-popout"})}function P(t){let o=document.getElementById("comments");t&&(o.value=t)}var C=C||[];C.push(function(){$(document).off("submit"),$("form").on("submit",function(t){return A(this,null,function*(){t.preventDefault();let o=$(this);if(o.attr("id")==="coach-form-block"){let e=_();if(e){let a=document.getElementById("second-coach-select"),s={name:a.options[a.selectedIndex].text,coach_id:parseInt(a.value)},n=yield m(U+p,"POST",s,e);if(n.isFetchOk!==void 0&&!n.isFetchOk){console.error(n.message),o.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("There was an error trying to add the second coach. Please refresh your browser and try again.");return}o.hide().siblings(".w-form-done").show().siblings(".w-form-fail").hide(),window.location.reload()}}else if(o.attr("id")==="notes-form-block"){let e=_();if(e){let s={comment:document.getElementById("comments").value},n=yield m(w+p,"POST",s,e);if(n.isFetchOk!==void 0&&!n.isFetchOk){console.error(n.message),u(`${h}?reason=NOT_SIGNED_IN`);return}window.location.reload()}else o.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Failed to add comment. Please refresh your browser and try again.")}else if(o.attr("id")==="search-form-block"){let e=_();if(e){let n=document.getElementById("edit-user-popout").querySelector("#search-input").value;if(n.length===0)return;let l={search_query:`${n}:*`},i=yield m(I+n,"POST",l,e);if(i.isFetchOk!==void 0&&!i.isFetchOk){console.error(i.message),o.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Oops, that user may not exist! Just to be safe, please try again after refreshing your browser.");return}v(i)}else o.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Please fill out all fields")}else if(o.attr("id")==="update-session-form-block"){let e=_();if(e){let a={};a.items=[...d.map(n=>({user_id:n.user_id,attended:n.attended}))];let s=yield m(O+p,"POST",a,e);if(s.isFetchOk!==void 0&&!s.isFetchOk){console.error(s.message),o.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("There was an error trying to update the session. Please refresh your browser and try again.");return}o.hide().siblings(".w-form-done").show().siblings(".w-form-fail").hide(),window.location.reload()}else o.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Please fill out all fields")}})})});
