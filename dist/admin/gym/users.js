var D=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var L=(t,n)=>{var e={};for(var o in t)P.call(t,o)&&n.indexOf(o)<0&&(e[o]=t[o]);if(t!=null&&D)for(var o of D(t))n.indexOf(o)<0&&$.call(t,o)&&(e[o]=t[o]);return e};var u=(t,n,e)=>new Promise((o,a)=>{var _=i=>{try{r(e.next(i))}catch(s){a(s)}},l=i=>{try{r(e.throw(i))}catch(s){a(s)}},r=i=>i.done?o(i.value):Promise.resolve(i.value).then(_,l);r((e=e.apply(t,n)).next())});var m={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function h(t,n="GET",e=!1,o=!1,a=!1,_=!0){try{let l={"Content-Type":"application/json"};a&&(l={}),o&&(l.Authorization=`Bearer ${o}`);let r={method:n,headers:l};return e&&(_?r.body=JSON.stringify(e):r.body=e),fetch(t,r).then(i=>i.ok?i.json():i.json().then(s=>(Promise.reject(s.message),{isFetchOk:!1,status:i.status,message:s.message,payload:s&&s.payload?s.payload:null}))).then(i=>i).catch(i=>(console.error("Error in fetch",i),i))}catch(l){return console.error("Error!: "+l),l}}function g(t="nammax_auth"){let e=`; ${document.cookie}`.split(`; ${t}=`);return e.length===2?e.pop().split(";").shift():null}function A(t="/",n=0){setTimeout(()=>{window.location.href=t},n)}function T(t=null){if(t==null)return"NaN";let n=t.split("-"),e=Date.now()-new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])).getTime(),o=new Date(e);return Math.abs(o.getUTCFullYear()-1970)}function C(t="/admin/sign-in",n="sidebar-logout-btn"){let e=document.getElementById(n);e?e.onclick=()=>G(t):console.error("Logout button not found")}function G(t="/sign-in"){window.localStorage.removeItem("auth"),A(`${t}`)}function w(t=m.ADMIN){if(t===m.ADMIN){let n=document.getElementById("admin-nav"),e=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),e&&e.remove()}else if(t===m.SUPER_ADMIN){let n=document.getElementById("admin-nav"),e=document.getElementById("super-admin-nav");e&&(e.style.display="flex"),n&&n.remove()}}function B(t){if(!t)return console.error("url does not cotnain gym id");let n=document.getElementById("navbar-home"),e=document.getElementById("navbar-finance"),o=document.getElementById("navbar-users"),a=document.getElementById("navbar-sessions");n&&n.setAttribute("href",`/admin/gym/g?gymCode=${t}`),e&&e.setAttribute("href",`/admin/gym/finance?gymCode=${t}`),o&&o.setAttribute("href",`/admin/gym/users?gymCode=${t}`),a&&a.setAttribute("href",`/admin/gym/sessions?gymCode=${t}`)}function M(t){if(!t)return console.error("gym data not found");let n=document.getElementById("gym-code-location"),e=document.getElementById("header-address"),o=document.getElementById("header-partner"),a=document.getElementById("header-contact"),_=document.getElementById("header-email");n&&(n.innerText=`${t.code} \u2022 ${t.location}`),e&&(e.innerText=t.address),o&&(o.innerText=t.partner),a&&(a.innerText=t.contact),_&&(_.innerText=t.partner_email)}function k({mode:t="API",clientObjRefName:n="name",data:e,token:o,API:a,extraXanoInputObj:_=[],searchContainerElId:l=""},r,i=null,s=null){let c,S,x;if(l.length>0){let E=document.getElementById(l);c=E.querySelector("#search-input"),c.setAttribute("placeholder","Search"),S=E.querySelector("#search-btn"),x=E.querySelector("#search-reset-btn")}else c=document.getElementById("search-input"),c.setAttribute("placeholder","Search"),S=document.getElementById("search-btn"),x=document.getElementById("search-reset-btn");x.onclick=()=>{c.value="",b(x,{mode:t,clientObjRefName:n,data:e,searchquery:"",token:o,API:a,extraXanoInputObj:_},r,i,s)},S.onclick=()=>{let E=c.value;b(x,{mode:t,clientObjRefName:n,data:e,searchquery:E,token:o,API:a,extraXanoInputObj:_},r,i,s)}}function b(S,x,E,rt,lt){return u(this,arguments,function*(t,{mode:n,clientObjRefName:e,data:o,searchquery:a,token:_,API:l,extraXanoInputObj:r=[]},i,s,c){if(a.length===0)t.style.display="none",s?i(o,s):i(o);else try{if(n==="API"){let p={search_query:`${a}:*`};r.length>0&&r.map(v=>{for(let[K,H]of Object.entries(v))p[K]=H});let d=yield h(l+"query","POST",p,_);if(d.isFetchOk!==void 0&&!d.isFetchOk)throw console.error(d.message),Error("API call failed");t.style.display="flex",s?i(d,s):i(d)}else{let p=o.filter(d=>d[e].toLowerCase().includes(a.toLowerCase()));t.style.display="flex",s?i(p,s):i(p)}}catch(p){c?c():console.error(p)}})}var R="/admin/sign-in";var I="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/users/";var X="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/users/search/";var N,U=null,O=0,f=[];window.onload=function(){return u(this,null,function*(){C("/admin/sign-in","sidebar-logout-btn");var t=new URL(document.location.href);if(N=t.searchParams.get("gymCode")||null,N)B(N);else{console.error("No gym id found");return}let n=g();if(n){let o=yield h(I+N+"/1","GET",!1,n);if(o.isFetchOk!==void 0&&!o.isFetchOk){console.error(o.message),A(`${R}?reason=NOT_SIGNED_IN`);return}let e=o,{team_role:a}=e,_=L(e,["team_role"]);a&&(a===m.SUPER_ADMIN||a===m.ADMIN)?(w(a),F(_,n)):A(`${R}?reason=UNAUTHORIZED_USER`)}else A(`${R}?reason=NOT_SIGNED_IN`)})};function F(t,n){return u(this,null,function*(){let{users:e,gym:o}=t;o&&M(o),y(e),W(e,o),k({data:e,token:n,API:X,extraXanoInputObj:[{gym_id:N}]},y,o.code)})}function W(t,n){document.getElementById("total-capacity").innerText=n.capacity,document.getElementById("total-users").innerText=t.items.length,document.getElementById("active-sessions").innerText=n.sessions.length}function y(t,n=!1){let e=document.getElementById("table-container"),o=e.querySelector("#table-item");function a(_){U=_.nextPage;let l=e.querySelectorAll(".adb-user.w-inline-block");l.forEach((r,i)=>{i!==l.length-1&&r.remove()}),f.items.forEach((r,i)=>{let s=o.cloneNode(!0);s.setAttribute("id",""),s.setAttribute("href",`/admin/user?userId=${r.id}`);let c=s.querySelectorAll(".colcontent");i%2===0&&(s.style.backgroundColor="#00edf4"),r.profile_picture&&(c[0].style.backgroundImage=`url(${r.profile_picture.url})`),c[1].innerText=r.name,c[2].innerText=`Ends on ${r.membership_end_date}`||"INACTIVE",c[3].innerText=r.gender,c[4].innerText=T(r.date_of_birth),s.style.display="flex",e.prepend(s)})}n?(f.items.push(...t.items),f.nextPage=t.nextPage):f=t,a(f),o.style.display="none"}var Y=new IntersectionObserver(t=>{t[0].intersectionRatio<=0||(O>0&&U?q(U):O<1&&O++)});Y.observe(document.querySelector(".loadmore"));function q(t){return u(this,null,function*(){let n=g();if(n){let e=yield h(I+N+`/${t}`,"GET",!1,n);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===m.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?A(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}y(e.users,!0)}})}
