var S=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var I=(t,n)=>{var e={};for(var o in t)K.call(t,o)&&n.indexOf(o)<0&&(e[o]=t[o]);if(t!=null&&S)for(var o of S(t))n.indexOf(o)<0&&v.call(t,o)&&(e[o]=t[o]);return e};var N=(t,n,e)=>new Promise((o,s)=>{var _=i=>{try{l(e.next(i))}catch(a){s(a)}},r=i=>{try{l(e.throw(i))}catch(a){s(a)}},l=i=>i.done?o(i.value):Promise.resolve(i.value).then(_,r);l((e=e.apply(t,n)).next())});var A={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function h(t,n="GET",e=!1,o=!1,s=!1,_=!0){try{let r={"Content-Type":"application/json"};s&&(r={}),o&&(r.Authorization=`Bearer ${o}`);let l={method:n,headers:r};return e&&(_?l.body=JSON.stringify(e):l.body=e),fetch(t,l).then(i=>i.ok?i.json():i.json().then(a=>(Promise.reject(a.message),{isFetchOk:!1,status:i.status,message:a.message,payload:a&&a.payload?a.payload:null}))).then(i=>i).catch(i=>(console.error("Error in fetch",i),i))}catch(r){return console.error("Error!: "+r),r}}function O(t="nammax_auth"){let e=`; ${document.cookie}`.split(`; ${t}=`);return e.length===2?e.pop().split(";").shift():null}function x(t="/",n=0){setTimeout(()=>{window.location.href=t},n)}function g(t=null){if(t==null)return"NaN";let n=t.split("-"),e=Date.now()-new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])).getTime(),o=new Date(e);return Math.abs(o.getUTCFullYear()-1970)}function U(t="/admin/sign-in",n="sidebar-logout-btn"){let e=document.getElementById(n);e?e.onclick=()=>H(t):console.error("Logout button not found")}function H(t="/sign-in"){window.localStorage.removeItem("auth"),x(`${t}`)}function y(t=A.ADMIN){if(t===A.ADMIN){let n=document.getElementById("admin-nav"),e=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),e&&e.remove()}else if(t===A.SUPER_ADMIN){let n=document.getElementById("admin-nav"),e=document.getElementById("super-admin-nav");e&&(e.style.display="flex"),n&&n.remove()}}function D(t){if(!t)return console.error("url does not cotnain gym id");let n=document.getElementById("navbar-home"),e=document.getElementById("navbar-finance"),o=document.getElementById("navbar-users"),s=document.getElementById("navbar-sessions");n&&n.setAttribute("href",`/admin/gym/g?gymCode=${t}`),e&&e.setAttribute("href",`/admin/gym/finance?gymCode=${t}`),o&&o.setAttribute("href",`/admin/gym/users?gymCode=${t}`),s&&s.setAttribute("href",`/admin/gym/sessions?gymCode=${t}`)}function L(t){if(!t)return console.error("gym data not found");let n=document.getElementById("gym-code-location"),e=document.getElementById("header-address"),o=document.getElementById("header-partner"),s=document.getElementById("header-contact"),_=document.getElementById("header-email");n&&(n.innerText=`${t.code} \u2022 ${t.location}`),e&&(e.innerText=t.address),o&&(o.innerText=t.partner),s&&(s.innerText=t.contact),_&&(_.innerText=t.partner_email)}function C({mode:t="API",clientObjRefName:n="name",data:e,token:o,API:s,extraXanoInputObj:_=[],searchContainerElId:r=""},l,i=null,a=null){let c,f,d;if(r.length>0){let u=document.getElementById(r);c=u.querySelector("#search-input"),c.setAttribute("placeholder","Search"),f=u.querySelector("#search-btn"),d=u.querySelector("#search-reset-btn")}else c=document.getElementById("search-input"),c.setAttribute("placeholder","Search"),f=document.getElementById("search-btn"),d=document.getElementById("search-reset-btn");d.onclick=()=>{c.value="",T(d,{mode:t,clientObjRefName:n,data:e,searchquery:"",token:o,API:s,extraXanoInputObj:_},l,i,a)},f.onclick=()=>{let u=c.value;T(d,{mode:t,clientObjRefName:n,data:e,searchquery:u,token:o,API:s,extraXanoInputObj:_},l,i,a)}}function T(f,d,u,nt,ot){return N(this,arguments,function*(t,{mode:n,clientObjRefName:e,data:o,searchquery:s,token:_,API:r,extraXanoInputObj:l=[]},i,a,c){if(s.length===0)t.style.display="none",a?i(o,a):i(o);else try{if(n==="API"){let m={search_query:`${s}:*`};l.length>0&&l.map(b=>{for(let[k,X]of Object.entries(b))m[k]=X});let p=yield h(r+"query","POST",m,_);if(p.isFetchOk!==void 0&&!p.isFetchOk)throw console.error(p.message),Error("API call failed");t.style.display="flex",a?i(p,a):i(p)}else{let m=o.filter(p=>p[e].toLowerCase().includes(s.toLowerCase()));t.style.display="flex",a?i(m,a):i(m)}}catch(m){c?c():console.error(m)}})}var R="/admin/sign-in";var w="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/users/";var B="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/users/search/";var E;window.onload=function(){return N(this,null,function*(){U("/admin/sign-in","sidebar-logout-btn");var t=new URL(document.location.href);if(E=t.searchParams.get("gymCode")||null,E)D(E);else{console.error("No gym id found");return}let n=O();if(n){let o=yield h(w+E,"GET",!1,n);if(o.isFetchOk!==void 0&&!o.isFetchOk){console.error(o.message),x(`${R}?reason=NOT_SIGNED_IN`);return}let e=o,{team_role:s}=e,_=I(e,["team_role"]);s&&(s===A.SUPER_ADMIN||s===A.ADMIN)?(y(s),P(_,n)):x(`${R}?reason=UNAUTHORIZED_USER`)}else x(`${R}?reason=NOT_SIGNED_IN`)})};function P(t,n){return N(this,null,function*(){let{users:e,gym:o}=t;o&&L(o),M(e),$(e,o),C({data:e,token:n,API:B,extraXanoInputObj:[{gym_id:E}]},M,o.code)})}function $(t,n){document.getElementById("total-capacity").innerText=n.capacity,document.getElementById("total-users").innerText=t.length,document.getElementById("active-sessions").innerText=n.sessions.length}function M(t){let n=document.getElementById("table-container"),e=n.querySelector("#table-item");function o(s){let _=n.querySelectorAll(".adb-user.w-inline-block");_.forEach((r,l)=>{l!==_.length-1&&r.remove()}),s.forEach((r,l)=>{let i=e.cloneNode(!0);i.setAttribute("id",""),i.setAttribute("href",`/admin/user?userId=${r.id}`);let a=i.querySelectorAll(".colcontent");l%2===0&&(i.style.backgroundColor="#00edf4"),r.profile_picture&&(a[0].style.backgroundImage=`url(${r.profile_picture.url})`),a[1].innerText=r.name,a[2].innerText=`Ends on ${r.membership_end_date}`||"INACTIVE",a[3].innerText=r.gender,a[4].innerText=g(r.date_of_birth),i.style.display="flex",n.prepend(i)})}o(t),e.style.display="none"}
