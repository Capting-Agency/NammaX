var T=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var L=(e,n)=>{var t={};for(var o in e)G.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(e!=null&&T)for(var o of T(e))n.indexOf(o)<0&&k.call(e,o)&&(t[o]=e[o]);return t};var A=(e,n,t)=>new Promise((o,r)=>{var c=a=>{try{s(t.next(a))}catch(i){r(i)}},_=a=>{try{s(t.throw(a))}catch(i){r(i)}},s=a=>a.done?o(a.value):Promise.resolve(a.value).then(c,_);s((t=t.apply(e,n)).next())});var p={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function h(e,n="GET",t=!1,o=!1,r=!1,c=!0){try{let _={"Content-Type":"application/json"};r&&(_={}),o&&(_.Authorization=`Bearer ${o}`);let s={method:n,headers:_};return t&&(c?s.body=JSON.stringify(t):s.body=t),fetch(e,s).then(a=>a.ok?a.json():a.json().then(i=>(Promise.reject(i.message),{isFetchOk:!1,status:a.status,message:i.message,payload:i&&i.payload?i.payload:null}))).then(a=>a).catch(a=>(console.error("Error in fetch",a),a))}catch(_){return console.error("Error!: "+_),_}}function S(e="nammax_auth"){let t=`; ${document.cookie}`.split(`; ${e}=`);return t.length===2?t.pop().split(";").shift():null}function N(e="/",n=2e3){setTimeout(()=>{window.location.href=e},n)}function M(e=null){if(e==null)return"NaN";let n=e.split("-"),t=Date.now()-new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])).getTime(),o=new Date(t);return Math.abs(o.getUTCFullYear()-1970)}function B(e="/admin/sign-in",n="sidebar-logout-btn"){let t=document.getElementById(n);t?t.onclick=()=>F(e):console.error("Logout button not found")}function F(e="/sign-in"){window.localStorage.removeItem("auth"),N(`${e}`)}function b(e=p.ADMIN){if(e===p.ADMIN){let n=document.getElementById("admin-nav"),t=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),t&&t.remove()}else if(e===p.SUPER_ADMIN){let n=document.getElementById("admin-nav"),t=document.getElementById("super-admin-nav");t&&(t.style.display="flex"),n&&n.remove()}}function X(e){if(!e)return console.error("url does not cotnain gym id");let n=document.getElementById("navbar-home"),t=document.getElementById("navbar-finance"),o=document.getElementById("navbar-users"),r=document.getElementById("navbar-sessions");n&&n.setAttribute("href",`/admin/gym/g?gymCode=${e}`),t&&t.setAttribute("href",`/admin/gym/finance?gymCode=${e}`),o&&o.setAttribute("href",`/admin/gym/users?gymCode=${e}`),r&&r.setAttribute("href",`/admin/gym/sessions?gymCode=${e}`)}function w(e){if(!e)return console.error("gym data not found");let n=document.getElementById("gym-code-location"),t=document.getElementById("header-address"),o=document.getElementById("header-partner"),r=document.getElementById("header-contact"),c=document.getElementById("header-email");n&&(n.innerText=`${e.code} \u2022 ${e.location}`),t&&(t.innerText=e.address),o&&(o.innerText=e.partner),r&&(r.innerText=e.contact),c&&(c.innerText=e.partner_email)}function j(){let e=document.getElementById("loading-screen");e?e.remove():console.log("did not find loading screen")}function C(e){let n=new Date(e);return n.setMinutes(n.getMinutes()-n.getTimezoneOffset()),n}function O(e,n,t=!1){let o=864e5;return Math.round((C(n)-C(e))/o)}function K({mode:e="API",clientObjRefName:n="name",data:t,token:o,API:r,extraXanoInputObj:c=[],searchContainerElId:_=""},s,a=null,i=null){let l,u,m;if(_.length>0){let E=document.getElementById(_);l=E.querySelector("#search-input"),l.setAttribute("placeholder","Search"),u=E.querySelector("#search-btn"),m=E.querySelector("#search-reset-btn")}else l=document.getElementById("search-input"),l.setAttribute("placeholder","Search"),u=document.getElementById("search-btn"),m=document.getElementById("search-reset-btn");m.onclick=()=>{l.value="",z(m,{mode:e,clientObjRefName:n,data:t,searchquery:"",token:o,API:r,extraXanoInputObj:c},s,a,i)},u.onclick=()=>{let E=l.value;z(m,{mode:e,clientObjRefName:n,data:t,searchquery:E,token:o,API:r,extraXanoInputObj:c},s,a,i)}}function z(u,m,E,ce,me){return A(this,arguments,function*(e,{mode:n,clientObjRefName:t,data:o,searchquery:r,token:c,API:_,extraXanoInputObj:s=[]},a,i,l){if(r.length===0)e.style.display="none",i?a(o,i):a(o);else try{if(n==="API"){let d={search_query:`${r}:*`};s.length>0&&s.map(v=>{for(let[$,P]of Object.entries(v))d[$]=P});let x=yield h(_+"query","POST",d,c);if(x.isFetchOk!==void 0&&!x.isFetchOk)throw console.error(x.message),Error("API call failed");e.style.display="flex",i?a(x,i):a(x)}else{let d=o.filter(x=>x[t].toLowerCase().includes(r.toLowerCase()));e.style.display="flex",i?a(d,i):a(d)}}catch(d){l?l():console.error(d)}})}var R="/admin/sign-in";var I="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/admin/users/";var H="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/admin/users/search/";var f,U=null,D=0,g=[];window.onload=function(){return A(this,null,function*(){B("/admin/sign-in","sidebar-logout-btn");var e=new URL(document.location.href);if(f=e.searchParams.get("gymCode")||null,f)X(f);else{console.error("No gym id found");return}let n=S();if(n){let o=yield h(I+f+"/1","GET",!1,n);if(o.isFetchOk!==void 0&&!o.isFetchOk){console.error(o.message),N(`${R}?reason=NOT_SIGNED_IN`);return}let t=o,{team_role:r}=t,c=L(t,["team_role"]);r&&(r===p.SUPER_ADMIN||r===p.ADMIN)?(b(r),W(c,n)):N(`${R}?reason=UNAUTHORIZED_USER`)}else N(`${R}?reason=NOT_SIGNED_IN`)})};function W(e,n){return A(this,null,function*(){let{users:t,gym:o}=e;o&&w(o),y(t),Y(t,o),K({data:t,token:n,API:H,extraXanoInputObj:[{gym_id:f}]},y,o.code),j()})}function Y(e,n){document.getElementById("total-capacity").innerText=n.capacity,document.getElementById("total-users").innerText=e.items.length,document.getElementById("active-sessions").innerText=n.sessions.length}function y(e,n=!1){let t=document.getElementById("table-container"),o=t.querySelector("#table-item");function r(c){U=c.nextPage;let _=t.querySelectorAll(".adb-user.w-inline-block");_.forEach((s,a)=>{a!==_.length-1&&s.remove()}),g.items.forEach((s,a)=>{let i=o.cloneNode(!0);i.setAttribute("id",""),i.setAttribute("href",`/admin/user?userId=${s.id}`);let l=i.querySelectorAll(".colcontent");if(a%2===0&&(i.style.backgroundColor="#00edf4"),s.profile_picture&&(l[0].style.backgroundImage=`url(${s.profile_picture.url})`),s!=null&&s.membership_end_date){let u=new Date(s.membership_end_date),m=new Date;(s==null?void 0:s.session_ledger)!==void 0&&s.session_ledger.length<=3?l[0].style.border="3px solid #009ca1":O(m,u,!0)<=3?l[0].style.border="3px solid red":O(m,u,!0)<=7&&(l[0].style.border="3px solid orange")}l[1].innerText=s.name,l[2].innerText=s.membership_end_date?`Ends on ${s.membership_end_date}`:"INACTIVE",l[3].innerText=s.gender,l[4].innerText=M(s.date_of_birth),i.style.display="flex",t.prepend(i)})}n?(g.items.push(...e.items),g.nextPage=e.nextPage):g=e,r(g),o.style.display="none"}var q=new IntersectionObserver(e=>{e[0].intersectionRatio<=0||(D>0&&U?J(U):D<1&&D++)});q.observe(document.querySelector(".loadmore"));function J(e){return A(this,null,function*(){let n=S();if(n){let t=yield h(I+f+`/${e}`,"GET",!1,n);if(t.isFetchOk!==void 0&&!t.isFetchOk){console.error(t.message),t.payload&&t.payload.role===p.ADMIN&&t.payload.gyms&&t.payload.gyms.length>0?N(`/admin/gym/g?gymCode=${t.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}y(t.users,!0)}})}
