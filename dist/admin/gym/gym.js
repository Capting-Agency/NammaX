var j=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var z=(e,n)=>{var o={};for(var s in e)se.call(e,s)&&n.indexOf(s)<0&&(o[s]=e[s]);if(e!=null&&j)for(var s of j(e))n.indexOf(s)<0&&re.call(e,s)&&(o[s]=e[s]);return o};var y=(e,n,o)=>new Promise((s,l)=>{var m=t=>{try{a(o.next(t))}catch(r){l(r)}},i=t=>{try{a(o.throw(t))}catch(r){l(r)}},a=t=>t.done?s(t.value):Promise.resolve(t.value).then(m,i);a((o=o.apply(e,n)).next())});var K=["Male","Female","Other","Prefer not to say"];var C=["January","February","March","April","May","June","July","August","September","October","November","December"],S={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"},h=["DROPOUT","NO SHOW","NEW USER","TRIAL","NO RENEWAL","NO MEMBERSHIP"];function O(e,n="GET",o=!1,s=!1,l=!1,m=!0){try{let i={"Content-Type":"application/json"};l&&(i={}),s&&(i.Authorization=`Bearer ${s}`);let a={method:n,headers:i};return o&&(m?a.body=JSON.stringify(o):a.body=o),fetch(e,a).then(t=>t.ok?t.json():t.json().then(r=>(Promise.reject(r.message),{isFetchOk:!1,status:t.status,message:r.message,payload:r&&r.payload?r.payload:null}))).then(t=>t).catch(t=>(console.error("Error in fetch",t),t))}catch(i){return console.error("Error!: "+i),i}}function P(e="nammax_auth"){let o=`; ${document.cookie}`.split(`; ${e}=`);return o.length===2?o.pop().split(";").shift():null}function D(e="/",n=2e3){setTimeout(()=>{window.location.href=e},n)}function F(e=null,n=!1,o=!1,s=!1){if(e==null)return"NaN";let l=new Date,m=new Date(e),i=m.getHours(),a="";if(s||(a=i>=12?"PM":"AM",i=i%12||12),n){let t=m.getMinutes();return t=t<10?`0${t}`:t,o?`${l.getDate()===m.getDate()?"Today At":l.getDate()+1===m.getDate()?"Tomorrow At":l.getDate()+2===m.getDate()?"Day After Tomorrow At":R(e)} ${i}:${t} ${a}`:`${i}:${t} ${a}`}else return o?`${l.getDate()===m.getDate()?"Today At":l.getDate()+1===m.getDate()?"Tomorrow At":l.getDate()+2===m.getDate()?"Day After Tomorrow At":R(e)} ${i} ${a}`:`${R(e)} ${i} ${a}`}function R(e=null){if(e==null)return"NaN";let n=new Date(e);return`${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()}`}function G(e=null){if(e==null)return"NaN";let n=e.split("-"),o=Date.now()-new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])).getTime(),s=new Date(o);return Math.abs(s.getUTCFullYear()-1970)}function k(e,n=null){if(e!=null){var o,s=e.options.length-1;for(o=s;o>=0;o--)o!==n&&e.remove(o)}}function q(e="/admin/sign-in",n="sidebar-logout-btn"){let o=document.getElementById(n);o?o.onclick=()=>ae(e):console.error("Logout button not found")}function ae(e="/sign-in"){window.localStorage.removeItem("auth"),D(`${e}`)}function T(e=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(e)).replace(/^(\D+)/,"$1 ")}function W(e=new Date,n=0){let o=e;return o&&o.setDate(o.getDate()+n),o}function Y(e=S.ADMIN){if(e===S.ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),o&&o.remove()}else if(e===S.SUPER_ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),n&&n.remove()}}function V(e){if(!e)return console.error("url does not cotnain gym id");let n=document.getElementById("navbar-home"),o=document.getElementById("navbar-finance"),s=document.getElementById("navbar-users"),l=document.getElementById("navbar-sessions");n&&n.setAttribute("href",`/admin/gym/g?gymCode=${e}`),o&&o.setAttribute("href",`/admin/gym/finance?gymCode=${e}`),s&&s.setAttribute("href",`/admin/gym/users?gymCode=${e}`),l&&l.setAttribute("href",`/admin/gym/sessions?gymCode=${e}`)}function J(e){if(!e)return console.error("gym data not found");let n=document.getElementById("gym-code-location"),o=document.getElementById("header-address"),s=document.getElementById("header-partner"),l=document.getElementById("header-contact"),m=document.getElementById("header-email");n&&(n.innerText=`${e.code} \u2022 ${e.location}`),o&&(o.innerText=e.address),s&&(s.innerText=e.partner),l&&(l.innerText=e.contact),m&&(m.innerText=e.partner_email)}function Z(){let e=document.getElementById("loading-screen");e?e.remove():console.log("did not find loading screen")}function H(e){let n=new Date(e);return n.setMinutes(n.getMinutes()-n.getTimezoneOffset()),n}function L(e,n,o=!1){let s=864e5;return Math.round((H(n)-H(e))/s)}var U="/admin/sign-in",Q="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/admin/gyms/";var ee="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/admin/sessions/search/",b="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/admin/users/search/";function B({mode:e="API",clientObjRefName:n="name",data:o,token:s,API:l,extraXanoInputObj:m=[],searchContainerElId:i=""},a,t=null,r=null){let _,u,x;if(i.length>0){let c=document.getElementById(i);_=c.querySelector("#search-input"),_.setAttribute("placeholder","Search"),u=c.querySelector("#search-btn"),x=c.querySelector("#search-reset-btn")}else _=document.getElementById("search-input"),_.setAttribute("placeholder","Search"),u=document.getElementById("search-btn"),x=document.getElementById("search-reset-btn");x.onclick=()=>{_.value="",te(x,{mode:e,clientObjRefName:n,data:o,searchquery:"",token:s,API:l,extraXanoInputObj:m},a,t,r)},u.onclick=()=>{let c=_.value;te(x,{mode:e,clientObjRefName:n,data:o,searchquery:c,token:s,API:l,extraXanoInputObj:m},a,t,r)}}function te(u,x,c,p,f){return y(this,arguments,function*(e,{mode:n,clientObjRefName:o,data:s,searchquery:l,token:m,API:i,extraXanoInputObj:a=[]},t,r,_){if(l.length===0)e.style.display="none",r?t(s,r):t(s);else try{if(n==="API"){let d={search_query:`${l}:*`};a.length>0&&a.map(N=>{for(let[E,I]of Object.entries(N))d[E]=I});let A=yield O(i+"query","POST",d,m);if(A.isFetchOk!==void 0&&!A.isFetchOk)throw console.error(A.message),Error("API call failed");e.style.display="flex",r?t(A,r):t(A)}else{let d=s.filter(A=>A[o].toLowerCase().includes(l.toLowerCase()));e.style.display="flex",r?t(d,r):t(d)}}catch(d){_?_():console.error(d)}})}function M({tag:e="gym",API:n=null,parentTableName:o="user-table-subscription-header",tableColumnContainerName:s="user-table-gym-header",extraXanoInputObj:l=[],filterData:m=null,searchContainerElId:i=""},a,t){if(!m){console.error("No Filter Data provided");return}let r=document.getElementById(s);if(!r){console.error("Failed to find column container");return}let _=r.querySelector("#filter-search");if(!_){console.error("Failed to find column filter");return}le(s,_,m),r.onclick=p=>{p.stopPropagation(),_.style.display="block"};let u=_.querySelector("#close-btn");u?u.onclick=p=>{p.stopPropagation(),_.style.display="none"}:console.error("Failed to find close btn");let x=r.querySelector("#filter-btn");if(!x){console.error("Failed to find submit filter btn");return}x.onclick=()=>{let p=_.querySelector(`input[name="${s}"]:checked`).value,f;i.length>0?f=document.getElementById(i).querySelector("#search-input"):f=document.getElementById("search-input"),ie(e,p,n,t,a,f.value,o,s,_,l)};let c=r.querySelector("#reset-filter-btn");if(!c){console.error("Failed to find reset filter btn");return}c.onclick=p=>{p.stopPropagation(),ne("","",n,t,a,"",l,!0),oe("hide",o,s,_)}}function ie(e,n,o,s,l,m,i,a,t,r){return y(this,null,function*(){ne(e,n,o,s,l,m,r),oe("show",i,a,t)})}function ne(t,r,_,u,x,c){return y(this,arguments,function*(e,n,o,s,l,m,i=[],a=!1){if(a){s&&s({isFilter:!0,filterQueries:{},API:o,isReset:a});return}let p={search_query:(m==null?void 0:m.length)>0?`${m}:*`:"",tag:e,filter:n||""};i.length>0&&i.map(f=>{for(let[d,A]of Object.entries(f))p[d]=A}),l=p,s&&s({isFilter:!0,filterQueries:l,API:o})})}function oe(e="show",n,o,s){let l=document.getElementById(n);if(!l){console.error("Could not find parent table name");return}if(l.querySelectorAll(".text-w").forEach(i=>{i.style.textDecoration="none"}),e==="show"){let i=document.getElementById(o);if(!i){console.error("Could not find column name");return}i.style.textDecoration="underline",s.querySelector("#reset-filter-btn").style.display="block"}else e==="hide"&&(s.querySelector("#reset-filter-btn").style.display="none");setTimeout(()=>{s.style.display="none"},500)}function le(e,n,o){let s=n.querySelector("label");o.forEach(l=>{let m=s.cloneNode(!0),i=m.querySelector("input"),a=m.querySelector("span");i.value=l.value,i.name=e,a.innerText=l.text,n.prepend(m)}),s.remove()}(()=>{let e,n;window.onload=function(){return y(this,null,function*(){q(U,"sidebar-logout-btn");var a=new URL(document.location.href);if(e=a.searchParams.get("gymCode")||null,e)V(e);else{console.error("No gym id found");return}let t=P();if(t){let _=yield O(Q+e,"GET",!1,t);if(_.isFetchOk!==void 0&&!_.isFetchOk){console.error(_.message);return}let r=_,{team_role:u}=r,x=z(r,["team_role"]);u&&(u===S.SUPER_ADMIN||u===S.ADMIN)?(Y(u),o(x,t)):D(`${U}?reason=UNAUTHORIZED_USER`)}else D(`${U}?reason=NOT_SIGNED_IN`)})};function o(a,t){return y(this,null,function*(){let{sessions:r,users:_,gym:u,finances:x,footfall:c}=a;u&&J(u);let p;n=x.some((d,A)=>{if(d.month===new Date().getMonth()+1)return p=A,!0})?x[p]:x[x.length-1],n===void 0&&(n=null),l(_,n,c),s(_,n,x,c),m(r.items,u.code),i(_),B({data:r,token:t,API:ee,extraXanoInputObj:[{gym_id:e}]},m,u.code),B({data:_,token:t,API:b,searchContainerElId:"user-search-container",extraXanoInputObj:[{gym_id:e}]},i,u.code),M({tag:"subscription",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-subscription-header",filterData:h.map(d=>({text:d,value:d})),extraXanoInputObj:[{gym_id:e}],token:t,API:b},i),M({tag:"gender",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gender-header",filterData:K.map(d=>({text:d,value:d})),extraXanoInputObj:[{gym_id:e}],token:t,API:b},i),Z()})}function s(a,t,r,_){let u=document.getElementById("select-month");k(u),r.forEach((x,c)=>{var p=document.createElement("option");p.value=c,p.innerText=C[x.month-1]+", "+x.year,x.month===t.month&&(p.selected=!0),u.appendChild(p)}),u.onchange=x=>{t=r[x.target.value],t===void 0&&(t=null),l(a,t,_)}}function l(a=[],t=[],r=0){var _;t?(document.getElementById("gym-statistics-month-year").innerText=C[t.month-1]+" "+t.year,document.getElementById("financial-expenses").innerText=T(Number(t.additional_expenses)),document.getElementById("financial-revenue").innerText=T(Number(t.gross_revenue)+Number(t.additional_revenue)),document.getElementById("financial-profit").innerText=T(t.net_profit),document.getElementById("gym-statistics-total-members").innerText=(_=a==null?void 0:a.items)==null?void 0:_.length,$("#gym-statistics-completed-sessions").text(r||0),$("#gym-statistics-active-members").text(a.items.filter(u=>u.membership_status!=="INACTIVE").length)):(document.getElementById("gym-statistics-month-year").innerText="This months data not found",document.getElementById("financial-expenses").innerText="No data found",document.getElementById("financial-revenue").innerText="No data found",document.getElementById("financial-profit").innerText="No data found")}function m(a,t){let r=document.getElementById("sessions-container"),_=r.querySelector("#table-item");function u(x){let c=r.querySelectorAll(".adb-user.w-inline-block");c.forEach((p,f)=>{f!==c.length-1&&p.remove()}),x.forEach((p,f)=>{var N,E;let d=_.cloneNode(!0);d.setAttribute("id",""),d.setAttribute("href",`/admin/session?sessionId=${p.id}`);let A=d.querySelectorAll(".colcontent");f%2===0&&(d.style.backgroundColor="#00edf4"),A[1].innerText=p.session_name,A[2].innerText=p.name||"-",A[3].innerText=t,A[4].innerText=R(p.time),A[5].innerText=F(p.time,!0),A[6].innerText=(E=(N=p==null?void 0:p.users)==null?void 0:N.length)!=null?E:0,A[7].innerText=p.status,d.style.display="flex",r.prepend(d)})}u(a),_.style.display="none"}function i(a){let t=document.getElementById("users-container"),r=t.querySelector("#table-item");function _(u){let x=t.querySelectorAll(".adb-user.w-inline-block");x.forEach((c,p)=>{p!==x.length-1&&c.remove()}),u.items.forEach((c,p)=>{let f=r.cloneNode(!0);f.setAttribute("id",""),f.setAttribute("href",`/admin/user?userId=${c.id}`),p%2===0&&(f.style.backgroundColor="#00edf4");let d=f.querySelectorAll(".colcontent");if(c.profile_picture&&(d[0].style.backgroundImage=`url(${c.profile_picture.url})`),c.membership_end_date){let X=new Date(c.membership_end_date),v=new Date;(c==null?void 0:c.session_ledger)!==void 0&&c.session_ledger.length<=3?d[0].style.border="3px solid #009ca1":L(v,X,!0)<=3?d[0].style.border="3px solid red":L(v,X,!0)<=7&&(d[0].style.border="3px solid orange")}d[1].innerText=c.name;let A=W(new Date(c.created_at),7),N=new Date().getTime(),E=c.tokens,I=c.session_ledger.length,w=c.membership_end_date?new Date(c.membership_end_date).getTime():null,g="";E===2&&I===0?A.getTime()<N?g=h[0]:g=h[2]:E===0&&I===0?A.getTime()>N?g=h[1]:g=h[2]:E===1&&I===1?g=h[3]:c.membership_status!=="TRIAL"&&I>0&&A.getTime()>N&&w<=N?g=h[4]:w<N&&(g=h[5]),d[2].innerText=g||c.membership_status||"INACTIVE",d[3].innerText=c.gender||"Unselected",d[4].innerText=G(c.date_of_birth),c.session_ledger.length>0?d[5].innerText=R(c.session_ledger[c.session_ledger.length-1].time):d[5].innerText="N/A",f.style.display="flex",t.prepend(f)})}_(a),r.style.display="none"}})();
