var T=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var D=(t,o)=>{var n={};for(var a in t)W.call(t,a)&&o.indexOf(a)<0&&(n[a]=t[a]);if(t!=null&&T)for(var a of T(t))o.indexOf(a)<0&&Y.call(t,a)&&(n[a]=t[a]);return n};var E=(t,o,n)=>new Promise((a,m)=>{var u=e=>{try{s(n.next(e))}catch(i){m(i)}},A=e=>{try{s(n.throw(e))}catch(i){m(i)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(u,A);s((n=n.apply(t,o)).next())});var y=["January","February","March","April","May","June","July","August","September","October","November","December"],h={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function S(t,o="GET",n=!1,a=!1,m=!1,u=!0){try{let A={"Content-Type":"application/json"};m&&(A={}),a&&(A.Authorization=`Bearer ${a}`);let s={method:o,headers:A};return n&&(u?s.body=JSON.stringify(n):s.body=n),fetch(t,s).then(e=>e.ok?e.json():e.json().then(i=>(Promise.reject(i.message),{isFetchOk:!1,status:e.status,message:i.message,payload:i&&i.payload?i.payload:null}))).then(e=>e).catch(e=>(console.error("Error in fetch",e),e))}catch(A){return console.error("Error!: "+A),A}}function C(t="nammax_auth"){let n=`; ${document.cookie}`.split(`; ${t}=`);return n.length===2?n.pop().split(";").shift():null}function g(t="/",o=0){setTimeout(()=>{window.location.href=t},o)}function L(t=null,o=!1){if(t==null)return"NaN";var n=new Date(t),a=n.getHours(),m=a>=12?"PM":"AM";if(a=a%12||12,o){var u=n.getMinutes();return u=u<10?`0${u}`:u,`${a}:${u} ${m}`}else return`${a} ${m}`}function w(t=null){if(t==null)return"NaN";let o=new Date(t);return`${o.getDate()}/${o.getMonth()+1}/${o.getFullYear()}`}function M(t=null){if(t==null)return"NaN";let o=t.split("-"),n=Date.now()-new Date(parseInt(o[2]),parseInt(o[1])-1,parseInt(o[0])).getTime(),a=new Date(n);return Math.abs(a.getUTCFullYear()-1970)}function B(t,o=null){if(t!=null){var n,a=t.options.length-1;for(n=a;n>=0;n--)n!==o&&t.remove(n)}}function b(t="/admin/sign-in",o="sidebar-logout-btn"){let n=document.getElementById(o);n?n.onclick=()=>q(t):console.error("Logout button not found")}function q(t="/sign-in"){window.localStorage.removeItem("auth"),g(`${t}`)}function R(t=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(t)).replace(/^(\D+)/,"$1 ")}function k(t=h.ADMIN){if(t===h.ADMIN){let o=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),n&&n.remove()}else if(t===h.SUPER_ADMIN){let o=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),o&&o.remove()}}function X(t){if(!t)return console.error("url does not cotnain gym id");let o=document.getElementById("navbar-home"),n=document.getElementById("navbar-finance"),a=document.getElementById("navbar-users"),m=document.getElementById("navbar-sessions");o&&o.setAttribute("href",`/admin/gym/g?gymCode=${t}`),n&&n.setAttribute("href",`/admin/gym/finance?gymCode=${t}`),a&&a.setAttribute("href",`/admin/gym/users?gymCode=${t}`),m&&m.setAttribute("href",`/admin/gym/sessions?gymCode=${t}`)}function v(t){if(!t)return console.error("gym data not found");let o=document.getElementById("gym-code-location"),n=document.getElementById("header-address"),a=document.getElementById("header-partner"),m=document.getElementById("header-contact"),u=document.getElementById("header-email");o&&(o.innerText=`${t.code} \u2022 ${t.location}`),n&&(n.innerText=t.address),a&&(a.innerText=t.partner),m&&(m.innerText=t.contact),u&&(u.innerText=t.partner_email)}var O="/admin/sign-in",K="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/gyms/";var H="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/sessions/search/",P="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/users/search/";function U({mode:t="API",clientObjRefName:o="name",data:n,token:a,API:m,extraXanoInputObj:u=[],searchContainerElId:A=""},s,e=null,i=null){let l,c,_;if(A.length>0){let r=document.getElementById(A);l=r.querySelector("#search-input"),l.setAttribute("placeholder","Search"),c=r.querySelector("#search-btn"),_=r.querySelector("#search-reset-btn")}else l=document.getElementById("search-input"),l.setAttribute("placeholder","Search"),c=document.getElementById("search-btn"),_=document.getElementById("search-reset-btn");_.onclick=()=>{l.value="",G(_,{mode:t,clientObjRefName:o,data:n,searchquery:"",token:a,API:m,extraXanoInputObj:u},s,e,i)},c.onclick=()=>{let r=l.value;G(_,{mode:t,clientObjRefName:o,data:n,searchquery:r,token:a,API:m,extraXanoInputObj:u},s,e,i)}}function G(c,_,r,d,N){return E(this,arguments,function*(t,{mode:o,clientObjRefName:n,data:a,searchquery:m,token:u,API:A,extraXanoInputObj:s=[]},e,i,l){if(m.length===0)t.style.display="none",i?e(a,i):e(a);else try{if(o==="API"){let p={search_query:`${m}:*`};s.length>0&&s.map(f=>{for(let[I,F]of Object.entries(f))p[I]=F});let x=yield S(A+"query","POST",p,u);if(x.isFetchOk!==void 0&&!x.isFetchOk)throw console.error(x.message),Error("API call failed");t.style.display="flex",i?e(x,i):e(x)}else{let p=a.filter(x=>x[n].toLowerCase().includes(m.toLowerCase()));t.style.display="flex",i?e(p,i):e(p)}}catch(p){l?l():console.error(p)}})}(()=>{let t,o;window.onload=function(){return E(this,null,function*(){b(O,"sidebar-logout-btn");var s=new URL(document.location.href);if(t=s.searchParams.get("gymCode")||null,t)X(t);else{console.error("No gym id found");return}let e=C();if(e){let l=yield S(K+t,"GET",!1,e);if(l.isFetchOk!==void 0&&!l.isFetchOk){console.error(l.message);return}let i=l,{team_role:c}=i,_=D(i,["team_role"]);c&&(c===h.SUPER_ADMIN||c===h.ADMIN)?(k(c),n(_,e)):g(`${O}?reason=UNAUTHORIZED_USER`)}else g(`${O}?reason=NOT_SIGNED_IN`)})};function n(s,e){return E(this,null,function*(){let{sessions:i,users:l,gym:c,finances:_}=s;c&&v(c);let r;o=_.some((N,p)=>{if(N.month===new Date().getMonth()+1)return r=p,!0})?_[r]:_[_.length-1],o===void 0&&(o=null),m(l,o,i),a(l,o,_,i),u(i,c.code),A(l),U({data:i,token:e,API:H,extraXanoInputObj:[{gym_id:t}]},u,c.code),U({data:l,token:e,API:P,searchContainerElId:"user-search-container",extraXanoInputObj:[{gym_id:t}]},A,c.code)})}function a(s,e,i,l){let c=document.getElementById("select-month");B(c),i.forEach((_,r)=>{var d=document.createElement("option");d.value=r,d.innerText=y[_.month-1]+", "+_.year,_.month===e.month&&(d.selected=!0),c.appendChild(d)}),c.onchange=_=>{e=i[_.target.value],e===void 0&&(e=null),m(s,e,l)}}function m(s=[],e=[],i=[]){if(!e)document.getElementById("gym-statistics-month-year").innerText="This months data not found",document.getElementById("financial-expenses").innerText="No data found",document.getElementById("financial-revenue").innerText="No data found",document.getElementById("financial-profit").innerText="No data found";else{document.getElementById("gym-statistics-month-year").innerText=y[e.month-1]+" "+e.year,document.getElementById("financial-expenses").innerText=R(Number(e.additional_expenses)),document.getElementById("financial-revenue").innerText=R(Number(e.gross_revenue)+Number(e.additional_revenue)),document.getElementById("financial-profit").innerText=R(e.net_profit),document.getElementById("gym-statistics-total-members").innerText=s==null?void 0:s.length;let l=new Date().getMonth(),c=new Date().getFullYear(),_=i==null?void 0:i.filter(r=>new Date(r.time).getMonth()===l&&new Date(r.time).getFullYear()===c&&r.status==="COMPLETED");$("#gym-statistics-completed-sessions").text(_.length||0),$("#gym-statistics-active-members").text(s.filter(r=>r.membership_status!=="INACTIVE"&&r.membership_status!=="TRIAL").length)}}function u(s,e){let i=document.getElementById("sessions-container"),l=i.querySelector("#table-item");function c(_){let r=i.querySelectorAll(".adb-user.w-inline-block");r.forEach((d,N)=>{N!==r.length-1&&d.remove()}),_.forEach((d,N)=>{var f,I;let p=l.cloneNode(!0);p.setAttribute("id",""),p.setAttribute("href",`/admin/session?sessionId=${d.id}`);let x=p.querySelectorAll(".colcontent");N%2===0&&(p.style.backgroundColor="#00edf4"),x[1].innerText=d.session_name,x[2].innerText=d.name||"Unknown",x[3].innerText=e,x[4].innerText=w(d.time),x[5].innerText=L(d.time,!0),x[6].innerText=(I=(f=d==null?void 0:d.users)==null?void 0:f.length)!=null?I:0,x[7].innerText=d.status,p.style.display="flex",i.prepend(p)})}c(s),l.style.display="none"}function A(s){let e=document.getElementById("users-container"),i=e.querySelector("#table-item");function l(c){let _=e.querySelectorAll(".adb-user.w-inline-block");_.forEach((r,d)=>{d!==_.length-1&&r.remove()}),c.forEach((r,d)=>{let N=i.cloneNode(!0);N.setAttribute("id",""),N.setAttribute("href",`/admin/user?userId=${r.id}`),d%2===0&&(N.style.backgroundColor="#00edf4");let p=N.querySelectorAll(".colcontent");r.profile_picture&&(p[0].style.backgroundImage=`url(${r.profile_picture.url})`),p[1].innerText=r.name,p[2].innerText=r.membership_status||"INACTIVE",p[3].innerText=r.gender,p[4].innerText=M(r.date_of_birth),N.style.display="flex",e.prepend(N)})}l(s),i.style.display="none"}})();
