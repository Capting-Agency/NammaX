var B=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var M=(e,n)=>{var o={};for(var s in e)ee.call(e,s)&&n.indexOf(s)<0&&(o[s]=e[s]);if(e!=null&&B)for(var s of B(e))n.indexOf(s)<0&&te.call(e,s)&&(o[s]=e[s]);return o};var h=(e,n,o)=>new Promise((s,c)=>{var _=t=>{try{l(o.next(t))}catch(i){c(i)}},a=t=>{try{l(o.throw(t))}catch(i){c(i)}},l=t=>t.done?s(t.value):Promise.resolve(t.value).then(_,a);l((o=o.apply(e,n)).next())});var w=["Male","Female","Other","Prefer not to say"];var U=["January","February","March","April","May","June","July","August","September","October","November","December"],g={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"},X=["DROPOUT","NO SHOW","NEW USER","TRIAL","NO RENEWAL","NO MEMBERSHIP"];function y(e,n="GET",o=!1,s=!1,c=!1,_=!0){try{let a={"Content-Type":"application/json"};c&&(a={}),s&&(a.Authorization=`Bearer ${s}`);let l={method:n,headers:a};return o&&(_?l.body=JSON.stringify(o):l.body=o),fetch(e,l).then(t=>t.ok?t.json():t.json().then(i=>(Promise.reject(i.message),{isFetchOk:!1,status:t.status,message:i.message,payload:i&&i.payload?i.payload:null}))).then(t=>t).catch(t=>(console.error("Error in fetch",t),t))}catch(a){return console.error("Error!: "+a),a}}function j(e="nammax_auth"){let o=`; ${document.cookie}`.split(`; ${e}=`);return o.length===2?o.pop().split(";").shift():null}function I(e="/",n=2e3){setTimeout(()=>{window.location.href=e},n)}function H(e=null,n=!1,o=!1,s=!1){if(e==null)return"NaN";let c=new Date,_=new Date(e),a=_.getHours(),l="";if(s||(l=a>=12?"PM":"AM",a=a%12||12),n){let t=_.getMinutes();return t=t<10?`0${t}`:t,o?`${c.getDate()===_.getDate()?"Today":c.getDate()+1===_.getDate()?"Tomorrow":c.getDate()+2===_.getDate()?"Day After Tomorrow":S(e)} ${a}:${t} ${l}`:`${a}:${t} ${l}`}else return o?`${c.getDate()===_.getDate()?"Today":c.getDate()+1===_.getDate()?"Tomorrow":c.getDate()+2===_.getDate()?"Day After Tomorrow":S(e)} ${a} ${l}`:`${S(e)} ${a} ${l}`}function S(e=null){if(e==null)return"NaN";let n=new Date(e);return`${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()}`}function z(e=null){if(e==null)return"NaN";let n=e.split("-"),o=Date.now()-new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])).getTime(),s=new Date(o);return Math.abs(s.getUTCFullYear()-1970)}function K(e,n=null){if(e!=null){var o,s=e.options.length-1;for(o=s;o>=0;o--)o!==n&&e.remove(o)}}function P(e="/admin/sign-in",n="sidebar-logout-btn"){let o=document.getElementById(n);o?o.onclick=()=>ne(e):console.error("Logout button not found")}function ne(e="/sign-in"){window.localStorage.removeItem("auth"),I(`${e}`)}function O(e=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(e)).replace(/^(\D+)/,"$1 ")}function k(e=new Date,n=0){let o=e;return o&&o.setDate(o.getDate()+n),o}function F(e=g.ADMIN){if(e===g.ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),o&&o.remove()}else if(e===g.SUPER_ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),n&&n.remove()}}function G(e){if(!e)return console.error("url does not cotnain gym id");let n=document.getElementById("navbar-home"),o=document.getElementById("navbar-finance"),s=document.getElementById("navbar-users"),c=document.getElementById("navbar-sessions");n&&n.setAttribute("href",`/admin/gym/g?gymCode=${e}`),o&&o.setAttribute("href",`/admin/gym/finance?gymCode=${e}`),s&&s.setAttribute("href",`/admin/gym/users?gymCode=${e}`),c&&c.setAttribute("href",`/admin/gym/sessions?gymCode=${e}`)}function q(e){if(!e)return console.error("gym data not found");let n=document.getElementById("gym-code-location"),o=document.getElementById("header-address"),s=document.getElementById("header-partner"),c=document.getElementById("header-contact"),_=document.getElementById("header-email");n&&(n.innerText=`${e.code} \u2022 ${e.location}`),o&&(o.innerText=e.address),s&&(s.innerText=e.partner),c&&(c.innerText=e.contact),_&&(_.innerText=e.partner_email)}function W(){let e=document.getElementById("loading-screen");e?e.remove():console.log("did not find loading screen")}function v(e){let n=new Date(e);return n.setMinutes(n.getMinutes()-n.getTimezoneOffset()),n}function b(e,n,o=!1){let s=864e5;return Math.round((v(n)-v(e))/s)}var D="/admin/sign-in",Y="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/admin/gyms/";var J="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/admin/sessions/search/",T="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/admin/users/search/";function C({mode:e="API",clientObjRefName:n="name",data:o,token:s,API:c,extraXanoInputObj:_=[],searchContainerElId:a=""},l,t=null,i=null){let m,u,x;if(a.length>0){let r=document.getElementById(a);m=r.querySelector("#search-input"),m.setAttribute("placeholder","Search"),u=r.querySelector("#search-btn"),x=r.querySelector("#search-reset-btn")}else m=document.getElementById("search-input"),m.setAttribute("placeholder","Search"),u=document.getElementById("search-btn"),x=document.getElementById("search-reset-btn");x.onclick=()=>{m.value="",V(x,{mode:e,clientObjRefName:n,data:o,searchquery:"",token:s,API:c,extraXanoInputObj:_},l,t,i)},u.onclick=()=>{let r=m.value;V(x,{mode:e,clientObjRefName:n,data:o,searchquery:r,token:s,API:c,extraXanoInputObj:_},l,t,i)}}function V(u,x,r,d,f){return h(this,arguments,function*(e,{mode:n,clientObjRefName:o,data:s,searchquery:c,token:_,API:a,extraXanoInputObj:l=[]},t,i,m){if(c.length===0)e.style.display="none",i?t(s,i):t(s);else try{if(n==="API"){let p={search_query:`${c}:*`};l.length>0&&l.map(N=>{for(let[E,R]of Object.entries(N))p[E]=R});let A=yield y(a+"query","POST",p,_);if(A.isFetchOk!==void 0&&!A.isFetchOk)throw console.error(A.message),Error("API call failed");e.style.display="flex",i?t(A,i):t(A)}else{let p=s.filter(A=>A[o].toLowerCase().includes(c.toLowerCase()));e.style.display="flex",i?t(p,i):t(p)}}catch(p){m?m():console.error(p)}})}function L({tag:e="gym",API:n=null,parentTableName:o="user-table-subscription-header",tableColumnContainerName:s="user-table-gym-header",extraXanoInputObj:c=[],filterData:_=null,searchContainerElId:a="",token:l},t){if(!_){console.error("No Filter Data provided");return}let i=document.getElementById(s);if(!i){console.error("Failed to find column container");return}let m=i.querySelector("#filter-search");if(!m){console.error("Failed to find column filter");return}se(s,m,_),i.onclick=d=>{d.stopPropagation(),m.style.display="block"};let u=m.querySelector("#close-btn");u?u.onclick=d=>{d.stopPropagation(),m.style.display="none"}:console.error("Failed to find close btn");let x=i.querySelector("#filter-btn");if(!x){console.error("Failed to find submit filter btn");return}x.onclick=()=>{let d=m.querySelector(`input[name="${s}"]:checked`).value,f;a.length>0?f=document.getElementById(a).querySelector("#search-input"):f=document.getElementById("search-input"),oe(e,d,n,t,l,f.value,o,s,m,c)};let r=i.querySelector("#reset-filter-btn");if(!r){console.error("Failed to find reset filter btn");return}r.onclick=d=>{d.stopPropagation(),Q("","",n,t,l,"",c),Z("hide",o,s,m)}}function oe(e,n,o,s,c,_,a,l,t,i){return h(this,null,function*(){Q(e,n,o,s,c,_,i),Z("show",a,l,t)})}function Q(l,t,i,m,u,x){return h(this,arguments,function*(e,n,o,s,c,_,a=[]){let r={search_query:(_==null?void 0:_.length)>0?`${_}:*`:"",tag:e,filter:n||""};a.length>0&&a.map(f=>{for(let[p,A]of Object.entries(f))r[p]=A});let d=yield y(o+"query","POST",r,c);if(d.isFetchOk!==void 0&&!d.isFetchOk)throw console.error(d.message),Error("API call failed");s&&s(d)})}function Z(e="show",n,o,s){let c=document.getElementById(n);if(!c){console.error("Could not find parent table name");return}if(c.querySelectorAll(".text-w").forEach(a=>{a.style.textDecoration="none"}),e==="show"){let a=document.getElementById(o);if(!a){console.error("Could not find column name");return}a.style.textDecoration="underline",s.querySelector("#reset-filter-btn").style.display="block"}else e==="hide"&&(s.querySelector("#reset-filter-btn").style.display="none");setTimeout(()=>{s.style.display="none"},500)}function se(e,n,o){let s=n.querySelector("label");o.forEach(c=>{let _=s.cloneNode(!0),a=_.querySelector("input"),l=_.querySelector("span");a.value=c.value,a.name=e,l.innerText=c.text,n.prepend(_)}),s.remove()}(()=>{let e,n;window.onload=function(){return h(this,null,function*(){P(D,"sidebar-logout-btn");var l=new URL(document.location.href);if(e=l.searchParams.get("gymCode")||null,e)G(e);else{console.error("No gym id found");return}let t=j();if(t){let m=yield y(Y+e,"GET",!1,t);if(m.isFetchOk!==void 0&&!m.isFetchOk){console.error(m.message);return}let i=m,{team_role:u}=i,x=M(i,["team_role"]);u&&(u===g.SUPER_ADMIN||u===g.ADMIN)?(F(u),o(x,t)):I(`${D}?reason=UNAUTHORIZED_USER`)}else I(`${D}?reason=NOT_SIGNED_IN`)})};function o(l,t){return h(this,null,function*(){let{sessions:i,users:m,gym:u,finances:x,footfall:r}=l;u&&q(u);let d;n=x.some((p,A)=>{if(p.month===new Date().getMonth()+1)return d=A,!0})?x[d]:x[x.length-1],n===void 0&&(n=null),c(m,n,r),s(m,n,x,r),_(i.items,u.code),a(m),C({data:i,token:t,API:J,extraXanoInputObj:[{gym_id:e}]},_,u.code),C({data:m,token:t,API:T,searchContainerElId:"user-search-container",extraXanoInputObj:[{gym_id:e}]},a,u.code),L({tag:"subscription",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-subscription-header",filterData:X.map(p=>({text:p,value:p})),extraXanoInputObj:[{gym_id:e}],token:t,API:T},a),L({tag:"gender",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gender-header",filterData:w.map(p=>({text:p,value:p})),extraXanoInputObj:[{gym_id:e}],token:t,API:T},a),W()})}function s(l,t,i,m){let u=document.getElementById("select-month");K(u),i.forEach((x,r)=>{var d=document.createElement("option");d.value=r,d.innerText=U[x.month-1]+", "+x.year,x.month===t.month&&(d.selected=!0),u.appendChild(d)}),u.onchange=x=>{t=i[x.target.value],t===void 0&&(t=null),c(l,t,m)}}function c(l=[],t=[],i=0){var m;t?(document.getElementById("gym-statistics-month-year").innerText=U[t.month-1]+" "+t.year,document.getElementById("financial-expenses").innerText=O(Number(t.additional_expenses)),document.getElementById("financial-revenue").innerText=O(Number(t.gross_revenue)+Number(t.additional_revenue)),document.getElementById("financial-profit").innerText=O(t.net_profit),document.getElementById("gym-statistics-total-members").innerText=(m=l==null?void 0:l.items)==null?void 0:m.length,$("#gym-statistics-completed-sessions").text(i||0),$("#gym-statistics-active-members").text(l.items.filter(u=>u.membership_status!=="INACTIVE").length)):(document.getElementById("gym-statistics-month-year").innerText="This months data not found",document.getElementById("financial-expenses").innerText="No data found",document.getElementById("financial-revenue").innerText="No data found",document.getElementById("financial-profit").innerText="No data found")}function _(l,t){let i=document.getElementById("sessions-container"),m=i.querySelector("#table-item");function u(x){let r=i.querySelectorAll(".adb-user.w-inline-block");r.forEach((d,f)=>{f!==r.length-1&&d.remove()}),x.forEach((d,f)=>{var N,E;let p=m.cloneNode(!0);p.setAttribute("id",""),p.setAttribute("href",`/admin/session?sessionId=${d.id}`);let A=p.querySelectorAll(".colcontent");f%2===0&&(p.style.backgroundColor="#00edf4"),A[1].innerText=d.session_name,A[2].innerText=d.name||"-",A[3].innerText=t,A[4].innerText=S(d.time),A[5].innerText=H(d.time,!0),A[6].innerText=(E=(N=d==null?void 0:d.users)==null?void 0:N.length)!=null?E:0,A[7].innerText=d.status,p.style.display="flex",i.prepend(p)})}u(l),m.style.display="none"}function a(l){let t=document.getElementById("users-container"),i=t.querySelector("#table-item");function m(u){let x=t.querySelectorAll(".adb-user.w-inline-block");x.forEach((r,d)=>{d!==x.length-1&&r.remove()}),u.items.forEach((r,d)=>{let f=i.cloneNode(!0);f.setAttribute("id",""),f.setAttribute("href",`/admin/user?userId=${r.id}`),d%2===0&&(f.style.backgroundColor="#00edf4");let p=f.querySelectorAll(".colcontent");if(r.profile_picture&&(p[0].style.backgroundImage=`url(${r.profile_picture.url})`),r.membership_end_date){let E=new Date(r.membership_end_date),R=new Date;(r==null?void 0:r.session_ledger)!==void 0&&r.session_ledger.length<=3?p[0].style.border="3px solid #009ca1":b(R,E,!0)<=3?p[0].style.border="3px solid red":b(R,E,!0)<=7&&(p[0].style.border="3px solid orange")}p[1].innerText=r.name;let A=k(new Date(r.created_at),7),N="";r.tokens===2&&r.session_ledger.length===0&&A.getTime()<new Date().getTime()?N="DROPOUT":r.tokens===0&&r.session_ledger.length===0&&A.getTime()>new Date().getTime()?N="NO SHOW":r.tokens===2&&r.session_ledger.length===0?N="NEW USER":r.tokens===1&&r.session_ledger.length===1?N="TRIAL":r.membership_status!=="TRIAL"&&r.session_ledger.length>0&&A.getTime()>new Date().getTime()?N="NO RENEWAL":r.membership_end_date&&new Date(r.membership_end_date).getTime()<new Date().getTime()&&(N="NO MEMBERSHIP"),p[2].innerText=N||r.membership_status||"INACTIVE",p[3].innerText=r.gender,p[4].innerText=z(r.date_of_birth),r.session_ledger.length>0?p[5].innerText=S(r.session_ledger[r.session_ledger.length-1].time):p[5].innerText="N/A",f.style.display="flex",t.prepend(f)})}m(l),i.style.display="none"}})();
