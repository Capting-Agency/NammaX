var C=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var L=(e,n)=>{var o={};for(var i in e)j.call(e,i)&&n.indexOf(i)<0&&(o[i]=e[i]);if(e!=null&&C)for(var i of C(e))n.indexOf(i)<0&&z.call(e,i)&&(o[i]=e[i]);return o};var f=(e,n,o)=>new Promise((i,_)=>{var u=t=>{try{r(o.next(t))}catch(a){_(a)}},p=t=>{try{r(o.throw(t))}catch(a){_(a)}},r=t=>t.done?i(t.value):Promise.resolve(t.value).then(u,p);r((o=o.apply(e,n)).next())});var y=["January","February","March","April","May","June","July","August","September","October","November","December"],E={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function I(e,n="GET",o=!1,i=!1,_=!1,u=!0){try{let p={"Content-Type":"application/json"};_&&(p={}),i&&(p.Authorization=`Bearer ${i}`);let r={method:n,headers:p};return o&&(u?r.body=JSON.stringify(o):r.body=o),fetch(e,r).then(t=>t.ok?t.json():t.json().then(a=>(Promise.reject(a.message),{isFetchOk:!1,status:t.status,message:a.message,payload:a&&a.payload?a.payload:null}))).then(t=>t).catch(t=>(console.error("Error in fetch",t),t))}catch(p){return console.error("Error!: "+p),p}}function B(e="nammax_auth"){let o=`; ${document.cookie}`.split(`; ${e}=`);return o.length===2?o.pop().split(";").shift():null}function R(e="/",n=2e3){setTimeout(()=>{window.location.href=e},n)}function b(e=null,n=!1,o=!1,i=!1){if(e==null)return"NaN";let _=new Date,u=new Date(e),p=u.getHours(),r="";if(i||(r=p>=12?"PM":"AM",p=p%12||12),n){let t=u.getMinutes();return t=t<10?`0${t}`:t,o?`${_.getDate()===u.getDate()?"Today":_.getDate()+1===u.getDate()?"Tomorrow":_.getDate()+2===u.getDate()?"Day After Tomorrow":""} ${p}:${t} ${r}`:`${p}:${t} ${r}`}else return o?`${_.getDate()===u.getDate()?"Today":_.getDate()+1===u.getDate()?"Tomorrow":_.getDate()+2===u.getDate()?"Day After Tomorrow":""} ${p} ${r}`:`${p} ${r}`}function D(e=null){if(e==null)return"NaN";let n=new Date(e);return`${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()}`}function M(e=null){if(e==null)return"NaN";let n=e.split("-"),o=Date.now()-new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])).getTime(),i=new Date(o);return Math.abs(i.getUTCFullYear()-1970)}function k(e,n=null){if(e!=null){var o,i=e.options.length-1;for(o=i;o>=0;o--)o!==n&&e.remove(o)}}function X(e="/admin/sign-in",n="sidebar-logout-btn"){let o=document.getElementById(n);o?o.onclick=()=>J(e):console.error("Logout button not found")}function J(e="/sign-in"){window.localStorage.removeItem("auth"),R(`${e}`)}function S(e=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(e)).replace(/^(\D+)/,"$1 ")}function v(e=E.ADMIN){if(e===E.ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),o&&o.remove()}else if(e===E.SUPER_ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),n&&n.remove()}}function K(e){if(!e)return console.error("url does not cotnain gym id");let n=document.getElementById("navbar-home"),o=document.getElementById("navbar-finance"),i=document.getElementById("navbar-users"),_=document.getElementById("navbar-sessions");n&&n.setAttribute("href",`/admin/gym/g?gymCode=${e}`),o&&o.setAttribute("href",`/admin/gym/finance?gymCode=${e}`),i&&i.setAttribute("href",`/admin/gym/users?gymCode=${e}`),_&&_.setAttribute("href",`/admin/gym/sessions?gymCode=${e}`)}function H(e){if(!e)return console.error("gym data not found");let n=document.getElementById("gym-code-location"),o=document.getElementById("header-address"),i=document.getElementById("header-partner"),_=document.getElementById("header-contact"),u=document.getElementById("header-email");n&&(n.innerText=`${e.code} \u2022 ${e.location}`),o&&(o.innerText=e.address),i&&(i.innerText=e.partner),_&&(_.innerText=e.contact),u&&(u.innerText=e.partner_email)}function P(){let e=document.getElementById("loading-screen");e?e.remove():console.log("did not find loading screen")}function w(e){let n=new Date(e);return n.setMinutes(n.getMinutes()-n.getTimezoneOffset()),n}function U(e,n,o=!1){let i=864e5;return Math.round((w(n)-w(e))/i)}var O="/admin/sign-in",G="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/gyms/";var F="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/sessions/search/",W="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/users/search/";function T({mode:e="API",clientObjRefName:n="name",data:o,token:i,API:_,extraXanoInputObj:u=[],searchContainerElId:p=""},r,t=null,a=null){let l,m,d;if(p.length>0){let s=document.getElementById(p);l=s.querySelector("#search-input"),l.setAttribute("placeholder","Search"),m=s.querySelector("#search-btn"),d=s.querySelector("#search-reset-btn")}else l=document.getElementById("search-input"),l.setAttribute("placeholder","Search"),m=document.getElementById("search-btn"),d=document.getElementById("search-reset-btn");d.onclick=()=>{l.value="",Y(d,{mode:e,clientObjRefName:n,data:o,searchquery:"",token:i,API:_,extraXanoInputObj:u},r,t,a)},m.onclick=()=>{let s=l.value;Y(d,{mode:e,clientObjRefName:n,data:o,searchquery:s,token:i,API:_,extraXanoInputObj:u},r,t,a)}}function Y(m,d,s,A,N){return f(this,arguments,function*(e,{mode:n,clientObjRefName:o,data:i,searchquery:_,token:u,API:p,extraXanoInputObj:r=[]},t,a,l){if(_.length===0)e.style.display="none",a?t(i,a):t(i);else try{if(n==="API"){let c={search_query:`${_}:*`};r.length>0&&r.map(h=>{for(let[g,q]of Object.entries(h))c[g]=q});let x=yield I(p+"query","POST",c,u);if(x.isFetchOk!==void 0&&!x.isFetchOk)throw console.error(x.message),Error("API call failed");e.style.display="flex",a?t(x,a):t(x)}else{let c=i.filter(x=>x[o].toLowerCase().includes(_.toLowerCase()));e.style.display="flex",a?t(c,a):t(c)}}catch(c){l?l():console.error(c)}})}(()=>{let e,n;window.onload=function(){return f(this,null,function*(){X(O,"sidebar-logout-btn");var r=new URL(document.location.href);if(e=r.searchParams.get("gymCode")||null,e)K(e);else{console.error("No gym id found");return}let t=B();if(t){let l=yield I(G+e,"GET",!1,t);if(l.isFetchOk!==void 0&&!l.isFetchOk){console.error(l.message);return}let a=l,{team_role:m}=a,d=L(a,["team_role"]);m&&(m===E.SUPER_ADMIN||m===E.ADMIN)?(v(m),o(d,t)):R(`${O}?reason=UNAUTHORIZED_USER`)}else R(`${O}?reason=NOT_SIGNED_IN`)})};function o(r,t){return f(this,null,function*(){let{sessions:a,users:l,gym:m,finances:d,footfall:s}=r;m&&H(m);let A;n=d.some((c,x)=>{if(c.month===new Date().getMonth()+1)return A=x,!0})?d[A]:d[d.length-1],n===void 0&&(n=null),_(l,n,s),i(l,n,d,s),u(a.items,m.code),p(l.items),T({data:a,token:t,API:F,extraXanoInputObj:[{gym_id:e}]},u,m.code),T({data:l,token:t,API:W,searchContainerElId:"user-search-container",extraXanoInputObj:[{gym_id:e}]},p,m.code),P()})}function i(r,t,a,l){let m=document.getElementById("select-month");k(m),a.forEach((d,s)=>{var A=document.createElement("option");A.value=s,A.innerText=y[d.month-1]+", "+d.year,d.month===t.month&&(A.selected=!0),m.appendChild(A)}),m.onchange=d=>{t=a[d.target.value],t===void 0&&(t=null),_(r,t,l)}}function _(r=[],t=[],a=0){var l;t?(document.getElementById("gym-statistics-month-year").innerText=y[t.month-1]+" "+t.year,document.getElementById("financial-expenses").innerText=S(Number(t.additional_expenses)),document.getElementById("financial-revenue").innerText=S(Number(t.gross_revenue)+Number(t.additional_revenue)),document.getElementById("financial-profit").innerText=S(t.net_profit),document.getElementById("gym-statistics-total-members").innerText=(l=r==null?void 0:r.items)==null?void 0:l.length,$("#gym-statistics-completed-sessions").text(a||0),$("#gym-statistics-active-members").text(r.items.filter(m=>m.membership_status!=="INACTIVE"&&m.membership_status!=="TRIAL").length)):(document.getElementById("gym-statistics-month-year").innerText="This months data not found",document.getElementById("financial-expenses").innerText="No data found",document.getElementById("financial-revenue").innerText="No data found",document.getElementById("financial-profit").innerText="No data found")}function u(r,t){let a=document.getElementById("sessions-container"),l=a.querySelector("#table-item");function m(d){let s=a.querySelectorAll(".adb-user.w-inline-block");s.forEach((A,N)=>{N!==s.length-1&&A.remove()}),d.forEach((A,N)=>{var h,g;let c=l.cloneNode(!0);c.setAttribute("id",""),c.setAttribute("href",`/admin/session?sessionId=${A.id}`);let x=c.querySelectorAll(".colcontent");N%2===0&&(c.style.backgroundColor="#00edf4"),x[1].innerText=A.session_name,x[2].innerText=A.name||"-",x[3].innerText=t,x[4].innerText=D(A.time),x[5].innerText=b(A.time,!0),x[6].innerText=(g=(h=A==null?void 0:A.users)==null?void 0:h.length)!=null?g:0,x[7].innerText=A.status,c.style.display="flex",a.prepend(c)})}m(r),l.style.display="none"}function p(r){let t=document.getElementById("users-container"),a=t.querySelector("#table-item");function l(m){let d=t.querySelectorAll(".adb-user.w-inline-block");d.forEach((s,A)=>{A!==d.length-1&&s.remove()}),m.forEach((s,A)=>{let N=a.cloneNode(!0);N.setAttribute("id",""),N.setAttribute("href",`/admin/user?userId=${s.id}`),A%2===0&&(N.style.backgroundColor="#00edf4");let c=N.querySelectorAll(".colcontent");if(s.profile_picture&&(c[0].style.backgroundImage=`url(${s.profile_picture.url})`),s.membership_end_date){let x=new Date(s.membership_end_date),h=new Date;(s==null?void 0:s.session_ledger)!==void 0&&s.session_ledger.length<=3?c[0].style.border="3px solid #009ca1":U(h,x,!0)<=3?c[0].style.border="3px solid red":U(h,x,!0)<=7&&(c[0].style.border="3px solid orange")}c[1].innerText=s.name,c[2].innerText=s.membership_status||"INACTIVE",c[3].innerText=s.gender,c[4].innerText=M(s.date_of_birth),s.session_ledger.length>0?c[5].innerText=D(s.session_ledger[s.session_ledger.length-1].time):c[5].innerText="N/A",N.style.display="flex",t.prepend(N)})}l(r),a.style.display="none"}})();
