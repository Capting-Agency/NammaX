var L=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var B=(e,n)=>{var o={};for(var i in e)ee.call(e,i)&&n.indexOf(i)<0&&(o[i]=e[i]);if(e!=null&&L)for(var i of L(e))n.indexOf(i)<0&&te.call(e,i)&&(o[i]=e[i]);return o};var h=(e,n,o)=>new Promise((i,c)=>{var _=t=>{try{l(o.next(t))}catch(a){c(a)}},s=t=>{try{l(o.throw(t))}catch(a){c(a)}},l=t=>t.done?i(t.value):Promise.resolve(t.value).then(_,s);l((o=o.apply(e,n)).next())});var M=["Male","Female","Other","Prefer not to say"];var U=["January","February","March","April","May","June","July","August","September","October","November","December"],g={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"},k=["DROPOUT","NO SHOW","NEW USER","TRIAL","NO RENEWAL","NO MEMBERSHIP"];function y(e,n="GET",o=!1,i=!1,c=!1,_=!0){try{let s={"Content-Type":"application/json"};c&&(s={}),i&&(s.Authorization=`Bearer ${i}`);let l={method:n,headers:s};return o&&(_?l.body=JSON.stringify(o):l.body=o),fetch(e,l).then(t=>t.ok?t.json():t.json().then(a=>(Promise.reject(a.message),{isFetchOk:!1,status:t.status,message:a.message,payload:a&&a.payload?a.payload:null}))).then(t=>t).catch(t=>(console.error("Error in fetch",t),t))}catch(s){return console.error("Error!: "+s),s}}function v(e="nammax_auth"){let o=`; ${document.cookie}`.split(`; ${e}=`);return o.length===2?o.pop().split(";").shift():null}function I(e="/",n=2e3){setTimeout(()=>{window.location.href=e},n)}function H(e=null,n=!1,o=!1,i=!1){if(e==null)return"NaN";let c=new Date,_=new Date(e),s=_.getHours(),l="";if(i||(l=s>=12?"PM":"AM",s=s%12||12),n){let t=_.getMinutes();return t=t<10?`0${t}`:t,o?`${c.getDate()===_.getDate()?"Today":c.getDate()+1===_.getDate()?"Tomorrow":c.getDate()+2===_.getDate()?"Day After Tomorrow":S(e)} ${s}:${t} ${l}`:`${s}:${t} ${l}`}else return o?`${c.getDate()===_.getDate()?"Today":c.getDate()+1===_.getDate()?"Tomorrow":c.getDate()+2===_.getDate()?"Day After Tomorrow":S(e)} ${s} ${l}`:`${S(e)} ${s} ${l}`}function S(e=null){if(e==null)return"NaN";let n=new Date(e);return`${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()}`}function K(e=null){if(e==null)return"NaN";let n=e.split("-"),o=Date.now()-new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])).getTime(),i=new Date(o);return Math.abs(i.getUTCFullYear()-1970)}function P(e,n=null){if(e!=null){var o,i=e.options.length-1;for(o=i;o>=0;o--)o!==n&&e.remove(o)}}function F(e="/admin/sign-in",n="sidebar-logout-btn"){let o=document.getElementById(n);o?o.onclick=()=>ne(e):console.error("Logout button not found")}function ne(e="/sign-in"){window.localStorage.removeItem("auth"),I(`${e}`)}function O(e=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(e)).replace(/^(\D+)/,"$1 ")}function G(e=new Date,n=0){let o=e;return o&&o.setDate(o.getDate()+n),o}function q(e=g.ADMIN){if(e===g.ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),o&&o.remove()}else if(e===g.SUPER_ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),n&&n.remove()}}function W(e){if(!e)return console.error("url does not cotnain gym id");let n=document.getElementById("navbar-home"),o=document.getElementById("navbar-finance"),i=document.getElementById("navbar-users"),c=document.getElementById("navbar-sessions");n&&n.setAttribute("href",`/admin/gym/g?gymCode=${e}`),o&&o.setAttribute("href",`/admin/gym/finance?gymCode=${e}`),i&&i.setAttribute("href",`/admin/gym/users?gymCode=${e}`),c&&c.setAttribute("href",`/admin/gym/sessions?gymCode=${e}`)}function Y(e){if(!e)return console.error("gym data not found");let n=document.getElementById("gym-code-location"),o=document.getElementById("header-address"),i=document.getElementById("header-partner"),c=document.getElementById("header-contact"),_=document.getElementById("header-email");n&&(n.innerText=`${e.code} \u2022 ${e.location}`),o&&(o.innerText=e.address),i&&(i.innerText=e.partner),c&&(c.innerText=e.contact),_&&(_.innerText=e.partner_email)}function j(){let e=document.getElementById("loading-screen");e?e.remove():console.log("did not find loading screen")}function X(e){let n=new Date(e);return n.setMinutes(n.getMinutes()-n.getTimezoneOffset()),n}function b(e,n,o=!1){let i=864e5;return Math.round((X(n)-X(e))/i)}var D="/admin/sign-in",z="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/gyms/";var J="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/sessions/search/",T="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/users/search/";function w({mode:e="API",clientObjRefName:n="name",data:o,token:i,API:c,extraXanoInputObj:_=[],searchContainerElId:s=""},l,t=null,a=null){let m,u,A;if(s.length>0){let r=document.getElementById(s);m=r.querySelector("#search-input"),m.setAttribute("placeholder","Search"),u=r.querySelector("#search-btn"),A=r.querySelector("#search-reset-btn")}else m=document.getElementById("search-input"),m.setAttribute("placeholder","Search"),u=document.getElementById("search-btn"),A=document.getElementById("search-reset-btn");A.onclick=()=>{m.value="",V(A,{mode:e,clientObjRefName:n,data:o,searchquery:"",token:i,API:c,extraXanoInputObj:_},l,t,a)},u.onclick=()=>{let r=m.value;V(A,{mode:e,clientObjRefName:n,data:o,searchquery:r,token:i,API:c,extraXanoInputObj:_},l,t,a)}}function V(u,A,r,d,N){return h(this,arguments,function*(e,{mode:n,clientObjRefName:o,data:i,searchquery:c,token:_,API:s,extraXanoInputObj:l=[]},t,a,m){if(c.length===0)e.style.display="none",a?t(i,a):t(i);else try{if(n==="API"){let p={search_query:`${c}:*`};l.length>0&&l.map(f=>{for(let[E,R]of Object.entries(f))p[E]=R});let x=yield y(s+"query","POST",p,_);if(x.isFetchOk!==void 0&&!x.isFetchOk)throw console.error(x.message),Error("API call failed");e.style.display="flex",a?t(x,a):t(x)}else{let p=i.filter(x=>x[o].toLowerCase().includes(c.toLowerCase()));e.style.display="flex",a?t(p,a):t(p)}}catch(p){m?m():console.error(p)}})}function C({tag:e="gym",API:n=null,parentTableName:o="user-table-subscription-header",tableColumnContainerName:i="user-table-gym-header",extraXanoInputObj:c=[],filterData:_=null,searchContainerElId:s="",token:l},t){if(!_){console.error("No Filter Data provided");return}let a=document.getElementById(i);if(!a){console.error("Failed to find column container");return}let m=a.querySelector("#filter-search");if(!m){console.error("Failed to find column filter");return}ie(i,m,_),a.onclick=d=>{d.stopPropagation(),m.style.display="block"};let u=m.querySelector("#close-btn");u?u.onclick=d=>{d.stopPropagation(),m.style.display="none"}:console.error("Failed to find close btn");let A=a.querySelector("#filter-btn");if(!A){console.error("Failed to find submit filter btn");return}A.onclick=()=>{let d=m.querySelector(`input[name="${i}"]:checked`).value,N;s.length>0?N=document.getElementById(s).querySelector("#search-input"):N=document.getElementById("search-input"),oe(e,d,n,t,l,N.value,o,i,m,c)};let r=a.querySelector("#reset-filter-btn");if(!r){console.error("Failed to find reset filter btn");return}r.onclick=d=>{d.stopPropagation(),Q("","",n,t,l,"",c),Z("hide",o,i,m)}}function oe(e,n,o,i,c,_,s,l,t,a){return h(this,null,function*(){Q(e,n,o,i,c,_,a),Z("show",s,l,t)})}function Q(l,t,a,m,u,A){return h(this,arguments,function*(e,n,o,i,c,_,s=[]){let r={search_query:(_==null?void 0:_.length)>0?`${_}:*`:"",tag:e,filter:n||""};s.length>0&&s.map(N=>{for(let[p,x]of Object.entries(N))r[p]=x});let d=yield y(o+"query","POST",r,c);if(d.isFetchOk!==void 0&&!d.isFetchOk)throw console.error(d.message),Error("API call failed");i&&i(d)})}function Z(e="show",n,o,i){let c=document.getElementById(n);if(!c){console.error("Could not find parent table name");return}if(c.querySelectorAll(".text-w").forEach(s=>{s.style.textDecoration="none"}),e==="show"){let s=document.getElementById(o);if(!s){console.error("Could not find column name");return}s.style.textDecoration="underline",i.querySelector("#reset-filter-btn").style.display="block"}else e==="hide"&&(i.querySelector("#reset-filter-btn").style.display="none");setTimeout(()=>{i.style.display="none"},500)}function ie(e,n,o){let i=n.querySelector("label");o.forEach(c=>{let _=i.cloneNode(!0),s=_.querySelector("input"),l=_.querySelector("span");s.value=c.value,s.name=e,l.innerText=c.text,n.prepend(_)}),i.remove()}(()=>{let e,n;window.onload=function(){return h(this,null,function*(){F(D,"sidebar-logout-btn");var l=new URL(document.location.href);if(e=l.searchParams.get("gymCode")||null,e)W(e);else{console.error("No gym id found");return}let t=v();if(t){let m=yield y(z+e,"GET",!1,t);if(m.isFetchOk!==void 0&&!m.isFetchOk){console.error(m.message);return}let a=m,{team_role:u}=a,A=B(a,["team_role"]);u&&(u===g.SUPER_ADMIN||u===g.ADMIN)?(q(u),o(A,t)):I(`${D}?reason=UNAUTHORIZED_USER`)}else I(`${D}?reason=NOT_SIGNED_IN`)})};function o(l,t){return h(this,null,function*(){let{sessions:a,users:m,gym:u,finances:A,footfall:r}=l;u&&Y(u);let d;n=A.some((p,x)=>{if(p.month===new Date().getMonth()+1)return d=x,!0})?A[d]:A[A.length-1],n===void 0&&(n=null),c(m,n,r),i(m,n,A,r),_(a.items,u.code),s(m),w({data:a,token:t,API:J,extraXanoInputObj:[{gym_id:e}]},_,u.code),w({data:m,token:t,API:T,searchContainerElId:"user-search-container",extraXanoInputObj:[{gym_id:e}]},s,u.code),C({tag:"subscription",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-subscription-header",filterData:k.map(p=>({text:p,value:p})),extraXanoInputObj:[{gym_id:e}],token:t,API:T},s),C({tag:"gender",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gender-header",filterData:M.map(p=>({text:p,value:p})),extraXanoInputObj:[{gym_id:e}],token:t,API:T},s),j()})}function i(l,t,a,m){let u=document.getElementById("select-month");P(u),a.forEach((A,r)=>{var d=document.createElement("option");d.value=r,d.innerText=U[A.month-1]+", "+A.year,A.month===t.month&&(d.selected=!0),u.appendChild(d)}),u.onchange=A=>{t=a[A.target.value],t===void 0&&(t=null),c(l,t,m)}}function c(l=[],t=[],a=0){var m;t?(document.getElementById("gym-statistics-month-year").innerText=U[t.month-1]+" "+t.year,document.getElementById("financial-expenses").innerText=O(Number(t.additional_expenses)),document.getElementById("financial-revenue").innerText=O(Number(t.gross_revenue)+Number(t.additional_revenue)),document.getElementById("financial-profit").innerText=O(t.net_profit),document.getElementById("gym-statistics-total-members").innerText=(m=l==null?void 0:l.items)==null?void 0:m.length,$("#gym-statistics-completed-sessions").text(a||0),$("#gym-statistics-active-members").text(l.items.filter(u=>u.membership_status!=="INACTIVE").length)):(document.getElementById("gym-statistics-month-year").innerText="This months data not found",document.getElementById("financial-expenses").innerText="No data found",document.getElementById("financial-revenue").innerText="No data found",document.getElementById("financial-profit").innerText="No data found")}function _(l,t){let a=document.getElementById("sessions-container"),m=a.querySelector("#table-item");function u(A){let r=a.querySelectorAll(".adb-user.w-inline-block");r.forEach((d,N)=>{N!==r.length-1&&d.remove()}),A.forEach((d,N)=>{var f,E;let p=m.cloneNode(!0);p.setAttribute("id",""),p.setAttribute("href",`/admin/session?sessionId=${d.id}`);let x=p.querySelectorAll(".colcontent");N%2===0&&(p.style.backgroundColor="#00edf4"),x[1].innerText=d.session_name,x[2].innerText=d.name||"-",x[3].innerText=t,x[4].innerText=S(d.time),x[5].innerText=H(d.time,!0),x[6].innerText=(E=(f=d==null?void 0:d.users)==null?void 0:f.length)!=null?E:0,x[7].innerText=d.status,p.style.display="flex",a.prepend(p)})}u(l),m.style.display="none"}function s(l){let t=document.getElementById("users-container"),a=t.querySelector("#table-item");function m(u){let A=t.querySelectorAll(".adb-user.w-inline-block");A.forEach((r,d)=>{d!==A.length-1&&r.remove()}),u.items.forEach((r,d)=>{let N=a.cloneNode(!0);N.setAttribute("id",""),N.setAttribute("href",`/admin/user?userId=${r.id}`),d%2===0&&(N.style.backgroundColor="#00edf4");let p=N.querySelectorAll(".colcontent");if(r.profile_picture&&(p[0].style.backgroundImage=`url(${r.profile_picture.url})`),r.membership_end_date){let E=new Date(r.membership_end_date),R=new Date;(r==null?void 0:r.session_ledger)!==void 0&&r.session_ledger.length<=3?p[0].style.border="3px solid #009ca1":b(R,E,!0)<=3?p[0].style.border="3px solid red":b(R,E,!0)<=7&&(p[0].style.border="3px solid orange")}p[1].innerText=r.name;let x=G(new Date(r.created_at),7),f="";r.tokens===2&&r.session_ledger.length===0&&x.getTime()<new Date().getTime()?f="DROPOUT":r.tokens===0&&r.session_ledger.length===0&&x.getTime()>new Date().getTime()?f="NO SHOW":r.tokens===2&&r.session_ledger.length===0?f="NEW USER":r.tokens===1&&r.session_ledger.length===1?f="TRIAL":r.membership_status!=="TRIAL"&&r.session_ledger.length>0&&x.getTime()>new Date().getTime()?f="NO RENEWAL":r.membership_end_date&&new Date(r.membership_end_date).getTime()<new Date().getTime()&&(f="NO MEMBERSHIP"),p[2].innerText=f||r.membership_status||"INACTIVE",p[3].innerText=r.gender,p[4].innerText=K(r.date_of_birth),r.session_ledger.length>0?p[5].innerText=S(r.session_ledger[r.session_ledger.length-1].time):p[5].innerText="N/A",N.style.display="flex",t.prepend(N)})}m(l),a.style.display="none"}})();
