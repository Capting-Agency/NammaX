var j=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var Y=(t,e)=>{var n={};for(var o in t)pe.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(t!=null&&j)for(var o of j(t))e.indexOf(o)<0&&_e.call(t,o)&&(n[o]=t[o]);return n};var h=(t,e,n)=>new Promise((o,a)=>{var l=i=>{try{r(n.next(i))}catch(s){a(s)}},c=i=>{try{r(n.throw(i))}catch(s){a(s)}},r=i=>i.done?o(i.value):Promise.resolve(i.value).then(l,c);r((n=n.apply(t,e)).next())});var I={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function x(t,e="GET",n=!1,o=!1,a=!1,l=!0){try{let c={"Content-Type":"application/json"};a&&(c={}),o&&(c.Authorization=`Bearer ${o}`);let r={method:e,headers:c};return n&&(l?r.body=JSON.stringify(n):r.body=n),fetch(t,r).then(i=>i.ok?i.json():i.json().then(s=>(Promise.reject(s.message),{isFetchOk:!1,status:i.status,message:s.message,payload:s&&s.payload?s.payload:null}))).then(i=>i).catch(i=>(console.error("Error in fetch",i),i))}catch(c){return console.error("Error!: "+c),c}}function v(t="nammax_auth"){let n=`; ${document.cookie}`.split(`; ${t}=`);return n.length===2?n.pop().split(";").shift():null}function k(t="/",e=0){setTimeout(()=>{window.location.href=t},e)}function K(t=1e3){setTimeout(()=>{window.location.reload()},t)}function P(t=null,e=!1){if(t==null)return"NaN";var n=new Date(t),o=n.getHours(),a=o>=12?"PM":"AM";if(o=o%12||12,e){var l=n.getMinutes();return l=l<10?`0${l}`:l,`${o}:${l} ${a}`}else return`${o} ${a}`}function z(t=null){if(t==null)return"NaN";let e=new Date(t);return`${e.getDate()}/${e.getMonth()+1}/${e.getFullYear()}`}function J(t=null){if(t==null)return"NaN";t=t*60;let e=`${t/60^0}`.slice(-2),n=("0"+t%60).slice(-2);return e!="0"?n!="00"?`${e} HR ${n} M`:e+" HR":n+" Mins"}function O(t,e=null){if(t!=null){var n,o=t.options.length-1;for(n=o;n>=0;n--)n!==e&&t.remove(n)}}function V(t="/admin/sign-in",e="sidebar-logout-btn"){let n=document.getElementById(e);n?n.onclick=()=>Ae(t):console.error("Logout button not found")}function Ae(t="/sign-in"){window.localStorage.removeItem("auth"),k(`${t}`)}function Q(t=I.ADMIN){if(t===I.ADMIN){let e=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");e&&(e.style.display="flex"),n&&n.remove()}else if(t===I.SUPER_ADMIN){let e=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),e&&e.remove()}}function Z(t){if(!t)return console.error("url does not cotnain gym id");let e=document.getElementById("navbar-home"),n=document.getElementById("navbar-finance"),o=document.getElementById("navbar-users"),a=document.getElementById("navbar-sessions");e&&e.setAttribute("href",`/admin/gym/g?gymCode=${t}`),n&&n.setAttribute("href",`/admin/gym/finance?gymCode=${t}`),o&&o.setAttribute("href",`/admin/gym/users?gymCode=${t}`),a&&a.setAttribute("href",`/admin/gym/sessions?gymCode=${t}`)}function ee(t){if(!t)return console.error("gym data not found");let e=document.getElementById("gym-code-location"),n=document.getElementById("header-address"),o=document.getElementById("header-partner"),a=document.getElementById("header-contact"),l=document.getElementById("header-email");e&&(e.innerText=`${t.code} \u2022 ${t.location}`),n&&(n.innerText=t.address),o&&(o.innerText=t.partner),a&&(a.innerText=t.contact),l&&(l.innerText=t.partner_email)}function te({single:t=!0,baseElement:e="",TriggerBtn:n="jsModalOpen",_modalWindow:o="jsModal"},a){if(t){var l=e.querySelector("#"+n);l.onclick=function(){var i=document.getElementById(o);a&&a(),i.classList?i.classList.add("open"):i.className+=" open"}}else for(var c=document.getElementsByClassName(n),r=0;r<c.length;r++)c[r].onclick=function(){var i=this.getAttribute("href").substr(1),s=document.getElementById(i);s.classList?s.classList.add("open"):s.className+=" open"}}function ne({TriggerBtn:t="jsModalClose",_modalWindow:e="jsModal"},n){var o=document.getElementById(t),a=document.getElementById(e);o.onclick=function(){a.classList?a.classList.remove("open"):a.className=a.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," ")},n&&n()}function ie({mode:t="API",clientObjRefName:e="name",data:n,token:o,API:a,extraXanoInputObj:l=[],searchContainerElId:c=""},r,i=null,s=null){let u,p,d;if(c.length>0){let m=document.getElementById(c);u=m.querySelector("#search-input"),u.setAttribute("placeholder","Search"),p=m.querySelector("#search-btn"),d=m.querySelector("#search-reset-btn")}else u=document.getElementById("search-input"),u.setAttribute("placeholder","Search"),p=document.getElementById("search-btn"),d=document.getElementById("search-reset-btn");d.onclick=()=>{u.value="",oe(d,{mode:t,clientObjRefName:e,data:n,searchquery:"",token:o,API:a,extraXanoInputObj:l},r,i,s)},p.onclick=()=>{let m=u.value;oe(d,{mode:t,clientObjRefName:e,data:n,searchquery:m,token:o,API:a,extraXanoInputObj:l},r,i,s)}}function oe(p,d,m,R,w){return h(this,arguments,function*(t,{mode:e,clientObjRefName:n,data:o,searchquery:a,token:l,API:c,extraXanoInputObj:r=[]},i,s,u){if(a.length===0)t.style.display="none",s?i(o,s):i(o);else try{if(e==="API"){let _={search_query:`${a}:*`};r.length>0&&r.map(T=>{for(let[y,U]of Object.entries(T))_[y]=U});let A=yield x(c+"query","POST",_,l);if(A.isFetchOk!==void 0&&!A.isFetchOk)throw console.error(A.message),Error("API call failed");t.style.display="flex",s?i(A,s):i(A)}else{let _=o.filter(A=>A[n].toLowerCase().includes(a.toLowerCase()));t.style.display="flex",s?i(_,s):i(_)}}catch(_){u?u():console.error(_)}})}var F="/admin/sign-in";var se="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/sessions/",M="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/sessions/add_session/",ae="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/session/add_recurring_session",re="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/session/delete_recurring_session";var le="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/sessions/search/";var g,E,S,G,C,B,X,L,b,ce;window.onload=function(){return h(this,null,function*(){V("/admin/sign-in","sidebar-logout-btn");var t=new URL(document.location.href);if(g=t.searchParams.get("gymCode")||null,g)Z(g);else{console.error("No gym id found");return}let e=v();if(e){let o=yield x(se+g,"GET",!1,e);if(o.isFetchOk!==void 0&&!o.isFetchOk){console.error(o.message);return}let n=o,{team_role:a}=n,l=Y(n,["team_role"]);a===I.SUPER_ADMIN||a===I.ADMIN?(Q(a),fe(l,e)):k(`${F}?reason=UNAUTHORIZED_USER`)}else k(`${F}?reason=NOT_SIGNED_IN`)})};$(document).ready(function(){E=document.getElementById("add-manual-session-form-block"),S=E.querySelector("#sessions-select-gym"),G=E.querySelector("#session-name-input"),C=E.querySelector("#sessions-select-coach"),B=E.querySelector("#datepicker-input"),X=E.querySelector("#timepicker-input"),L=E.querySelector("#sessions-select-duration"),b=E.querySelector("#session-select-capacity"),ce=E.querySelector("#sessions-select-btn"),S.disabled=!0,G.disabled=!0,C.disabled=!0,B.disabled=!0,X.disabled=!0,L.disabled=!0,b.disabled=!0,ce.disabled=!0,$(B).datepicker({startDate:new Date,format:"dd/mm/yyyy",language:"en",multidate:!0,orientation:"bottom auto"}),$(X).timepicker({timeFormat:"h:mm p",interval:15,defaultTime:"7",minTime:"7",maxTime:"11:45pm"})});function fe(t,e){return h(this,null,function*(){let{manual_type_sessions:n,recurring_type_sessions:o,recurring_sessions:a,gym:l}=t;S.disabled=!1,l&&ee(l),de([...n,...o],l.code),Ne(a,e),he(e),ie({data:n,token:e,API:le,extraXanoInputObj:[{gym_id:g}]},de,l.code)})}function de(t,e){let n=document.getElementById("table-container"),o=n.querySelector("#table-item");function a(l){let c=n.querySelectorAll(".adb-user.w-inline-block");c.forEach((r,i)=>{i!==c.length-1&&r.remove()}),l.forEach((r,i)=>{var p,d;let s=o.cloneNode(!0);s.setAttribute("id",""),s.setAttribute("href",`/admin/session?sessionId=${r.id}`);let u=s.querySelectorAll(".colcontent");i%2===0&&(s.style.backgroundColor="#00edf4"),u[1].innerText=r.session_name,u[2].innerText=r.name||"To Be Decided",u[3].innerText=e,u[4].innerText=z(r.time),u[5].innerText=P(r.time,!0),u[6].innerText=(d=(p=r==null?void 0:r.users)==null?void 0:p.length)!=null?d:0,u[7].innerText=r.status,s.style.display="flex",n.prepend(s)})}a(t),o.style.display="none"}function Ne(t,e){let o=document.getElementById("recursive-table-container").querySelectorAll(".recursive-table-columns");function a(l){let c;o.forEach((r,i)=>{let s=i+1,u=r.querySelector("#recursive-table-wrapper"),p=u.querySelector("#recursive-table-item");l.forEach(d=>{if(d.weekday==s){let m=p.cloneNode(!0);m.setAttribute("id","");let R=m.querySelectorAll(".colcontent");R[0].innerText=d.session_name,R[1].innerText=P(d.time,!0),R[2].innerText=J(d.duration),R[3].innerText=d.capacity;let w=m.querySelector(".delete-icon-w.off");m.onmouseover=()=>{w.style.display="flex"},m.onmouseout=()=>{w.style.display="none"};let _=m.querySelector(".delete-recurring-session");_.onclick=()=>h(this,null,function*(){document.querySelectorAll(".delete-recurring-session").forEach(U=>{U.disabled=!0});let T={recurring_id:d.id},y=yield x(re,"POST",T,e);if(y.isFetchOk!==void 0&&!y.isFetchOk){console.error(y.message),$("#add-recurring-session-form-block").hide().siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Failed to delete recurring session"),K(1500);return}m.remove(),$("#add-recurring-session-form-block").hide().siblings(".w-form-fail").hide().siblings(".w-form-done").show().text("Successfully deleted recurring session"),K(1500)}),m.style.display="flex",u.prepend(m)}}),te({_modalWindow:"recursive-popout",TriggerBtn:"add-recursive-weekday-btn",baseElement:r},()=>{let d=document.getElementById("recursive-popout"),m=d.querySelector("#recursive-sessions-name-select"),R=d.querySelector("#recursive-sessions-duration-select"),w=d.querySelector("#recursive-sessions-capacity-select"),_=d.querySelector("#datepicker-input"),A=d.querySelector("#timepicker-input"),T=d.querySelector("#selected-day"),y=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];O(_),[y[s-1]].forEach(f=>{var N=document.createElement("option");N.value=s,N.innerText=f,N.selected=!0,_.appendChild(N)}),_.disabled=!0,T.innerText=y[s-1],A.style.color="#080808",$(A).timepicker({timeFormat:"HH:mm",interval:15,defaultTime:"7",minTime:"7",maxTime:"11:45pm",zindex:10}),O(R,0);let U=["15 mins","30 mins","45 mins","1 hour","1 hour and 15 mins","1 hour and 30 mins","1 hour and 45 mins","2 hours","2 hour and 15 mins","2 hour and 30 mins","2 hour and 45 mins","3 hours","3 hour and 15 mins","3 hour and 30 mins","3 hour and 45 mins"],ue=["0.25","0.5","0.75","1","1.25","1.5","1.75","2","2.25","2.5","2.75","3","3.25","3.5","3.75"];U.forEach((f,N)=>{var D=document.createElement("option");D.value=ue[N],D.innerText=f,R.appendChild(D)});function q(){return h(this,null,function*(){let f;if(c?f=c:f=yield x(M+g,"GET",!1,e),f.isFetchOk!==void 0&&!f.isFetchOk){console.error(f.message);return}c=f;let{gyms:N,session_names:D}=f;O(m),D.forEach(W=>{var H=document.createElement("option");H.value=W.name,H.innerText=W.name,m.appendChild(H)}),w.setAttribute("max",N[0].capacity),w.setAttribute("placeholder","Max capacity: "+N[0].capacity),m.removeEventListener("focus",q)})}m.addEventListener("focus",q)}),p.style.display="none"})}ne({_modalWindow:"recursive-popout",TriggerBtn:"close-recursive-session-popout-btn"}),a(t)}function he(t){$("form :input").attr("autocomplete","off");function e(){return h(this,null,function*(){let n=yield x(M+g,"GET",!1,t);if(n.isFetchOk!==void 0&&!n.isFetchOk){console.error(n.message);return}G.disabled=!1,C.disabled=!1,B.disabled=!1,X.disabled=!1,L.disabled=!1,b.disabled=!1;let{gyms:o,coaches:a}=n;O(S),o.forEach((r,i)=>{var s=document.createElement("option");s.value=r.id,s.innerText=r.location,i===0&&(s.selected=!0),S.appendChild(s)}),O(C,0),a.forEach(r=>{var i=document.createElement("option");i.value=r.id,i.innerText=r.name,C.appendChild(i)}),O(L,0);let l=["15 mins","30 mins","45 mins","1 hour","1 hour and 15 mins","1 hour and 30 mins","1 hour and 45 mins","2 hours","2 hour and 15 mins","2 hour and 30 mins","2 hour and 45 mins","3 hours","3 hour and 15 mins","3 hour and 30 mins","3 hour and 45 mins"],c=["0.25","0.5","0.75","1","1.25","1.5","1.75","2","2.25","2.5","2.75","3","3.25","3.5","3.75"];l.forEach((r,i)=>{var s=document.createElement("option");s.value=c[i],s.innerText=r,L.appendChild(s)}),b.setAttribute("max",o[0].capacity),b.setAttribute("placeholder","Max capacity: "+o[0].capacity),S.addEventListener("change",()=>{o.some(r=>r.id===parseInt(S.value)?(b.setAttribute("max",r.capacity),b.setAttribute("placeholder","Max capacity: "+r.capacity),!0):!1)},!1),S.removeEventListener("focus",e)})}S.addEventListener("focus",e)}var me=me||[];me.push(function(){$(document).off("submit"),$("form").on("change",function(){let t=$(this);if(t.attr("id")==="add-manual-session-form-block"){let e=t[0][0].value,n=t[0][1].value,o=t[0][3].value,a=t[0][5].value,l=t[0][6].value;e!==""&&n!==""&&n!=="Session Name"&&o!==""&&a!==""&&a!=="Duration"&&l.trim()!==""&&(t[0][7].disabled=!1,t[0][7].classList.remove("disabled"))}}),$("form").on("submit",function(t){return h(this,null,function*(){t.preventDefault();let e=$(this);if(e.attr("id")==="add-manual-session-form-block"){let n=v();if(n){let o=e[0][0].value,a=e[0][1].value,l=e[0][2].value,c=e[0][3].value,r=e[0][4].value,i=e[0][5].value,s=e[0][6].value;if(o!==""&&a!==""&&a!=="Session Name"&&c!==""&&r!==""&&i!==""&&i!=="Duration"&&s.trim()!==""){let u={};u.items=[...c.split(",").map(d=>{let m=d.split("/");return{gym_id:o,session_name:a,team_id:l==="Coach"?null:l,time:new Date(`${m[2]}/${m[1]}/${m[0]} ${r}`).getTime(),duration:i,capacity:s}})];let p=yield x(M+o,"POST",u,n);if(p.isFetchOk!==void 0&&!p.isFetchOk){console.error(p.message),e.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("There was an error trying to add your session. Please refresh your browser and try again.");return}e.hide().siblings(".w-form-done").show().siblings(".w-form-fail").hide(),window.location.reload()}else a==="Session Name"?e[0][1].style.borderColor="red":e[0][1].style.borderColor="black",c.trim()===""?e[0][3].style.borderColor="red":e[0][3].style.borderColor="black",r.trim()===""?e[0][4].style.borderColor="red":e[0][4].style.borderColor="black",i==="Duration"?e[0][5].style.borderColor="red":e[0][5].style.borderColor="black",s.trim()===""?e[0][6].style.borderColor="red":e[0][6].style.borderColor="black",e.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Please fill out all fields")}}else if(e.attr("id")==="add-recurring-session-modal-form-block"){let n=v();if(n){let o=e[0][0].value,a=e[0][1].value,l=e[0][2].value,c=e[0][3].value,r=e[0][4].value;if(o!==""&&a!==""&&l!==""&&c!==""&&r!==""){let i={gym_id:g,session_name:o,weekday:parseInt(a),time:new Date().setHours(l.split(":")[0],l.split(":")[1],0,0),duration:c,capacity:r},s=yield x(ae,"POST",i,n);if(s.isFetchOk!==void 0&&!s.isFetchOk){console.error(s.message),e.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("There was an error trying to add your session. Please refresh your browser and try again.");return}e.hide().siblings(".w-form-done").show().siblings(".w-form-fail").hide(),window.location.reload()}}}})})});
