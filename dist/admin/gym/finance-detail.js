var U=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var O=(t,e)=>{var n={};for(var a in t)K.call(t,a)&&e.indexOf(a)<0&&(n[a]=t[a]);if(t!=null&&U)for(var a of U(t))e.indexOf(a)<0&&H.call(t,a)&&(n[a]=t[a]);return n};var h=(t,e,n)=>new Promise((a,d)=>{var A=r=>{try{N(n.next(r))}catch(o){d(o)}},c=r=>{try{N(n.throw(r))}catch(o){d(o)}},N=r=>r.done?a(r.value):Promise.resolve(r.value).then(A,c);N((n=n.apply(t,e)).next())});var L=["January","February","March","April","May","June","July","August","September","October","November","December"],E={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function S(t,e="GET",n=!1,a=!1,d=!1,A=!0){try{let c={"Content-Type":"application/json"};d&&(c={}),a&&(c.Authorization=`Bearer ${a}`);let N={method:e,headers:c};return n&&(A?N.body=JSON.stringify(n):N.body=n),fetch(t,N).then(r=>r.ok?r.json():r.json().then(o=>(Promise.reject(o.message),{isFetchOk:!1,status:r.status,message:o.message,payload:o&&o.payload?o.payload:null}))).then(r=>r).catch(r=>(console.error("Error in fetch",r),r))}catch(c){return console.error("Error!: "+c),c}}function y(t="nammax_auth"){let n=`; ${document.cookie}`.split(`; ${t}=`);return n.length===2?n.pop().split(";").shift():null}function R(t="/",e=0){setTimeout(()=>{window.location.href=t},e)}function T(t=1e3){setTimeout(()=>{window.location.reload()},t)}function D(t=null){if(t==null)return"NaN";let e=new Date(t);return`${e.getDate()}/${e.getMonth()+1}/${e.getFullYear()}`}function b(t=null){if(t==null)return"NaN";let e=t.split("/");return new Date(`${e[2]}/${e[1]}/${e[0]} ${new Date().getHours()}:${new Date().getMinutes()}`).getTime()}function w(t="/admin/sign-in",e="sidebar-logout-btn"){let n=document.getElementById(e);n?n.onclick=()=>P(t):console.error("Logout button not found")}function P(t="/sign-in"){window.localStorage.removeItem("auth"),R(`${t}`)}function f(t=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(t)).replace(/^(\D+)/,"$1 ")}function C(t=E.ADMIN){if(t===E.ADMIN){let e=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");e&&(e.style.display="flex"),n&&n.remove()}else if(t===E.SUPER_ADMIN){let e=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),e&&e.remove()}}function B(t){if(!t)return console.error("url does not cotnain gym id");let e=document.getElementById("navbar-home"),n=document.getElementById("navbar-finance"),a=document.getElementById("navbar-users"),d=document.getElementById("navbar-sessions");e&&e.setAttribute("href",`/admin/gym/g?gymCode=${t}`),n&&n.setAttribute("href",`/admin/gym/finance?gymCode=${t}`),a&&a.setAttribute("href",`/admin/gym/users?gymCode=${t}`),d&&d.setAttribute("href",`/admin/gym/sessions?gymCode=${t}`)}function k(t){if(!t)return console.error("gym data not found");let e=document.getElementById("gym-code-location"),n=document.getElementById("header-address"),a=document.getElementById("header-partner"),d=document.getElementById("header-contact"),A=document.getElementById("header-email");e&&(e.innerText=`${t.code} \u2022 ${t.location}`),n&&(n.innerText=t.address),a&&(a.innerText=t.partner),d&&(d.innerText=t.contact),A&&(A.innerText=t.partner_email)}var M=Webflow||[];var I="/admin/sign-in";var X="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/finance_detail",v="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/admin/finance_detail/new_entry";(()=>{let t,e,n,a;window.onload=function(){return h(this,null,function*(){w("/admin/sign-in","sidebar-logout-btn");var o=new URL(document.location.href);if(t=o.searchParams.get("gymCode")||null,e=o.searchParams.get("month")||null,n=o.searchParams.get("year")||null,t)B(t);else{console.error("No gym id found");return}let l=y();if(l){let m=yield S(X,"POST",{gym_id:t,month:e,year:n},l);if(m.isFetchOk!==void 0&&!m.isFetchOk){console.error(m.message);return}let _=m,{team_role:i}=_,s=O(_,["team_role"]);i===E.SUPER_ADMIN||i===E.ADMIN?(C(i),d(s,l)):R(`${I}?reason=UNAUTHORIZED_USER`)}else R(`${I}?reason=NOT_SIGNED_IN`)})};function d(o){return h(this,null,function*(){let{gym:l,finance:_,payment_ledger:p}=o;if(l&&k(l),N(),_){let m=_[0],{id:i,additional_entries:s}=m,x=O(m,["id","additional_entries"]);i&&(a=i),A(x),c(s,p)}})}function A(o){let{month:l,year:_,member_revenue:p,fixed_expense:m,gross_revenue:i,additional_expenses:s,net_profit:x}=o;document.getElementById("finance-month").innerText=L[l-1],document.getElementById("finance-year").innerText=_,document.getElementById("financial-gross-gym-revenue").innerText=f(p)||"0",document.getElementById("financial-franchise-cut").innerText=f(m)||"0",document.getElementById("financial-net-gym-revenue").innerText=f(i)||"0",document.getElementById("financial-gym-expenses").innerText=f(s)||"0",document.getElementById("financial-net-profit").innerText=f(x)||"0"}function c(o=[],l=[]){let _=document.getElementById("account-table-container"),p=_.querySelector("#account-table-item"),m=[...l.map(s=>({time:s.time,description:`${s.name}  (${s.mode_of_payment} | ${D(s.membership_end_date)})`,debit:null,credit:s.amount,user:!0}))],i=o.concat(m);i.sort((s,x)=>x.time-s.time),i==null||i.forEach((s,x)=>{let u=p.cloneNode(!0);u.setAttribute("id","");let g=u.querySelectorAll(".colcontent");x%2===0&&(u.style.backgroundColor="#00edf4"),s&&s.user&&(u.style.textDecoration="underline"),g[0].innerText=D(s.time),g[1].innerText=s.description||"",g[2].innerText=s.debit||"",g[3].innerText=s.credit||"",_.append(u)}),p.remove()}function N(){let o=new Date,l=new Date(o.getFullYear(),o.getMonth(),1),_=new Date(o.getFullYear(),o.getMonth(),31),p=document.getElementById("datepicker-input");$(p).datepicker({startDate:l,endDate:_,format:"dd/mm/yyyy",language:"en",multidate:!1,orientation:"bottom auto"}).datepicker("setDate","now");let i=document.getElementById("entry-form-block").querySelector("#entry-btn");i.onclick=()=>{i.disabled||(i.disabled=!0,i.value="Submitting...",i.classList.contains("disabled")||i.classList.add("disabled"),r())}}function r(){return h(this,null,function*(){let o=$("#entry-form-block");if(o.attr("id")==="entry-form-block"){let l=document.getElementById("entry-btn");l&&(l.disabled=!0,l.classList.add("disabled"));let _=y();if(_){let p=o[0][0].value||"",m=o[0][1].value||"",i=o[0][2].value||"",s=o[0][3].value||"";if(p!==""&&m!==""&&(i!==""||s!=="")){let x={finance_id:a,gym_id:t,month:e,year:n,time:b(p),description:m,debit:i,credit:s},u=yield S(v,"POST",x,_);if(u.isFetchOk!==void 0&&!u.isFetchOk){console.error(u.message),l&&(l.disabled=!1,l.classList.remove("disabled")),o.hide().siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Failed to add new entry. Please try again - Error: "+u.message);return}o.hide().siblings(".w-form-fail").hide().siblings(".w-form-done").show().text("Successfully added new entry!"),T()}}else R(`${I}?reason=NOT_SIGNED_IN`)}})}})();var F=M||[];F.push(function(){$(document).off("submit"),$("form").on("change",function(){let t=$(this);if(t.attr("id")==="entry-form-block"){let e=t[0][0].value||"",n=t[0][1].value||"",a=t[0][2].value||"",d=t[0][3].value||"",c=document.getElementById("entry-form-block").querySelector("#entry-btn");e!==""&&n!==""&&(a!==""||d!=="")?(c.disabled=!1,c.classList.remove("disabled")):(c.disabled=!0,c.classList.contains("disabled")||c.classList.addClass("disabled"))}}),$("form").on("submit",function(t){return h(this,null,function*(){t.preventDefault()})})});
