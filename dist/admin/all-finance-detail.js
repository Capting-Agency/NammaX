var K=Object.defineProperty,P=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var T=(t,n,i)=>n in t?K(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,S=(t,n)=>{for(var i in n||={})F.call(n,i)&&T(t,i,n[i]);if(b)for(var i of b(n))G.call(n,i)&&T(t,i,n[i]);return t},O=(t,n)=>P(t,H(n));var g=(t,n,i)=>new Promise((p,A)=>{var m=o=>{try{a(i.next(o))}catch(r){A(r)}},d=o=>{try{a(i.throw(o))}catch(r){A(r)}},a=o=>o.done?p(o.value):Promise.resolve(o.value).then(m,d);a((i=i.apply(t,n)).next())});var w=["January","February","March","April","May","June","July","August","September","October","November","December"],x={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function y(t,n="GET",i=!1,p=!1,A=!1,m=!0){try{let d={"Content-Type":"application/json"};A&&(d={}),p&&(d.Authorization=`Bearer ${p}`);let a={method:n,headers:d};return i&&(m?a.body=JSON.stringify(i):a.body=i),fetch(t,a).then(o=>o.ok?o.json():o.json().then(r=>(Promise.reject(r.message),{isFetchOk:!1,status:o.status,message:r.message,payload:r&&r.payload?r.payload:null}))).then(o=>o).catch(o=>(console.error("Error in fetch",o),o))}catch(d){return console.error("Error!: "+d),d}}function U(t="nammax_auth"){let i=`; ${document.cookie}`.split(`; ${t}=`);return i.length===2?i.pop().split(";").shift():null}function E(t="/",n=0){setTimeout(()=>{window.location.href=t},n)}function C(t=1e3){setTimeout(()=>{window.location.reload()},t)}function D(t=null){if(t==null)return"NaN";let n=new Date(t);return`${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()}`}function B(t="/admin/sign-in",n="sidebar-logout-btn"){let i=document.getElementById(n);i?i.onclick=()=>W(t):console.error("Logout button not found")}function W(t="/sign-in"){window.localStorage.removeItem("auth"),E(`${t}`)}function N(t=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(t)).replace(/^(\D+)/,"$1 ")}function k(t=x.ADMIN){if(t===x.ADMIN){let n=document.getElementById("admin-nav"),i=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),i&&i.remove()}else if(t===x.SUPER_ADMIN){let n=document.getElementById("admin-nav"),i=document.getElementById("super-admin-nav");i&&(i.style.display="flex"),n&&n.remove()}}var L="/admin/sign-in";var M="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/all_finance_detail",v="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/all_finance_detail/new_entry";(()=>{let t,n;window.onload=function(){return g(this,null,function*(){B("/admin/sign-in","sidebar-logout-btn");var a=new URL(document.location.href);if(t=a.searchParams.get("month")||null,n=a.searchParams.get("year")||null,!t||!n){console.error("No month or year found");return}let o=U();if(o){let s=yield y(M,"POST",{month:t,year:n},o);if(s.isFetchOk!==void 0&&!s.isFetchOk){console.error(s.message),s.payload&&s.payload.role===x.ADMIN&&s.payload.gyms&&s.payload.gyms.length>0?E(`/admin/gym/g?gymCode=${s.payload.gyms[0].gym_id}`):E(`${L}?reason=UNAUTHORIZED_USER`);return}k(x.SUPER_ADMIN),i(s,o)}else E(`${L}?reason=NOT_SIGNED_IN`)})};function i(a){let{finance:o,external_finance:r,payment_ledger:s}=a,l={};o.map(e=>l[e.month+","+e.year]!==void 0?l[e.month+","+e.year]=O(S({},l[e.month+","+e.year]),{additional_revenue:e.additional_revenue+l[e.month+","+e.year].additional_revenue,additional_expenses:e.additional_expenses+l[e.month+","+e.year].additional_expenses,gross_revenue:e.gross_revenue+l[e.month+","+e.year].gross_revenue,member_revenue:e.member_revenue+l[e.month+","+e.year].member_revenue,fixed_expense:e.fixed_expense+l[e.month+","+e.year].fixed_expense,net_profit:e.net_profit+l[e.month+","+e.year].net_profit}):l[e.month+","+e.year]=e);let c=l;r.map(e=>c[e.month+","+e.year]!==void 0?c[e.month+","+e.year]=O(S({},c[e.month+","+e.year]),{additional_revenue:e.credit+c[e.month+","+e.year].additional_revenue,additional_expenses:e.debit+c[e.month+","+e.year].additional_expenses}):e),m(),p(c),A([...o.map(e=>e.additional_entries)],s,r)}function p(a){let{month:o,year:r,member_revenue:s,fixed_expense:l,gross_revenue:c,additional_revenue:e,additional_expenses:h}=a[t+","+n],u=Number(c)+Number(e)-Number(h);document.getElementById("finance-month").innerText=w[o-1],document.getElementById("finance-year").innerText=r,document.getElementById("financial-member-revenue").innerText=N(s)||"0",document.getElementById("financial-fixed-expense").innerText=N(l)||"0",document.getElementById("financial-gross-revenue").innerText=N(c)||"0",document.getElementById("financial-additional-revenue").innerText=N(e)||"0",document.getElementById("financial-additional-expenses").innerText=N(h)||"0",document.getElementById("financial-net-profit").innerText=N(u)||"0"}function A(a=[],o=[],r=[]){let s=document.getElementById("account-table-container"),l=s.querySelector("#account-table-item"),c=a.flat(1),e=[...o.map(_=>({time:_.time,description:`${_.name}  (${_.mode_of_payment} | ${D(_.membership_end_date)})`,debit:null,credit:_.amount,user:!0}))],h=[...r.map(_=>({time:_.created_at,description:_.description,debit:_.debit,credit:_.credit}))],u=c.concat(e);u=u.concat(h),u.sort((_,I)=>I.time-_.time),u==null||u.forEach((_,I)=>{let R=l.cloneNode(!0);R.setAttribute("id","");let f=R.querySelectorAll(".colcontent");I%2===0&&(R.style.backgroundColor="#00edf4"),f[0].innerText=D(_.time),f[1].innerText=_.description||"",f[2].innerText=_.debit||"",f[3].innerText=_.credit||"",s.append(R)}),l.remove()}function m(){let o=document.getElementById("entry-form-block").querySelector("#entry-btn");o.onclick=()=>{o.disabled||(o.disabled=!0,o.value="Submitting...",o.classList.contains("disabled")||o.classList.add("disabled"),d())}}function d(){return g(this,null,function*(){let a=$("#entry-form-block");if(a.attr("id")==="entry-form-block"){let o=U();if(o){let r=a[0][0].value||"",s=a[0][1].value||"",l=a[0][2].value||"";if(r!==""&&(s!==""||l!=="")){let e=yield y(v,"POST",{month:t,year:n,description:r,debit:s,credit:l},o);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),a.hide().siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Failed to add new entry. Please try again - Error: "+e.message);return}a.hide().siblings(".w-form-fail").hide().siblings(".w-form-done").show().text("Successfully added new entry!"),C()}}}})}})();var X=X||[];X.push(function(){$(document).off("submit"),$("form").on("change",function(){let t=$(this);if(t.attr("id")==="entry-form-block"){let n=t[0][0].value||"",i=t[0][1].value||"",p=t[0][2].value||"",m=document.getElementById("entry-form-block").querySelector("#entry-btn");n!==""&&(i!==""||p!=="")?(m.disabled=!1,m.classList.remove("disabled")):(m.disabled=!0,m.classList.contains("disabled")||m.classList.addClass("disabled"))}}),$("form").on("submit",function(t){return g(this,null,function*(){t.preventDefault()})})});
//# sourceMappingURL=all-finance-detail.js.map
