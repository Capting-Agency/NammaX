var P=Object.defineProperty,H=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var b=(t,o,a)=>o in t?P(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,I=(t,o)=>{for(var a in o||={})G.call(o,a)&&b(t,a,o[a]);if(T)for(var a of T(o))W.call(o,a)&&b(t,a,o[a]);return t},S=(t,o)=>H(t,F(o));var R=(t,o,a)=>new Promise((u,x)=>{var m=n=>{try{i(a.next(n))}catch(r){x(r)}},d=n=>{try{i(a.throw(n))}catch(r){x(r)}},i=n=>n.done?u(n.value):Promise.resolve(n.value).then(m,d);i((a=a.apply(t,o)).next())});var w=["January","February","March","April","May","June","July","August","September","October","November","December"],N={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function y(t,o="GET",a=!1,u=!1,x=!1,m=!0){try{let d={"Content-Type":"application/json"};x&&(d={}),u&&(d.Authorization=`Bearer ${u}`);let i={method:o,headers:d};return a&&(m?i.body=JSON.stringify(a):i.body=a),fetch(t,i).then(n=>n.ok?n.json():n.json().then(r=>(Promise.reject(r.message),{isFetchOk:!1,status:n.status,message:r.message,payload:r&&r.payload?r.payload:null}))).then(n=>n).catch(n=>(console.error("Error in fetch",n),n))}catch(d){return console.error("Error!: "+d),d}}function D(t="nammax_auth"){let a=`; ${document.cookie}`.split(`; ${t}=`);return a.length===2?a.pop().split(";").shift():null}function h(t="/",o=2e3){setTimeout(()=>{window.location.href=t},o)}function C(t=1e3){setTimeout(()=>{window.location.reload()},t)}function U(t=null){if(t==null)return"NaN";let o=new Date(t);return`${o.getDate()}/${o.getMonth()+1}/${o.getFullYear()}`}function B(t="/admin/sign-in",o="sidebar-logout-btn"){let a=document.getElementById(o);a?a.onclick=()=>Y(t):console.error("Logout button not found")}function Y(t="/sign-in"){window.localStorage.removeItem("auth"),h(`${t}`)}function E(t=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(t)).replace(/^(\D+)/,"$1 ")}function k(t=N.ADMIN){if(t===N.ADMIN){let o=document.getElementById("admin-nav"),a=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),a&&a.remove()}else if(t===N.SUPER_ADMIN){let o=document.getElementById("admin-nav"),a=document.getElementById("super-admin-nav");a&&(a.style.display="flex"),o&&o.remove()}}function M(){let t=document.getElementById("loading-screen");t?t.remove():console.log("did not find loading screen")}var v=Webflow||[];var L="/admin/sign-in";var X="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/all_finance_detail",K="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/all_finance_detail/new_entry";(()=>{let t,o;window.onload=function(){return R(this,null,function*(){B("/admin/sign-in","sidebar-logout-btn");var i=new URL(document.location.href);if(t=i.searchParams.get("month")||null,o=i.searchParams.get("year")||null,!t||!o){console.error("No month or year found");return}let n=D();if(n){let s=yield y(X,"POST",{month:t,year:o},n);if(s.isFetchOk!==void 0&&!s.isFetchOk){console.error(s.message),s.payload&&s.payload.role===N.ADMIN&&s.payload.gyms&&s.payload.gyms.length>0?h(`/admin/gym/g?gymCode=${s.payload.gyms[0].gym_id}`):h(`${L}?reason=UNAUTHORIZED_USER`);return}k(N.SUPER_ADMIN),a(s,n)}else h(`${L}?reason=NOT_SIGNED_IN`)})};function a(i){let{finance:n,external_finance:r,payment_ledger:s}=i,l={};n.map(e=>l[e.month+","+e.year]!==void 0?l[e.month+","+e.year]=S(I({},l[e.month+","+e.year]),{additional_revenue:e.additional_revenue+l[e.month+","+e.year].additional_revenue,additional_expenses:e.additional_expenses+l[e.month+","+e.year].additional_expenses,gross_revenue:e.gross_revenue+l[e.month+","+e.year].gross_revenue,member_revenue:e.member_revenue+l[e.month+","+e.year].member_revenue,fixed_expense:e.fixed_expense+l[e.month+","+e.year].fixed_expense,net_profit:e.net_profit+l[e.month+","+e.year].net_profit}):l[e.month+","+e.year]=e);let c=l;r.map(e=>c[e.month+","+e.year]!==void 0?c[e.month+","+e.year]=S(I({},c[e.month+","+e.year]),{additional_revenue:e.credit+c[e.month+","+e.year].additional_revenue,additional_expenses:e.debit+c[e.month+","+e.year].additional_expenses}):e),m(),u(c),x([...n.map(e=>e.additional_entries)],s,r),M()}function u(i){let{month:n,year:r,member_revenue:s,fixed_expense:l,gross_revenue:c,additional_revenue:e,additional_expenses:p}=i[t+","+o],A=Number(c)+Number(e)-Number(p);document.getElementById("finance-month").innerText=w[n-1],document.getElementById("finance-year").innerText=r,document.getElementById("financial-member-revenue").innerText=E(s)||"0",document.getElementById("financial-fixed-expense").innerText=E(l)||"0",document.getElementById("financial-gross-revenue").innerText=E(c)||"0",document.getElementById("financial-additional-revenue").innerText=E(e)||"0",document.getElementById("financial-additional-expenses").innerText=E(p)||"0",document.getElementById("financial-net-profit").innerText=E(A)||"0"}function x(i=[],n=[],r=[]){let s=document.getElementById("account-table-container"),l=s.querySelector("#account-table-item"),c=i.flat(1),e=[...n.map(_=>({time:_.time,description:`${_.name}  (${_.mode_of_payment} | ${U(_.membership_end_date)})`,debit:null,credit:_.amount,user:!0}))],p=[...r.map(_=>({time:_.created_at,description:_.description,debit:_.debit,credit:_.credit}))],A=c.concat(e);A=A.concat(p),A.sort((_,O)=>O.time-_.time),A==null||A.forEach((_,O)=>{let f=l.cloneNode(!0);f.setAttribute("id","");let g=f.querySelectorAll(".colcontent");O%2===0&&(f.style.backgroundColor="#00edf4"),g[0].innerText=U(_.time),g[1].innerText=_.description||"",g[2].innerText=_.debit||"",g[3].innerText=_.credit||"",s.append(f)}),l.remove()}function m(){let n=document.getElementById("entry-form-block").querySelector("#entry-btn");n.onclick=()=>{n.disabled||(n.disabled=!0,n.value="Submitting...",n.classList.contains("disabled")||n.classList.add("disabled"),d())}}function d(){return R(this,null,function*(){let i=$("#entry-form-block");if(i.attr("id")==="entry-form-block"){let n=document.getElementById("entry-btn");n&&(n.disabled=!0);let r=D();if(r){let s=i[0][0].value||"",l=i[0][1].value||"",c=i[0][2].value||"";if(s!==""&&(l!==""||c!=="")){let p=yield y(K,"POST",{month:t,year:o,description:s,debit:l,credit:c},r);if(p.isFetchOk!==void 0&&!p.isFetchOk){console.error(p.message),i.hide().siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Failed to add new entry. Please try again - Error: "+p.message),n&&(n.disabled=!1);return}i.hide().siblings(".w-form-fail").hide().siblings(".w-form-done").show().text("Successfully added new entry!"),C()}}}})}})();var j=v||[];j.push(function(){$(document).off("submit"),$("form").on("change",function(){let t=$(this);if(t.attr("id")==="entry-form-block"){let o=t[0][0].value||"",a=t[0][1].value||"",u=t[0][2].value||"",m=document.getElementById("entry-form-block").querySelector("#entry-btn");o!==""&&(a!==""||u!=="")?(m.disabled=!1,m.classList.remove("disabled")):(m.disabled=!0,m.classList.contains("disabled")||m.classList.addClass("disabled"))}}),$("form").on("submit",function(t){return R(this,null,function*(){t.preventDefault()})})});
