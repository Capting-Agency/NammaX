var N=(e,t,n)=>new Promise((r,_)=>{var c=i=>{try{o(n.next(i))}catch(a){_(a)}},l=i=>{try{o(n.throw(i))}catch(a){_(a)}},o=i=>i.done?r(i.value):Promise.resolve(i.value).then(c,l);o((n=n.apply(e,t)).next())});var p={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function h(e,t="GET",n=!1,r=!1,_=!1,c=!0){try{let l={"Content-Type":"application/json"};_&&(l={}),r&&(l.Authorization=`Bearer ${r}`);let o={method:t,headers:l};return n&&(c?o.body=JSON.stringify(n):o.body=n),fetch(e,o).then(i=>i.ok?i.json():i.json().then(a=>(Promise.reject(a.message),{isFetchOk:!1,status:i.status,message:a.message,payload:a&&a.payload?a.payload:null}))).then(i=>i).catch(i=>(console.error("Error in fetch",i),i))}catch(l){return console.error("Error!: "+l),l}}function R(e="nammax_auth"){let n=`; ${document.cookie}`.split(`; ${e}=`);return n.length===2?n.pop().split(";").shift():null}function x(e="/",t=2e3){setTimeout(()=>{window.location.href=e},t)}function T(e=null){if(e==null)return"NaN";let t=new Date(e);return`${t.getDate()}/${t.getMonth()+1}/${t.getFullYear()}`}function L(e=null){if(e==null)return"NaN";let t=e.split("-"),n=Date.now()-new Date(parseInt(t[2]),parseInt(t[1])-1,parseInt(t[0])).getTime(),r=new Date(n);return Math.abs(r.getUTCFullYear()-1970)}function C(e="/admin/sign-in",t="sidebar-logout-btn"){let n=document.getElementById(t);n?n.onclick=()=>v(e):console.error("Logout button not found")}function v(e="/sign-in"){window.localStorage.removeItem("auth"),x(`${e}`)}function w(e=p.ADMIN){if(e===p.ADMIN){let t=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");t&&(t.style.display="flex"),n&&n.remove()}else if(e===p.SUPER_ADMIN){let t=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),t&&t.remove()}}function M(){let e=document.getElementById("loading-screen");e?e.remove():console.log("did not find loading screen")}function y(e){let t=new Date(e);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t}function S(e,t,n=!1){let r=864e5;return Math.round((y(t)-y(e))/r)}function k({mode:e="API",clientObjRefName:t="name",data:n,token:r,API:_,extraXanoInputObj:c=[],searchContainerElId:l=""},o,i=null,a=null){let s,u,m;if(l.length>0){let E=document.getElementById(l);s=E.querySelector("#search-input"),s.setAttribute("placeholder","Search"),u=E.querySelector("#search-btn"),m=E.querySelector("#search-reset-btn")}else s=document.getElementById("search-input"),s.setAttribute("placeholder","Search"),u=document.getElementById("search-btn"),m=document.getElementById("search-reset-btn");m.onclick=()=>{s.value="",B(m,{mode:e,clientObjRefName:t,data:n,searchquery:"",token:r,API:_,extraXanoInputObj:c},o,i,a)},u.onclick=()=>{let E=s.value;B(m,{mode:e,clientObjRefName:t,data:n,searchquery:E,token:r,API:_,extraXanoInputObj:c},o,i,a)}}function B(u,m,E,ot,it){return N(this,arguments,function*(e,{mode:t,clientObjRefName:n,data:r,searchquery:_,token:c,API:l,extraXanoInputObj:o=[]},i,a,s){if(_.length===0)e.style.display="none",a?i(r,a):i(r);else try{if(t==="API"){let d={search_query:`${_}:*`};o.length>0&&o.map(X=>{for(let[K,H]of Object.entries(X))d[K]=H});let A=yield h(l+"query","POST",d,c);if(A.isFetchOk!==void 0&&!A.isFetchOk)throw console.error(A.message),Error("API call failed");e.style.display="flex",a?i(A,a):i(A)}else{let d=r.filter(A=>A[n].toLowerCase().includes(_.toLowerCase()));e.style.display="flex",a?i(d,a):i(d)}}catch(d){s?s():console.error(d)}})}var g="/admin/sign-in";var O="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/all_users";var b="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";var D=null,I=0,f=[];window.onload=function(){return N(this,null,function*(){C(g,"sidebar-logout-btn");let e=R();if(e){let t=yield h(O+"/1","GET",!1,e);if(t.isFetchOk!==void 0&&!t.isFetchOk){console.error(t.message),t.payload&&t.payload.role===p.ADMIN&&t.payload.gyms&&t.payload.gyms.length>0?x(`/admin/gym/g?gymCode=${t.payload.gyms[0].gym_id}`):x(`${g}?reason=UNAUTHORIZED_USER`);return}w(p.SUPER_ADMIN),$(t,e)}else x(`${g}?reason=NOT_SIGNED_IN`)})};function $(e,t){return N(this,null,function*(){U(e),k({data:e,token:t,API:b},U),M()})}function U(e,t=!1){let n=document.getElementById("table-container"),r=n.querySelector("#table-item");function _(c){D=c.nextPage;let l=n.querySelectorAll(".adb-user.w-inline-block");l.forEach((o,i)=>{i!==l.length-1&&o.remove()}),f.items.forEach((o,i)=>{let a=r.cloneNode(!0);a.setAttribute("id",""),a.setAttribute("href",`/admin/user?userId=${o.id}`);let s=a.querySelectorAll(".colcontent");if(i%2===0&&(a.style.backgroundColor="#00edf4"),o.profile_picture&&(s[0].style.backgroundImage=`url(${o.profile_picture.url})`),o.membership_end_date){let u=new Date(o.membership_end_date),m=new Date;(o==null?void 0:o.session_ledger)!==void 0&&o.session_ledger.length<=3?s[0].style.border="3px solid #009ca1":S(m,u,!0)<=3?s[0].style.border="3px solid red":S(m,u,!0)<=7&&(s[0].style.border="3px solid orange")}s[1].innerText=o.name,s[2].innerText=o.code,s[3].innerText="NaN",s[4].innerText=o.gender.charAt(0),s[5].innerText=L(o.date_of_birth),o.session_ledger.length>0?s[6].innerText=T(o.session_ledger[o.session_ledger.length-1].time):s[6].innerText="N/A",a.style.display="flex",n.prepend(a)})}t?(f.items.push(...e.items),f.nextPage=e.nextPage):f=e,_(f),r.style.display="none"}var P=new IntersectionObserver(e=>{e[0].intersectionRatio<=0||(I>0&&D?G(D):I<1&&I++)});P.observe(document.querySelector(".loadmore"));function G(e){return N(this,null,function*(){let t=R();if(t){let n=yield h(O+`/${e}`,"GET",!1,t);if(n.isFetchOk!==void 0&&!n.isFetchOk){console.error(n.message),n.payload&&n.payload.role===p.ADMIN&&n.payload.gyms&&n.payload.gyms.length>0?x(`/admin/gym/g?gymCode=${n.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}U(n,!0)}})}
