var E=(o,t,n)=>new Promise((r,s)=>{var _=i=>{try{e(n.next(i))}catch(c){s(c)}},a=i=>{try{e(n.throw(i))}catch(c){s(c)}},e=i=>i.done?r(i.value):Promise.resolve(i.value).then(_,a);e((n=n.apply(o,t)).next())});var M=["Male","Female","Other","Prefer not to say"];var A={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"},m=["DROPOUT","NO SHOW","NEW USER","TRIAL","NO RENEWAL","NO MEMBERSHIP","HAS MEMBERSHIP"];function h(o,t="GET",n=!1,r=!1,s=!1,_=!0){try{let a={"Content-Type":"application/json"};s&&(a={}),r&&(a.Authorization=`Bearer ${r}`);let e={method:t,headers:a};return n&&(_?e.body=JSON.stringify(n):e.body=n),fetch(o,e).then(i=>i.ok?i.json():i.json().then(c=>(Promise.reject(c.message),{isFetchOk:!1,status:i.status,message:c.message,payload:c&&c.payload?c.payload:null}))).then(i=>i).catch(i=>(console.error("Error in fetch",i),i))}catch(a){return console.error("Error!: "+a),a}}function b(o="nammax_auth"){let n=`; ${document.cookie}`.split(`; ${o}=`);return n.length===2?n.pop().split(";").shift():null}function g(o="/",t=2e3){setTimeout(()=>{window.location.href=o},t)}function X(o=null){if(o==null)return"NaN";let t=new Date(o);return`${t.getDate()}/${t.getMonth()+1}/${t.getFullYear()}`}function j(o="/admin/sign-in",t="sidebar-logout-btn"){let n=document.getElementById(t);n?n.onclick=()=>Z(o):console.error("Logout button not found")}function Z(o="/sign-in"){window.localStorage.removeItem("auth"),g(`${o}`)}function Q(o=new Date,t=0){let n=o;return n&&n.setDate(n.getDate()+t),n}function z(o=A.ADMIN){if(o===A.ADMIN){let t=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");t&&(t.style.display="flex"),n&&n.remove()}else if(o===A.SUPER_ADMIN){let t=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),t&&t.remove()}}function v(){let o=document.getElementById("loading-screen");o?o.remove():console.warn("Loading screen not found")}function w(o){let t=new Date(o);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t}function B(o,t,n=!1){let r=864e5;return Math.round((w(t)-w(o))/r)}function P(o,t,n,r,s){let _=Q(new Date(o),7),a=new Date().getTime(),e=t,i=n,c=r?new Date(r).getTime():null,l="";return e===0?i===2&&_&&_.getTime()>a?l=m[0]:i===0&&_&&_.getTime()>a&&(l=m[1]):e===2&&i===0&&s===m[3]?l=m[2]:s===m[3]?l=m[3]:s!==m[3]&&i>0&&_&&_.getTime()>a&&c&&c<=a?l=m[4]:i>3&&s==="INACTIVE"?l=m[5]:s!=="INACTIVE"&&s!==m[3]&&(l=m[6]),l}function U({tag:o="gym",API:t=null,parentTableName:n="user-table-subscription-header",tableColumnContainerName:r="user-table-gym-header",extraXanoInputObj:s=[],filterData:_=null,searchContainerElId:a=""},e,i){if(!_){console.error("No Filter Data provided");return}let c=document.getElementById(r);if(!c){console.error("Failed to find column container");return}let l=c.querySelector("#filter-search");if(!l){console.error("Failed to find column filter");return}te(r,l,_),c.onclick=u=>{u.stopPropagation(),l.style.display="block"};let f=l.querySelector("#close-btn");f?f.onclick=u=>{u.stopPropagation(),l.style.display="none"}:console.error("Failed to find close btn");let p=c.querySelector("#filter-btn");if(!p){console.error("Failed to find submit filter btn");return}p.onclick=()=>{let u=l.querySelector(`input[name="${r}"]:checked`).value,R;a.length>0?R=document.getElementById(a).querySelector("#search-input"):R=document.getElementById("search-input"),ee(o,u,t,i,e,R.value,n,r,l,s)};let d=c.querySelector("#reset-filter-btn");if(!d){console.error("Failed to find reset filter btn");return}d.onclick=u=>{u.stopPropagation(),K("","",t,i,e,"",s,!0),H("hide",n,r,l)}}function ee(o,t,n,r,s,_,a,e,i,c){return E(this,null,function*(){K(o,t,n,r,s,_,c),H("show",a,e,i)})}function K(i,c,l,f,p,d){return E(this,arguments,function*(o,t,n,r,s,_,a=[],e=!1){if(e){r&&r({isFilter:!0,filterQueries:{},API:n,isReset:e});return}let u={search_query:(_==null?void 0:_.length)>0?`${_}:*`:"",tag:o,filter:t||""};a.length>0&&a.map(R=>{for(let[x,N]of Object.entries(R))u[x]=N}),s=u,r&&r({isFilter:!0,filterQueries:s,API:n})})}function H(o="show",t,n,r){let s=document.getElementById(t);if(!s){console.error("Could not find parent table name");return}if(s.querySelectorAll(".text-w").forEach(a=>{a.style.textDecoration="none"}),o==="show"){let a=document.getElementById(n);if(!a){console.error("Could not find column name");return}a.style.textDecoration="underline",r.querySelector("#reset-filter-btn").style.display="block"}else o==="hide"&&(r.querySelector("#reset-filter-btn").style.display="none");setTimeout(()=>{r.style.display="none"},500)}function te(o,t,n){let r=t.querySelector("label");n.forEach(s=>{let _=r.cloneNode(!0),a=_.querySelector("input"),e=_.querySelector("span");a.value=s.value,a.name=o,e.innerText=s.text,t.prepend(_)}),r.remove()}function F({mode:o="API",clientObjRefName:t="name",data:n,token:r,API:s,extraXanoInputObj:_=[],searchContainerElId:a=""},e,i=null,c=null){let l,f,p;if(a.length>0){let d=document.getElementById(a);l=d.querySelector("#search-input"),l.setAttribute("placeholder","Search"),f=d.querySelector("#search-btn"),p=d.querySelector("#search-reset-btn")}else l=document.getElementById("search-input"),l.setAttribute("placeholder","Search"),f=document.getElementById("search-btn"),p=document.getElementById("search-reset-btn");p.onclick=()=>{l.value="",$(p,{mode:o,clientObjRefName:t,data:n,searchquery:"",token:r,API:s,extraXanoInputObj:_},e,i,c)},f.onclick=()=>{let d=l.value;$(p,{mode:o,clientObjRefName:t,data:n,searchquery:d,token:r,API:s,extraXanoInputObj:_},e,i,c)}}function $(f,p,d,u,R){return E(this,arguments,function*(o,{mode:t,clientObjRefName:n,data:r,searchquery:s,token:_,API:a,extraXanoInputObj:e=[]},i,c,l){if(s.length===0)o.style.display="none",c?i(r,c):i(r);else try{if(t==="API"){let x={search_query:`${s}:*`};e.length>0&&e.map(Y=>{for(let[V,J]of Object.entries(Y))x[V]=J});let N=yield h(a+"query","POST",x,_);if(N.isFetchOk!==void 0&&!N.isFetchOk)throw console.error(N.message),Error("API call failed");o.style.display="flex",c?i(N,c):i(N)}else{let x=r.filter(N=>N[n].toLowerCase().includes(s.toLowerCase()));o.style.display="flex",c?i(x,c):i(x)}}catch(x){l?l():console.error(x)}})}var T="/admin/sign-in";var k="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/super_admin/dashboard",G="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/super_admin/all_users";var O="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";var oe="https://www.nammacrossfit.com",q=oe;var xe=`${q}/sign-up-2`;var Ae=`${q}/user/dashboard`;var y=null,L=0,I=[],S={},W="";window.onload=function(){return E(this,null,function*(){j(T,"sidebar-logout-btn");let o=b();if(o){let t=yield h(G+"/1","GET",!1,o);if(t.isFetchOk!==void 0&&!t.isFetchOk){console.error(t.message),t.payload&&t.payload.role===A.ADMIN&&t.payload.gyms&&t.payload.gyms.length>0?g(`/admin/gym/g?gymCode=${t.payload.gyms[0].gym_id}`):g(`${T}?reason=UNAUTHORIZED_USER`);return}z(A.SUPER_ADMIN),ne(t,o)}else g(`${T}?reason=NOT_SIGNED_IN`)})};function ne(o,t){return E(this,null,function*(){let{users:n,gyms:r}=o;D(n),F({data:n,token:t,API:O},D),U({tag:"gym",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gym-header",filterData:r.map(s=>({text:s.code,value:s.id})),API:O},S,C),U({tag:"subscription",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-subscription-header",filterData:m.map(s=>({text:s,value:s})),API:O},S,C),U({tag:"gender",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gender-header",filterData:M.map(s=>({text:s,value:s})),API:O},S,C),v()})}function D(o,t=!1){let n=document.getElementById("table-container"),r=n.querySelector("#table-item");function s(_){y=_.nextPage;let a=n.querySelectorAll(".adb-user.w-inline-block");a.forEach((e,i)=>{i!==a.length-1&&(i!==a.length-2||L>0)&&(console.log("removing item",e),e.remove())}),I.items.forEach((e,i)=>{let c=r.cloneNode(!0);c.setAttribute("id",""),c.setAttribute("href",`/admin/user?userId=${e.id}`);let l=c.querySelectorAll(".colcontent");if(i%2===0&&(c.style.backgroundColor="#00edf4"),e.profile_picture&&(l[0].style.backgroundImage=`url(${e.profile_picture.url})`),e.membership_end_date){let p=new Date(e.membership_end_date),d=new Date;(e==null?void 0:e.session_ledger)!==void 0&&e.session_ledger.length<=3?l[0].style.border="3px solid #009ca1":B(d,p,!0)<=3?l[0].style.border="3px solid red":B(d,p,!0)<=7&&(l[0].style.border="3px solid orange")}l[1].innerText=e.name||"",l[2].innerText=e.code||"Unselected";let f="";f=P(e.created_at,e.tokens,e.session_ledger.length,e.membership_end_date,e.membership_status)||"",l[3].innerText=f||e.membership_status||"INACTIVE",l[4].innerText=e.gender||"Unselected",l[5].innerText=e.session_ledger.length||0,e.session_ledger.length>0?l[6].innerText=X(e.session_ledger[e.session_ledger.length-1].time):l[6].innerText="N/A",c.style.display="flex",n.prepend(c)})}t?(I.items.push(...o.items),I.nextPage=o.nextPage):I=o,s(I),r.style.display="none"}var se=document.getElementById("table-container"),re=new IntersectionObserver(o=>{o[0].intersectionRatio<=0||(L>0&&y?C({},y):L<1&&L++)},{root:se,threshold:[0,1]});re.observe(document.querySelector(".loadmore"));function C(_){return E(this,arguments,function*({isFilter:o=!1,filterQueries:t=S||{},API:n=W,isReset:r=!1},s=y){let a=b();if(a)if(Object.entries(t).length>0&&n)if(S=t,W=n,o){let e=yield h(n+"query","POST",t,a);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===A.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?g(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.error("error fetching paginated");return}else{D(e,!1);return}}else{t.page=s;let e=yield h(n+"query","POST",t,a);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===A.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?g(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.error("error fetching paginated");return}else{D(e,y);return}}else{r&&(y=null,s=1,S={});let e=yield h(k+`/${s}`,"GET",!1,a);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===A.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?g(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.error("error fetching paginated");return}D(e.users,!1)}})}
