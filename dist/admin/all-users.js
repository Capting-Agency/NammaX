var N=(n,e,t)=>new Promise((i,s)=>{var _=r=>{try{o(t.next(r))}catch(a){s(a)}},l=r=>{try{o(t.throw(r))}catch(a){s(a)}},o=r=>r.done?i(r.value):Promise.resolve(r.value).then(_,l);o((t=t.apply(n,e)).next())});var C=["Male","Female","Other","Prefer not to say"];var h={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"},f=["DROPOUT","NO SHOW","NEW USER","TRIAL","NO RENEWAL","NO MEMBERSHIP"];function E(n,e="GET",t=!1,i=!1,s=!1,_=!0){try{let l={"Content-Type":"application/json"};s&&(l={}),i&&(l.Authorization=`Bearer ${i}`);let o={method:e,headers:l};return t&&(_?o.body=JSON.stringify(t):o.body=t),fetch(n,o).then(r=>r.ok?r.json():r.json().then(a=>(Promise.reject(a.message),{isFetchOk:!1,status:r.status,message:a.message,payload:a&&a.payload?a.payload:null}))).then(r=>r).catch(r=>(console.error("Error in fetch",r),r))}catch(l){return console.error("Error!: "+l),l}}function U(n="nammax_auth"){let t=`; ${document.cookie}`.split(`; ${n}=`);return t.length===2?t.pop().split(";").shift():null}function g(n="/",e=2e3){setTimeout(()=>{window.location.href=n},e)}function M(n=null){if(n==null)return"NaN";let e=new Date(n);return`${e.getDate()}/${e.getMonth()+1}/${e.getFullYear()}`}function k(n="/admin/sign-in",e="sidebar-logout-btn"){let t=document.getElementById(e);t?t.onclick=()=>Y(n):console.error("Logout button not found")}function Y(n="/sign-in"){window.localStorage.removeItem("auth"),g(`${n}`)}function X(n=new Date,e=0){let t=n;return t&&t.setDate(t.getDate()+e),t}function v(n=h.ADMIN){if(n===h.ADMIN){let e=document.getElementById("admin-nav"),t=document.getElementById("super-admin-nav");e&&(e.style.display="flex"),t&&t.remove()}else if(n===h.SUPER_ADMIN){let e=document.getElementById("admin-nav"),t=document.getElementById("super-admin-nav");t&&(t.style.display="flex"),e&&e.remove()}}function P(){let n=document.getElementById("loading-screen");n?n.remove():console.log("did not find loading screen")}function B(n){let e=new Date(n);return e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e}function T(n,e,t=!1){let i=864e5;return Math.round((B(e)-B(n))/i)}function D({tag:n="gym",API:e=null,parentTableName:t="user-table-subscription-header",tableColumnContainerName:i="user-table-gym-header",extraXanoInputObj:s=[],filterData:_=null,searchContainerElId:l="",token:o},r){if(!_){console.error("No Filter Data provided");return}let a=document.getElementById(i);if(!a){console.error("Failed to find column container");return}let c=a.querySelector("#filter-search");if(!c){console.error("Failed to find column filter");return}z(i,c,_),a.onclick=p=>{p.stopPropagation(),c.style.display="block"};let u=c.querySelector("#close-btn");u?u.onclick=p=>{p.stopPropagation(),c.style.display="none"}:console.error("Failed to find close btn");let m=a.querySelector("#filter-btn");if(!m){console.error("Failed to find submit filter btn");return}m.onclick=()=>{let p=c.querySelector(`input[name="${i}"]:checked`).value,y;l.length>0?y=document.getElementById(l).querySelector("#search-input"):y=document.getElementById("search-input"),j(n,p,e,r,o,y.value,t,i,c,s)};let d=a.querySelector("#reset-filter-btn");if(!d){console.error("Failed to find reset filter btn");return}d.onclick=p=>{p.stopPropagation(),K("","",e,r,o,"",s),H("hide",t,i,c)}}function j(n,e,t,i,s,_,l,o,r,a){return N(this,null,function*(){K(n,e,t,i,s,_,a),H("show",l,o,r)})}function K(o,r,a,c,u,m){return N(this,arguments,function*(n,e,t,i,s,_,l=[]){let d={search_query:(_==null?void 0:_.length)>0?`${_}:*`:"",tag:n,filter:e||""};l.length>0&&l.map(y=>{for(let[A,x]of Object.entries(y))d[A]=x});let p=yield E(t+"query","POST",d,s);if(p.isFetchOk!==void 0&&!p.isFetchOk)throw console.error(p.message),Error("API call failed");i&&i(p)})}function H(n="show",e,t,i){let s=document.getElementById(e);if(!s){console.error("Could not find parent table name");return}if(s.querySelectorAll(".text-w").forEach(l=>{l.style.textDecoration="none"}),n==="show"){let l=document.getElementById(t);if(!l){console.error("Could not find column name");return}l.style.textDecoration="underline",i.querySelector("#reset-filter-btn").style.display="block"}else n==="hide"&&(i.querySelector("#reset-filter-btn").style.display="none");setTimeout(()=>{i.style.display="none"},500)}function z(n,e,t){let i=e.querySelector("label");t.forEach(s=>{let _=i.cloneNode(!0),l=_.querySelector("input"),o=_.querySelector("span");l.value=s.value,l.name=n,o.innerText=s.text,e.prepend(_)}),i.remove()}function F({mode:n="API",clientObjRefName:e="name",data:t,token:i,API:s,extraXanoInputObj:_=[],searchContainerElId:l=""},o,r=null,a=null){let c,u,m;if(l.length>0){let d=document.getElementById(l);c=d.querySelector("#search-input"),c.setAttribute("placeholder","Search"),u=d.querySelector("#search-btn"),m=d.querySelector("#search-reset-btn")}else c=document.getElementById("search-input"),c.setAttribute("placeholder","Search"),u=document.getElementById("search-btn"),m=document.getElementById("search-reset-btn");m.onclick=()=>{c.value="",$(m,{mode:n,clientObjRefName:e,data:t,searchquery:"",token:i,API:s,extraXanoInputObj:_},o,r,a)},u.onclick=()=>{let d=c.value;$(m,{mode:n,clientObjRefName:e,data:t,searchquery:d,token:i,API:s,extraXanoInputObj:_},o,r,a)}}function $(u,m,d,p,y){return N(this,arguments,function*(n,{mode:e,clientObjRefName:t,data:i,searchquery:s,token:_,API:l,extraXanoInputObj:o=[]},r,a,c){if(s.length===0)n.style.display="none",a?r(i,a):r(i);else try{if(e==="API"){let A={search_query:`${s}:*`};o.length>0&&o.map(G=>{for(let[q,W]of Object.entries(G))A[q]=W});let x=yield E(l+"query","POST",A,_);if(x.isFetchOk!==void 0&&!x.isFetchOk)throw console.error(x.message),Error("API call failed");n.style.display="flex",a?r(x,a):r(x)}else{let A=i.filter(x=>x[t].toLowerCase().includes(s.toLowerCase()));n.style.display="flex",a?r(A,a):r(A)}}catch(A){c?c():console.error(A)}})}var I="/admin/sign-in";var w="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/all_users";var R="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";var b=null,L=0,O=[];window.onload=function(){return N(this,null,function*(){k(I,"sidebar-logout-btn");let n=U();if(n){let e=yield E(w+"/1","GET",!1,n);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===h.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?g(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):g(`${I}?reason=UNAUTHORIZED_USER`);return}v(h.SUPER_ADMIN),J(e,n)}else g(`${I}?reason=NOT_SIGNED_IN`)})};function J(n,e){return N(this,null,function*(){let{users:t,gyms:i}=n;S(t),F({data:t,token:e,API:R},S),D({tag:"gym",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gym-header",filterData:i.map(s=>({text:s.code,value:s.id})),token:e,API:R},S),D({tag:"subscription",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-subscription-header",filterData:f.map(s=>({text:s,value:s})),token:e,API:R},S),D({tag:"gender",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gender-header",filterData:C.map(s=>({text:s,value:s})),token:e,API:R},S),P()})}function S(n,e=!1){let t=document.getElementById("table-container"),i=t.querySelector("#table-item");function s(_){b=_.nextPage;let l=t.querySelectorAll(".adb-user.w-inline-block");l.forEach((o,r)=>{r!==l.length-1&&o.remove()}),O.items.forEach((o,r)=>{let a=i.cloneNode(!0);a.setAttribute("id",""),a.setAttribute("href",`/admin/user?userId=${o.id}`);let c=a.querySelectorAll(".colcontent");if(r%2===0&&(a.style.backgroundColor="#00edf4"),o.profile_picture&&(c[0].style.backgroundImage=`url(${o.profile_picture.url})`),o.membership_end_date){let d=new Date(o.membership_end_date),p=new Date;(o==null?void 0:o.session_ledger)!==void 0&&o.session_ledger.length<=3?c[0].style.border="3px solid #009ca1":T(p,d,!0)<=3?c[0].style.border="3px solid red":T(p,d,!0)<=7&&(c[0].style.border="3px solid orange")}c[1].innerText=o.name,c[2].innerText=o.code||"unselected";let u=X(new Date(o.created_at),7),m="";o.tokens===2&&o.session_ledger.length===0&&u.getTime()<new Date().getTime()?m=f[0]:o.tokens===0&&o.session_ledger.length===0&&u.getTime()>new Date().getTime()?m=f[1]:o.tokens===2&&o.session_ledger.length===0?m=f[2]:o.tokens===1&&o.session_ledger.length===1?m=f[3]:o.membership_status!=="TRIAL"&&o.session_ledger.length>0&&u.getTime()>new Date().getTime()?m=f[4]:o.membership_end_date&&new Date(o.membership_end_date).getTime()<new Date().getTime()&&(m=f[5]),c[3].innerText=m||o.membership_status||"INACTIVE",c[4].innerText=o.gender.charAt(0),c[5].innerText=o.session_ledger.length||0,o.session_ledger.length>0?c[6].innerText=M(o.session_ledger[o.session_ledger.length-1].time):c[6].innerText="N/A",a.style.display="flex",t.prepend(a)})}e?(O.items.push(...n.items),O.nextPage=n.nextPage):O=n,s(O),i.style.display="none"}var V=new IntersectionObserver(n=>{n[0].intersectionRatio<=0||(L>0&&b?Q(b):L<1&&L++)});V.observe(document.querySelector(".loadmore"));function Q(n){return N(this,null,function*(){let e=U();if(e){let t=yield E(w+`/${n}`,"GET",!1,e);if(t.isFetchOk!==void 0&&!t.isFetchOk){console.error(t.message),t.payload&&t.payload.role===h.ADMIN&&t.payload.gyms&&t.payload.gyms.length>0?g(`/admin/gym/g?gymCode=${t.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}S(t,!0)}})}
