var L=Object.defineProperty,C=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var R=(e,i,n)=>i in e?L(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n,x=(e,i)=>{for(var n in i||={})b.call(i,n)&&R(e,n,i[n]);if(f)for(var n of f(i))B.call(i,n)&&R(e,n,i[n]);return e},E=(e,i)=>C(e,w(i));var S=(e,i,n)=>new Promise((d,p)=>{var s=o=>{try{l(n.next(o))}catch(t){p(t)}},r=o=>{try{l(n.throw(o))}catch(t){p(t)}},l=o=>o.done?d(o.value):Promise.resolve(o.value).then(s,r);l((n=n.apply(e,i)).next())});var N=["January","February","March","April","May","June","July","August","September","October","November","December"],c={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function I(e,i="GET",n=!1,d=!1,p=!1,s=!0){try{let r={"Content-Type":"application/json"};p&&(r={}),d&&(r.Authorization=`Bearer ${d}`);let l={method:i,headers:r};return n&&(s?l.body=JSON.stringify(n):l.body=n),fetch(e,l).then(o=>o.ok?o.json():o.json().then(t=>(Promise.reject(t.message),{isFetchOk:!1,status:o.status,message:t.message,payload:t&&t.payload?t.payload:null}))).then(o=>o).catch(o=>(console.error("Error in fetch",o),o))}catch(r){return console.error("Error!: "+r),r}}function O(e="nammax_auth"){let n=`; ${document.cookie}`.split(`; ${e}=`);return n.length===2?n.pop().split(";").shift():null}function A(e="/",i=2e3){setTimeout(()=>{window.location.href=e},i)}function D(e="/admin/sign-in",i="sidebar-logout-btn"){let n=document.getElementById(i);n?n.onclick=()=>M(e):console.error("Logout button not found")}function M(e="/sign-in"){window.localStorage.removeItem("auth"),A(`${e}`)}function m(e=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(e)).replace(/^(\D+)/,"$1 ")}function y(e=c.ADMIN){if(e===c.ADMIN){let i=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");i&&(i.style.display="flex"),n&&n.remove()}else if(e===c.SUPER_ADMIN){let i=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),i&&i.remove()}}function U(){let e=document.getElementById("loading-screen");e?e.remove():console.log("did not find loading screen")}var h="/admin/sign-in";var T="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/all_finance";(()=>{let e;window.onload=function(){return S(this,null,function*(){D("/admin/sign-in","sidebar-logout-btn");let s=O();if(s){let r=yield I(T,"GET",!1,s);if(r.isFetchOk!==void 0&&!r.isFetchOk){console.error(r.message),r.payload&&r.payload.role===c.ADMIN&&r.payload.gyms&&r.payload.gyms.length>0?A(`/admin/gym/g?gymCode=${r.payload.gyms[0].gym_id}`):A(`${h}?reason=UNAUTHORIZED_USER`);return}y(c.SUPER_ADMIN),i(r,s)}else A(`${h}?reason=NOT_SIGNED_IN`)})};function i(s){let{finance:r,external_finance:l}=s,o={};r.map(a=>o[a.month+","+a.year]!==void 0?o[a.month+","+a.year]=E(x({},o[a.month+","+a.year]),{additional_revenue:a.additional_revenue+o[a.month+","+a.year].additional_revenue,additional_expenses:0,gross_revenue:a.gross_revenue+o[a.month+","+a.year].gross_revenue}):o[a.month+","+a.year]=a);let t=o;l.map(a=>t[a.month+","+a.year]!==void 0?t[a.month+","+a.year]=E(x({},t[a.month+","+a.year]),{additional_revenue:a.credit+t[a.month+","+a.year].additional_revenue,additional_expenses:a.debit+t[a.month+","+a.year].additional_expenses}):a);let u=Object.keys(t).sort();d(t),n(t,u),p(t,u),U()}function n(s,r){let l=document.getElementById("financial-data-container"),o=l.querySelector("#financial-data-item");r.forEach(t=>{let[u,a]=t.split(","),_=o.cloneNode(!0);_.setAttribute("id",""),_.setAttribute("href","/admin/all-financial-month?month="+u+"&year="+a),_.querySelector("#financial-data-month ").innerText=N[u-1],_.querySelector("#financial-data-year ").innerText=a,_.querySelector("#financial-data-revenue").innerText=m(Number(s[t].gross_revenue)+Number(s[t].additional_revenue)),_.querySelector("#financial-data-expenses").innerText=m(Number(s[t].additional_expenses||0));let g=Number(s[t].gross_revenue)+Number(s[t].additional_revenue)-Number(s[t].additional_expenses);_.querySelector("#financial-data-profit").innerText=m(g||0),g<0?(_.querySelector("#financial-indicator").classList.add("is-loss"),_.querySelector("#financial-data-profit").style.color="#ff634e"):_.querySelector("#financial-indicator").classList.add("is-profitable"),l.prepend(_)}),o.remove()}function d(s){let r=new Date().getMonth()+1,l=new Date().getFullYear();if(e=s[r+","+l],e===void 0&&(e=null),!e)document.getElementById("gym-financial-month").innerText="This months",document.getElementById("gym-financial-year").innerText="data not found",document.getElementById("financial-expenses").innerText="No data found",document.getElementById("financial-revenue").innerText="No data found",document.getElementById("financial-profit").innerText="No data found";else{document.getElementById("gym-financial-month").innerText=N[e.month-1],document.getElementById("gym-financial-year").innerText=e.year,document.getElementById("financial-expenses").innerText=m(Number(e.additional_expenses||0)),document.getElementById("financial-revenue").innerText=m(Number(e.gross_revenue)+Number(e.additional_revenue||0));let o=Number(e.gross_revenue)+Number(e.additional_revenue)-Number(e.additional_expenses);document.querySelector("#financial-profit").innerText=m(o||0)}}function p(s,r){let l=document.getElementById("finance-chart").getContext("2d"),o=[...r.map(t=>N[t.split(",")[0]-1])];new Chart(l,{type:"bar",data:{labels:o,datasets:[{label:"Revenue",data:[...r.map(t=>Number(s[t].gross_revenue)+Number(s[t].additional_revenue))],backgroundColor:["#00EDF4"]},{label:"Profit",data:[...r.map(t=>Number(s[t].gross_revenue)+Number(s[t].additional_revenue)-Number(s[t].additional_expenses))],backgroundColor:["#E0FFC1"]},{label:"Expenses",data:[...r.map(t=>-Number(s[t].additional_expenses))],backgroundColor:["#ff0000"]}]},options:{scales:{x:{grid:{display:!1},stacked:!0},y:{grid:{display:!1},stacked:!0}}}})}})();
