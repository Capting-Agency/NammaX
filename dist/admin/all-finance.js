var T=Object.defineProperty,L=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var g=(n,a,o)=>a in n?T(n,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[a]=o,N=(n,a)=>{for(var o in a||={})b.call(a,o)&&g(n,o,a[o]);if(R)for(var o of R(a))w.call(a,o)&&g(n,o,a[o]);return n},A=(n,a)=>L(n,C(a));var S=(n,a,o)=>new Promise((d,p)=>{var s=e=>{try{l(o.next(e))}catch(r){p(r)}},i=e=>{try{l(o.throw(e))}catch(r){p(r)}},l=e=>e.done?d(e.value):Promise.resolve(e.value).then(s,i);l((o=o.apply(n,a)).next())});var x=["January","February","March","April","May","June","July","August","September","October","November","December"],c={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function f(n,a="GET",o=!1,d=!1,p=!1,s=!0){try{let i={"Content-Type":"application/json"};p&&(i={}),d&&(i.Authorization=`Bearer ${d}`);let l={method:a,headers:i};return o&&(s?l.body=JSON.stringify(o):l.body=o),fetch(n,l).then(e=>e.ok?e.json():e.json().then(r=>(Promise.reject(r.message),{isFetchOk:!1,status:e.status,message:r.message,payload:r&&r.payload?r.payload:null}))).then(e=>e).catch(e=>(console.error("Error in fetch",e),e))}catch(i){return console.error("Error!: "+i),i}}function I(n="nammax_auth"){let o=`; ${document.cookie}`.split(`; ${n}=`);return o.length===2?o.pop().split(";").shift():null}function u(n="/",a=2e3){setTimeout(()=>{window.location.href=n},a)}function O(n="/admin/sign-in",a="sidebar-logout-btn"){let o=document.getElementById(a);o?o.onclick=()=>B(n):console.error("Logout button not found")}function B(n="/sign-in"){window.localStorage.removeItem("auth"),u(`${n}`)}function m(n=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(n)).replace(/^(\D+)/,"$1 ")}function y(n=c.ADMIN){if(n===c.ADMIN){let a=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");a&&(a.style.display="flex"),o&&o.remove()}else if(n===c.SUPER_ADMIN){let a=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),a&&a.remove()}}function U(){let n=document.getElementById("loading-screen");n?n.remove():console.log("did not find loading screen")}var E="/admin/sign-in";var D="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/all_finance";(()=>{let n;window.onload=function(){return S(this,null,function*(){O("/admin/sign-in","sidebar-logout-btn");let s=I();if(s){let i=yield f(D,"GET",!1,s);if(i.isFetchOk!==void 0&&!i.isFetchOk){console.error(i.message),i.payload&&i.payload.role===c.ADMIN&&i.payload.gyms&&i.payload.gyms.length>0?u(`/admin/gym/g?gymCode=${i.payload.gyms[0].gym_id}`):u(`${E}?reason=UNAUTHORIZED_USER`);return}y(c.SUPER_ADMIN),a(i,s)}else u(`${E}?reason=NOT_SIGNED_IN`)})};function a(s){let{finance:i,external_finance:l}=s,e={};i.map(t=>e[t.month+","+t.year]!==void 0?e[t.month+","+t.year]=A(N({},e[t.month+","+t.year]),{additional_revenue:t.additional_revenue+e[t.month+","+t.year].additional_revenue,additional_expenses:t.additional_expenses+e[t.month+","+t.year].additional_expenses,gross_revenue:t.gross_revenue+e[t.month+","+t.year].gross_revenue,member_revenue:t.member_revenue+e[t.month+","+t.year].member_revenue,fixed_expense:t.fixed_expense+e[t.month+","+t.year].fixed_expense,net_profit:t.net_profit+e[t.month+","+t.year].net_profit}):e[t.month+","+t.year]=t);let r=e;l.map(t=>r[t.month+","+t.year]!==void 0?r[t.month+","+t.year]=A(N({},r[t.month+","+t.year]),{additional_revenue:t.credit+r[t.month+","+t.year].additional_revenue,additional_expenses:t.debit+r[t.month+","+t.year].additional_expenses}):t),d(r),o(r),p(r),U()}function o(s){let i=document.getElementById("financial-data-container"),l=i.querySelector("#financial-data-item");Object.entries(s).forEach(e=>{let[r,t]=e[0].split(","),_=l.cloneNode(!0);_.setAttribute("id",""),_.setAttribute("href","/admin/all-financial-month?month="+r+"&year="+t),_.querySelector("#financial-data-month ").innerText=x[r-1],_.querySelector("#financial-data-year ").innerText=t,_.querySelector("#financial-data-revenue").innerText=m(Number(e[1].gross_revenue)+Number(e[1].additional_revenue)),_.querySelector("#financial-data-expenses").innerText=m(Number(e[1].additional_expenses));let h=Number(e[1].gross_revenue)+Number(e[1].additional_revenue)-Number(e[1].additional_expenses);_.querySelector("#financial-data-profit").innerText=m(h),h<0?(_.querySelector("#financial-indicator").classList.add("is-loss"),_.querySelector("#financial-data-profit").style.color="#ff634e"):_.querySelector("#financial-indicator").classList.add("is-profitable"),i.prepend(_)}),l.remove()}function d(s){let i=new Date().getMonth()+1,l=new Date().getFullYear();if(n=s[i+","+l],n===void 0&&(n=null),!n)document.getElementById("gym-financial-month").innerText="This months",document.getElementById("gym-financial-year").innerText="data not found",document.getElementById("financial-expenses").innerText="No data found",document.getElementById("financial-revenue").innerText="No data found",document.getElementById("financial-profit").innerText="No data found";else{document.getElementById("gym-financial-month").innerText=x[n.month-1],document.getElementById("gym-financial-year").innerText=n.year,document.getElementById("financial-expenses").innerText=m(Number(n.additional_expenses)),document.getElementById("financial-revenue").innerText=m(Number(n.gross_revenue)+Number(n.additional_revenue));let e=Number(n.gross_revenue)+Number(n.additional_revenue)-Number(n.additional_expenses);document.querySelector("#financial-profit").innerText=m(e)}}function p(s){let i=document.getElementById("finance-chart").getContext("2d"),l=[...Object.keys(s).map(e=>x[e.split(",")[0]-1])];new Chart(i,{type:"bar",data:{labels:l,datasets:[{label:"Revenue",data:[...Object.values(s).map(e=>Number(e.gross_revenue)+Number(e.additional_revenue))],backgroundColor:["#00EDF4"]},{label:"Profit",data:[...Object.values(s).map(e=>Number(e.gross_revenue)+Number(e.additional_revenue)-Number(e.additional_expenses))],backgroundColor:["#E0FFC1"]},{label:"Expenses",data:[...Object.values(s).map(e=>-Number(e.additional_expenses))],backgroundColor:["#ff0000"]}]},options:{scales:{x:{grid:{display:!1},stacked:!0,reverse:!0},y:{grid:{display:!1},stacked:!0}}}})}})();
