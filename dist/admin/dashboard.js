var S=(t,n,o)=>new Promise((r,p)=>{var f=i=>{try{x(o.next(i))}catch(_){p(_)}},m=i=>{try{x(o.throw(i))}catch(_){p(_)}},x=i=>i.done?r(i.value):Promise.resolve(i.value).then(f,m);x((o=o.apply(t,n)).next())});var H=["Male","Female","Other","Prefer not to say"];var D={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"},I=["DROPOUT","NO SHOW","NEW USER","TRIAL","NO RENEWAL","NO MEMBERSHIP"];function B(t,n="GET",o=!1,r=!1,p=!1,f=!0){try{let m={"Content-Type":"application/json"};p&&(m={}),r&&(m.Authorization=`Bearer ${r}`);let x={method:n,headers:m};return o&&(f?x.body=JSON.stringify(o):x.body=o),fetch(t,x).then(i=>i.ok?i.json():i.json().then(_=>(Promise.reject(_.message),{isFetchOk:!1,status:i.status,message:_.message,payload:_&&_.payload?_.payload:null}))).then(i=>i).catch(i=>(console.error("Error in fetch",i),i))}catch(m){return console.error("Error!: "+m),m}}function j(t="nammax_auth"){let o=`; ${document.cookie}`.split(`; ${t}=`);return o.length===2?o.pop().split(";").shift():null}function C(t="/",n=2e3){setTimeout(()=>{window.location.href=t},n)}function G(t=null){if(t==null)return"NaN";let n=new Date(t);return`${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()}`}function q(t="/admin/sign-in",n="sidebar-logout-btn"){let o=document.getElementById(n);o?o.onclick=()=>ne(t):console.error("Logout button not found")}function ne(t="/sign-in"){window.localStorage.removeItem("auth"),C(`${t}`)}function W(t=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(t)).replace(/^(\D+)/,"$1 ")}function Y(t=new Date,n=0){let o=t;return o&&o.setDate(o.getDate()+n),o}function J(t=D.ADMIN){if(t===D.ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),o&&o.remove()}else if(t===D.SUPER_ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),n&&n.remove()}}function V(){let t=document.getElementById("loading-screen");t?t.remove():console.log("did not find loading screen")}function k(t){let n=new Date(t);return n.setMinutes(n.getMinutes()-n.getTimezoneOffset()),n}function X(t,n,o=!1){let r=864e5;return Math.round((k(n)-k(t))/r)}function w({tag:t="gym",API:n=null,parentTableName:o="user-table-subscription-header",tableColumnContainerName:r="user-table-gym-header",extraXanoInputObj:p=[],filterData:f=null,searchContainerElId:m=""},x,i){if(!f){console.error("No Filter Data provided");return}let _=document.getElementById(r);if(!_){console.error("Failed to find column container");return}let N=_.querySelector("#filter-search");if(!N){console.error("Failed to find column filter");return}se(r,N,f),_.onclick=a=>{a.stopPropagation(),N.style.display="block"};let y=N.querySelector("#close-btn");y?y.onclick=a=>{a.stopPropagation(),N.style.display="none"}:console.error("Failed to find close btn");let R=_.querySelector("#filter-btn");if(!R){console.error("Failed to find submit filter btn");return}R.onclick=()=>{let a=N.querySelector(`input[name="${r}"]:checked`).value,l;m.length>0?l=document.getElementById(m).querySelector("#search-input"):l=document.getElementById("search-input"),oe(t,a,n,i,x,l.value,o,r,N,p)};let O=_.querySelector("#reset-filter-btn");if(!O){console.error("Failed to find reset filter btn");return}O.onclick=a=>{a.stopPropagation(),Z("","",n,i,x,"",p,!0),Q("hide",o,r,N)}}function oe(t,n,o,r,p,f,m,x,i,_){return S(this,null,function*(){Z(t,n,o,r,p,f,_),Q("show",m,x,i)})}function Z(i,_,N,y,R,O){return S(this,arguments,function*(t,n,o,r,p,f,m=[],x=!1){if(x){r&&r({isFilter:!0,filterQueries:{},API:o,isReset:x});return}let a={search_query:(f==null?void 0:f.length)>0?`${f}:*`:"",tag:t,filter:n||""};m.length>0&&m.map(l=>{for(let[c,s]of Object.entries(l))a[c]=s}),p=a,r&&r({isFilter:!0,filterQueries:p,API:o})})}function Q(t="show",n,o,r){let p=document.getElementById(n);if(!p){console.error("Could not find parent table name");return}if(p.querySelectorAll(".text-w").forEach(m=>{m.style.textDecoration="none"}),t==="show"){let m=document.getElementById(o);if(!m){console.error("Could not find column name");return}m.style.textDecoration="underline",r.querySelector("#reset-filter-btn").style.display="block"}else t==="hide"&&(r.querySelector("#reset-filter-btn").style.display="none");setTimeout(()=>{r.style.display="none"},500)}function se(t,n,o){let r=n.querySelector("label");o.forEach(p=>{let f=r.cloneNode(!0),m=f.querySelector("input"),x=f.querySelector("span");m.value=p.value,m.name=t,x.innerText=p.text,n.prepend(f)}),r.remove()}function te({mode:t="API",clientObjRefName:n="name",data:o,token:r,API:p,extraXanoInputObj:f=[],searchContainerElId:m=""},x,i=null,_=null){let N,y,R;if(m.length>0){let O=document.getElementById(m);N=O.querySelector("#search-input"),N.setAttribute("placeholder","Search"),y=O.querySelector("#search-btn"),R=O.querySelector("#search-reset-btn")}else N=document.getElementById("search-input"),N.setAttribute("placeholder","Search"),y=document.getElementById("search-btn"),R=document.getElementById("search-reset-btn");R.onclick=()=>{N.value="",ee(R,{mode:t,clientObjRefName:n,data:o,searchquery:"",token:r,API:p,extraXanoInputObj:f},x,i,_)},y.onclick=()=>{let O=N.value;ee(R,{mode:t,clientObjRefName:n,data:o,searchquery:O,token:r,API:p,extraXanoInputObj:f},x,i,_)}}function ee(y,R,O,a,l){return S(this,arguments,function*(t,{mode:n,clientObjRefName:o,data:r,searchquery:p,token:f,API:m,extraXanoInputObj:x=[]},i,_,N){if(p.length===0)t.style.display="none",_?i(r,_):i(r);else try{if(n==="API"){let c={search_query:`${p}:*`};x.length>0&&x.map(u=>{for(let[A,d]of Object.entries(u))c[A]=d});let s=yield B(m+"query","POST",c,f);if(s.isFetchOk!==void 0&&!s.isFetchOk)throw console.error(s.message),Error("API call failed");t.style.display="flex",_?i(s,_):i(s)}else{let c=r.filter(s=>s[o].toLowerCase().includes(p.toLowerCase()));t.style.display="flex",_?i(c,_):i(c)}}catch(c){N?N():console.error(c)}})}var z="/admin/sign-in";var P="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/super_admin/dashboard";var M="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";(()=>{let t=null,n=0,o=[],r={},p="";window.onload=function(){return S(this,null,function*(){q("/admin/sign-in","sidebar-logout-btn");let a=j();if(a){let l=yield B(P+"/1","GET",!1,a);if(l.isFetchOk!==void 0&&!l.isFetchOk){console.error(l.message),l.payload&&l.payload.role===D.ADMIN&&l.payload.gyms&&l.payload.gyms.length>0?C(`/admin/gym/g?gymCode=${l.payload.gyms[0].gym_id}`):C(`${z}?reason=UNAUTHORIZED_USER`);return}J(D.SUPER_ADMIN),f(l,a)}else C(`${z}?reason=NOT_SIGNED_IN`)})};function f(a,l){return S(this,null,function*(){let{users:c,gyms:s,finance:u,footfall:A}=a;R(u),O(c),m(s,c,A),x(s),i(c),te({data:c,token:l,API:M},i),w({tag:"gym",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gym-header",filterData:s.map(d=>({text:d.code,value:d.id})),API:M},r,y),w({tag:"subscription",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-subscription-header",filterData:I.map(d=>({text:d,value:d})),API:M},r,y),w({tag:"gender",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gender-header",filterData:H.map(d=>({text:d,value:d})),API:M},r,y),V()})}function m(a,l,c){var s;if(a&&a.length>0){let u=l.items.filter(e=>{let h=new Date,E=new Date(e.created_at),g=Math.abs(h-E);return Math.ceil(g/(1e3*60*60*24))<=24});document.getElementById("gym-statistics-new-sign-ups").innerText=u.length||0,document.getElementById("gym-statistics-attendence").innerText=c||0;let A={};a.forEach(e=>{var h;(h=e==null?void 0:e.footfall)==null||h.items.forEach(E=>{A[e.code]?A[e.code]+=Number(E.traffic):A[e.code]=Number(E.traffic)})});let d=((s=Object.keys(A))==null?void 0:s.reduce((e,h)=>A[e]>A[h]?e:h,a[0].code))||a[0].code||"NaN";document.getElementById("gym-statistics-top-performer").innerText=d,document.getElementById("gym-statistics-total-members").innerText=l.items.length}}function x(a){let l=document.getElementById("gym-container"),c=l.querySelector("#gym-item");a.forEach(s=>{var d,e,h,E,g,L,T;let u=c.cloneNode(!0);u.setAttribute("id",""),u.setAttribute("href",`/admin/gym/g?gymCode=${s.id}`),s.map_icon&&(u.querySelector("#gym-map").style.backgroundImage=`url(${s.map_icon.url})`),u.querySelector("#gym-code").innerText=s.code,u.querySelector("#gym-name").innerText=s.location,u.querySelector("#gym-coach").innerText=s.partner||"NaN",u.querySelector("#gym-active-sessions").innerText=(e=(d=s==null?void 0:s.sessions)==null?void 0:d.length)!=null?e:0;let A=0;s.finances.forEach(U=>{A+=Number(U.gross_revenue)+Number(U.additional_revenue)}),s.finances.length>0?A=A/s.finances.length:A=null,u.querySelector("#gym-revenue").innerText=(h=W(Math.round(A)||0))!=null?h:"NaN",u.querySelector("#gym-active-users").innerText=(g=(E=s==null?void 0:s.users)==null?void 0:E.filter(U=>U.membership_status!=="INACTIVE").length)!=null?g:0,u.querySelector("#gym-users").innerText=(T=(L=s==null?void 0:s.users)==null?void 0:L.length)!=null?T:0,l.prepend(u)}),c.remove()}function i(a,l=!1){let c=document.getElementById("table-container"),s=c.querySelector("#table-item");function u(A){t=A.nextPage;let d=c.querySelectorAll(".adb-user.w-inline-block");d.forEach((e,h)=>{h!==d.length-1&&(h!==d.length-2||n>0)&&e.remove()}),o.items.forEach((e,h)=>{let E=s.cloneNode(!0);E.setAttribute("id",""),E.setAttribute("href",`/admin/user?userId=${e.id}`);let g=E.querySelectorAll(".colcontent");if(h%2===0&&(E.style.backgroundColor="#00edf4"),e.profile_picture&&(g[0].style.backgroundImage=`url(${e.profile_picture.url})`),e.membership_end_date){let $=new Date(e.membership_end_date),K=new Date;(e==null?void 0:e.session_ledger)!==void 0&&e.session_ledger.length<=3?g[0].style.border="3px solid #009ca1":X(K,$,!0)<=3?g[0].style.border="3px solid red":X(K,$,!0)<=7&&(g[0].style.border="3px solid orange")}g[1].innerText=e.name||"",g[2].innerText=e.code||"Unselected";let L=Y(new Date(e.created_at),7),T=new Date().getTime(),U=e.tokens,v=e.session_ledger.length,F=e.membership_end_date?new Date(e.membership_end_date).getTime():null,b="";U===2&&v===0?L.getTime()<T?b=I[0]:b=I[2]:U===0&&v===0?L.getTime()>T?b=I[1]:b=I[2]:U===1&&v===1?b=I[3]:e.membership_status!=="TRIAL"&&v>0&&L.getTime()>T&&F<=T?b=I[4]:F<T&&(b=I[5]),g[3].innerText=b||e.membership_status||"INACTIVE",g[4].innerText=e.gender||"Unselected",g[5].innerText=e.session_ledger.length||0,e.session_ledger.length>0?g[6].innerText=G(e.session_ledger[e.session_ledger.length-1].time):g[6].innerText="N/A",E.style.display="flex",c.prepend(E)})}l?(o.items.push(...a.items),o.nextPage=a.nextPage):o=a,u(o),s.style.display="none"}let _=document.getElementById("table-container");new IntersectionObserver(a=>{a[0].intersectionRatio<=0||(n>0&&t?y({},t):n<1&&n++)},{root:_,threshold:[0,1]}).observe(document.querySelector(".loadmore"));function y(A){return S(this,arguments,function*({isFilter:a=!1,filterQueries:l=r||{},API:c=p,isReset:s=!1},u=t){let d=j();if(d)if(Object.entries(l).length>0&&c)if(r=l,p=c,a){let e=yield B(c+"query","POST",l,d);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===D.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?C(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}else{i(e,!1);return}}else{l.page=u;let e=yield B(c+"query","POST",l,d);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===D.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?C(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}else{i(e,t);return}}else{s&&(t=null,u=1,r={});let e=yield B(P+`/${u}`,"GET",!1,d);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===D.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?C(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}i(e.users,!0)}})}function R(a){return S(this,null,function*(){let l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=[...new Set(a.map(d=>d.month))].sort(),s={},u={};c.map(d=>{s[d]=a.filter(e=>e.month===d).reduce((e,h)=>e+h.gross_revenue+h.additional_revenue,0),u[d]=a.filter(e=>e.month===d).reduce((e,h)=>e+h.net_profit,0)});let A=document.getElementById("dashboard-profits-chart").getContext("2d");A.canvas.parentNode.style.height="400px",A.canvas.parentNode.style.width="400px",new Chart(A,{type:"bar",data:{labels:c.map(d=>l[d-1]),datasets:[{label:"Revenue",data:Object.values(s),backgroundColor:["#00EDF4"]},{label:"Profit",data:Object.values(u),backgroundColor:["#E0FFC1"]}]},options:{scales:{x:{grid:{display:!1},stacked:!0},y:{grid:{display:!1},stacked:!0}}}})})}function O(a){return S(this,null,function*(){let l=a.items.filter(s=>s.membership_status!=="INACTIVE"),c=document.getElementById("dashboard-sessions-chart").getContext("2d");c.canvas.parentNode.style.height="230px",c.canvas.parentNode.style.width="230px",a.items.length===l.length?new Chart(c,{type:"pie",data:{labels:[`Total/Active Users ${a.items.length}`],datasets:[{label:"Revenue",data:[a.items.length],backgroundColor:["#00EDF4"]}]},options:{plugins:{legend:{position:"top"}}}}):new Chart(c,{type:"pie",data:{labels:[`Total Users ${a.items.length}`,`Active Users ${l.length}`],datasets:[{label:"Revenue",data:[a.items.length,l.length],backgroundColor:["#00EDF4","#E0FFC1"]}]},options:{plugins:{legend:{position:"top"}}}})})}})();
