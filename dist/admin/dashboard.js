var y=(e,n,o)=>new Promise((_,u)=>{var f=d=>{try{h(o.next(d))}catch(p){u(p)}},l=d=>{try{h(o.throw(d))}catch(p){u(p)}},h=d=>d.done?_(d.value):Promise.resolve(d.value).then(f,l);h((o=o.apply(e,n)).next())});var $=["Male","Female","Other","Prefer not to say"];var O={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"},S=["DROPOUT","NO SHOW","NEW USER","TRIAL","NO RENEWAL","NO MEMBERSHIP"];function b(e,n="GET",o=!1,_=!1,u=!1,f=!0){try{let l={"Content-Type":"application/json"};u&&(l={}),_&&(l.Authorization=`Bearer ${_}`);let h={method:n,headers:l};return o&&(f?h.body=JSON.stringify(o):h.body=o),fetch(e,h).then(d=>d.ok?d.json():d.json().then(p=>(Promise.reject(p.message),{isFetchOk:!1,status:d.status,message:p.message,payload:p&&p.payload?p.payload:null}))).then(d=>d).catch(d=>(console.error("Error in fetch",d),d))}catch(l){return console.error("Error!: "+l),l}}function M(e="nammax_auth"){let o=`; ${document.cookie}`.split(`; ${e}=`);return o.length===2?o.pop().split(";").shift():null}function T(e="/",n=2e3){setTimeout(()=>{window.location.href=e},n)}function F(e=null){if(e==null)return"NaN";let n=new Date(e);return`${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()}`}function H(e="/admin/sign-in",n="sidebar-logout-btn"){let o=document.getElementById(n);o?o.onclick=()=>Z(e):console.error("Logout button not found")}function Z(e="/sign-in"){window.localStorage.removeItem("auth"),T(`${e}`)}function k(e=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(e)).replace(/^(\D+)/,"$1 ")}function G(e=new Date,n=0){let o=e;return o&&o.setDate(o.getDate()+n),o}function q(e=O.ADMIN){if(e===O.ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),o&&o.remove()}else if(e===O.SUPER_ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),n&&n.remove()}}function W(){let e=document.getElementById("loading-screen");e?e.remove():console.log("did not find loading screen")}function K(e){let n=new Date(e);return n.setMinutes(n.getMinutes()-n.getTimezoneOffset()),n}function v(e,n,o=!1){let _=864e5;return Math.round((K(n)-K(e))/_)}function B({tag:e="gym",API:n=null,parentTableName:o="user-table-subscription-header",tableColumnContainerName:_="user-table-gym-header",extraXanoInputObj:u=[],filterData:f=null,searchContainerElId:l="",token:h},d){if(!f){console.error("No Filter Data provided");return}let p=document.getElementById(_);if(!p){console.error("Failed to find column container");return}let N=p.querySelector("#filter-search");if(!N){console.error("Failed to find column filter");return}te(_,N,f),p.onclick=s=>{s.stopPropagation(),N.style.display="block"};let i=N.querySelector("#close-btn");i?i.onclick=s=>{s.stopPropagation(),N.style.display="none"}:console.error("Failed to find close btn");let r=p.querySelector("#filter-btn");if(!r){console.error("Failed to find submit filter btn");return}r.onclick=()=>{let s=N.querySelector(`input[name="${_}"]:checked`).value,x;l.length>0?x=document.getElementById(l).querySelector("#search-input"):x=document.getElementById("search-input"),ee(e,s,n,d,h,x.value,o,_,N,u)};let a=p.querySelector("#reset-filter-btn");if(!a){console.error("Failed to find reset filter btn");return}a.onclick=s=>{s.stopPropagation(),Y("","",n,d,h,"",u),J("hide",o,_,N)}}function ee(e,n,o,_,u,f,l,h,d,p){return y(this,null,function*(){Y(e,n,o,_,u,f,p),J("show",l,h,d)})}function Y(h,d,p,N,i,r){return y(this,arguments,function*(e,n,o,_,u,f,l=[]){let a={search_query:(f==null?void 0:f.length)>0?`${f}:*`:"",tag:e,filter:n||""};l.length>0&&l.map(x=>{for(let[m,c]of Object.entries(x))a[m]=c});let s=yield b(o+"query","POST",a,u);if(s.isFetchOk!==void 0&&!s.isFetchOk)throw console.error(s.message),Error("API call failed");_&&_(s)})}function J(e="show",n,o,_){let u=document.getElementById(n);if(!u){console.error("Could not find parent table name");return}if(u.querySelectorAll(".text-w").forEach(l=>{l.style.textDecoration="none"}),e==="show"){let l=document.getElementById(o);if(!l){console.error("Could not find column name");return}l.style.textDecoration="underline",_.querySelector("#reset-filter-btn").style.display="block"}else e==="hide"&&(_.querySelector("#reset-filter-btn").style.display="none");setTimeout(()=>{_.style.display="none"},500)}function te(e,n,o){let _=n.querySelector("label");o.forEach(u=>{let f=_.cloneNode(!0),l=f.querySelector("input"),h=f.querySelector("span");l.value=u.value,l.name=e,h.innerText=u.text,n.prepend(f)}),_.remove()}function Q({mode:e="API",clientObjRefName:n="name",data:o,token:_,API:u,extraXanoInputObj:f=[],searchContainerElId:l=""},h,d=null,p=null){let N,i,r;if(l.length>0){let a=document.getElementById(l);N=a.querySelector("#search-input"),N.setAttribute("placeholder","Search"),i=a.querySelector("#search-btn"),r=a.querySelector("#search-reset-btn")}else N=document.getElementById("search-input"),N.setAttribute("placeholder","Search"),i=document.getElementById("search-btn"),r=document.getElementById("search-reset-btn");r.onclick=()=>{N.value="",V(r,{mode:e,clientObjRefName:n,data:o,searchquery:"",token:_,API:u,extraXanoInputObj:f},h,d,p)},i.onclick=()=>{let a=N.value;V(r,{mode:e,clientObjRefName:n,data:o,searchquery:a,token:_,API:u,extraXanoInputObj:f},h,d,p)}}function V(i,r,a,s,x){return y(this,arguments,function*(e,{mode:n,clientObjRefName:o,data:_,searchquery:u,token:f,API:l,extraXanoInputObj:h=[]},d,p,N){if(u.length===0)e.style.display="none",p?d(_,p):d(_);else try{if(n==="API"){let m={search_query:`${u}:*`};h.length>0&&h.map(t=>{for(let[A,g]of Object.entries(t))m[A]=g});let c=yield b(l+"query","POST",m,f);if(c.isFetchOk!==void 0&&!c.isFetchOk)throw console.error(c.message),Error("API call failed");e.style.display="flex",p?d(c,p):d(c)}else{let m=_.filter(c=>c[o].toLowerCase().includes(u.toLowerCase()));e.style.display="flex",p?d(m,p):d(m)}}catch(m){N?N():console.error(m)}})}var w="/admin/sign-in";var j="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/super_admin/dashboard";var C="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";(()=>{let e=null,n=0,o=[];window.onload=function(){return y(this,null,function*(){H("/admin/sign-in","sidebar-logout-btn");let i=M();if(i){let r=yield b(j+"/1","GET",!1,i);if(r.isFetchOk!==void 0&&!r.isFetchOk){console.error(r.message),r.payload&&r.payload.role===O.ADMIN&&r.payload.gyms&&r.payload.gyms.length>0?T(`/admin/gym/g?gymCode=${r.payload.gyms[0].gym_id}`):T(`${w}?reason=UNAUTHORIZED_USER`);return}q(O.SUPER_ADMIN),_(r,i)}else T(`${w}?reason=NOT_SIGNED_IN`)})};function _(i,r){return y(this,null,function*(){let{users:a,gyms:s,finance:x,footfall:m}=i;p(x),N(a),u(s,a,m),f(s),l(a),Q({data:a,token:r,API:C},l),B({tag:"gym",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gym-header",filterData:s.map(c=>({text:c.code,value:c.id})),token:r,API:C},l),B({tag:"subscription",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-subscription-header",filterData:S.map(c=>({text:c,value:c})),token:r,API:C},l),B({tag:"gender",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gender-header",filterData:$.map(c=>({text:c,value:c})),token:r,API:C},l),W()})}function u(i,r,a){var s;if(i&&i.length>0){let x=r.items.filter(t=>{let A=new Date,g=new Date(t.created_at),E=Math.abs(A-g);return Math.ceil(E/(1e3*60*60*24))<=24});document.getElementById("gym-statistics-new-sign-ups").innerText=x.length||0,document.getElementById("gym-statistics-attendence").innerText=a||0;let m={};i.forEach(t=>{var A;(A=t==null?void 0:t.footfall)==null||A.items.forEach(g=>{m[t.code]?m[t.code]+=Number(g.traffic):m[t.code]=Number(g.traffic)})});let c=((s=Object.keys(m))==null?void 0:s.reduce((t,A)=>m[t]>m[A]?t:A,i[0].code))||i[0].code||"NaN";document.getElementById("gym-statistics-top-performer").innerText=c,document.getElementById("gym-statistics-total-members").innerText=r.items.length}}function f(i){let r=document.getElementById("gym-container"),a=r.querySelector("#gym-item");i.forEach(s=>{var c,t,A,g,E,U,R;let x=a.cloneNode(!0);x.setAttribute("id",""),x.setAttribute("href",`/admin/gym/g?gymCode=${s.id}`),s.map_icon&&(x.querySelector("#gym-map").style.backgroundImage=`url(${s.map_icon.url})`),x.querySelector("#gym-code").innerText=s.code,x.querySelector("#gym-name").innerText=s.location,x.querySelector("#gym-coach").innerText=s.partner||"NaN",x.querySelector("#gym-active-sessions").innerText=(t=(c=s==null?void 0:s.sessions)==null?void 0:c.length)!=null?t:0;let m=0;s.finances.forEach(D=>{m+=Number(D.gross_revenue)+Number(D.additional_revenue)}),s.finances.length>0?m=m/s.finances.length:m=null,x.querySelector("#gym-revenue").innerText=(A=k(Math.round(m)||0))!=null?A:"NaN",x.querySelector("#gym-active-users").innerText=(E=(g=s==null?void 0:s.users)==null?void 0:g.filter(D=>D.membership_status!=="INACTIVE").length)!=null?E:0,x.querySelector("#gym-users").innerText=(R=(U=s==null?void 0:s.users)==null?void 0:U.length)!=null?R:0,r.prepend(x)}),a.remove()}function l(i,r=!1){let a=document.getElementById("table-container"),s=a.querySelector("#table-item");function x(m){e=m.nextPage;let c=a.querySelectorAll(".adb-user.w-inline-block");c.forEach((t,A)=>{A!==c.length-1&&(A!==c.length-2||n>0)&&t.remove()}),o.items.forEach((t,A)=>{let g=s.cloneNode(!0);g.setAttribute("id",""),g.setAttribute("href",`/admin/user?userId=${t.id}`);let E=g.querySelectorAll(".colcontent");if(A%2===0&&(g.style.backgroundColor="#00edf4"),t.profile_picture&&(E[0].style.backgroundImage=`url(${t.profile_picture.url})`),t.membership_end_date){let z=new Date(t.membership_end_date),P=new Date;(t==null?void 0:t.session_ledger)!==void 0&&t.session_ledger.length<=3?E[0].style.border="3px solid #009ca1":v(P,z,!0)<=3?E[0].style.border="3px solid red":v(P,z,!0)<=7&&(E[0].style.border="3px solid orange")}E[1].innerText=t.name||"",E[2].innerText=t.code||"Unselected";let U=G(new Date(t.created_at),7),R=new Date().getTime(),D=t.tokens,L=t.session_ledger.length,X=t.membership_end_date?new Date(t.membership_end_date).getTime():null,I="";D===2&&L===0?U.getTime()<R?I=S[0]:I=S[2]:D===0&&L===0?U.getTime()>R?I=S[1]:I=S[2]:D===1&&L===1?I=S[3]:t.membership_status!=="TRIAL"&&L>0&&U.getTime()>R&&X<=R?I=S[4]:X<R&&(I=S[5]),E[3].innerText=I||t.membership_status||"INACTIVE",E[4].innerText=t.gender||"Unselected",E[5].innerText=t.session_ledger.length||0,t.session_ledger.length>0?E[6].innerText=F(t.session_ledger[t.session_ledger.length-1].time):E[6].innerText="N/A",g.style.display="flex",a.prepend(g)})}r?(o.items.push(...i.items),o.nextPage=i.nextPage):o=i,x(o),s.style.display="none"}new IntersectionObserver(i=>{i[0].intersectionRatio<=0||(n>0&&e?d(e):n<1&&n++)}).observe(document.querySelector(".loadmore"));function d(i){return y(this,null,function*(){let r=M();if(r){let a=yield b(j+`/${i}`,"GET",!1,r);if(a.isFetchOk!==void 0&&!a.isFetchOk){console.error(a.message),a.payload&&a.payload.role===O.ADMIN&&a.payload.gyms&&a.payload.gyms.length>0?T(`/admin/gym/g?gymCode=${a.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}l(a.users,!0)}})}function p(i){return y(this,null,function*(){let r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=[...new Set(i.map(c=>c.month))].sort(),s={},x={};a.map(c=>{s[c]=i.filter(t=>t.month===c).reduce((t,A)=>t+A.gross_revenue+A.additional_revenue,0),x[c]=i.filter(t=>t.month===c).reduce((t,A)=>t+A.net_profit,0)});let m=document.getElementById("dashboard-profits-chart").getContext("2d");m.canvas.parentNode.style.height="400px",m.canvas.parentNode.style.width="400px",new Chart(m,{type:"bar",data:{labels:a.map(c=>r[c-1]),datasets:[{label:"Revenue",data:Object.values(s),backgroundColor:["#00EDF4"]},{label:"Profit",data:Object.values(x),backgroundColor:["#E0FFC1"]}]},options:{scales:{x:{grid:{display:!1},stacked:!0},y:{grid:{display:!1},stacked:!0}}}})})}function N(i){return y(this,null,function*(){let r=i.items.filter(s=>s.membership_status!=="INACTIVE"),a=document.getElementById("dashboard-sessions-chart").getContext("2d");a.canvas.parentNode.style.height="300px",a.canvas.parentNode.style.width="300px",i.items.length===r.length?new Chart(a,{type:"pie",data:{labels:[`Total/Active Users ${i.items.length}`],datasets:[{label:"Revenue",data:[i.items.length],backgroundColor:["#00EDF4"]}]},options:{plugins:{legend:{position:"top"}}}}):new Chart(a,{type:"pie",data:{labels:[`Total Users ${i.items.length}`,`Active Users ${r.length}`],datasets:[{label:"Revenue",data:[i.items.length,r.length],backgroundColor:["#00EDF4","#E0FFC1"]}]},options:{plugins:{legend:{position:"top"}}}})})}})();
