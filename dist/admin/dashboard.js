var R=(t,s,i)=>new Promise((u,N)=>{var g=r=>{try{x(i.next(r))}catch(_){N(_)}},d=r=>{try{x(i.throw(r))}catch(_){N(_)}},x=r=>r.done?u(r.value):Promise.resolve(r.value).then(g,d);x((i=i.apply(t,s)).next())});var S={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function O(t,s="GET",i=!1,u=!1,N=!1,g=!0){try{let d={"Content-Type":"application/json"};N&&(d={}),u&&(d.Authorization=`Bearer ${u}`);let x={method:s,headers:d};return i&&(g?x.body=JSON.stringify(i):x.body=i),fetch(t,x).then(r=>r.ok?r.json():r.json().then(_=>(Promise.reject(_.message),{isFetchOk:!1,status:r.status,message:_.message,payload:_&&_.payload?_.payload:null}))).then(r=>r).catch(r=>(console.error("Error in fetch",r),r))}catch(d){return console.error("Error!: "+d),d}}function y(t="nammax_auth"){let i=`; ${document.cookie}`.split(`; ${t}=`);return i.length===2?i.pop().split(";").shift():null}function I(t="/",s=2e3){setTimeout(()=>{window.location.href=t},s)}function L(t=null){if(t==null)return"NaN";let s=new Date(t);return`${s.getDate()}/${s.getMonth()+1}/${s.getFullYear()}`}function b(t=null){if(t==null)return"NaN";let s=t.split("-"),i=Date.now()-new Date(parseInt(s[2]),parseInt(s[1])-1,parseInt(s[0])).getTime(),u=new Date(i);return Math.abs(u.getUTCFullYear()-1970)}function B(t="/admin/sign-in",s="sidebar-logout-btn"){let i=document.getElementById(s);i?i.onclick=()=>$(t):console.error("Logout button not found")}function $(t="/sign-in"){window.localStorage.removeItem("auth"),I(`${t}`)}function M(t=S.ADMIN){if(t===S.ADMIN){let s=document.getElementById("admin-nav"),i=document.getElementById("super-admin-nav");s&&(s.style.display="flex"),i&&i.remove()}else if(t===S.SUPER_ADMIN){let s=document.getElementById("admin-nav"),i=document.getElementById("super-admin-nav");i&&(i.style.display="flex"),s&&s.remove()}}function k(){let t=document.getElementById("loading-screen");t?t.remove():console.log("did not find loading screen")}function X({mode:t="API",clientObjRefName:s="name",data:i,token:u,API:N,extraXanoInputObj:g=[],searchContainerElId:d=""},x,r=null,_=null){let h,n,o;if(d.length>0){let e=document.getElementById(d);h=e.querySelector("#search-input"),h.setAttribute("placeholder","Search"),n=e.querySelector("#search-btn"),o=e.querySelector("#search-reset-btn")}else h=document.getElementById("search-input"),h.setAttribute("placeholder","Search"),n=document.getElementById("search-btn"),o=document.getElementById("search-reset-btn");o.onclick=()=>{h.value="",v(o,{mode:t,clientObjRefName:s,data:i,searchquery:"",token:u,API:N,extraXanoInputObj:g},x,r,_)},n.onclick=()=>{let e=h.value;v(o,{mode:t,clientObjRefName:s,data:i,searchquery:e,token:u,API:N,extraXanoInputObj:g},x,r,_)}}function v(n,o,e,a,m){return R(this,arguments,function*(t,{mode:s,clientObjRefName:i,data:u,searchquery:N,token:g,API:d,extraXanoInputObj:x=[]},r,_,h){if(N.length===0)t.style.display="none",_?r(u,_):r(u);else try{if(s==="API"){let p={search_query:`${N}:*`};x.length>0&&x.map(l=>{for(let[A,E]of Object.entries(l))p[A]=E});let c=yield O(d+"query","POST",p,g);if(c.isFetchOk!==void 0&&!c.isFetchOk)throw console.error(c.message),Error("API call failed");t.style.display="flex",_?r(c,_):r(c)}else{let p=u.filter(c=>c[i].toLowerCase().includes(N.toLowerCase()));t.style.display="flex",_?r(p,_):r(p)}}catch(p){h?h():console.error(p)}})}var D="/admin/sign-in";var U="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard";var K="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";(()=>{let t=null,s=0,i=[];window.onload=function(){return R(this,null,function*(){B("/admin/sign-in","sidebar-logout-btn");let n=y();if(n){let o=yield O(U+"/1","GET",!1,n);if(o.isFetchOk!==void 0&&!o.isFetchOk){console.error(o.message),o.payload&&o.payload.role===S.ADMIN&&o.payload.gyms&&o.payload.gyms.length>0?I(`/admin/gym/g?gymCode=${o.payload.gyms[0].gym_id}`):I(`${D}?reason=UNAUTHORIZED_USER`);return}M(S.SUPER_ADMIN),u(o,n)}else I(`${D}?reason=NOT_SIGNED_IN`)})};function u(n,o){return R(this,null,function*(){let{users:e,gyms:a,finance:m,footfall:p}=n;_(m),h(e),N(a,e,p),g(a),d(e),X({data:e,token:o,API:K},d),k()})}function N(n,o,e){if(n&&n.length>0){let a=o.items.filter(m=>{let p=new Date,c=new Date(m.created_at),l=Math.abs(p-c);return Math.ceil(l/(1e3*60*60*24))<=24});document.getElementById("gym-statistics-new-sign-ups").innerText=a.length,document.getElementById("gym-statistics-attendence").innerText=e||0,document.getElementById("gym-statistics-top-performer").innerText=n[0].code,document.getElementById("gym-statistics-total-members").innerText=o.items.length}}function g(n){let o=document.getElementById("gym-container"),e=o.querySelector("#gym-item");n.forEach(a=>{var p,c,l,A,E,f,T,C;let m=e.cloneNode(!0);m.setAttribute("id",""),m.setAttribute("href",`/admin/gym/g?gymCode=${a.id}`),a.map_icon&&(m.querySelector("#gym-map").style.backgroundImage=`url(${a.map_icon.url})`),m.querySelector("#gym-code").innerText=a.code,m.querySelector("#gym-name").innerText=a.location,m.querySelector("#gym-coach").innerText=a.partner||"NaN",m.querySelector("#gym-active-sessions").innerText=(c=(p=a==null?void 0:a.sessions)==null?void 0:p.length)!=null?c:0,m.querySelector("#gym-revenue").innerText=Number((l=a==null?void 0:a.finance)==null?void 0:l.gross_revenue)+Number((A=a==null?void 0:a.finance)==null?void 0:A.additional_revenue),m.querySelector("#gym-active-users").innerText=(f=(E=a==null?void 0:a.users)==null?void 0:E.filter(w=>w.membership_status!=="INACTIVE"&&w.membership_status!=="TRIAL").length)!=null?f:0,m.querySelector("#gym-users").innerText=(C=(T=a==null?void 0:a.users)==null?void 0:T.length)!=null?C:0,o.prepend(m)}),e.remove()}function d(n,o=!1){let e=document.getElementById("table-container"),a=e.querySelector("#table-item");function m(p){t=p.nextPage;let c=e.querySelectorAll(".adb-user.w-inline-block");c.forEach((l,A)=>{A!==c.length-1&&(A!==c.length-2||s>0)&&l.remove()}),i.items.forEach((l,A)=>{let E=a.cloneNode(!0);E.setAttribute("id",""),E.setAttribute("href",`/admin/user?userId=${l.id}`);let f=E.querySelectorAll(".colcontent");A%2===0&&(E.style.backgroundColor="#00edf4"),l.profile_picture&&(f[0].style.backgroundImage=`url(${l.profile_picture.url})`),f[1].innerText=l.name||"",f[2].innerText=l.code||"Unselected",f[3].innerText=l.membership_status||"INACTIVE",f[4].innerText=l.gender||"Unselected",f[5].innerText=b(l.date_of_birth)||"Unselected",l.session_ledger.length>0?f[6].innerText=L(l.session_ledger[l.session_ledger.length-1].time):f[6].innerText="N/A",E.style.display="flex",e.prepend(E)})}o?(i.items.push(...n.items),i.nextPage=n.nextPage):i=n,m(i),a.style.display="none"}new IntersectionObserver(n=>{n[0].intersectionRatio<=0||(s>0&&t?r(t):s<1&&s++)}).observe(document.querySelector(".loadmore"));function r(n){return R(this,null,function*(){let o=y();if(o){let e=yield O(U+`/${n}`,"GET",!1,o);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===S.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?I(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}d(e.users,!0)}})}function _(n){return R(this,null,function*(){let o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=[...new Set(n.map(c=>c.month))].sort(),a={},m={};e.map(c=>{a[c]=n.filter(l=>l.month===c).reduce((l,A)=>l+A.gross_revenue+A.additional_revenue,0),m[c]=n.filter(l=>l.month===c).reduce((l,A)=>l+A.net_profit,0)});let p=document.getElementById("dashboard-profits-chart").getContext("2d");p.canvas.parentNode.style.height="400px",p.canvas.parentNode.style.width="400px",new Chart(p,{type:"bar",data:{labels:e.map(c=>o[c-1]),datasets:[{label:"Revenue",data:Object.values(a),backgroundColor:["#00EDF4"]},{label:"Profit",data:Object.values(m),backgroundColor:["#E0FFC1"]}]},options:{scales:{x:{grid:{display:!1},stacked:!0},y:{grid:{display:!1},stacked:!0}}}})})}function h(n){return R(this,null,function*(){let o=n.items.filter(a=>a.membership_status!=="INACTIVE"),e=document.getElementById("dashboard-sessions-chart").getContext("2d");e.canvas.parentNode.style.height="300px",e.canvas.parentNode.style.width="300px",n.items.length===o.length?new Chart(e,{type:"pie",data:{labels:[`Total/Active Users ${n.items.length}`],datasets:[{label:"Revenue",data:[n.items.length],backgroundColor:["#00EDF4"]}]},options:{plugins:{legend:{position:"top"}}}}):new Chart(e,{type:"pie",data:{labels:[`Total Users ${n.items.length}`,`Active Users ${o.length}`],datasets:[{label:"Revenue",data:[n.items.length,o.length],backgroundColor:["#00EDF4","#E0FFC1"]}]},options:{plugins:{legend:{position:"top"}}}})})}})();
