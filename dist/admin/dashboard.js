var y=(t,n,o)=>new Promise((_,u)=>{var f=d=>{try{h(o.next(d))}catch(p){u(p)}},l=d=>{try{h(o.throw(d))}catch(p){u(p)}},h=d=>d.done?_(d.value):Promise.resolve(d.value).then(f,l);h((o=o.apply(t,n)).next())});var X=["Male","Female","Other","Prefer not to say"];var R={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"},D=["DROPOUT","NO SHOW","NEW USER","TRIAL","NO RENEWAL","NO MEMBERSHIP"];function U(t,n="GET",o=!1,_=!1,u=!1,f=!0){try{let l={"Content-Type":"application/json"};u&&(l={}),_&&(l.Authorization=`Bearer ${_}`);let h={method:n,headers:l};return o&&(f?h.body=JSON.stringify(o):h.body=o),fetch(t,h).then(d=>d.ok?d.json():d.json().then(p=>(Promise.reject(p.message),{isFetchOk:!1,status:d.status,message:p.message,payload:p&&p.payload?p.payload:null}))).then(d=>d).catch(d=>(console.error("Error in fetch",d),d))}catch(l){return console.error("Error!: "+l),l}}function L(t="nammax_auth"){let o=`; ${document.cookie}`.split(`; ${t}=`);return o.length===2?o.pop().split(";").shift():null}function T(t="/",n=2e3){setTimeout(()=>{window.location.href=t},n)}function P(t=null){if(t==null)return"NaN";let n=new Date(t);return`${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()}`}function z(t="/admin/sign-in",n="sidebar-logout-btn"){let o=document.getElementById(n);o?o.onclick=()=>Y(t):console.error("Logout button not found")}function Y(t="/sign-in"){window.localStorage.removeItem("auth"),T(`${t}`)}function $(t=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(t)).replace(/^(\D+)/,"$1 ")}function F(t=new Date,n=0){let o=t;return o&&o.setDate(o.getDate()+n),o}function K(t=R.ADMIN){if(t===R.ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),o&&o.remove()}else if(t===R.SUPER_ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),n&&n.remove()}}function H(){let t=document.getElementById("loading-screen");t?t.remove():console.log("did not find loading screen")}function j(t){let n=new Date(t);return n.setMinutes(n.getMinutes()-n.getTimezoneOffset()),n}function B(t,n,o=!1){let _=864e5;return Math.round((j(n)-j(t))/_)}function C({tag:t="gym",API:n=null,parentTableName:o="user-table-subscription-header",tableColumnContainerName:_="user-table-gym-header",extraXanoInputObj:u=[],filterData:f=null,searchContainerElId:l="",token:h},d){if(!f){console.error("No Filter Data provided");return}let p=document.getElementById(_);if(!p){console.error("Failed to find column container");return}let N=p.querySelector("#filter-search");if(!N){console.error("Failed to find column filter");return}V(_,N,f),p.onclick=s=>{s.stopPropagation(),N.style.display="block"};let i=N.querySelector("#close-btn");i?i.onclick=s=>{s.stopPropagation(),N.style.display="none"}:console.error("Failed to find close btn");let r=p.querySelector("#filter-btn");if(!r){console.error("Failed to find submit filter btn");return}r.onclick=()=>{let s=N.querySelector(`input[name="${_}"]:checked`).value,x;l.length>0?x=document.getElementById(l).querySelector("#search-input"):x=document.getElementById("search-input"),J(t,s,n,d,h,x.value,o,_,N,u)};let a=p.querySelector("#reset-filter-btn");if(!a){console.error("Failed to find reset filter btn");return}a.onclick=s=>{s.stopPropagation(),k("","",n,d,h,"",u),G("hide",o,_,N)}}function J(t,n,o,_,u,f,l,h,d,p){return y(this,null,function*(){k(t,n,o,_,u,f,p),G("show",l,h,d)})}function k(h,d,p,N,i,r){return y(this,arguments,function*(t,n,o,_,u,f,l=[]){let a={search_query:(f==null?void 0:f.length)>0?`${f}:*`:"",tag:t,filter:n||""};l.length>0&&l.map(x=>{for(let[m,c]of Object.entries(x))a[m]=c});let s=yield U(o+"query","POST",a,u);if(s.isFetchOk!==void 0&&!s.isFetchOk)throw console.error(s.message),Error("API call failed");_&&_(s)})}function G(t="show",n,o,_){let u=document.getElementById(n);if(!u){console.error("Could not find parent table name");return}if(u.querySelectorAll(".text-w").forEach(l=>{l.style.textDecoration="none"}),t==="show"){let l=document.getElementById(o);if(!l){console.error("Could not find column name");return}l.style.textDecoration="underline",_.querySelector("#reset-filter-btn").style.display="block"}else t==="hide"&&(_.querySelector("#reset-filter-btn").style.display="none");setTimeout(()=>{_.style.display="none"},500)}function V(t,n,o){let _=n.querySelector("label");o.forEach(u=>{let f=_.cloneNode(!0),l=f.querySelector("input"),h=f.querySelector("span");l.value=u.value,l.name=t,h.innerText=u.text,n.prepend(f)}),_.remove()}function W({mode:t="API",clientObjRefName:n="name",data:o,token:_,API:u,extraXanoInputObj:f=[],searchContainerElId:l=""},h,d=null,p=null){let N,i,r;if(l.length>0){let a=document.getElementById(l);N=a.querySelector("#search-input"),N.setAttribute("placeholder","Search"),i=a.querySelector("#search-btn"),r=a.querySelector("#search-reset-btn")}else N=document.getElementById("search-input"),N.setAttribute("placeholder","Search"),i=document.getElementById("search-btn"),r=document.getElementById("search-reset-btn");r.onclick=()=>{N.value="",q(r,{mode:t,clientObjRefName:n,data:o,searchquery:"",token:_,API:u,extraXanoInputObj:f},h,d,p)},i.onclick=()=>{let a=N.value;q(r,{mode:t,clientObjRefName:n,data:o,searchquery:a,token:_,API:u,extraXanoInputObj:f},h,d,p)}}function q(i,r,a,s,x){return y(this,arguments,function*(t,{mode:n,clientObjRefName:o,data:_,searchquery:u,token:f,API:l,extraXanoInputObj:h=[]},d,p,N){if(u.length===0)t.style.display="none",p?d(_,p):d(_);else try{if(n==="API"){let m={search_query:`${u}:*`};h.length>0&&h.map(e=>{for(let[A,g]of Object.entries(e))m[A]=g});let c=yield U(l+"query","POST",m,f);if(c.isFetchOk!==void 0&&!c.isFetchOk)throw console.error(c.message),Error("API call failed");t.style.display="flex",p?d(c,p):d(c)}else{let m=_.filter(c=>c[o].toLowerCase().includes(u.toLowerCase()));t.style.display="flex",p?d(m,p):d(m)}}catch(m){N?N():console.error(m)}})}var M="/admin/sign-in";var v="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/super_admin/dashboard";var b="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";(()=>{let t=null,n=0,o=[];window.onload=function(){return y(this,null,function*(){z("/admin/sign-in","sidebar-logout-btn");let i=L();if(i){let r=yield U(v+"/1","GET",!1,i);if(r.isFetchOk!==void 0&&!r.isFetchOk){console.error(r.message),r.payload&&r.payload.role===R.ADMIN&&r.payload.gyms&&r.payload.gyms.length>0?T(`/admin/gym/g?gymCode=${r.payload.gyms[0].gym_id}`):T(`${M}?reason=UNAUTHORIZED_USER`);return}K(R.SUPER_ADMIN),_(r,i)}else T(`${M}?reason=NOT_SIGNED_IN`)})};function _(i,r){return y(this,null,function*(){let{users:a,gyms:s,finance:x,footfall:m}=i;p(x),N(a),u(s,a,m),f(s),l(a),W({data:a,token:r,API:b},l),C({tag:"gym",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gym-header",filterData:s.map(c=>({text:c.code,value:c.id})),token:r,API:b},l),C({tag:"subscription",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-subscription-header",filterData:D.map(c=>({text:c,value:c})),token:r,API:b},l),C({tag:"gender",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gender-header",filterData:X.map(c=>({text:c,value:c})),token:r,API:b},l),H()})}function u(i,r,a){var s;if(i&&i.length>0){let x=r.items.filter(e=>{let A=new Date,g=new Date(e.created_at),E=Math.abs(A-g);return Math.ceil(E/(1e3*60*60*24))<=24});document.getElementById("gym-statistics-new-sign-ups").innerText=x.length||0,document.getElementById("gym-statistics-attendence").innerText=a||0;let m={};i.forEach(e=>{var A;(A=e==null?void 0:e.footfall)==null||A.items.forEach(g=>{m[e.code]?m[e.code]+=Number(g.traffic):m[e.code]=Number(g.traffic)})});let c=((s=Object.keys(m))==null?void 0:s.reduce((e,A)=>m[e]>m[A]?e:A,i[0].code))||i[0].code||"NaN";document.getElementById("gym-statistics-top-performer").innerText=c,document.getElementById("gym-statistics-total-members").innerText=r.items.length}}function f(i){let r=document.getElementById("gym-container"),a=r.querySelector("#gym-item");i.forEach(s=>{var c,e,A,g,E,O,S;let x=a.cloneNode(!0);x.setAttribute("id",""),x.setAttribute("href",`/admin/gym/g?gymCode=${s.id}`),s.map_icon&&(x.querySelector("#gym-map").style.backgroundImage=`url(${s.map_icon.url})`),x.querySelector("#gym-code").innerText=s.code,x.querySelector("#gym-name").innerText=s.location,x.querySelector("#gym-coach").innerText=s.partner||"NaN",x.querySelector("#gym-active-sessions").innerText=(e=(c=s==null?void 0:s.sessions)==null?void 0:c.length)!=null?e:0;let m=0;s.finances.forEach(I=>{m+=Number(I.gross_revenue)+Number(I.additional_revenue)}),s.finances.length>0?m=m/s.finances.length:m=null,x.querySelector("#gym-revenue").innerText=(A=$(Math.round(m)||0))!=null?A:"NaN",x.querySelector("#gym-active-users").innerText=(E=(g=s==null?void 0:s.users)==null?void 0:g.filter(I=>I.membership_status!=="INACTIVE").length)!=null?E:0,x.querySelector("#gym-users").innerText=(S=(O=s==null?void 0:s.users)==null?void 0:O.length)!=null?S:0,r.prepend(x)}),a.remove()}function l(i,r=!1){let a=document.getElementById("table-container"),s=a.querySelector("#table-item");function x(m){t=m.nextPage;let c=a.querySelectorAll(".adb-user.w-inline-block");c.forEach((e,A)=>{A!==c.length-1&&(A!==c.length-2||n>0)&&e.remove()}),o.items.forEach((e,A)=>{let g=s.cloneNode(!0);g.setAttribute("id",""),g.setAttribute("href",`/admin/user?userId=${e.id}`);let E=g.querySelectorAll(".colcontent");if(A%2===0&&(g.style.backgroundColor="#00edf4"),e.profile_picture&&(E[0].style.backgroundImage=`url(${e.profile_picture.url})`),e.membership_end_date){let I=new Date(e.membership_end_date),w=new Date;(e==null?void 0:e.session_ledger)!==void 0&&e.session_ledger.length<=3?E[0].style.border="3px solid #009ca1":B(w,I,!0)<=3?E[0].style.border="3px solid red":B(w,I,!0)<=7&&(E[0].style.border="3px solid orange")}E[1].innerText=e.name||"",E[2].innerText=e.code||"Unselected";let O=F(new Date(e.created_at),7),S="";e.tokens===2&&e.session_ledger.length===0&&O.getTime()<new Date().getTime()?S=D[0]:e.tokens===0&&e.session_ledger.length===0&&O.getTime()>new Date().getTime()?S=D[1]:e.tokens===2&&e.session_ledger.length===0?S=D[2]:e.tokens===1&&e.session_ledger.length===1?S=D[3]:e.membership_status!=="TRIAL"&&e.session_ledger.length>0&&O.getTime()>new Date().getTime()?S=D[4]:e.membership_end_date&&new Date(e.membership_end_date).getTime()<new Date().getTime()&&(S=D[5]),E[3].innerText=S||e.membership_status||"INACTIVE",E[4].innerText=e.gender||"Unselected",E[5].innerText=e.session_ledger.length||0,e.session_ledger.length>0?E[6].innerText=P(e.session_ledger[e.session_ledger.length-1].time):E[6].innerText="N/A",g.style.display="flex",a.prepend(g)})}r?(o.items.push(...i.items),o.nextPage=i.nextPage):o=i,x(o),s.style.display="none"}new IntersectionObserver(i=>{i[0].intersectionRatio<=0||(n>0&&t?d(t):n<1&&n++)}).observe(document.querySelector(".loadmore"));function d(i){return y(this,null,function*(){let r=L();if(r){let a=yield U(v+`/${i}`,"GET",!1,r);if(a.isFetchOk!==void 0&&!a.isFetchOk){console.error(a.message),a.payload&&a.payload.role===R.ADMIN&&a.payload.gyms&&a.payload.gyms.length>0?T(`/admin/gym/g?gymCode=${a.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}l(a.users,!0)}})}function p(i){return y(this,null,function*(){let r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=[...new Set(i.map(c=>c.month))].sort(),s={},x={};a.map(c=>{s[c]=i.filter(e=>e.month===c).reduce((e,A)=>e+A.gross_revenue+A.additional_revenue,0),x[c]=i.filter(e=>e.month===c).reduce((e,A)=>e+A.net_profit,0)});let m=document.getElementById("dashboard-profits-chart").getContext("2d");m.canvas.parentNode.style.height="400px",m.canvas.parentNode.style.width="400px",new Chart(m,{type:"bar",data:{labels:a.map(c=>r[c-1]),datasets:[{label:"Revenue",data:Object.values(s),backgroundColor:["#00EDF4"]},{label:"Profit",data:Object.values(x),backgroundColor:["#E0FFC1"]}]},options:{scales:{x:{grid:{display:!1},stacked:!0},y:{grid:{display:!1},stacked:!0}}}})})}function N(i){return y(this,null,function*(){let r=i.items.filter(s=>s.membership_status!=="INACTIVE"),a=document.getElementById("dashboard-sessions-chart").getContext("2d");a.canvas.parentNode.style.height="300px",a.canvas.parentNode.style.width="300px",i.items.length===r.length?new Chart(a,{type:"pie",data:{labels:[`Total/Active Users ${i.items.length}`],datasets:[{label:"Revenue",data:[i.items.length],backgroundColor:["#00EDF4"]}]},options:{plugins:{legend:{position:"top"}}}}):new Chart(a,{type:"pie",data:{labels:[`Total Users ${i.items.length}`,`Active Users ${r.length}`],datasets:[{label:"Revenue",data:[i.items.length,r.length],backgroundColor:["#00EDF4","#E0FFC1"]}]},options:{plugins:{legend:{position:"top"}}}})})}})();
