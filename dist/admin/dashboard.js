var R=(n,l,s)=>new Promise((A,x)=>{var g=c=>{try{N(s.next(c))}catch(m){x(m)}},d=c=>{try{N(s.throw(c))}catch(m){x(m)}},N=c=>c.done?A(c.value):Promise.resolve(c.value).then(g,d);N((s=s.apply(n,l)).next())});var S={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function O(n,l="GET",s=!1,A=!1,x=!1,g=!0){try{let d={"Content-Type":"application/json"};x&&(d={}),A&&(d.Authorization=`Bearer ${A}`);let N={method:l,headers:d};return s&&(g?N.body=JSON.stringify(s):N.body=s),fetch(n,N).then(c=>c.ok?c.json():c.json().then(m=>(Promise.reject(m.message),{isFetchOk:!1,status:c.status,message:m.message,payload:m&&m.payload?m.payload:null}))).then(c=>c).catch(c=>(console.error("Error in fetch",c),c))}catch(d){return console.error("Error!: "+d),d}}function y(n="nammax_auth"){let s=`; ${document.cookie}`.split(`; ${n}=`);return s.length===2?s.pop().split(";").shift():null}function I(n="/",l=2e3){setTimeout(()=>{window.location.href=n},l)}function L(n=null){if(n==null)return"NaN";let l=new Date(n);return`${l.getDate()}/${l.getMonth()+1}/${l.getFullYear()}`}function b(n=null){if(n==null)return"NaN";let l=n.split("-"),s=Date.now()-new Date(parseInt(l[2]),parseInt(l[1])-1,parseInt(l[0])).getTime(),A=new Date(s);return Math.abs(A.getUTCFullYear()-1970)}function B(n="/admin/sign-in",l="sidebar-logout-btn"){let s=document.getElementById(l);s?s.onclick=()=>$(n):console.error("Logout button not found")}function $(n="/sign-in"){window.localStorage.removeItem("auth"),I(`${n}`)}function M(n=S.ADMIN){if(n===S.ADMIN){let l=document.getElementById("admin-nav"),s=document.getElementById("super-admin-nav");l&&(l.style.display="flex"),s&&s.remove()}else if(n===S.SUPER_ADMIN){let l=document.getElementById("admin-nav"),s=document.getElementById("super-admin-nav");s&&(s.style.display="flex"),l&&l.remove()}}function k(){let n=document.getElementById("loading-screen");n?n.remove():console.log("did not find loading screen")}function X({mode:n="API",clientObjRefName:l="name",data:s,token:A,API:x,extraXanoInputObj:g=[],searchContainerElId:d=""},N,c=null,m=null){let f,t,o;if(d.length>0){let e=document.getElementById(d);f=e.querySelector("#search-input"),f.setAttribute("placeholder","Search"),t=e.querySelector("#search-btn"),o=e.querySelector("#search-reset-btn")}else f=document.getElementById("search-input"),f.setAttribute("placeholder","Search"),t=document.getElementById("search-btn"),o=document.getElementById("search-reset-btn");o.onclick=()=>{f.value="",v(o,{mode:n,clientObjRefName:l,data:s,searchquery:"",token:A,API:x,extraXanoInputObj:g},N,c,m)},t.onclick=()=>{let e=f.value;v(o,{mode:n,clientObjRefName:l,data:s,searchquery:e,token:A,API:x,extraXanoInputObj:g},N,c,m)}}function v(t,o,e,a,_){return R(this,arguments,function*(n,{mode:l,clientObjRefName:s,data:A,searchquery:x,token:g,API:d,extraXanoInputObj:N=[]},c,m,f){if(x.length===0)n.style.display="none",m?c(A,m):c(A);else try{if(l==="API"){let p={search_query:`${x}:*`};N.length>0&&N.map(i=>{for(let[u,h]of Object.entries(i))p[u]=h});let r=yield O(d+"query","POST",p,g);if(r.isFetchOk!==void 0&&!r.isFetchOk)throw console.error(r.message),Error("API call failed");n.style.display="flex",m?c(r,m):c(r)}else{let p=A.filter(r=>r[s].toLowerCase().includes(x.toLowerCase()));n.style.display="flex",m?c(p,m):c(p)}}catch(p){f?f():console.error(p)}})}var D="/admin/sign-in";var U="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard";var K="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";(()=>{let n=null,l=0,s=[];window.onload=function(){return R(this,null,function*(){B("/admin/sign-in","sidebar-logout-btn");let t=y();if(t){let o=yield O(U+"/1","GET",!1,t);if(o.isFetchOk!==void 0&&!o.isFetchOk){console.error(o.message),o.payload&&o.payload.role===S.ADMIN&&o.payload.gyms&&o.payload.gyms.length>0?I(`/admin/gym/g?gymCode=${o.payload.gyms[0].gym_id}`):I(`${D}?reason=UNAUTHORIZED_USER`);return}M(S.SUPER_ADMIN),A(o,t)}else I(`${D}?reason=NOT_SIGNED_IN`)})};function A(t,o){return R(this,null,function*(){let{users:e,gyms:a,finance:_,footfall:p}=t;m(_),f(e),x(a,e,p),g(a),d(e),X({data:e,token:o,API:K},d),k()})}function x(t,o,e){if(t&&t.length>0){let a=o.items.filter(r=>{let i=new Date,u=new Date(r.created_at),h=Math.abs(i-u);return Math.ceil(h/(1e3*60*60*24))<=24});document.getElementById("gym-statistics-new-sign-ups").innerText=a.length||0,document.getElementById("gym-statistics-attendence").innerText=e||0;let _={};t.forEach(r=>{r.footfall.items.forEach(i=>{_[r.code]?_[r.code]+=Number(i.traffic):_[r.code]=Number(i.traffic)})});let p=Object.keys(_).reduce((r,i)=>_[r]>_[i]?r:i)||t[0].code||"NaN";document.getElementById("gym-statistics-top-performer").innerText=p,document.getElementById("gym-statistics-total-members").innerText=o.items.length}}function g(t){let o=document.getElementById("gym-container"),e=o.querySelector("#gym-item");t.forEach(a=>{var p,r,i,u,h,E,T,C;let _=e.cloneNode(!0);_.setAttribute("id",""),_.setAttribute("href",`/admin/gym/g?gymCode=${a.id}`),a.map_icon&&(_.querySelector("#gym-map").style.backgroundImage=`url(${a.map_icon.url})`),_.querySelector("#gym-code").innerText=a.code,_.querySelector("#gym-name").innerText=a.location,_.querySelector("#gym-coach").innerText=a.partner||"NaN",_.querySelector("#gym-active-sessions").innerText=(r=(p=a==null?void 0:a.sessions)==null?void 0:p.length)!=null?r:0,_.querySelector("#gym-revenue").innerText=Number((i=a==null?void 0:a.finance)==null?void 0:i.gross_revenue)+Number((u=a==null?void 0:a.finance)==null?void 0:u.additional_revenue),_.querySelector("#gym-active-users").innerText=(E=(h=a==null?void 0:a.users)==null?void 0:h.filter(w=>w.membership_status!=="INACTIVE"&&w.membership_status!=="TRIAL").length)!=null?E:0,_.querySelector("#gym-users").innerText=(C=(T=a==null?void 0:a.users)==null?void 0:T.length)!=null?C:0,o.prepend(_)}),e.remove()}function d(t,o=!1){let e=document.getElementById("table-container"),a=e.querySelector("#table-item");function _(p){n=p.nextPage;let r=e.querySelectorAll(".adb-user.w-inline-block");r.forEach((i,u)=>{u!==r.length-1&&(u!==r.length-2||l>0)&&i.remove()}),s.items.forEach((i,u)=>{let h=a.cloneNode(!0);h.setAttribute("id",""),h.setAttribute("href",`/admin/user?userId=${i.id}`);let E=h.querySelectorAll(".colcontent");u%2===0&&(h.style.backgroundColor="#00edf4"),i.profile_picture&&(E[0].style.backgroundImage=`url(${i.profile_picture.url})`),E[1].innerText=i.name||"",E[2].innerText=i.code||"Unselected",E[3].innerText=i.membership_status||"INACTIVE",E[4].innerText=i.gender||"Unselected",E[5].innerText=b(i.date_of_birth)||"Unselected",i.session_ledger.length>0?E[6].innerText=L(i.session_ledger[i.session_ledger.length-1].time):E[6].innerText="N/A",h.style.display="flex",e.prepend(h)})}o?(s.items.push(...t.items),s.nextPage=t.nextPage):s=t,_(s),a.style.display="none"}new IntersectionObserver(t=>{t[0].intersectionRatio<=0||(l>0&&n?c(n):l<1&&l++)}).observe(document.querySelector(".loadmore"));function c(t){return R(this,null,function*(){let o=y();if(o){let e=yield O(U+`/${t}`,"GET",!1,o);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===S.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?I(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}d(e.users,!0)}})}function m(t){return R(this,null,function*(){let o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=[...new Set(t.map(r=>r.month))].sort(),a={},_={};e.map(r=>{a[r]=t.filter(i=>i.month===r).reduce((i,u)=>i+u.gross_revenue+u.additional_revenue,0),_[r]=t.filter(i=>i.month===r).reduce((i,u)=>i+u.net_profit,0)});let p=document.getElementById("dashboard-profits-chart").getContext("2d");p.canvas.parentNode.style.height="400px",p.canvas.parentNode.style.width="400px",new Chart(p,{type:"bar",data:{labels:e.map(r=>o[r-1]),datasets:[{label:"Revenue",data:Object.values(a),backgroundColor:["#00EDF4"]},{label:"Profit",data:Object.values(_),backgroundColor:["#E0FFC1"]}]},options:{scales:{x:{grid:{display:!1},stacked:!0},y:{grid:{display:!1},stacked:!0}}}})})}function f(t){return R(this,null,function*(){let o=t.items.filter(a=>a.membership_status!=="INACTIVE"),e=document.getElementById("dashboard-sessions-chart").getContext("2d");e.canvas.parentNode.style.height="300px",e.canvas.parentNode.style.width="300px",t.items.length===o.length?new Chart(e,{type:"pie",data:{labels:[`Total/Active Users ${t.items.length}`],datasets:[{label:"Revenue",data:[t.items.length],backgroundColor:["#00EDF4"]}]},options:{plugins:{legend:{position:"top"}}}}):new Chart(e,{type:"pie",data:{labels:[`Total Users ${t.items.length}`,`Active Users ${o.length}`],datasets:[{label:"Revenue",data:[t.items.length,o.length],backgroundColor:["#00EDF4","#E0FFC1"]}]},options:{plugins:{legend:{position:"top"}}}})})}})();
