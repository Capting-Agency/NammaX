var O=(t,n,o)=>new Promise((r,_)=>{var p=a=>{try{x(o.next(a))}catch(u){_(u)}},d=a=>{try{x(o.throw(a))}catch(u){_(u)}},x=a=>a.done?r(a.value):Promise.resolve(a.value).then(p,d);x((o=o.apply(t,n)).next())});var z=["Male","Female","Other","Prefer not to say"];var D={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"},y=["DROPOUT","NO SHOW","NEW USER","TRIAL","NO RENEWAL","NO MEMBERSHIP","HAS MEMBERSHIP"];function b(t,n="GET",o=!1,r=!1,_=!1,p=!0){try{let d={"Content-Type":"application/json"};_&&(d={}),r&&(d.Authorization=`Bearer ${r}`);let x={method:n,headers:d};return o&&(p?x.body=JSON.stringify(o):x.body=o),fetch(t,x).then(a=>a.ok?a.json():a.json().then(u=>(Promise.reject(u.message),{isFetchOk:!1,status:a.status,message:u.message,payload:u&&u.payload?u.payload:null}))).then(a=>a).catch(a=>(console.error("Error in fetch",a),a))}catch(d){return console.error("Error!: "+d),d}}function v(t="nammax_auth"){let o=`; ${document.cookie}`.split(`; ${t}=`);return o.length===2?o.pop().split(";").shift():null}function U(t="/",n=2e3){setTimeout(()=>{window.location.href=t},n)}function F(t=null){if(t==null)return"NaN";let n=new Date(t);return`${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()}`}function K(t="/admin/sign-in",n="sidebar-logout-btn"){let o=document.getElementById(n);o?o.onclick=()=>Z(t):console.error("Logout button not found")}function Z(t="/sign-in"){window.localStorage.removeItem("auth"),U(`${t}`)}function $(t=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(t)).replace(/^(\D+)/,"$1 ")}function Q(t=new Date,n=0){let o=t;return o&&o.setDate(o.getDate()+n),o}function H(t=D.ADMIN){if(t===D.ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),o&&o.remove()}else if(t===D.SUPER_ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),n&&n.remove()}}function k(){let t=document.getElementById("loading-screen");t?t.remove():console.warn("Loading screen not found")}function P(t){let n=new Date(t);return n.setMinutes(n.getMinutes()-n.getTimezoneOffset()),n}function w(t,n,o=!1){let r=864e5;return Math.round((P(n)-P(t))/r)}function G(t,n,o,r,_){let p=Q(new Date(t),7),d=new Date().getTime(),x=n,a=o,u=r?new Date(r).getTime():null,f="";return x===0?a===2&&p&&p.getTime()>d?f=y[0]:a===0&&p&&p.getTime()>d&&(f=y[1]):x===2&&a===0&&_===y[3]?f=y[2]:_===y[3]?f=y[3]:_!==y[3]&&a>0&&p&&p.getTime()>d&&u&&u<=d?f=y[4]:a>3&&_==="INACTIVE"?f=y[5]:_!=="INACTIVE"&&_!==y[3]&&(f=y[6]),f}function M({tag:t="gym",API:n=null,parentTableName:o="user-table-subscription-header",tableColumnContainerName:r="user-table-gym-header",extraXanoInputObj:_=[],filterData:p=null,searchContainerElId:d=""},x,a){if(!p){console.error("No Filter Data provided");return}let u=document.getElementById(r);if(!u){console.error("Failed to find column container");return}let f=u.querySelector("#filter-search");if(!f){console.error("Failed to find column filter");return}te(r,f,p),u.onclick=i=>{i.stopPropagation(),f.style.display="block"};let S=f.querySelector("#close-btn");S?S.onclick=i=>{i.stopPropagation(),f.style.display="none"}:console.error("Failed to find close btn");let R=u.querySelector("#filter-btn");if(!R){console.error("Failed to find submit filter btn");return}R.onclick=()=>{let i=f.querySelector(`input[name="${r}"]:checked`).value,l;d.length>0?l=document.getElementById(d).querySelector("#search-input"):l=document.getElementById("search-input"),ee(t,i,n,a,x,l.value,o,r,f,_)};let I=u.querySelector("#reset-filter-btn");if(!I){console.error("Failed to find reset filter btn");return}I.onclick=i=>{i.stopPropagation(),q("","",n,a,x,"",_,!0),W("hide",o,r,f)}}function ee(t,n,o,r,_,p,d,x,a,u){return O(this,null,function*(){q(t,n,o,r,_,p,u),W("show",d,x,a)})}function q(a,u,f,S,R,I){return O(this,arguments,function*(t,n,o,r,_,p,d=[],x=!1){if(x){r&&r({isFilter:!0,filterQueries:{},API:o,isReset:x});return}let i={search_query:(p==null?void 0:p.length)>0?`${p}:*`:"",tag:t,filter:n||""};d.length>0&&d.map(l=>{for(let[c,s]of Object.entries(l))i[c]=s}),_=i,r&&r({isFilter:!0,filterQueries:_,API:o})})}function W(t="show",n,o,r){let _=document.getElementById(n);if(!_){console.error("Could not find parent table name");return}if(_.querySelectorAll(".text-w").forEach(d=>{d.style.textDecoration="none"}),t==="show"){let d=document.getElementById(o);if(!d){console.error("Could not find column name");return}d.style.textDecoration="underline",r.querySelector("#reset-filter-btn").style.display="block"}else t==="hide"&&(r.querySelector("#reset-filter-btn").style.display="none");setTimeout(()=>{r.style.display="none"},500)}function te(t,n,o){let r=n.querySelector("label");o.forEach(_=>{let p=r.cloneNode(!0),d=p.querySelector("input"),x=p.querySelector("span");d.value=_.value,d.name=t,x.innerText=_.text,n.prepend(p)}),r.remove()}function V({mode:t="API",clientObjRefName:n="name",data:o,token:r,API:_,extraXanoInputObj:p=[],searchContainerElId:d=""},x,a=null,u=null){let f,S,R;if(d.length>0){let I=document.getElementById(d);f=I.querySelector("#search-input"),f.setAttribute("placeholder","Search"),S=I.querySelector("#search-btn"),R=I.querySelector("#search-reset-btn")}else f=document.getElementById("search-input"),f.setAttribute("placeholder","Search"),S=document.getElementById("search-btn"),R=document.getElementById("search-reset-btn");R.onclick=()=>{f.value="",Y(R,{mode:t,clientObjRefName:n,data:o,searchquery:"",token:r,API:_,extraXanoInputObj:p},x,a,u)},S.onclick=()=>{let I=f.value;Y(R,{mode:t,clientObjRefName:n,data:o,searchquery:I,token:r,API:_,extraXanoInputObj:p},x,a,u)}}function Y(S,R,I,i,l){return O(this,arguments,function*(t,{mode:n,clientObjRefName:o,data:r,searchquery:_,token:p,API:d,extraXanoInputObj:x=[]},a,u,f){if(_.length===0)t.style.display="none",u?a(r,u):a(r);else try{if(n==="API"){let c={search_query:`${_}:*`};x.length>0&&x.map(A=>{for(let[N,m]of Object.entries(A))c[N]=m});let s=yield b(d+"query","POST",c,p);if(s.isFetchOk!==void 0&&!s.isFetchOk)throw console.error(s.message),Error("API call failed");t.style.display="flex",u?a(s,u):a(s)}else{let c=r.filter(s=>s[o].toLowerCase().includes(_.toLowerCase()));t.style.display="flex",u?a(c,u):a(c)}}catch(c){f?f():console.error(c)}})}var j="/admin/sign-in";var X="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/super_admin/dashboard";var B="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";var ne="https://www.nammacrossfit.com",J=ne;var me=`${J}/sign-up-2`;var pe=`${J}/user/dashboard`;(()=>{let t=null,n=0,o=[],r={},_="";window.onload=function(){return O(this,null,function*(){K("/admin/sign-in","sidebar-logout-btn");let i=v();if(i){let l=yield b(X+"/1","GET",!1,i);if(l.isFetchOk!==void 0&&!l.isFetchOk){console.error(l.message),l.payload&&l.payload.role===D.ADMIN&&l.payload.gyms&&l.payload.gyms.length>0?U(`/admin/gym/g?gymCode=${l.payload.gyms[0].gym_id}`):U(`${j}?reason=UNAUTHORIZED_USER`);return}H(D.SUPER_ADMIN),p(l,i)}else U(`${j}?reason=NOT_SIGNED_IN`)})};function p(i,l){return O(this,null,function*(){let{users:c,gyms:s,finance:A,footfall:N}=i;R(A),I(c),d(s,c,N),x(s),a(c),V({data:c,token:l,API:B},a),M({tag:"gym",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gym-header",filterData:s.map(m=>({text:m.code,value:m.id})),API:B},r,S),M({tag:"subscription",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-subscription-header",filterData:y.map(m=>({text:m,value:m})),API:B},r,S),M({tag:"gender",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gender-header",filterData:z.map(m=>({text:m,value:m})),API:B},r,S),k()})}function d(i,l,c){var s;if(i&&i.length>0){let A=l.items.filter(e=>{let h=new Date,E=new Date(e.created_at),g=Math.abs(h-E);return Math.ceil(g/(1e3*60*60*24))<=24});document.getElementById("gym-statistics-new-sign-ups").innerText=A.length||0,document.getElementById("gym-statistics-attendence").innerText=c||0;let N={};i.forEach(e=>{var h;(h=e==null?void 0:e.footfall)==null||h.items.forEach(E=>{N[e.code]?N[e.code]+=Number(E.traffic):N[e.code]=Number(E.traffic)})});let m=((s=Object.keys(N))==null?void 0:s.reduce((e,h)=>N[e]>N[h]?e:h,i[0].code))||i[0].code||"NaN";document.getElementById("gym-statistics-top-performer").innerText=m,document.getElementById("gym-statistics-total-members").innerText=l.items.length}}function x(i){let l=document.getElementById("gym-container"),c=l.querySelector("#gym-item");i.forEach(s=>{var m,e,h,E,g,C,L;let A=c.cloneNode(!0);A.setAttribute("id",""),A.setAttribute("href",`/admin/gym/g?gymCode=${s.id}`),s.map_icon&&(A.querySelector("#gym-map").style.backgroundImage=`url(${s.map_icon.url})`),A.querySelector("#gym-code").innerText=s.code,A.querySelector("#gym-name").innerText=s.location,A.querySelector("#gym-coach").innerText=s.partner||"NaN",A.querySelector("#gym-active-sessions").innerText=(e=(m=s==null?void 0:s.sessions)==null?void 0:m.length)!=null?e:0;let N=0;s.finances.forEach(T=>{N+=Number(T.gross_revenue)+Number(T.additional_revenue)}),s.finances.length>0?N=N/s.finances.length:N=null,A.querySelector("#gym-revenue").innerText=(h=$(Math.round(N)||0))!=null?h:"NaN",A.querySelector("#gym-active-users").innerText=(g=(E=s==null?void 0:s.users)==null?void 0:E.filter(T=>T.membership_status!=="INACTIVE").length)!=null?g:0,A.querySelector("#gym-users").innerText=(L=(C=s==null?void 0:s.users)==null?void 0:C.length)!=null?L:0,l.prepend(A)}),c.remove()}function a(i,l=!1){let c=document.getElementById("table-container"),s=c.querySelector("#table-item");function A(N){t=N.nextPage;let m=c.querySelectorAll(".adb-user.w-inline-block");m.forEach((e,h)=>{h!==m.length-1&&(h!==m.length-2||n>0)&&(console.log("removing item",e),e.remove())}),o.items.forEach((e,h)=>{let E=s.cloneNode(!0);E.setAttribute("id",""),E.setAttribute("href",`/admin/user?userId=${e.id}`);let g=E.querySelectorAll(".colcontent");if(h%2===0&&(E.style.backgroundColor="#00edf4"),e.profile_picture&&(g[0].style.backgroundImage=`url(${e.profile_picture.url})`),e.membership_end_date){let L=new Date(e.membership_end_date),T=new Date;(e==null?void 0:e.session_ledger)!==void 0&&e.session_ledger.length<=3?g[0].style.border="3px solid #009ca1":w(T,L,!0)<=3?g[0].style.border="3px solid red":w(T,L,!0)<=7&&(g[0].style.border="3px solid orange")}g[1].innerText=e.name||"",g[2].innerText=e.code||"Unselected";let C="";C=G(e.created_at,e.tokens,e.session_ledger.length,e.membership_end_date,e.membership_status)||"",g[3].innerText=C||e.membership_status||"INACTIVE",g[4].innerText=e.gender||"Unselected",g[5].innerText=e.session_ledger.length||0,e.session_ledger.length>0?g[6].innerText=F(e.session_ledger[e.session_ledger.length-1].time):g[6].innerText="N/A",E.style.display="flex",c.prepend(E)})}l?(o.items.push(...i.items),o.nextPage=i.nextPage):o=i,A(o),s.style.display="none"}let u=document.getElementById("table-container");new IntersectionObserver(i=>{i[0].intersectionRatio<=0||(n>0&&t?S({},t):n<1&&n++)},{root:u,threshold:[0,1]}).observe(document.querySelector(".loadmore"));function S(N){return O(this,arguments,function*({isFilter:i=!1,filterQueries:l=r||{},API:c=_,isReset:s=!1},A=t){let m=v();if(m)if(Object.entries(l).length>0&&c)if(r=l,_=c,i){let e=yield b(c+"query","POST",l,m);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===D.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?U(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.error("error fetching paginated");return}else{a(e,!1);return}}else{l.page=A;let e=yield b(c+"query","POST",l,m);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===D.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?U(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.error("error fetching paginated");return}else{a(e,t);return}}else{s&&(t=null,A=1,r={});let e=yield b(X+`/${A}`,"GET",!1,m);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===D.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?U(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.error("error fetching paginated");return}a(e.users,!1)}})}function R(i){return O(this,null,function*(){let l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=[...new Set(i.map(m=>m.month))].sort(),s={},A={};c.map(m=>{s[m]=i.filter(e=>e.month===m).reduce((e,h)=>e+h.gross_revenue+h.additional_revenue,0),A[m]=i.filter(e=>e.month===m).reduce((e,h)=>e+h.net_profit,0)});let N=document.getElementById("dashboard-profits-chart").getContext("2d");N.canvas.parentNode.style.height="400px",N.canvas.parentNode.style.width="400px",new Chart(N,{type:"bar",data:{labels:c.map(m=>l[m-1]),datasets:[{label:"Revenue",data:Object.values(s),backgroundColor:["#00EDF4"]},{label:"Profit",data:Object.values(A),backgroundColor:["#E0FFC1"]}]},options:{scales:{x:{grid:{display:!1},stacked:!0},y:{grid:{display:!1},stacked:!0}}}})})}function I(i){return O(this,null,function*(){let l=i.items.filter(s=>s.membership_status!=="INACTIVE"),c=document.getElementById("dashboard-sessions-chart").getContext("2d");c.canvas.parentNode.style.height="230px",c.canvas.parentNode.style.width="230px",i.items.length===l.length?new Chart(c,{type:"pie",data:{labels:[`Total/Active Users ${i.items.length}`],datasets:[{label:"Revenue",data:[i.items.length],backgroundColor:["#00EDF4"]}]},options:{plugins:{legend:{position:"top"}}}}):new Chart(c,{type:"pie",data:{labels:[`Total Users ${i.items.length}`,`Active Users ${l.length}`],datasets:[{label:"Revenue",data:[i.items.length,l.length],backgroundColor:["#00EDF4","#E0FFC1"]}]},options:{plugins:{legend:{position:"top"}}}})})}})();
