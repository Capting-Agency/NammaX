var y=(t,n,o)=>new Promise((_,u)=>{var h=d=>{try{x(o.next(d))}catch(p){u(p)}},c=d=>{try{x(o.throw(d))}catch(p){u(p)}},x=d=>d.done?_(d.value):Promise.resolve(d.value).then(h,c);x((o=o.apply(t,n)).next())});var v=["Male","Female","Other","Prefer not to say"];var R={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"},D=["DROPOUT","NO SHOW","NEW USER","TRIAL","NO RENEWAL","NO MEMBERSHIP"];function I(t,n="GET",o=!1,_=!1,u=!1,h=!0){try{let c={"Content-Type":"application/json"};u&&(c={}),_&&(c.Authorization=`Bearer ${_}`);let x={method:n,headers:c};return o&&(h?x.body=JSON.stringify(o):x.body=o),fetch(t,x).then(d=>d.ok?d.json():d.json().then(p=>(Promise.reject(p.message),{isFetchOk:!1,status:d.status,message:p.message,payload:p&&p.payload?p.payload:null}))).then(d=>d).catch(d=>(console.error("Error in fetch",d),d))}catch(c){return console.error("Error!: "+c),c}}function w(t="nammax_auth"){let o=`; ${document.cookie}`.split(`; ${t}=`);return o.length===2?o.pop().split(";").shift():null}function T(t="/",n=2e3){setTimeout(()=>{window.location.href=t},n)}function P(t=null){if(t==null)return"NaN";let n=new Date(t);return`${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()}`}function $(t="/admin/sign-in",n="sidebar-logout-btn"){let o=document.getElementById(n);o?o.onclick=()=>J(t):console.error("Logout button not found")}function J(t="/sign-in"){window.localStorage.removeItem("auth"),T(`${t}`)}function F(t=0){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(t)).replace(/^(\D+)/,"$1 ")}function K(t=new Date,n=0){let o=t;return o&&o.setDate(o.getDate()+n),o}function H(t=R.ADMIN){if(t===R.ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),o&&o.remove()}else if(t===R.SUPER_ADMIN){let n=document.getElementById("admin-nav"),o=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),n&&n.remove()}}function G(){let t=document.getElementById("loading-screen");t?t.remove():console.log("did not find loading screen")}function X(t){let n=new Date(t);return n.setMinutes(n.getMinutes()-n.getTimezoneOffset()),n}function L(t,n,o=!1){let _=864e5;return Math.round((X(n)-X(t))/_)}function C({tag:t="gym",API:n=null,parentTableName:o="user-table-subscription-header",tableColumnContainerName:_="user-table-gym-header",extraXanoInputObj:u=[],filterData:h=null,searchContainerElId:c="",token:x},d){if(!h){console.error("No Filter Data provided");return}let p=document.getElementById(_);if(!p){console.error("Failed to find column container");return}let N=p.querySelector("#filter-search");if(!N){console.error("Failed to find column filter");return}V(_,N,h),p.onclick=i=>{i.stopPropagation(),N.style.display="block"};let l=N.querySelector("#close-btn");l?l.onclick=i=>{i.stopPropagation(),N.style.display="none"}:console.error("Failed to find close btn");let r=p.querySelector("#filter-btn");if(!r){console.error("Failed to find submit filter btn");return}r.onclick=()=>{let i=N.querySelector(`input[name="${_}"]:checked`).value,m;c.length>0?m=document.getElementById(c).querySelector("#search-input"):m=document.getElementById("search-input"),z(t,i,n,d,x,m.value,o,_,N,u)};let s=p.querySelector("#reset-filter-btn");if(!s){console.error("Failed to find reset filter btn");return}s.onclick=i=>{i.stopPropagation(),q("","",n,d,x,"",u),W("hide",o,_,N)}}function z(t,n,o,_,u,h,c,x,d,p){return y(this,null,function*(){q(t,n,o,_,u,h,p),W("show",c,x,d)})}function q(x,d,p,N,l,r){return y(this,arguments,function*(t,n,o,_,u,h,c=[]){let s={search_query:(h==null?void 0:h.length)>0?`${h}:*`:"",tag:t,filter:n||""};c.length>0&&c.map(m=>{for(let[A,a]of Object.entries(m))s[A]=a});let i=yield I(o+"query","POST",s,u);if(i.isFetchOk!==void 0&&!i.isFetchOk)throw console.error(i.message),Error("API call failed");_&&_(i)})}function W(t="show",n,o,_){let u=document.getElementById(n);if(!u){console.error("Could not find parent table name");return}if(u.querySelectorAll(".text-w").forEach(c=>{c.style.textDecoration="none"}),t==="show"){let c=document.getElementById(o);if(!c){console.error("Could not find column name");return}c.style.textDecoration="underline",_.querySelector("#reset-filter-btn").style.display="block"}else t==="hide"&&(_.querySelector("#reset-filter-btn").style.display="none");setTimeout(()=>{_.style.display="none"},500)}function V(t,n,o){let _=n.querySelector("label");o.forEach(u=>{let h=_.cloneNode(!0),c=h.querySelector("input"),x=h.querySelector("span");c.value=u.value,c.name=t,x.innerText=u.text,n.prepend(h)}),_.remove()}function j({mode:t="API",clientObjRefName:n="name",data:o,token:_,API:u,extraXanoInputObj:h=[],searchContainerElId:c=""},x,d=null,p=null){let N,l,r;if(c.length>0){let s=document.getElementById(c);N=s.querySelector("#search-input"),N.setAttribute("placeholder","Search"),l=s.querySelector("#search-btn"),r=s.querySelector("#search-reset-btn")}else N=document.getElementById("search-input"),N.setAttribute("placeholder","Search"),l=document.getElementById("search-btn"),r=document.getElementById("search-reset-btn");r.onclick=()=>{N.value="",Y(r,{mode:t,clientObjRefName:n,data:o,searchquery:"",token:_,API:u,extraXanoInputObj:h},x,d,p)},l.onclick=()=>{let s=N.value;Y(r,{mode:t,clientObjRefName:n,data:o,searchquery:s,token:_,API:u,extraXanoInputObj:h},x,d,p)}}function Y(l,r,s,i,m){return y(this,arguments,function*(t,{mode:n,clientObjRefName:o,data:_,searchquery:u,token:h,API:c,extraXanoInputObj:x=[]},d,p,N){if(u.length===0)t.style.display="none",p?d(_,p):d(_);else try{if(n==="API"){let A={search_query:`${u}:*`};x.length>0&&x.map(e=>{for(let[f,E]of Object.entries(e))A[f]=E});let a=yield I(c+"query","POST",A,h);if(a.isFetchOk!==void 0&&!a.isFetchOk)throw console.error(a.message),Error("API call failed");t.style.display="flex",p?d(a,p):d(a)}else{let A=_.filter(a=>a[o].toLowerCase().includes(u.toLowerCase()));t.style.display="flex",p?d(A,p):d(A)}}catch(A){N?N():console.error(A)}})}var B="/admin/sign-in";var k="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard";var b="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";(()=>{let t=null,n=0,o=[];window.onload=function(){return y(this,null,function*(){$("/admin/sign-in","sidebar-logout-btn");let l=w();if(l){let r=yield I(k+"/1","GET",!1,l);if(r.isFetchOk!==void 0&&!r.isFetchOk){console.error(r.message),r.payload&&r.payload.role===R.ADMIN&&r.payload.gyms&&r.payload.gyms.length>0?T(`/admin/gym/g?gymCode=${r.payload.gyms[0].gym_id}`):T(`${B}?reason=UNAUTHORIZED_USER`);return}H(R.SUPER_ADMIN),_(r,l)}else T(`${B}?reason=NOT_SIGNED_IN`)})};function _(l,r){return y(this,null,function*(){let{users:s,gyms:i,finance:m,footfall:A}=l;p(m),N(s),u(i,s,A),h(i),c(s),j({data:s,token:r,API:b},c),C({tag:"gym",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gym-header",filterData:i.map(a=>({text:a.code,value:a.id})),token:r,API:b},c),C({tag:"subscription",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-subscription-header",filterData:D.map(a=>({text:a,value:a})),token:r,API:b},c),C({tag:"gender",parentTableName:"user-table-header-container",tableColumnContainerName:"user-table-gender-header",filterData:v.map(a=>({text:a,value:a})),token:r,API:b},c),G()})}function u(l,r,s){if(l&&l.length>0){let i=r.items.filter(a=>{let e=new Date,f=new Date(a.created_at),E=Math.abs(e-f);return Math.ceil(E/(1e3*60*60*24))<=24});document.getElementById("gym-statistics-new-sign-ups").innerText=i.length||0,document.getElementById("gym-statistics-attendence").innerText=s||0;let m={};l.forEach(a=>{var e;(e=a==null?void 0:a.footfall)==null||e.items.forEach(f=>{m[a.code]?m[a.code]+=Number(f.traffic):m[a.code]=Number(f.traffic)})});let A=Object.keys(m).reduce((a,e)=>m[a]>m[e]?a:e)||l[0].code||"NaN";document.getElementById("gym-statistics-top-performer").innerText=A,document.getElementById("gym-statistics-total-members").innerText=r.items.length}}function h(l){let r=document.getElementById("gym-container"),s=r.querySelector("#gym-item");l.forEach(i=>{var a,e,f,E,g,U,S;let m=s.cloneNode(!0);m.setAttribute("id",""),m.setAttribute("href",`/admin/gym/g?gymCode=${i.id}`),i.map_icon&&(m.querySelector("#gym-map").style.backgroundImage=`url(${i.map_icon.url})`),m.querySelector("#gym-code").innerText=i.code,m.querySelector("#gym-name").innerText=i.location,m.querySelector("#gym-coach").innerText=i.partner||"NaN",m.querySelector("#gym-active-sessions").innerText=(e=(a=i==null?void 0:i.sessions)==null?void 0:a.length)!=null?e:0;let A=0;i.finances.forEach(O=>{A+=Number(O.gross_revenue)+Number(O.additional_revenue)}),i.finances.length>0?A=A/i.finances.length:A=null,m.querySelector("#gym-revenue").innerText=(f=F(Math.round(A)||0))!=null?f:"NaN",m.querySelector("#gym-active-users").innerText=(g=(E=i==null?void 0:i.users)==null?void 0:E.filter(O=>O.membership_status!=="INACTIVE").length)!=null?g:0,m.querySelector("#gym-users").innerText=(S=(U=i==null?void 0:i.users)==null?void 0:U.length)!=null?S:0,r.prepend(m)}),s.remove()}function c(l,r=!1){let s=document.getElementById("table-container"),i=s.querySelector("#table-item");function m(A){t=A.nextPage;let a=s.querySelectorAll(".adb-user.w-inline-block");a.forEach((e,f)=>{f!==a.length-1&&(f!==a.length-2||n>0)&&e.remove()}),o.items.forEach((e,f)=>{let E=i.cloneNode(!0);E.setAttribute("id",""),E.setAttribute("href",`/admin/user?userId=${e.id}`);let g=E.querySelectorAll(".colcontent");if(f%2===0&&(E.style.backgroundColor="#00edf4"),e.profile_picture&&(g[0].style.backgroundImage=`url(${e.profile_picture.url})`),e.membership_end_date){let O=new Date(e.membership_end_date),M=new Date;(e==null?void 0:e.session_ledger)!==void 0&&e.session_ledger.length<=3?g[0].style.border="3px solid #009ca1":L(M,O,!0)<=3?g[0].style.border="3px solid red":L(M,O,!0)<=7&&(g[0].style.border="3px solid orange")}g[1].innerText=e.name||"",g[2].innerText=e.code||"Unselected";let U=K(new Date(e.created_at),7),S="";e.tokens===2&&e.session_ledger.length===0&&U.getTime()<new Date().getTime()?S=D[0]:e.tokens===0&&e.session_ledger.length===0&&U.getTime()>new Date().getTime()?S=D[1]:e.tokens===2&&e.session_ledger.length===0?S=D[2]:e.tokens===1&&e.session_ledger.length===1?S=D[3]:e.membership_status!=="TRIAL"&&e.session_ledger.length>0&&U.getTime()>new Date().getTime()?S=D[4]:e.membership_end_date&&new Date(e.membership_end_date).getTime()<new Date().getTime()&&(S=D[5]),g[3].innerText=S||e.membership_status||"INACTIVE",g[4].innerText=e.gender||"Unselected",g[5].innerText=e.session_ledger.length||0,e.session_ledger.length>0?g[6].innerText=P(e.session_ledger[e.session_ledger.length-1].time):g[6].innerText="N/A",E.style.display="flex",s.prepend(E)})}r?(o.items.push(...l.items),o.nextPage=l.nextPage):o=l,m(o),i.style.display="none"}new IntersectionObserver(l=>{l[0].intersectionRatio<=0||(n>0&&t?d(t):n<1&&n++)}).observe(document.querySelector(".loadmore"));function d(l){return y(this,null,function*(){let r=w();if(r){let s=yield I(k+`/${l}`,"GET",!1,r);if(s.isFetchOk!==void 0&&!s.isFetchOk){console.error(s.message),s.payload&&s.payload.role===R.ADMIN&&s.payload.gyms&&s.payload.gyms.length>0?T(`/admin/gym/g?gymCode=${s.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}c(s.users,!0)}})}function p(l){return y(this,null,function*(){let r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=[...new Set(l.map(a=>a.month))].sort(),i={},m={};s.map(a=>{i[a]=l.filter(e=>e.month===a).reduce((e,f)=>e+f.gross_revenue+f.additional_revenue,0),m[a]=l.filter(e=>e.month===a).reduce((e,f)=>e+f.net_profit,0)});let A=document.getElementById("dashboard-profits-chart").getContext("2d");A.canvas.parentNode.style.height="400px",A.canvas.parentNode.style.width="400px",new Chart(A,{type:"bar",data:{labels:s.map(a=>r[a-1]),datasets:[{label:"Revenue",data:Object.values(i),backgroundColor:["#00EDF4"]},{label:"Profit",data:Object.values(m),backgroundColor:["#E0FFC1"]}]},options:{scales:{x:{grid:{display:!1},stacked:!0},y:{grid:{display:!1},stacked:!0}}}})})}function N(l){return y(this,null,function*(){let r=l.items.filter(i=>i.membership_status!=="INACTIVE"),s=document.getElementById("dashboard-sessions-chart").getContext("2d");s.canvas.parentNode.style.height="300px",s.canvas.parentNode.style.width="300px",l.items.length===r.length?new Chart(s,{type:"pie",data:{labels:[`Total/Active Users ${l.items.length}`],datasets:[{label:"Revenue",data:[l.items.length],backgroundColor:["#00EDF4"]}]},options:{plugins:{legend:{position:"top"}}}}):new Chart(s,{type:"pie",data:{labels:[`Total Users ${l.items.length}`,`Active Users ${r.length}`],datasets:[{label:"Revenue",data:[l.items.length,r.length],backgroundColor:["#00EDF4","#E0FFC1"]}]},options:{plugins:{legend:{position:"top"}}}})})}})();
