var R=(i,r,a)=>new Promise((u,x)=>{var f=s=>{try{N(a.next(s))}catch(_){x(_)}},d=s=>{try{N(a.throw(s))}catch(_){x(_)}},N=s=>s.done?u(s.value):Promise.resolve(s.value).then(f,d);N((a=a.apply(i,r)).next())});var S={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function O(i,r="GET",a=!1,u=!1,x=!1,f=!0){try{let d={"Content-Type":"application/json"};x&&(d={}),u&&(d.Authorization=`Bearer ${u}`);let N={method:r,headers:d};return a&&(f?N.body=JSON.stringify(a):N.body=a),fetch(i,N).then(s=>s.ok?s.json():s.json().then(_=>(Promise.reject(_.message),{isFetchOk:!1,status:s.status,message:_.message,payload:_&&_.payload?_.payload:null}))).then(s=>s).catch(s=>(console.error("Error in fetch",s),s))}catch(d){return console.error("Error!: "+d),d}}function y(i="nammax_auth"){let a=`; ${document.cookie}`.split(`; ${i}=`);return a.length===2?a.pop().split(";").shift():null}function I(i="/",r=2e3){setTimeout(()=>{window.location.href=i},r)}function b(i=null){if(i==null)return"NaN";let r=i.split("-"),a=Date.now()-new Date(parseInt(r[2]),parseInt(r[1])-1,parseInt(r[0])).getTime(),u=new Date(a);return Math.abs(u.getUTCFullYear()-1970)}function L(i="/admin/sign-in",r="sidebar-logout-btn"){let a=document.getElementById(r);a?a.onclick=()=>K(i):console.error("Logout button not found")}function K(i="/sign-in"){window.localStorage.removeItem("auth"),I(`${i}`)}function B(i=S.ADMIN){if(i===S.ADMIN){let r=document.getElementById("admin-nav"),a=document.getElementById("super-admin-nav");r&&(r.style.display="flex"),a&&a.remove()}else if(i===S.SUPER_ADMIN){let r=document.getElementById("admin-nav"),a=document.getElementById("super-admin-nav");a&&(a.style.display="flex"),r&&r.remove()}}function M(){let i=document.getElementById("loading-screen");i?i.remove():console.log("did not find loading screen")}function v({mode:i="API",clientObjRefName:r="name",data:a,token:u,API:x,extraXanoInputObj:f=[],searchContainerElId:d=""},N,s=null,_=null){let h,t,n;if(d.length>0){let e=document.getElementById(d);h=e.querySelector("#search-input"),h.setAttribute("placeholder","Search"),t=e.querySelector("#search-btn"),n=e.querySelector("#search-reset-btn")}else h=document.getElementById("search-input"),h.setAttribute("placeholder","Search"),t=document.getElementById("search-btn"),n=document.getElementById("search-reset-btn");n.onclick=()=>{h.value="",k(n,{mode:i,clientObjRefName:r,data:a,searchquery:"",token:u,API:x,extraXanoInputObj:f},N,s,_)},t.onclick=()=>{let e=h.value;k(n,{mode:i,clientObjRefName:r,data:a,searchquery:e,token:u,API:x,extraXanoInputObj:f},N,s,_)}}function k(t,n,e,o,p){return R(this,arguments,function*(i,{mode:r,clientObjRefName:a,data:u,searchquery:x,token:f,API:d,extraXanoInputObj:N=[]},s,_,h){if(x.length===0)i.style.display="none",_?s(u,_):s(u);else try{if(r==="API"){let m={search_query:`${x}:*`};N.length>0&&N.map(c=>{for(let[A,E]of Object.entries(c))m[A]=E});let l=yield O(d+"query","POST",m,f);if(l.isFetchOk!==void 0&&!l.isFetchOk)throw console.error(l.message),Error("API call failed");i.style.display="flex",_?s(l,_):s(l)}else{let m=u.filter(l=>l[a].toLowerCase().includes(x.toLowerCase()));i.style.display="flex",_?s(m,_):s(m)}}catch(m){h?h():console.error(m)}})}var U="/admin/sign-in";var D="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard";var X="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";(()=>{let i=null,r=0,a=[];window.onload=function(){return R(this,null,function*(){L("/admin/sign-in","sidebar-logout-btn");let t=y();if(t){let n=yield O(D+"/1","GET",!1,t);if(n.isFetchOk!==void 0&&!n.isFetchOk){console.error(n.message),n.payload&&n.payload.role===S.ADMIN&&n.payload.gyms&&n.payload.gyms.length>0?I(`/admin/gym/g?gymCode=${n.payload.gyms[0].gym_id}`):I(`${U}?reason=UNAUTHORIZED_USER`);return}B(S.SUPER_ADMIN),u(n,t)}else I(`${U}?reason=NOT_SIGNED_IN`)})};function u(t,n){return R(this,null,function*(){let{users:e,gyms:o,finance:p,footfall:m}=t;_(p),h(e),x(o,e,m),f(o),d(e),v({data:e,token:n,API:X},d),M()})}function x(t,n,e){if(t&&t.length>0){let o=n.items.filter(p=>{let m=new Date,l=new Date(p.created_at),c=Math.abs(m-l);return Math.ceil(c/(1e3*60*60*24))<=24});document.getElementById("gym-statistics-new-sign-ups").innerText=o.length,document.getElementById("gym-statistics-attendence").innerText=e||0,document.getElementById("gym-statistics-top-performer").innerText=t[0].code,document.getElementById("gym-statistics-total-members").innerText=n.items.length}}function f(t){let n=document.getElementById("gym-container"),e=n.querySelector("#gym-item");t.forEach(o=>{var m,l,c,A,E,g,C,T;let p=e.cloneNode(!0);p.setAttribute("id",""),p.setAttribute("href",`/admin/gym/g?gymCode=${o.id}`),o.map_icon&&(p.querySelector("#gym-map").style.backgroundImage=`url(${o.map_icon.url})`),p.querySelector("#gym-code").innerText=o.code,p.querySelector("#gym-name").innerText=o.location,p.querySelector("#gym-coach").innerText=o.partner||"NaN",p.querySelector("#gym-active-sessions").innerText=(l=(m=o==null?void 0:o.sessions)==null?void 0:m.length)!=null?l:0,p.querySelector("#gym-revenue").innerText=Number((c=o==null?void 0:o.finance)==null?void 0:c.gross_revenue)+Number((A=o==null?void 0:o.finance)==null?void 0:A.additional_revenue),p.querySelector("#gym-active-users").innerText=(g=(E=o==null?void 0:o.users)==null?void 0:E.filter(w=>w.membership_status!=="INACTIVE"&&w.membership_status!=="TRIAL").length)!=null?g:0,p.querySelector("#gym-users").innerText=(T=(C=o==null?void 0:o.users)==null?void 0:C.length)!=null?T:0,n.prepend(p)}),e.remove()}function d(t,n=!1){let e=document.getElementById("table-container"),o=e.querySelector("#table-item");function p(m){i=m.nextPage;let l=e.querySelectorAll(".adb-user.w-inline-block");l.forEach((c,A)=>{A!==l.length-1&&(A!==l.length-2||r>0)&&c.remove()}),a.items.forEach((c,A)=>{let E=o.cloneNode(!0);E.setAttribute("id",""),E.setAttribute("href",`/admin/user?userId=${c.id}`);let g=E.querySelectorAll(".colcontent");A%2===0&&(E.style.backgroundColor="#00edf4"),c.profile_picture&&(g[0].style.backgroundImage=`url(${c.profile_picture.url})`),g[1].innerText=c.name,g[2].innerText=c.code,g[3].innerText=c.membership_status||"INACTIVE",g[4].innerText=c.gender,g[5].innerText=b(c.date_of_birth),E.style.display="flex",e.prepend(E)})}n?(a.items.push(...t.items),a.nextPage=t.nextPage):a=t,p(a),o.style.display="none"}new IntersectionObserver(t=>{t[0].intersectionRatio<=0||(r>0&&i?s(i):r<1&&r++)}).observe(document.querySelector(".loadmore"));function s(t){return R(this,null,function*(){let n=y();if(n){let e=yield O(D+`/${t}`,"GET",!1,n);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===S.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?I(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}d(e.users,!0)}})}function _(t){return R(this,null,function*(){let n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=[...new Set(t.map(l=>l.month))].sort(),o={},p={};e.map(l=>{o[l]=t.filter(c=>c.month===l).reduce((c,A)=>c+A.gross_revenue+A.additional_revenue,0),p[l]=t.filter(c=>c.month===l).reduce((c,A)=>c+A.net_profit,0)});let m=document.getElementById("dashboard-profits-chart").getContext("2d");m.canvas.parentNode.style.height="400px",m.canvas.parentNode.style.width="400px",new Chart(m,{type:"bar",data:{labels:e.map(l=>n[l-1]),datasets:[{label:"Revenue",data:Object.values(o),backgroundColor:["#00EDF4"]},{label:"Profit",data:Object.values(p),backgroundColor:["#E0FFC1"]}]},options:{scales:{x:{grid:{display:!1},stacked:!0},y:{grid:{display:!1},stacked:!0}}}})})}function h(t){return R(this,null,function*(){let n=t.items.filter(o=>o.membership_status!=="INACTIVE"),e=document.getElementById("dashboard-sessions-chart").getContext("2d");e.canvas.parentNode.style.height="300px",e.canvas.parentNode.style.width="300px",t.length===n.length?new Chart(e,{type:"pie",data:{labels:[`Total/Active Users ${t.length}`],datasets:[{label:"Revenue",data:[t.length],backgroundColor:["#00EDF4"]}]},options:{plugins:{legend:{position:"top"}}}}):new Chart(e,{type:"pie",data:{labels:[`Total Users ${t.length}`,`Active Users ${n.length}`],datasets:[{label:"Revenue",data:[t.length,n.length],backgroundColor:["#00EDF4","#E0FFC1"]}]},options:{plugins:{legend:{position:"top"}}}})})}})();
