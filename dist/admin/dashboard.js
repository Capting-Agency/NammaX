var A=(t,e,n)=>new Promise((o,s)=>{var c=a=>{try{l(n.next(a))}catch(r){s(r)}},i=a=>{try{l(n.throw(a))}catch(r){s(r)}},l=a=>a.done?o(a.value):Promise.resolve(a.value).then(c,i);l((n=n.apply(t,e)).next())});var N={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function E(t,e="GET",n=!1,o=!1,s=!1,c=!0){try{let i={"Content-Type":"application/json"};s&&(i={}),o&&(i.Authorization=`Bearer ${o}`);let l={method:e,headers:i};return n&&(c?l.body=JSON.stringify(n):l.body=n),fetch(t,l).then(a=>a.ok?a.json():a.json().then(r=>(Promise.reject(r.message),{isFetchOk:!1,status:a.status,message:r.message,payload:r&&r.payload?r.payload:null}))).then(a=>a).catch(a=>(console.error("Error in fetch",a),a))}catch(i){return console.error("Error!: "+i),i}}function R(t="nammax_auth"){let n=`; ${document.cookie}`.split(`; ${t}=`);return n.length===2?n.pop().split(";").shift():null}function h(t="/",e=0){setTimeout(()=>{window.location.href=t},e)}function g(t=null){if(t==null)return"NaN";let e=t.split("-"),n=Date.now()-new Date(parseInt(e[2]),parseInt(e[1])-1,parseInt(e[0])).getTime(),o=new Date(n);return Math.abs(o.getUTCFullYear()-1970)}function S(t="/admin/sign-in",e="sidebar-logout-btn"){let n=document.getElementById(e);n?n.onclick=()=>b(t):console.error("Logout button not found")}function b(t="/sign-in"){window.localStorage.removeItem("auth"),h(`${t}`)}function I(t=N.ADMIN){if(t===N.ADMIN){let e=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");e&&(e.style.display="flex"),n&&n.remove()}else if(t===N.SUPER_ADMIN){let e=document.getElementById("admin-nav"),n=document.getElementById("super-admin-nav");n&&(n.style.display="flex"),e&&e.remove()}}function U({mode:t="API",clientObjRefName:e="name",data:n,token:o,API:s,extraXanoInputObj:c=[],searchContainerElId:i=""},l,a=null,r=null){let _,x,p;if(i.length>0){let m=document.getElementById(i);_=m.querySelector("#search-input"),_.setAttribute("placeholder","Search"),x=m.querySelector("#search-btn"),p=m.querySelector("#search-reset-btn")}else _=document.getElementById("search-input"),_.setAttribute("placeholder","Search"),x=document.getElementById("search-btn"),p=document.getElementById("search-reset-btn");p.onclick=()=>{_.value="",O(p,{mode:t,clientObjRefName:e,data:n,searchquery:"",token:o,API:s,extraXanoInputObj:c},l,a,r)},x.onclick=()=>{let m=_.value;O(p,{mode:t,clientObjRefName:e,data:n,searchquery:m,token:o,API:s,extraXanoInputObj:c},l,a,r)}}function O(x,p,m,Q,Z){return A(this,arguments,function*(t,{mode:e,clientObjRefName:n,data:o,searchquery:s,token:c,API:i,extraXanoInputObj:l=[]},a,r,_){if(s.length===0)t.style.display="none",r?a(o,r):a(o);else try{if(e==="API"){let d={search_query:`${s}:*`};l.length>0&&l.map(T=>{for(let[w,L]of Object.entries(T))d[w]=L});let u=yield E(i+"query","POST",d,c);if(u.isFetchOk!==void 0&&!u.isFetchOk)throw console.error(u.message),Error("API call failed");t.style.display="flex",r?a(u,r):a(u)}else{let d=o.filter(u=>u[n].toLowerCase().includes(s.toLowerCase()));t.style.display="flex",r?a(d,r):a(d)}}catch(d){_?_():console.error(d)}})}var f="/admin/sign-in";var y="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard";var D="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";window.onload=function(){return A(this,null,function*(){S("/admin/sign-in","sidebar-logout-btn");let t=R();if(t){let e=yield E(y,"GET",!1,t);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),e.payload&&e.payload.role===N.ADMIN&&e.payload.gyms&&e.payload.gyms.length>0?h(`/admin/gym/g?gymCode=${e.payload.gyms[0].gym_id}`):h(`${f}?reason=UNAUTHORIZED_USER`);return}I(N.SUPER_ADMIN),B(e,t)}else h(`${f}?reason=NOT_SIGNED_IN`)})};function B(t,e){return A(this,null,function*(){let{users:n,gyms:o,finance:s}=t;v(s),X(n),M(o,n),k(o),C(n),U({data:n,token:e,API:D},C)})}function M(t,e){if(t&&t.length>0){let n=e.filter(o=>{let s=new Date,c=new Date(o.created_at),i=Math.abs(s-c);return Math.ceil(i/(1e3*60*60*24))<=24});document.getElementById("gym-statistics-new-sign-ups").innerText=n.length,document.getElementById("gym-statistics-attendence").innerText=t.length,document.getElementById("gym-statistics-top-performer").innerText=t[0].code,document.getElementById("gym-statistics-total-members").innerText=e.length}}function k(t){let e=document.getElementById("gym-container"),n=e.querySelector("#gym-item");console.log(t),t.forEach(o=>{var c,i,l,a,r,_,x,p;let s=n.cloneNode(!0);s.setAttribute("id",""),s.setAttribute("href",`/admin/gym/g?gymCode=${o.id}`),o.map_icon&&(s.querySelector("#gym-map").style.backgroundImage=`url(${o.map_icon.url})`),s.querySelector("#gym-code").innerText=o.code,s.querySelector("#gym-name").innerText=o.location,s.querySelector("#gym-coach").innerText=o.partner||"NaN",s.querySelector("#gym-active-sessions").innerText=(i=(c=o==null?void 0:o.sessions)==null?void 0:c.length)!=null?i:0,s.querySelector("#gym-revenue").innerText=Number((l=o==null?void 0:o.finance)==null?void 0:l.gross_revenue)+Number((a=o==null?void 0:o.finance)==null?void 0:a.additional_revenue),s.querySelector("#gym-active-users").innerText=(_=(r=o==null?void 0:o.users)==null?void 0:r.filter(m=>m.membership_status!=="INACTIVE"&&m.membership_status!=="TRIAL").length)!=null?_:0,s.querySelector("#gym-users").innerText=(p=(x=o==null?void 0:o.users)==null?void 0:x.length)!=null?p:0,e.prepend(s)}),n.remove()}function C(t){let e=document.getElementById("table-container"),n=e.querySelector("#table-item");function o(s){let c=e.querySelectorAll(".adb-user.w-inline-block");c.forEach((i,l)=>{l!==c.length-1&&i.remove()}),s.forEach((i,l)=>{let a=n.cloneNode(!0);a.setAttribute("id",""),a.setAttribute("href",`/admin/user?userId=${i.id}`);let r=a.querySelectorAll(".colcontent");l%2===0&&(a.style.backgroundColor="#00edf4"),i.profile_picture&&(r[0].style.backgroundImage=`url(${i.profile_picture.url})`),r[1].innerText=i.name,r[2].innerText=i.code,r[3].innerText=i.membership_status||"INACTIVE",r[4].innerText=i.gender,r[5].innerText=g(i.date_of_birth),r[6].innerText="NaN",a.style.display="flex",e.prepend(a)})}o(t),n.style.display="none"}function v(t){return A(this,null,function*(){let e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=[...new Set(t.map(i=>i.month))].sort(),o={},s={};n.map(i=>{o[i]=t.filter(l=>l.month===i).reduce((l,a)=>l+a.gross_revenue+a.additional_revenue,0),s[i]=t.filter(l=>l.month===i).reduce((l,a)=>l+a.net_profit,0)});let c=document.getElementById("dashboard-profits-chart").getContext("2d");c.canvas.parentNode.style.height="400px",c.canvas.parentNode.style.width="400px",new Chart(c,{type:"bar",data:{labels:n.map(i=>e[i-1]),datasets:[{label:"Revenue",data:Object.values(o),backgroundColor:["#00EDF4"]},{label:"Profit",data:Object.values(s),backgroundColor:["#E0FFC1"]}]},options:{scales:{x:{grid:{display:!1},stacked:!0},y:{grid:{display:!1},stacked:!0}}}})})}function X(t){return A(this,null,function*(){let e=t.filter(o=>o.membership_status!=="INACTIVE"),n=document.getElementById("dashboard-sessions-chart").getContext("2d");n.canvas.parentNode.style.height="300px",n.canvas.parentNode.style.width="300px",t.length===e.length?new Chart(n,{type:"pie",data:{labels:[`Total/Active Users ${t.length}`],datasets:[{label:"Revenue",data:[t.length],backgroundColor:["#00EDF4"]}]},options:{plugins:{legend:{position:"top"}}}}):new Chart(n,{type:"pie",data:{labels:[`Total Users ${t.length}`,`Active Users ${e.length}`],datasets:[{label:"Revenue",data:[t.length,e.length],backgroundColor:["#00EDF4","#E0FFC1"]}]},options:{plugins:{legend:{position:"top"}}}})})}
