var R=(n,t,s)=>new Promise((d,h)=>{var g=c=>{try{N(s.next(c))}catch(m){h(m)}},u=c=>{try{N(s.throw(c))}catch(m){h(m)}},N=c=>c.done?d(c.value):Promise.resolve(c.value).then(g,u);N((s=s.apply(n,t)).next())});var S={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function D(n,t="GET",s=!1,d=!1,h=!1,g=!0){try{let u={"Content-Type":"application/json"};h&&(u={}),d&&(u.Authorization=`Bearer ${d}`);let N={method:t,headers:u};return s&&(g?N.body=JSON.stringify(s):N.body=s),fetch(n,N).then(c=>c.ok?c.json():c.json().then(m=>(Promise.reject(m.message),{isFetchOk:!1,status:c.status,message:m.message,payload:m&&m.payload?m.payload:null}))).then(c=>c).catch(c=>(console.error("Error in fetch",c),c))}catch(u){return console.error("Error!: "+u),u}}function U(n="nammax_auth"){let s=`; ${document.cookie}`.split(`; ${n}=`);return s.length===2?s.pop().split(";").shift():null}function I(n="/",t=2e3){setTimeout(()=>{window.location.href=n},t)}function M(n=null){if(n==null)return"NaN";let t=new Date(n);return`${t.getDate()}/${t.getMonth()+1}/${t.getFullYear()}`}function B(n=null){if(n==null)return"NaN";let t=n.split("-"),s=Date.now()-new Date(parseInt(t[2]),parseInt(t[1])-1,parseInt(t[0])).getTime(),d=new Date(s);return Math.abs(d.getUTCFullYear()-1970)}function k(n="/admin/sign-in",t="sidebar-logout-btn"){let s=document.getElementById(t);s?s.onclick=()=>P(n):console.error("Logout button not found")}function P(n="/sign-in"){window.localStorage.removeItem("auth"),I(`${n}`)}function v(n=S.ADMIN){if(n===S.ADMIN){let t=document.getElementById("admin-nav"),s=document.getElementById("super-admin-nav");t&&(t.style.display="flex"),s&&s.remove()}else if(n===S.SUPER_ADMIN){let t=document.getElementById("admin-nav"),s=document.getElementById("super-admin-nav");s&&(s.style.display="flex"),t&&t.remove()}}function X(){let n=document.getElementById("loading-screen");n?n.remove():console.log("did not find loading screen")}function L(n){let t=new Date(n);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t}function T(n,t,s=!1){let d=864e5;return Math.round((L(t)-L(n))/d)}function $({mode:n="API",clientObjRefName:t="name",data:s,token:d,API:h,extraXanoInputObj:g=[],searchContainerElId:u=""},N,c=null,m=null){let E,a,i;if(u.length>0){let o=document.getElementById(u);E=o.querySelector("#search-input"),E.setAttribute("placeholder","Search"),a=o.querySelector("#search-btn"),i=o.querySelector("#search-reset-btn")}else E=document.getElementById("search-input"),E.setAttribute("placeholder","Search"),a=document.getElementById("search-btn"),i=document.getElementById("search-reset-btn");i.onclick=()=>{E.value="",K(i,{mode:n,clientObjRefName:t,data:s,searchquery:"",token:d,API:h,extraXanoInputObj:g},N,c,m)},a.onclick=()=>{let o=E.value;K(i,{mode:n,clientObjRefName:t,data:s,searchquery:o,token:d,API:h,extraXanoInputObj:g},N,c,m)}}function K(a,i,o,r,_){return R(this,arguments,function*(n,{mode:t,clientObjRefName:s,data:d,searchquery:h,token:g,API:u,extraXanoInputObj:N=[]},c,m,E){if(h.length===0)n.style.display="none",m?c(d,m):c(d);else try{if(t==="API"){let p={search_query:`${h}:*`};N.length>0&&N.map(e=>{for(let[A,f]of Object.entries(e))p[A]=f});let l=yield D(u+"query","POST",p,g);if(l.isFetchOk!==void 0&&!l.isFetchOk)throw console.error(l.message),Error("API call failed");n.style.display="flex",m?c(l,m):c(l)}else{let p=d.filter(l=>l[s].toLowerCase().includes(h.toLowerCase()));n.style.display="flex",m?c(p,m):c(p)}}catch(p){E?E():console.error(p)}})}var C="/admin/sign-in";var w="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard";var H="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/dashboard/search/";(()=>{let n=null,t=0,s=[];window.onload=function(){return R(this,null,function*(){k("/admin/sign-in","sidebar-logout-btn");let a=U();if(a){let i=yield D(w+"/1","GET",!1,a);if(i.isFetchOk!==void 0&&!i.isFetchOk){console.error(i.message),i.payload&&i.payload.role===S.ADMIN&&i.payload.gyms&&i.payload.gyms.length>0?I(`/admin/gym/g?gymCode=${i.payload.gyms[0].gym_id}`):I(`${C}?reason=UNAUTHORIZED_USER`);return}v(S.SUPER_ADMIN),d(i,a)}else I(`${C}?reason=NOT_SIGNED_IN`)})};function d(a,i){return R(this,null,function*(){let{users:o,gyms:r,finance:_,footfall:p}=a;m(_),E(o),h(r,o,p),g(r),u(o),$({data:o,token:i,API:H},u),X()})}function h(a,i,o){if(a&&a.length>0){let r=i.items.filter(l=>{let e=new Date,A=new Date(l.created_at),f=Math.abs(e-A);return Math.ceil(f/(1e3*60*60*24))<=24});document.getElementById("gym-statistics-new-sign-ups").innerText=r.length||0,document.getElementById("gym-statistics-attendence").innerText=o||0;let _={};a.forEach(l=>{l.footfall.items.forEach(e=>{_[l.code]?_[l.code]+=Number(e.traffic):_[l.code]=Number(e.traffic)})});let p=Object.keys(_).reduce((l,e)=>_[l]>_[e]?l:e)||a[0].code||"NaN";document.getElementById("gym-statistics-top-performer").innerText=p,document.getElementById("gym-statistics-total-members").innerText=i.items.length}}function g(a){let i=document.getElementById("gym-container"),o=i.querySelector("#gym-item");a.forEach(r=>{var p,l,e,A,f,x,O,y;let _=o.cloneNode(!0);_.setAttribute("id",""),_.setAttribute("href",`/admin/gym/g?gymCode=${r.id}`),r.map_icon&&(_.querySelector("#gym-map").style.backgroundImage=`url(${r.map_icon.url})`),_.querySelector("#gym-code").innerText=r.code,_.querySelector("#gym-name").innerText=r.location,_.querySelector("#gym-coach").innerText=r.partner||"NaN",_.querySelector("#gym-active-sessions").innerText=(l=(p=r==null?void 0:r.sessions)==null?void 0:p.length)!=null?l:0,_.querySelector("#gym-revenue").innerText=Number((e=r==null?void 0:r.finance)==null?void 0:e.gross_revenue)+Number((A=r==null?void 0:r.finance)==null?void 0:A.additional_revenue),_.querySelector("#gym-active-users").innerText=(x=(f=r==null?void 0:r.users)==null?void 0:f.filter(b=>b.membership_status!=="INACTIVE"&&b.membership_status!=="TRIAL").length)!=null?x:0,_.querySelector("#gym-users").innerText=(y=(O=r==null?void 0:r.users)==null?void 0:O.length)!=null?y:0,i.prepend(_)}),o.remove()}function u(a,i=!1){let o=document.getElementById("table-container"),r=o.querySelector("#table-item");function _(p){n=p.nextPage;let l=o.querySelectorAll(".adb-user.w-inline-block");l.forEach((e,A)=>{A!==l.length-1&&(A!==l.length-2||t>0)&&e.remove()}),s.items.forEach((e,A)=>{let f=r.cloneNode(!0);f.setAttribute("id",""),f.setAttribute("href",`/admin/user?userId=${e.id}`);let x=f.querySelectorAll(".colcontent");if(A%2===0&&(f.style.backgroundColor="#00edf4"),e.profile_picture&&(x[0].style.backgroundImage=`url(${e.profile_picture.url})`),e.membership_end_date){let O=new Date(e.membership_end_date),y=new Date;(e==null?void 0:e.session_ledger)!==void 0&&e.session_ledger.length<=3?x[0].style.border="3px solid #009ca1":T(y,O,!0)<=3?x[0].style.border="3px solid red":T(y,O,!0)<=7&&(x[0].style.border="3px solid orange")}x[1].innerText=e.name||"",x[2].innerText=e.code||"Unselected",x[3].innerText=e.membership_status||"INACTIVE",x[4].innerText=e.gender||"Unselected",x[5].innerText=B(e.date_of_birth)||"Unselected",e.session_ledger.length>0?x[6].innerText=M(e.session_ledger[e.session_ledger.length-1].time):x[6].innerText="N/A",f.style.display="flex",o.prepend(f)})}i?(s.items.push(...a.items),s.nextPage=a.nextPage):s=a,_(s),r.style.display="none"}new IntersectionObserver(a=>{a[0].intersectionRatio<=0||(t>0&&n?c(n):t<1&&t++)}).observe(document.querySelector(".loadmore"));function c(a){return R(this,null,function*(){let i=U();if(i){let o=yield D(w+`/${a}`,"GET",!1,i);if(o.isFetchOk!==void 0&&!o.isFetchOk){console.error(o.message),o.payload&&o.payload.role===S.ADMIN&&o.payload.gyms&&o.payload.gyms.length>0?I(`/admin/gym/g?gymCode=${o.payload.gyms[0].gym_id}`):console.log("error fetching paginated");return}u(o.users,!0)}})}function m(a){return R(this,null,function*(){let i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=[...new Set(a.map(l=>l.month))].sort(),r={},_={};o.map(l=>{r[l]=a.filter(e=>e.month===l).reduce((e,A)=>e+A.gross_revenue+A.additional_revenue,0),_[l]=a.filter(e=>e.month===l).reduce((e,A)=>e+A.net_profit,0)});let p=document.getElementById("dashboard-profits-chart").getContext("2d");p.canvas.parentNode.style.height="400px",p.canvas.parentNode.style.width="400px",new Chart(p,{type:"bar",data:{labels:o.map(l=>i[l-1]),datasets:[{label:"Revenue",data:Object.values(r),backgroundColor:["#00EDF4"]},{label:"Profit",data:Object.values(_),backgroundColor:["#E0FFC1"]}]},options:{scales:{x:{grid:{display:!1},stacked:!0},y:{grid:{display:!1},stacked:!0}}}})})}function E(a){return R(this,null,function*(){let i=a.items.filter(r=>r.membership_status!=="INACTIVE"),o=document.getElementById("dashboard-sessions-chart").getContext("2d");o.canvas.parentNode.style.height="300px",o.canvas.parentNode.style.width="300px",a.items.length===i.length?new Chart(o,{type:"pie",data:{labels:[`Total/Active Users ${a.items.length}`],datasets:[{label:"Revenue",data:[a.items.length],backgroundColor:["#00EDF4"]}]},options:{plugins:{legend:{position:"top"}}}}):new Chart(o,{type:"pie",data:{labels:[`Total Users ${a.items.length}`,`Active Users ${i.length}`],datasets:[{label:"Revenue",data:[a.items.length,i.length],backgroundColor:["#00EDF4","#E0FFC1"]}]},options:{plugins:{legend:{position:"top"}}}})})}})();
