var E=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var h=(n,o)=>{var e={};for(var t in n)y.call(n,t)&&o.indexOf(t)<0&&(e[t]=n[t]);if(n!=null&&E)for(var t of E(n))o.indexOf(t)<0&&w.call(n,t)&&(e[t]=n[t]);return e};var p=(n,o,e)=>new Promise((t,a)=>{var s=i=>{try{l(e.next(i))}catch(_){a(_)}},r=i=>{try{l(e.throw(i))}catch(_){a(_)}},l=i=>i.done?t(i.value):Promise.resolve(i.value).then(s,r);l((e=e.apply(n,o)).next())});var m={ADMIN:"ADMIN",SUPER_ADMIN:"SUPER_ADMIN",COACH:"COACH"};function u(n,o="GET",e=!1,t=!1,a=!1,s=!0){try{let r={"Content-Type":"application/json"};a&&(r={}),t&&(r.Authorization=`Bearer ${t}`);let l={method:o,headers:r};return e&&(s?l.body=JSON.stringify(e):l.body=e),fetch(n,l).then(i=>i.ok?i.json():i.json().then(_=>(Promise.reject(_.message),{isFetchOk:!1,status:i.status,message:_.message,payload:_&&_.payload?_.payload:null}))).then(i=>i).catch(i=>(console.error("Error in fetch",i),i))}catch(r){return console.error("Error!: "+r),r}}function x(n="nammax_auth"){let e=`; ${document.cookie}`.split(`; ${n}=`);return e.length===2?e.pop().split(";").shift():null}function A(n="/",o=0){setTimeout(()=>{window.location.href=n},o)}function f(n="/admin/sign-in",o="sidebar-logout-btn"){let e=document.getElementById(o);e?e.onclick=()=>b(n):console.error("Logout button not found")}function b(n="/sign-in"){window.localStorage.removeItem("auth"),A(`${n}`)}function R(n=m.ADMIN){if(n===m.ADMIN){let o=document.getElementById("admin-nav"),e=document.getElementById("super-admin-nav");o&&(o.style.display="flex"),e&&e.remove()}else if(n===m.SUPER_ADMIN){let o=document.getElementById("admin-nav"),e=document.getElementById("super-admin-nav");e&&(e.style.display="flex"),o&&o.remove()}}function g(){let n=document.getElementById("loading-screen");n&&n.remove()}var N="/admin/sign-in";var S="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/all_gyms",I="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/all_gyms/add_gym",O="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/super_admin/all_gyms/upload/image";window.onload=function(){return p(this,null,function*(){f(N,"sidebar-logout-btn");let n=x();if(n){let e=yield u(S,"GET",!1,n);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message);return}let o=e,{team_role:t}=o,a=h(o,["team_role"]);t&&(t===m.SUPER_ADMIN||t===m.ADMIN)?(R(t),L(a)):A(`${N}?reason=UNAUTHORIZED_USER`)}else A(`${N}?reason=NOT_SIGNED_IN`)})};function L(n){return p(this,null,function*(){let{gyms:o}=n;M(),C(o),g()})}function C(n){let o=document.getElementById("gym-container"),e=o.querySelector("#gym-item");n.forEach(t=>{var r,l,i,_;let a=e.cloneNode(!0);a.setAttribute("id",""),a.setAttribute("href",`/admin/gym/g?gymCode=${t.id}`),t.map_icon&&(a.querySelector("#gym-map").style.backgroundImage=`url(${t.map_icon.url})`),a.querySelector("#gym-code").innerText=t.code,a.querySelector("#gym-name").innerText=t.location,a.querySelector("#gym-coach").innerText=t.partner,a.querySelector("#gym-active-sessions").innerText=(l=(r=t==null?void 0:t.sessions)==null?void 0:r.length)!=null?l:0;let s=0;t.finances.forEach(c=>{s+=Number(c.gross_revenue)+Number(c.additional_revenue)}),t.finances.length>0?s=s/t.finances.length:s=null,a.querySelector("#gym-revenue").innerText=s!=null?s:"NaN",a.querySelector("#gym-active-users").innerText=t.users.filter(c=>c.membership_status!=="INACTIVE"&&c.membership_status!=="TRIAL").length||0,a.querySelector("#gym-users").innerText=(_=(i=t==null?void 0:t.users)==null?void 0:i.length)!=null?_:0,o.prepend(a)}),e.remove()}function T(n,o,e){return p(this,null,function*(){let t=document.getElementById("pfp_input"),a=t.files[0];if(a!==void 0){if(a.size>2097152){alert("File too big. Max size is 2MB");return}if(a.type!=="image/jpg"&&a.type!=="image/jpeg"&&a.type!=="image/png"){alert("Incorrect file type. Acceptable types: .png, .jpg, .jpeg");return}let s=new FormData;s.append("content",a),s.append("gym_id",e);let r=yield u(O,"POST",s,n,!0,!1);if(r.isFetchOk!==void 0&&!r.isFetchOk){console.error(r.message),o.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Uh oh, failed to upload image!");return}return t.value="",r}return!0})}function M(){let n=document.getElementById("pfp_input"),o=document.getElementById("pfp_preview"),e=document.getElementById("preview-icon-container");n.addEventListener("change",function(t){t.target&&t.target.files.length>0&&t.target.files[0]?(e.style.display="flex",o.src=URL.createObjectURL(t.target.files[0])):e.style.display="none"})}var U=U||[];U.push(function(){$(document).off("submit"),$("form").on("change",function(){let n=$(this),o=n[0][0].value,e=n[0][1].value,t=n[0][2].value,a=n[0][3].value,s=n[0][4].value,r=n[0][5].value,l=n[0][6].value,i=n[0][7].value;o!==""&&e!==""&&t!==""&&a!==""&&s!==""&&r!==""&&l!==""&&i!==""&&(n[0][8].disabled=!1,n[0][8].classList.remove("disabled"))}),$("form").on("submit",function(n){return p(this,null,function*(){n.preventDefault();let o=document.getElementById("sessions-select-btn");o.disabled=!0,o.classList.add("disabled"),o.value="SUBMITTING...";let e=$(this),t=x();if(t){let a=e[0][0].value,s=e[0][1].value,r=e[0][2].value,l=e[0][3].value,i=e[0][4].value,_=e[0][5].value,c=e[0][6].value,D=e[0][7].value;if(a!==""&&s!==""&&r!==""&&l!==""&&i!==""&&_!==""&&c!==""&&D!==""){let d=yield u(I,"POST",{location:a,code:s,address:r,capacity:l,partner_name:i,partner_email:_,partner_contact:c},t);if(d.isFetchOk!==void 0&&!d.isFetchOk){console.error(d.message),e.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("There was an error trying to add your session. Please refresh your browser and try again.");return}e.hide().siblings(".w-form-done").show().siblings(".w-form-fail").hide(),yield T(t,e,d.id),window.location.reload()}else a.trim()===""?e[0][0].style.borderColor="red":e[0][1].style.borderColor="black",s.trim()===""?e[0][1].style.borderColor="red":e[0][2].style.borderColor="black",r.trim()===""?e[0][2].style.borderColor="red":e[0][3].style.borderColor="black",l.trim()===""?e[0][3].style.borderColor="red":e[0][4].style.borderColor="black",i.trim()==="Duration"?e[0][4].style.borderColor="red":e[0][5].style.borderColor="black",_.trim()===""?e[0][5].style.borderColor="red":e[0][6].style.borderColor="black",c.trim()===""?e[0][6].style.borderColor="red":e[0][6].style.borderColor="black",e.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("Please fill out all fields"),o.disabled=!1,o.classList.remove("disabled"),o.value="ADD NEW GYM"}})})});
//# sourceMappingURL=all-gyms.js.map
