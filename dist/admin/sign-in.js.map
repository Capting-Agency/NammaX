{
  "version": 3,
  "sources": ["../../util/constants.ts", "../../util/index.ts", "../../admin/sign-in.js"],
  "sourcesContent": ["export const genderArr = [\"Male\", \"Female\", \"Other\", \"Prefer not to say\"];\nexport const weekdayArr = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\nexport const monthsArr = [\n  \"January\",\n  \"February\",\n  \"March\",\n  \"April\",\n  \"May\",\n  \"June\",\n  \"July\",\n  \"August\",\n  \"September\",\n  \"October\",\n  \"November\",\n  \"December\",\n];\nexport const ROLES = { ADMIN: \"ADMIN\", SUPER_ADMIN: \"SUPER_ADMIN\", COACH: \"COACH\" };\n", "import { ROLES } from \"./constants\";\n\nexport function fetchUrl(\n  url: string,\n  method = \"GET\",\n  body = false,\n  token = false,\n  hideContentType = false,\n  stringifyBody = true\n) {\n  try {\n    let headers: any = { \"Content-Type\": \"application/json\" };\n    if (hideContentType) headers = {};\n    if (token) {\n      headers.Authorization = `Bearer ${token}`;\n    }\n    let options: any = {\n      method,\n      headers,\n    };\n    if (body) {\n      if (stringifyBody) options.body = JSON.stringify(body);\n      else options.body = body;\n    }\n\n    return fetch(url, options)\n      .then((res) => {\n        if (res.ok) {\n          return res.json();\n        }\n        return res.json().then((r) => {\n          Promise.reject(r.message);\n          return {\n            isFetchOk: false,\n            status: res.status,\n            message: r.message,\n            payload: r && r.payload ? r.payload : null,\n          };\n        });\n      })\n      .then((json) => json)\n      .catch((e) => {\n        console.error(\"Error in fetch\", e);\n        return e;\n        // redirectTo(`${SIGN_IN_URL}?reason=INVALID_TOKEN`);\n      });\n  } catch (e) {\n    console.error(\"Error!: \" + e);\n    return e;\n  }\n}\n\nexport function saveToken(token = null, name = \"nammax_auth\", age = 60 * 60 * 24) {\n  if (token)\n    // ? expires in 1 day (24 Hours)\n    document.cookie = `${name}=${token}; path=/; max-age=${age}`;\n}\n\nexport function getToken(name = \"nammax_auth\") {\n  let value = `; ${document.cookie}`;\n  let parts: any = value.split(`; ${name}=`);\n  if (parts.length === 2) return parts.pop().split(\";\").shift();\n  else return null;\n}\n\nexport function redirectTo(link = \"/\", delay = 0) {\n  setTimeout(() => {\n    window.location.href = link;\n  }, delay);\n}\n\nexport function reloadDelay(delay = 1000) {\n  setTimeout(() => {\n    window.location.reload();\n  }, delay);\n}\n\nexport function formatTimestampToAMPM(unformattedTime: number | string | Date | null = null, showMinutes = false) {\n  if (unformattedTime == null) return \"NaN\";\n\n  var date = new Date(unformattedTime);\n  var hours = date.getHours();\n  var ampm = hours >= 12 ? \"PM\" : \"AM\";\n  hours = hours % 12 || 12; // the hour '0' should be '12'\n\n  if (showMinutes) {\n    var minutes: string | number = date.getMinutes();\n    minutes = minutes < 10 ? `0${minutes}` : minutes;\n    return `${hours}:${minutes} ${ampm}`;\n  } else {\n    return `${hours} ${ampm}`;\n  }\n}\n\nexport function getDateFromTimestamp(timestamp: number | null = null) {\n  if (timestamp == null) return \"NaN\";\n\n  const date = new Date(timestamp);\n  return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;\n}\n\nexport function getTimestampFromDateText(date: string | null = null) {\n  if (date == null) return \"NaN\";\n\n  let df = date.split(\"/\");\n\n  return new Date(`${df[2]}/${df[1]}/${df[0]} ${new Date().getHours()}:${new Date().getMinutes()}`).getTime();\n}\n\nexport function formatDuration(t: number | null = null) {\n  if (t == null) return \"NaN\";\n  t = t * 60;\n  let hours = `${(t / 60) ^ 0}`.slice(-2);\n  let minutes = (\"0\" + (t % 60)).slice(-2);\n\n  if (hours != \"0\") {\n    if (minutes != \"00\") {\n      return `${hours} HR ${minutes} M`;\n    }\n    return hours + \" HR\";\n  }\n  return minutes + \" Mins\";\n}\n\nexport function calculateAgeFromDOB(dateStr: string | null = null) {\n  if (dateStr == null) return \"NaN\";\n  // ? need to split it since new Date() is in the format mm-dd-yyyy not dd-mm-yyyy\n  let parts = dateStr.split(\"-\");\n  const diff_ms = Date.now() - new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0])).getTime();\n  const age_dt = new Date(diff_ms);\n  return Math.abs(age_dt.getUTCFullYear() - 1970);\n}\n\nexport function removeOptions(selectElement: HTMLSelectElement | null, dontRemoveIndx: number | null = null) {\n  if (selectElement == null) return;\n  var i,\n    L = selectElement.options.length - 1;\n  for (i = L; i >= 0; i--) {\n    if (i !== dontRemoveIndx) selectElement.remove(i);\n  }\n}\n\nexport function logoutBtnOnClick(redirect_url = \"/admin/sign-in\", element_id = \"sidebar-logout-btn\") {\n  const logoutButton = document.getElementById(element_id);\n  if (logoutButton) {\n    logoutButton.onclick = () => logout(redirect_url);\n  } else {\n    console.error(\"Logout button not found\");\n  }\n}\n\nexport function logout(SIGN_IN_URL = \"/sign-in\") {\n  window.localStorage.removeItem(\"auth\");\n  redirectTo(`${SIGN_IN_URL}`);\n}\n\nexport function formatCurrency(amount: string | number = 0) {\n  return new Intl.NumberFormat(\"en-IN\", {\n    style: \"currency\",\n    currency: \"INR\",\n  })\n    .format(Number(amount))\n    .replace(/^(\\D+)/, \"$1 \");\n}\n\n// function to automatically get time and update it every minute\nexport function getAndUpdateTime(element_name = \"current-time\") {\n  const el = document.getElementById(element_name);\n  if (el) el.innerText = formatTimestampToAMPM(new Date(), true);\n  setTimeout(() => getAndUpdateTime(element_name), 30000); // check every 30 seconds\n}\n\n// ? source: https://stackoverflow.com/a/2706169\nexport function addMonthsToDate(date: Date | null = null, months: number = 0) {\n  if (date == null) return \"NaN\";\n  var d = date.getDate();\n  date.setMonth(date.getMonth() + +months);\n  if (date.getDate() != d) {\n    date.setDate(0);\n  }\n  return date;\n}\n\nexport function assignAdminNavbar(role = ROLES.ADMIN) {\n  if (role === ROLES.ADMIN) {\n    const adminNavbar = document.getElementById(\"admin-nav\");\n    const superNavbar = document.getElementById(\"super-admin-nav\");\n    if (adminNavbar) adminNavbar.style.display = \"flex\";\n    if (superNavbar) superNavbar.remove();\n  } else if (role === ROLES.SUPER_ADMIN) {\n    const adminNavbar = document.getElementById(\"admin-nav\");\n    const superNavbar = document.getElementById(\"super-admin-nav\");\n    if (superNavbar) superNavbar.style.display = \"flex\";\n    if (adminNavbar) adminNavbar.remove();\n  }\n}\n\nexport function correctNavbarHref(UrlGymId: string) {\n  if (!UrlGymId) return console.error(\"url does not cotnain gym id\");\n  const navbarHome = document.getElementById(\"navbar-home\");\n  const navbarFinance = document.getElementById(\"navbar-finance\");\n  const navbarUsers = document.getElementById(\"navbar-users\");\n  const navbarSessions = document.getElementById(\"navbar-sessions\");\n  if (navbarHome) navbarHome.setAttribute(\"href\", `/admin/gym/g?gymCode=${UrlGymId}`);\n  if (navbarFinance) navbarFinance.setAttribute(\"href\", `/admin/gym/finance?gymCode=${UrlGymId}`);\n  if (navbarUsers) navbarUsers.setAttribute(\"href\", `/admin/gym/users?gymCode=${UrlGymId}`);\n  if (navbarSessions) navbarSessions.setAttribute(\"href\", `/admin/gym/sessions?gymCode=${UrlGymId}`);\n}\n\nexport function appendHeader(gym: any) {\n  if (!gym) return console.error(\"gym data not found\");\n  const gymCodeLocation = document.getElementById(\"gym-code-location\");\n  const headerAddress = document.getElementById(\"header-address\");\n  const headerPartner = document.getElementById(\"header-partner\");\n  const headerContact = document.getElementById(\"header-contact\");\n  const headerEmail = document.getElementById(\"header-email\");\n\n  if (gymCodeLocation) gymCodeLocation.innerText = `${gym.code} \u2022 ${gym.location}`;\n  if (headerAddress) headerAddress.innerText = gym.address;\n  if (headerPartner) headerPartner.innerText = gym.partner;\n  if (headerContact) headerContact.innerText = gym.contact;\n  if (headerEmail) headerEmail.innerText = gym.partner_email;\n}\n\nexport function removeLoadingScreen() {\n  const loadingScreen = document.getElementById(\"loading-screen\");\n  if (loadingScreen) loadingScreen.remove();\n}\n\nexport function errorModal({\n  text = \"Oops, there was an error\",\n  error = \"Unknown Error\",\n  callback = null,\n  redirectUrl = null,\n}) {\n  const modal = document.createElement(\"div\");\n  modal.style.cssText = `\n  position: fixed;\n  width: 100vw;\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: #000000cc;\n  z-index: 99;\n`;\n  const modalWrapper = document.createElement(\"div\");\n  modalWrapper.style.cssText = `\n  background-color: white;\n  padding: 30px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  width: 100%;\n  height: fit-content;\n  max-width: 400px;\n  max-height: 80%;\n  gap: 30px;\n  `;\n\n  const top = document.createElement(\"div\");\n  top.style.cssText = `\n  color: black;\n  font-weight: 800;\n  text-align: center;\n  `;\n  top.innerText = text;\n\n  const middle = document.createElement(\"div\");\n  middle.style.cssText = `\n  color: black;\n  background-color: #cccccccc;\n  width: 100%;\n  min-height: 30px;\n  text-align: center;\n  padding: 10px;\n  `;\n  middle.innerText = error;\n\n  const bottom = document.createElement(\"div\");\n  bottom.style.cssText = `\n  color: #ff0000cc;\n  text-align: center;\n  margin-bottom: -20px;\n  `;\n  bottom.innerText = \"Please contact an admin for assistance if this issue persists\";\n\n  const bottomBtn = document.createElement(\"button\");\n  bottomBtn.classList.add(\"w-button\", \"small-button\");\n  bottomBtn.textContent = \"RELOAD PAGE\";\n  bottomBtn.onclick = () => {\n    bottomBtn.disabled = true;\n    if (redirectUrl) redirectTo(redirectUrl);\n    else reloadDelay();\n  };\n\n  modalWrapper.appendChild(top);\n  modalWrapper.appendChild(middle);\n  modalWrapper.appendChild(bottom);\n  modalWrapper.appendChild(bottomBtn);\n  modal.appendChild(modalWrapper);\n\n  document.body.prepend(modal);\n}\n", "import { saveToken, redirectTo, fetchUrl } from \"../util\";\nimport { ROLES } from \"../util/constants\";\n\nconst REDIRECT_SA_URL = \"/admin/dashboard\";\nconst REDIRECT_A_URL = \"/admin/gym/g\";\nconst REDIRECT_FAIL_URL = \"/admin/all-gyms\";\nconst XANO_OAUTH_LOGIN_URL = \"https://x8ki-letl-twmt.n7.xano.io/api:GEC76oIp/admin_auth/login\";\n\n// ? login user via xano after they submit form\n// ? form submission workaround\nvar Webflow = Webflow || [];\nWebflow.push(function () {\n  // unbind webflow form handling (keep this if you only want to affect specific forms)\n  $(document).off(\"submit\");\n  /* Any form on the page */\n  $(\"form\").submit(async function (e) {\n    e.preventDefault();\n    const $form = $(this); // The submitted form\n\n    const xano_input = {\n      email: document.getElementById(\"admin_email-2\").value,\n      password: document.getElementById(\"admin_password\").value, // ? bcrypt\n    };\n\n    let data = await fetchUrl(XANO_OAUTH_LOGIN_URL, \"POST\", xano_input);\n\n    if (data.isFetchOk !== undefined && !data.isFetchOk) {\n      $form\n        .siblings(\".w-form-done\")\n        .hide() // Hide success\n        .siblings(\".w-form-fail\")\n        .show(); // show failure\n\n      console.error(data.message);\n      // redirectTo(`${SIGN_IN_URL}?reason=NOT_SIGNED_IN`);\n      return;\n    }\n\n    const hasKey = Object.keys(data).includes(\"authToken\");\n\n    if (hasKey === false) {\n      // ? Invalid username or password\n      $form\n        .siblings(\".w-form-done\")\n        .hide() // Hide success\n        .siblings(\".w-form-fail\")\n        .show(); // show failure\n    } else {\n      // ? user logged in\n      saveToken(data.authToken);\n\n      if (data.role === ROLES.SUPER_ADMIN) {\n        redirectTo(REDIRECT_SA_URL);\n      } else if (data.role === ROLES.ADMIN) {\n        if (data.gyms && data.gyms.length > 0) {\n          redirectTo(`${REDIRECT_A_URL}?gymCode=${data.gyms[0].gym_id}`);\n        } else {\n          redirectTo(REDIRECT_FAIL_URL); // ? redirect to page where they can view all gyms\n        }\n      } else {\n        console.error(\"Unknown role\");\n      }\n\n      // If form redirect setting set, then use this and prevent any other actions\n      $form\n        .hide() // optional hiding of form\n        .siblings(\".w-form-done\")\n        .show() // Show success\n        .siblings(\".w-form-fail\")\n        .hide(); // Hide failure\n    }\n  });\n});\n"],
  "mappings": "6MAgBO,IAAMA,EAAQ,CAAE,MAAO,QAAS,YAAa,cAAe,MAAO,OAAQ,ECd3E,SAASC,EACdC,EACAC,EAAS,MACTC,EAAO,GACPC,EAAQ,GACRC,EAAkB,GAClBC,EAAgB,GAChB,CACA,GAAI,CACF,IAAIC,EAAe,CAAE,eAAgB,kBAAmB,EACpDF,IAAiBE,EAAU,CAAC,GAC5BH,IACFG,EAAQ,cAAgB,UAAUH,KAEpC,IAAII,EAAe,CACjB,OAAAN,EACA,QAAAK,CACF,EACA,OAAIJ,IACEG,EAAeE,EAAQ,KAAO,KAAK,UAAUL,CAAI,EAChDK,EAAQ,KAAOL,GAGf,MAAMF,EAAKO,CAAO,EACtB,KAAMC,GACDA,EAAI,GACCA,EAAI,KAAK,EAEXA,EAAI,KAAK,EAAE,KAAMC,IACtB,QAAQ,OAAOA,EAAE,OAAO,EACjB,CACL,UAAW,GACX,OAAQD,EAAI,OACZ,QAASC,EAAE,QACX,QAASA,GAAKA,EAAE,QAAUA,EAAE,QAAU,IACxC,EACD,CACF,EACA,KAAMC,GAASA,CAAI,EACnB,MAAO,IACN,QAAQ,MAAM,iBAAkB,CAAC,EAC1B,EAER,CACL,OAASC,EAAP,CACA,eAAQ,MAAM,WAAaA,CAAC,EACrBA,CACT,CACF,CAEO,SAASC,EAAUT,EAAQ,KAAMU,EAAO,cAAeC,EAAM,GAAK,GAAK,GAAI,CAC5EX,IAEF,SAAS,OAAS,GAAGU,KAAQV,sBAA0BW,IAC3D,CASO,SAASC,EAAWC,EAAO,IAAKC,EAAQ,EAAG,CAChD,WAAW,IAAM,CACf,OAAO,SAAS,KAAOD,CACzB,EAAGC,CAAK,CACV,CClEA,IAAMC,EAAkB,mBAClBC,EAAiB,eACjBC,EAAoB,kBACpBC,EAAuB,kEAIzBC,EAAUA,GAAW,CAAC,EAC1BA,EAAQ,KAAK,UAAY,CAEvB,EAAE,QAAQ,EAAE,IAAI,QAAQ,EAExB,EAAE,MAAM,EAAE,OAAO,SAAgBC,EAAG,QAAAC,EAAA,sBAClCD,EAAE,eAAe,EACjB,IAAME,EAAQ,EAAE,IAAI,EAEdC,EAAa,CACjB,MAAO,SAAS,eAAe,eAAe,EAAE,MAChD,SAAU,SAAS,eAAe,gBAAgB,EAAE,KACtD,EAEIC,EAAO,MAAMC,EAASP,EAAsB,OAAQK,CAAU,EAElE,GAAIC,EAAK,YAAc,QAAa,CAACA,EAAK,UAAW,CACnDF,EACG,SAAS,cAAc,EACvB,KAAK,EACL,SAAS,cAAc,EACvB,KAAK,EAER,QAAQ,MAAME,EAAK,OAAO,EAE1B,MACF,CAEe,OAAO,KAAKA,CAAI,EAAE,SAAS,WAAW,IAEtC,GAEbF,EACG,SAAS,cAAc,EACvB,KAAK,EACL,SAAS,cAAc,EACvB,KAAK,GAGRI,EAAUF,EAAK,SAAS,EAEpBA,EAAK,OAASG,EAAM,YACtBC,EAAWb,CAAe,EACjBS,EAAK,OAASG,EAAM,MACzBH,EAAK,MAAQA,EAAK,KAAK,OAAS,EAClCI,EAAW,GAAGZ,aAA0BQ,EAAK,KAAK,CAAC,EAAE,QAAQ,EAE7DI,EAAWX,CAAiB,EAG9B,QAAQ,MAAM,cAAc,EAI9BK,EACG,KAAK,EACL,SAAS,cAAc,EACvB,KAAK,EACL,SAAS,cAAc,EACvB,KAAK,EAEZ,GAAC,CACH,CAAC",
  "names": ["ROLES", "fetchUrl", "url", "method", "body", "token", "hideContentType", "stringifyBody", "headers", "options", "res", "r", "json", "e", "saveToken", "name", "age", "redirectTo", "link", "delay", "REDIRECT_SA_URL", "REDIRECT_A_URL", "REDIRECT_FAIL_URL", "XANO_OAUTH_LOGIN_URL", "Webflow", "e", "__async", "$form", "xano_input", "data", "fetchUrl", "saveToken", "ROLES", "redirectTo"]
}
