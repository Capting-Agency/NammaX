var A=(n,r,o)=>new Promise((s,_)=>{var t=a=>{try{i(o.next(a))}catch(e){_(e)}},l=a=>{try{i(o.throw(a))}catch(e){_(e)}},i=a=>a.done?s(a.value):Promise.resolve(a.value).then(t,l);i((o=o.apply(n,r)).next())});function f(n,r="GET",o=!1,s=!1,_=!1,t=!0){try{let l={"Content-Type":"application/json"};_&&(l={}),s&&(l.Authorization=`Bearer ${s}`);let i={method:r,headers:l};return o&&(t?i.body=JSON.stringify(o):i.body=o),fetch(n,i).then(a=>a.ok?a.json():a.json().then(e=>(Promise.reject(e.message),{isFetchOk:!1,status:a.status,message:e.message,payload:e&&e.payload?e.payload:null}))).then(a=>a).catch(a=>(console.error("Error in fetch",a),a))}catch(l){return console.error("Error!: "+l),l}}function D(n=null,r="nammax_auth",o=60*60*24){n&&(document.cookie=`${r}=${n}; path=/; max-age=${o}`)}function S(n="nammax_auth"){let o=`; ${document.cookie}`.split(`; ${n}=`);return o.length===2?o.pop().split(";").shift():null}function x(n="/",r=2e3){setTimeout(()=>{window.location.href=n},r)}function O(n=1e3){setTimeout(()=>{window.location.reload()},n)}function h(n=null,r=!1){if(n==null)return"NaN";var o=new Date(n),s=o.getHours(),_=s>=12?"PM":"AM";if(s=s%12||12,r){var t=o.getMinutes();return t=t<10?`0${t}`:t,`${s}:${t} ${_}`}else return`${s} ${_}`}function g(n=null){if(n==null)return"NaN";n=n*60;let r=`${n/60^0}`.slice(-2),o=("0"+n%60).slice(-2);return r!="0"?o!="00"?`${r} HR ${o} M`:r+" HR":o+" Mins"}function L(n,r=null){if(n!=null){var o,s=n.options.length-1;for(o=s;o>=0;o--)o!==r&&n.remove(o)}}function w(n="/sign-in"){window.localStorage.removeItem("auth"),x(`${n}`)}function y(n="current-time"){let r=document.getElementById(n);r&&(r.innerText=h(new Date,!0)),setTimeout(()=>y(n),3e4)}function k(){let n=document.getElementById("loading-screen");n?n.remove():console.log("did not find loading screen")}function I({single:n=!0,baseElement:r="",TriggerBtn:o="jsModalOpen",_modalWindow:s="jsModal"},_){if(n){var t=r.querySelector("#"+o);t.onclick=function(){var a=document.getElementById(s);_&&_(),a.classList?a.classList.add("open"):a.className+=" open"}}else for(var l=document.getElementsByClassName(o),i=0;i<l.length;i++)l[i].onclick=function(){var a=this.getAttribute("href").substr(1),e=document.getElementById(a);e.classList?e.classList.add("open"):e.className+=" open"}}function U({TriggerBtn:n="jsModalClose",_modalWindow:r="jsModal"},o){var s=document.getElementById(n),_=document.getElementById(r);s.onclick=function(){_.classList?_.classList.remove("open"):_.className=_.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," ")},o&&o()}var b=Webflow||[];var R="/sign-in",B="/sign-up-2";var C="/user/dashboard";var M="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/dashboard",v="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/dashboard/book_session/",X="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/dashboard/cancel_session/",P="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/dashboard/filters";var H=[],K=[];function F(n){var r=new URL("https://x8ki-letl-twmt.n7.xano.io/api:ocRzyo-e/oauth/google/continue");r.searchParams.set("REDIRECT_URL","https://nammax.webflow.io/user/dashboard"),r.searchParams.set("code",n),r=r.toString();var o=new URL(document.location.href);o.searchParams.delete("code"),o.searchParams.delete("scope"),o.searchParams.delete("authuser"),o.searchParams.delete("hd"),o.searchParams.delete("prompt"),history.replaceState(null,"",o.toString()),fetch(r,{headers:H,method:"GET"}).then(s=>s.json()).then(s=>K=s).then(()=>D(K.token)).catch(s=>{console.error("Error:",s)})}(()=>{window.onload=function(){var t=new URL(document.location.href),l=t.searchParams.get("code");if(l)F(l);else{let i=S(),a=document.querySelector("#navbar-logout-btn");a&&(a.onclick=()=>{w()}),i?(y(),n(i),r(i)):x(`${R}?reason=NOT_SIGNED_IN`)}};function n(t){return A(this,null,function*(){var l=new URL(document.location.href),i=l.searchParams.get("session_name"),a=l.searchParams.get("time");let e=M;if(i&&i!=="Select Program"||a){e+="?",i&&(e+=`session_name=${i}&`),a&&(e+=`time=${a}`);let p=document.getElementById("on-a-filter-container");p.style.display="flex"}let c=yield f(e,"GET",!1,t);if(c.isFetchOk!==void 0&&!c.isFetchOk){console.error(c.message),x(`${R}?reason=NOT_SIGNED_IN`);return}let{users:m,sessions:d}=c;if(m.gym_id===0)x(`${B}?reason=UNSET_DETAILS`);else{o(m);let p=[],N=[];d.forEach(u=>{u.users.some(T=>T&&m&&T.user_id===m.id?(p.push(u),!0):!1)||N.push(u)}),s(m,p),_(m,N)}k()})}function r(t){let l=document.getElementById("filter-form-block"),i=l.querySelector("#filter-program"),a=l.querySelector("#datepicker-input");$(a).attr("autocomplete","off"),$(a).datepicker({startDate:new Date,format:"dd/mm/yyyy",language:"en",orientation:"bottom auto"});function e(){return A(this,null,function*(){let c=yield f(P,"GET",!1,t);if(c.isFetchOk!==void 0&&!c.isFetchOk){console.error(c.message),x(`${R}?reason=NOT_SIGNED_IN`);return}let{sessions:m}=c;L(i,0),m.forEach(d=>{var p=document.createElement("option");p.value=d.name,p.innerHTML=d.name,i.appendChild(p)}),i.removeEventListener("focus",e)})}i.addEventListener("focus",e)}function o(t){document.getElementById("user_name").innerText=t.name,document.getElementById("gym-location").innerText=t.location,t.profile_picture&&(document.getElementById("profile-avatar").style.backgroundImage=`url(${t.profile_picture.url})`)}function s(t,l){return A(this,null,function*(){let i=document.getElementById("booked-sessions-container"),a=i.querySelector("#booked-sessions-item");l.forEach(e=>{let c=a.cloneNode(!0);c.setAttribute("id",""),c.querySelector("#booked-session-name").innerText=e.session_name,c.querySelector("#booked-time").innerText=h(e.time,!0),c.querySelector("#booked-duration").innerText=g(e.duration),c.querySelector("#booked-session-slot-bar").style.width=e.users.length/e.capacity*100+"%",c.querySelector("#booked-capacity").innerText=`${e.users.length}/${e.capacity}`,I({baseElement:c,TriggerBtn:"cancel-booked-session-btn",_modalWindow:"cancel-booked-session-popout"},()=>{let m=document.getElementById("cancel-booked-session-popout");m.querySelector("#session-name").innerText=e.session_name,m.querySelector("#date").innerText=new Date(e.time).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"}),m.querySelector("#time").innerText=h(e.time),m.querySelector("#duration").innerText=g(e.duration),m.querySelector("#capacity").innerHTML=`${e.users.length}/${e.capacity}`;let d=m.querySelector("#confirm-cancel-booking-popout-btn");d.onclick=()=>A(this,null,function*(){d.disabled=!0;let p=S(),N={membership_end_date:(t==null?void 0:t.membership_end_date)||null},u=yield f(X+e.id,"POST",N,p);if(u.isFetchOk!==void 0&&!u.isFetchOk){let E=m.querySelector("#warning_block");E.innerText=u.message,E.style.display="flex",d.disabled=!1;return}O()})}),i.prepend(c)}),U({TriggerBtn:"close-cancel-booked-session-modal-btn",_modalWindow:"cancel-booked-session-popout"}),i.classList.remove("off"),a.remove()})}function _(t,l){return A(this,null,function*(){let i=document.getElementById("view-sessions-container"),a=i.querySelector("#view-sessions-item");l.forEach(e=>{let c=a.cloneNode(!0);c.setAttribute("id",""),c.querySelector("#session-name").innerText=e.session_name,c.querySelector("#time").innerText=h(e.time),c.querySelector("#duration").innerText=g(e.duration),c.querySelector("#session-slot-bar").style.width=e.users.length/e.capacity*100+"%",c.querySelector("#capacity").innerText=`${e.users.length}/${e.capacity}`,I({baseElement:c,TriggerBtn:"book-session-btn",_modalWindow:"book-session-popout"},()=>{let m=document.getElementById("book-session-popout");m.querySelector("#name").innerText=e.session_name,m.querySelector("#date").innerText=new Date(e.time).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"}),m.querySelector("#time").innerText=h(e.time),m.querySelector("#duration").innerText=g(e.duration),m.querySelector("#capacity").innerText=`${e.users.length}/${e.capacity}`,t!=null&&t.membership_end_date?m.querySelector("#remaining_sessions").innerText="Your membership ends on "+(t==null?void 0:t.membership_end_date.toString()):t!=null&&t.tokens&&(t==null?void 0:t.tokens)>0?m.querySelector("#remaining_sessions").innerText=t==null?void 0:t.tokens.toString().padStart(3,"0"):m.querySelector("#remaining_sessions").innerText="Please contact an admin for a membership";let d=m.querySelector("#confirm-booking-popout-btn");d.onclick=()=>A(this,null,function*(){d.disabled=!0;let p=S(),N={session_id:e.id},u=yield f(v+e.id,"POST",N,p);if(u.isFetchOk!==void 0&&!u.isFetchOk){let E=m.querySelector("#warning_block");E.innerText=u.message,E.style.display="flex",d.disabled=!1;return}O()})}),i.prepend(c)}),U({TriggerBtn:"close-cancel-booking-session-modal-btn",_modalWindow:"book-session-popout"}),i.classList.remove("off"),a.remove()})}})();var G=b||[];G.push(function(){$(document).off("submit"),$("form").submit(function(n){return A(this,null,function*(){n.preventDefault();let r=$(this);if(S()){let s=r[0][0].value,_=r[0][1].value,t=C;if((s&&s!=="Select Program"||_)&&(t+="?",s!=="Select Program"&&s!=="Loading..."&&(t+=`session_name=${s}&`),_)){let l=_.split("/"),i=new Date(+l[2],l[1]-1,+l[0]).toISOString(),a=new Date((typeof i=="string"?new Date(i):i).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}));t+=`time=${a.getTime()+1e7}`}x(t)}})})});
