var N=(t,s,o)=>new Promise((l,m)=>{var e=n=>{try{a(o.next(n))}catch(i){m(i)}},r=n=>{try{a(o.throw(n))}catch(i){m(i)}},a=n=>n.done?l(n.value):Promise.resolve(n.value).then(e,r);a((o=o.apply(t,s)).next())});var B=["January","February","March","April","May","June","July","August","September","October","November","December"];function S(t,s="GET",o=!1,l=!1,m=!1,e=!0){try{let r={"Content-Type":"application/json"};m&&(r={}),l&&(r.Authorization=`Bearer ${l}`);let a={method:s,headers:r};return o&&(e?a.body=JSON.stringify(o):a.body=o),fetch(t,a).then(n=>n.ok?n.json():n.json().then(i=>(Promise.reject(i.message),{isFetchOk:!1,status:n.status,message:i.message,payload:i&&i.payload?i.payload:null}))).then(n=>n).catch(n=>(console.error("Error in fetch",n),n))}catch(r){return console.error("Error!: "+r),r}}function C(t=null,s="nammax_auth",o=60*60*24){t&&(document.cookie=`${s}=${t}; path=/; max-age=${o}`)}function R(t="nammax_auth"){let o=`; ${document.cookie}`.split(`; ${t}=`);return o.length===2?o.pop().split(";").shift():null}function h(t="/",s=2e3){setTimeout(()=>{window.location.href=t},s)}function U(t=1e3){setTimeout(()=>{window.location.reload()},t)}function E(t=null,s=!1,o=!1,l=!1){if(t==null)return"NaN";let m=new Date,e=new Date(t),r=e.getHours(),a="";if(l||(a=r>=12?"PM":"AM",r=r%12||12),s){let n=e.getMinutes();return n=n<10?`0${n}`:n,o?`${m.getDate()===e.getDate()?"Today":m.getDate()+1===e.getDate()?"Tomorrow":m.getDate()+2===e.getDate()?"Day After Tomorrow":I(t)} ${r}:${n} ${a}`:`${r}:${n} ${a}`}else return o?`${m.getDate()===e.getDate()?"Today":m.getDate()+1===e.getDate()?"Tomorrow":m.getDate()+2===e.getDate()?"Day After Tomorrow":I(t)} ${r} ${a}`:`${I(t)} ${r} ${a}`}function I(t=null){if(t==null)return"NaN";let s=new Date(t);return`${s.getDate()}/${s.getMonth()+1}/${s.getFullYear()}`}function O(t=null){if(t==null)return"NaN";t=t*60;let s=`${t/60^0}`.slice(-2),o=("0"+t%60).slice(-2);return s!="0"?o!="00"?`${s} HR ${o} M`:s+" HR":o+" Mins"}function M(t,s=null){if(t!=null){var o,l=t.options.length-1;for(o=l;o>=0;o--)o!==s&&t.remove(o)}}function w(t="/sign-in"){window.localStorage.removeItem("auth"),h(`${t}`)}function y(t=!1,s=!0,o="current-time"){let l=document.getElementById(o);l&&s?(l.innerText=`${new Date().toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"})} | ${E(new Date().getTime(),!0,!1,t)}`,setTimeout(()=>y(t,s,o),2e4)):l&&!s&&(l.innerText=E(new Date().getTime(),!0,!1,t),setTimeout(()=>y(t,s,o),2e4))}function k(){let t=document.getElementById("loading-screen");t?t.remove():console.log("did not find loading screen")}function T({single:t=!0,baseElement:s="",TriggerBtn:o="jsModalOpen",_modalWindow:l="jsModal"},m){if(t){var e=s.querySelector("#"+o);e.onclick=function(){var n=document.getElementById(l);m&&m(),n.classList?n.classList.add("open"):n.className+=" open"}}else for(var r=document.getElementsByClassName(o),a=0;a<r.length;a++)r[a].onclick=function(){var n=this.getAttribute("href").substr(1),i=document.getElementById(n);i.classList?i.classList.add("open"):i.className+=" open"}}function L({TriggerBtn:t="jsModalClose",_modalWindow:s="jsModal"},o){var l=document.getElementById(t),m=document.getElementById(s);l.onclick=function(){m.classList?m.classList.remove("open"):m.className=m.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," ")},o&&o()}var v=Webflow||[];var D="/sign-in",j="/sign-up-2";var X="/user/dashboard";var P="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/user/dashboard",z="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/user/dashboard/book_session/",F="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/user/dashboard/cancel_session/",K="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/user/dashboard/filters";var G=[],H=[];function q(t){var s=new URL("https://xoxo-jnzf-s0on.m2.xano.io/api:ocRzyo-e/oauth/google/continue");s.searchParams.set("REDIRECT_URL","https://nammacrossfit.com/user/dashboard"),s.searchParams.set("code",t),s=s.toString();var o=new URL(document.location.href);o.searchParams.delete("code"),o.searchParams.delete("scope"),o.searchParams.delete("authuser"),o.searchParams.delete("hd"),o.searchParams.delete("prompt"),history.replaceState(null,"",o.toString()),fetch(s,{headers:G,method:"GET"}).then(l=>l.json()).then(l=>H=l).then(()=>C(H.token)).catch(l=>{console.error("Error:",l)})}(()=>{window.onload=function(){var e=new URL(document.location.href),r=e.searchParams.get("code");if(r)q(r);else{let a=R(),n=document.querySelector("#navbar-logout-btn");n&&(n.onclick=()=>{w()}),a?(y(),t(a),s(a)):h(`${D}?reason=NOT_SIGNED_IN`)}};function t(e){return N(this,null,function*(){var r=new URL(document.location.href),a=r.searchParams.get("session_name"),n=r.searchParams.get("time");let i=P;if(a&&a!=="Select Program"||n){i+="?",a&&(i+=`session_name=${a}&`),n&&(i+=`time=${n}`);let d=document.getElementById("on-a-filter-container");d.style.display="flex"}let c=yield S(i,"GET",!1,e);if(c.isFetchOk!==void 0&&!c.isFetchOk){console.error(c.message),h(`${D}?reason=NOT_SIGNED_IN`);return}let{users:_,sessions:p}=c;if(_.gym_id===0)h(`${j}?reason=UNSET_DETAILS`);else{o(_);let d=[],A=[];p.forEach(f=>{f.users.some(u=>u&&_&&u.user_id===_.id?(d.push(f),!0):!1)||A.push(f)}),l(d),m(_,A)}k()})}function s(e){let r=document.getElementById("filter-form-block"),a=r.querySelector("#filter-program"),n=r.querySelector("#datepicker-input");$(n).attr("autocomplete","off"),$(n).datepicker({startDate:new Date,format:"dd/mm/yyyy",language:"en",orientation:"bottom auto"});function i(){return N(this,null,function*(){let c=yield S(K,"GET",!1,e);if(c.isFetchOk!==void 0&&!c.isFetchOk){console.error(c.message),h(`${D}?reason=NOT_SIGNED_IN`);return}let{sessions:_}=c;M(a,0),_.forEach(p=>{var d=document.createElement("option");d.value=p.name,d.innerHTML=p.name,a.appendChild(d)}),a.removeEventListener("focus",i)})}a.addEventListener("focus",i)}function o(e){document.getElementById("user_name").innerText=e.name,document.getElementById("gym-location").innerText=e.location,e.profile_picture&&(document.getElementById("profile-avatar").style.backgroundImage=`url(${e.profile_picture.url})`)}function l(e){return N(this,null,function*(){let r=document.getElementById("booked-sessions-container"),a=r.querySelector("#booked-sessions-item");e.sort((i,c)=>c.time-i.time).forEach(i=>{let c=a.cloneNode(!0);c.setAttribute("id",""),c.querySelector("#booked-session-name").innerText=i.session_name,c.querySelector("#booked-time").innerText=E(i.time,!0,!0),c.querySelector("#booked-duration").innerText=O(i.duration);let _=(i.users.length/i.capacity).toFixed(2);c.querySelector("#booked-capacity").innerText=`${_>=1?"Full":_>.85?"Few Slots Left":_>.6?"Filling Fast!":(_*100).toFixed(2)+"%"}`,c.querySelector("#booked-session-slot-bar").style.width=_*100+"%",T({baseElement:c,TriggerBtn:"cancel-booked-session-btn",_modalWindow:"cancel-booked-session-popout"},()=>{let p=document.getElementById("cancel-booked-session-popout");p.querySelector("#session-name").innerText=i.session_name,p.querySelector("#date").innerText=new Date(i.time).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"}),p.querySelector("#time").innerText=E(i.time),p.querySelector("#duration").innerText=O(i.duration);let d=(i.users.length/i.capacity).toFixed(2);p.querySelector("#capacity").innerHTML=d*100+"%";let A=p.querySelector("#confirm-cancel-booking-popout-btn");A.onclick=()=>N(this,null,function*(){A.disabled=!0;let f=R(),x={session_id:i.id},u=yield S(F+i.id,"POST",x,f);if(u.isFetchOk!==void 0&&!u.isFetchOk){let g=p.querySelector("#warning_block");g.innerText=u.message,g.style.display="flex",A.disabled=!1;return}U()})}),r.prepend(c)}),L({TriggerBtn:"close-cancel-booked-session-modal-btn",_modalWindow:"cancel-booked-session-popout"}),r.classList.remove("off"),a.remove()})}function m(e,r){return N(this,null,function*(){let a=document.getElementById("view-sessions-container"),n=a.querySelector("#view-sessions-item");r.sort((c,_)=>_.time-c.time).forEach(c=>{let _=n.cloneNode(!0);_.setAttribute("id",""),_.querySelector("#session-name").innerText=c.session_name,_.querySelector("#time").innerText=E(c.time,!1,!0),_.querySelector("#duration").innerText=O(c.duration);let p=(c.users.length/c.capacity).toFixed(2);_.querySelector("#capacity").innerText=`${p>=1?"Full":p>.85?"Few Slots Left":p>.6?"Filling Fast!":(p*100).toFixed(2)+"%"}`,_.querySelector("#session-slot-bar").style.width=p*100+"%",T({baseElement:_,TriggerBtn:"book-session-btn",_modalWindow:"book-session-popout"},()=>{let d=document.getElementById("book-session-popout");d.querySelector("#name").innerText=c.session_name,d.querySelector("#date").innerText=new Date(c.time).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"}),d.querySelector("#time").innerText=E(c.time),d.querySelector("#duration").innerText=O(c.duration);let A=((c.users.length/c.capacity).toFixed(2)*100).toFixed(2);if(d.querySelector("#capacity").innerText=`${A}%`,e!=null&&e.membership_end_date){console.log(e==null?void 0:e.membership_end_date);let x=e==null?void 0:e.membership_end_date.split("-"),u=B[x[1]-1];e!=null&&e.tokens&&(e==null?void 0:e.tokens)>0?d.querySelector("#remaining_sessions").innerText=`${e==null?void 0:e.tokens} (ends on ${x[2]}-${u}-${x[0]})`:d.querySelector("#remaining_sessions").innerText=`Your membership ends on ${x[2]}-${u}-${x[0]}`}else e!=null&&e.tokens&&(e==null?void 0:e.tokens)>0?d.querySelector("#remaining_sessions").innerText=e==null?void 0:e.tokens.toString().padStart(3,"0"):d.querySelector("#remaining_sessions").innerText="Please contact an admin for a membership";let f=d.querySelector("#confirm-booking-popout-btn");f.onclick=()=>N(this,null,function*(){f.disabled=!0;let x=R(),u={session_id:c.id},g=yield S(z+c.id,"POST",u,x);if(g.isFetchOk!==void 0&&!g.isFetchOk){let b=d.querySelector("#warning_block");b.innerText=g.message,b.style.display="flex",f.disabled=!1;return}U()})}),a.prepend(_)}),L({TriggerBtn:"close-cancel-booking-session-modal-btn",_modalWindow:"book-session-popout"}),a.classList.remove("off"),n.remove()})}})();var W=v||[];W.push(function(){$(document).off("submit"),$("form").submit(function(t){return N(this,null,function*(){t.preventDefault();let s=$(this);if(R()){let l=s[0][0].value,m=s[0][1].value,e=X;if((l&&l!=="Select Program"||m)&&(e+="?",l!=="Select Program"&&l!=="Loading..."&&(e+=`session_name=${l}&`),m)){let r=m.split("/"),a=new Date(+r[2],r[1]-1,+r[0]).toISOString(),n=new Date((typeof a=="string"?new Date(a):a).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}));e+=`time=${n.getTime()+1e7}`}h(e)}})})});
