var _=(e,o,t)=>new Promise((a,n)=>{var i=s=>{try{l(t.next(s))}catch(c){n(c)}},r=s=>{try{l(t.throw(s))}catch(c){n(c)}},l=s=>s.done?a(s.value):Promise.resolve(s.value).then(i,r);l((t=t.apply(e,o)).next())});function A(e,o="GET",t=!1,a=!1,n=!1,i=!0){try{let r={"Content-Type":"application/json"};n&&(r={}),a&&(r.Authorization=`Bearer ${a}`);let l={method:o,headers:r};return t&&(i?l.body=JSON.stringify(t):l.body=t),fetch(e,l).then(s=>s.ok?s.json():s.json().then(c=>(Promise.reject(c.message),{isFetchOk:!1,status:s.status,message:c.message,payload:c&&c.payload?c.payload:null}))).then(s=>s).catch(s=>(console.error("Error in fetch",s),s))}catch(r){return console.error("Error!: "+r),r}}function R(e=null,o="nammax_auth",t=60*60*24){e&&(document.cookie=`${o}=${e}; path=/; max-age=${t}`)}function x(e="nammax_auth"){let t=`; ${document.cookie}`.split(`; ${e}=`);return t.length===2?t.pop().split(";").shift():null}function d(e="/",o=0){setTimeout(()=>{window.location.href=e},o)}function u(e=null,o=!1){if(e==null)return"NaN";var t=new Date(e),a=t.getHours(),n=a>=12?"PM":"AM";if(a=a%12||12,o){var i=t.getMinutes();return i=i<10?`0${i}`:i,`${a}:${i} ${n}`}else return`${a} ${n}`}function N(e=null){if(e==null)return"NaN";e=e*60;let o=`${e/60^0}`.slice(-2),t=("0"+e%60).slice(-2);return o!="0"?t!="00"?`${o} HR ${t} M`:o+" HR":t+" Mins"}function O(e,o=null){if(e!=null){var t,a=e.options.length-1;for(t=a;t>=0;t--)t!==o&&e.remove(t)}}function y(e="/sign-in"){window.localStorage.removeItem("auth"),d(`${e}`)}function h(e="current-time"){let o=document.getElementById(e);o&&(o.innerText=u(new Date,!0)),setTimeout(()=>h(e),3e4)}function f({single:e=!0,baseElement:o="",TriggerBtn:t="jsModalOpen",_modalWindow:a="jsModal"},n){if(e){var i=o.querySelector("#"+t);i.onclick=function(){var s=document.getElementById(a);n&&n(),s.classList?s.classList.add("open"):s.className+=" open"}}else for(var r=document.getElementsByClassName(t),l=0;l<r.length;l++)r[l].onclick=function(){var s=this.getAttribute("href").substr(1),c=document.getElementById(s);c.classList?c.classList.add("open"):c.className+=" open"}}function S({TriggerBtn:e="jsModalClose",_modalWindow:o="jsModal"},t){var a=document.getElementById(e),n=document.getElementById(o);a.onclick=function(){n.classList?n.classList.remove("open"):n.className=n.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," ")},t&&t()}var E="/sign-in",I="/sign-up-2";var U="/user/dashboard";var T="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/dashboard",w="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/dashboard/book_session/",D="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/dashboard/cancel_session/",L="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/dashboard/filters";var B=[],k=[];function C(e){var o=new URL("https://x8ki-letl-twmt.n7.xano.io/api:ocRzyo-e/oauth/google/continue");o.searchParams.set("REDIRECT_URL","https://nammax.webflow.io/user/dashboard"),o.searchParams.set("code",e),o=o.toString();var t=new URL(document.location.href);t.searchParams.delete("code"),t.searchParams.delete("scope"),t.searchParams.delete("authuser"),t.searchParams.delete("hd"),t.searchParams.delete("prompt"),history.replaceState(null,"",t.toString()),fetch(o,{headers:B,method:"GET"}).then(a=>a.json()).then(a=>k=a).then(()=>R(k.token)).catch(a=>{console.error("Error:",a)})}window.onload=function(){var e=new URL(document.location.href),o=e.searchParams.get("code");if(o)C(o);else{let t=x(),a=document.querySelector("#navbar-logout-btn");a&&(a.onclick=()=>{y()}),t?(h(),M(t),v(t)):d(`${E}?reason=NOT_SIGNED_IN`)}};function M(e){return _(this,null,function*(){var o=new URL(document.location.href),t=o.searchParams.get("session_name"),a=o.searchParams.get("time");let n=T;if(t&&t!=="Select Program"||a){n+="?",t&&(n+=`session_name=${t}&`),a&&(n+=`time=${a}`);let s=document.getElementById("on-a-filter-container");s.style.display="flex"}let i=yield A(n,"GET",!1,e);if(i.isFetchOk!==void 0&&!i.isFetchOk){console.error(i.message),d(`${E}?reason=NOT_SIGNED_IN`);return}let{users:r,sessions:l}=i;if(r.gym_id===0)d(`${I}?reason=UNSET_DETAILS`);else{X(r);let s=[],c=[];l.forEach(m=>{m.users.some(g=>g&&r&&g.user_id===r.id?(s.push(m),!0):!1)||c.push(m)}),P(r,s),K(r,c)}})}function v(e){let o=document.getElementById("filter-form-block"),t=o.querySelector("#filter-program"),a=o.querySelector("#datepicker-input");$(a).attr("autocomplete","off"),$(a).datepicker({startDate:new Date,format:"dd/mm/yyyy",language:"en",orientation:"bottom auto"});function n(){return _(this,null,function*(){let i=yield A(L,"GET",!1,e);if(i.isFetchOk!==void 0&&!i.isFetchOk){console.error(i.message),d(`${E}?reason=NOT_SIGNED_IN`);return}let{sessions:r}=i;O(t,0),r.forEach(l=>{var s=document.createElement("option");s.value=l.name,s.innerHTML=l.name,t.appendChild(s)}),t.removeEventListener("focus",n)})}t.addEventListener("focus",n)}function X(e){document.getElementById("user_name").innerText=e.name,document.getElementById("gym-location").innerText=e.location,e.profile_picture&&(document.getElementById("profile-avatar").style.backgroundImage=`url(${e.profile_picture.url})`)}function P(e,o){return _(this,null,function*(){let t=document.getElementById("booked-sessions-container"),a=t.querySelector("#booked-sessions-item");o.forEach(n=>{let i=a.cloneNode(!0);i.setAttribute("id",""),i.querySelector("#booked-session-name").innerText=n.session_name,i.querySelector("#booked-time").innerText=u(n.time,!0),i.querySelector("#booked-duration").innerText=N(n.duration),i.querySelector("#booked-session-slot-bar").style.width=n.users.length/n.capacity*100+"%",i.querySelector("#booked-capacity").innerText=`${n.users.length}/${n.capacity}`,f({baseElement:i,TriggerBtn:"cancel-booked-session-btn",_modalWindow:"cancel-booked-session-popout"},()=>{let r=document.getElementById("cancel-booked-session-popout");r.querySelector("#session-name").innerText=n.session_name,r.querySelector("#date").innerText=new Date(n.time).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"}),r.querySelector("#time").innerText=u(n.time),r.querySelector("#duration").innerText=N(n.duration),r.querySelector("#capacity").innerHTML=`${n.users.length}/${n.capacity}`;let l=r.querySelector("#confirm-cancel-booking-popout-btn");l.onclick=()=>_(this,null,function*(){let s=x(),c={membership_end_date:(e==null?void 0:e.membership_end_date)||null},m=yield A(D+n.id,"POST",c,s);if(m.isFetchOk!==void 0&&!m.isFetchOk){let p=r.querySelector("#warning_block");p.innerText=m.message,p.style.display="flex";return}window.location.reload()})}),t.prepend(i)}),S({TriggerBtn:"close-cancel-booked-session-modal-btn",_modalWindow:"cancel-booked-session-popout"}),t.classList.remove("off"),a.remove()})}function K(e,o){return _(this,null,function*(){let t=document.getElementById("view-sessions-container"),a=t.querySelector("#view-sessions-item");o.forEach(n=>{let i=a.cloneNode(!0);i.setAttribute("id",""),i.querySelector("#session-name").innerText=n.session_name,i.querySelector("#time").innerText=u(n.time),i.querySelector("#duration").innerText=N(n.duration),i.querySelector("#session-slot-bar").style.width=n.users.length/n.capacity*100+"%",i.querySelector("#capacity").innerText=`${n.users.length}/${n.capacity}`,f({baseElement:i,TriggerBtn:"book-session-btn",_modalWindow:"book-session-popout"},()=>{let r=document.getElementById("book-session-popout");r.querySelector("#name").innerText=n.session_name,r.querySelector("#date").innerText=new Date(n.time).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"}),r.querySelector("#time").innerText=u(n.time),r.querySelector("#duration").innerText=N(n.duration),r.querySelector("#capacity").innerText=`${n.users.length}/${n.capacity}`,e!=null&&e.membership_end_date?r.querySelector("#remaining_sessions").innerText="Your membership ends on "+(e==null?void 0:e.membership_end_date.toString()):e!=null&&e.tokens&&(e==null?void 0:e.tokens)>0?r.querySelector("#remaining_sessions").innerText=e==null?void 0:e.tokens.toString().padStart(3,"0"):r.querySelector("#remaining_sessions").innerText="Please contact an admin for a membership";let l=r.querySelector("#confirm-booking-popout-btn");l.onclick=()=>_(this,null,function*(){let s=x(),c={session_id:n.id},m=yield A(w+n.id,"POST",c,s);if(m.isFetchOk!==void 0&&!m.isFetchOk){let p=r.querySelector("#warning_block");p.innerText=m.message,p.style.display="flex";return}window.location.reload()})}),t.prepend(i)}),S({TriggerBtn:"close-cancel-booking-session-modal-btn",_modalWindow:"book-session-popout"}),t.classList.remove("off"),a.remove()})}var b=b||[];b.push(function(){$(document).off("submit"),$("form").submit(function(e){return _(this,null,function*(){e.preventDefault();let o=$(this);if(x()){let a=o[0][0].value,n=o[0][1].value,i=U;if((a&&a!=="Select Program"||n)&&(i+="?",a!=="Select Program"&&a!=="Loading..."&&(i+=`session_name=${a}&`),n)){let r=n.split("/"),l=new Date(+r[2],r[1]-1,+r[0]).toISOString(),s=new Date((typeof l=="string"?new Date(l):l).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}));i+=`time=${s.getTime()+1e7}`}d(i)}})})});
//# sourceMappingURL=dashboard.js.map
