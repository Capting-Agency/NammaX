var E=(t,i,n)=>new Promise((c,m)=>{var e=o=>{try{a(n.next(o))}catch(s){m(s)}},r=o=>{try{a(n.throw(o))}catch(s){m(s)}},a=o=>o.done?c(o.value):Promise.resolve(o.value).then(e,r);a((n=n.apply(t,i)).next())});var k=["January","February","March","April","May","June","July","August","September","October","November","December"];function S(t,i="GET",n=!1,c=!1,m=!1,e=!0){try{let r={"Content-Type":"application/json"};m&&(r={}),c&&(r.Authorization=`Bearer ${c}`);let a={method:i,headers:r};return n&&(e?a.body=JSON.stringify(n):a.body=n),fetch(t,a).then(o=>o.ok?o.json():o.json().then(s=>(Promise.reject(s.message),{isFetchOk:!1,status:o.status,message:s.message,payload:s&&s.payload?s.payload:null}))).then(o=>o).catch(o=>(console.error("Error in fetch",o),o))}catch(r){return console.error("Error!: "+r),r}}function b(t=null,i="nammax_auth",n=60*60*24){t&&(document.cookie=`${i}=${t}; path=/; max-age=${n}`)}function R(t="nammax_auth"){let n=`; ${document.cookie}`.split(`; ${t}=`);return n.length===2?n.pop().split(";").shift():null}function h(t="/",i=2e3){setTimeout(()=>{window.location.href=t},i)}function U(t=1e3){setTimeout(()=>{window.location.reload()},t)}function f(t=null,i=!1,n=!1,c=!1){if(t==null)return"NaN";let m=new Date,e=new Date(t),r=e.getHours(),a="";if(c||(a=r>=12?"PM":"AM",r=r%12||12),i){let o=e.getMinutes();return o=o<10?`0${o}`:o,n?`${m.getDate()===e.getDate()?"Today":m.getDate()+1===e.getDate()?"Tomorrow":m.getDate()+2===e.getDate()?"Day After Tomorrow":I(t)} ${r}:${o} ${a}`:`${r}:${o} ${a}`}else return n?`${m.getDate()===e.getDate()?"Today":m.getDate()+1===e.getDate()?"Tomorrow":m.getDate()+2===e.getDate()?"Day After Tomorrow":I(t)} ${r} ${a}`:`${I(t)} ${r} ${a}`}function I(t=null){if(t==null)return"NaN";let i=new Date(t);return`${i.getDate()}/${i.getMonth()+1}/${i.getFullYear()}`}function O(t=null){if(t==null)return"NaN";t=t*60;let i=`${t/60^0}`.slice(-2),n=("0"+t%60).slice(-2);return i!="0"?n!="00"?`${i} HR ${n} M`:i+" HR":n+" Mins"}function B(t,i=null){if(t!=null){var n,c=t.options.length-1;for(n=c;n>=0;n--)n!==i&&t.remove(n)}}function C(t="/sign-in"){window.localStorage.removeItem("auth"),h(`${t}`)}function y(t=!1,i=!0,n="current-time"){let c=document.getElementById(n);c&&i?(c.innerText=`${new Date().toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"})} | ${f(new Date().getTime(),!0,!1,t)}`,setTimeout(()=>y(t,i,n),2e4)):c&&!i&&(c.innerText=f(new Date().getTime(),!0,!1,t),setTimeout(()=>y(t,i,n),2e4))}function M(){let t=document.getElementById("loading-screen");t?t.remove():console.log("did not find loading screen")}function T({single:t=!0,baseElement:i="",TriggerBtn:n="jsModalOpen",_modalWindow:c="jsModal"},m){if(t){var e=i.querySelector("#"+n);e.onclick=function(){var o=document.getElementById(c);m&&m(),o.classList?o.classList.add("open"):o.className+=" open"}}else for(var r=document.getElementsByClassName(n),a=0;a<r.length;a++)r[a].onclick=function(){var o=this.getAttribute("href").substr(1),s=document.getElementById(o);s.classList?s.classList.add("open"):s.className+=" open"}}function L({TriggerBtn:t="jsModalClose",_modalWindow:i="jsModal"},n){var c=document.getElementById(t),m=document.getElementById(i);c.onclick=function(){m.classList?m.classList.remove("open"):m.className=m.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," ")},n&&n()}var v=Webflow||[];var D="/sign-in",X="/sign-up-2";var P="/user/dashboard";var F="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/dashboard",K="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/dashboard/book_session/",H="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/dashboard/cancel_session/",G="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/dashboard/filters";var W=[],q=[];function j(t){var i=new URL("https://x8ki-letl-twmt.n7.xano.io/api:ocRzyo-e/oauth/google/continue");i.searchParams.set("REDIRECT_URL","https://nammacrossfit.com/user/dashboard"),i.searchParams.set("code",t),i=i.toString();var n=new URL(document.location.href);n.searchParams.delete("code"),n.searchParams.delete("scope"),n.searchParams.delete("authuser"),n.searchParams.delete("hd"),n.searchParams.delete("prompt"),history.replaceState(null,"",n.toString()),fetch(i,{headers:W,method:"GET"}).then(c=>c.json()).then(c=>q=c).then(()=>b(q.token)).catch(c=>{console.error("Error:",c)})}(()=>{window.onload=function(){var e=new URL(document.location.href),r=e.searchParams.get("code");if(r)j(r);else{let a=R(),o=document.querySelector("#navbar-logout-btn");o&&(o.onclick=()=>{C()}),a?(y(),t(a),i(a)):h(`${D}?reason=NOT_SIGNED_IN`)}};function t(e){return E(this,null,function*(){var r=new URL(document.location.href),a=r.searchParams.get("session_name"),o=r.searchParams.get("time");let s=F;if(a&&a!=="Select Program"||o){s+="?",a&&(s+=`session_name=${a}&`),o&&(s+=`time=${o}`);let d=document.getElementById("on-a-filter-container");d.style.display="flex"}let l=yield S(s,"GET",!1,e);if(l.isFetchOk!==void 0&&!l.isFetchOk){console.error(l.message),h(`${D}?reason=NOT_SIGNED_IN`);return}let{users:_,sessions:p}=l;if(_.gym_id===0)h(`${X}?reason=UNSET_DETAILS`);else{n(_);let d=[],N=[];p.forEach(x=>{x.users.some(u=>u&&_&&u.user_id===_.id?(d.push(x),!0):!1)||N.push(x)}),c(d),m(_,N)}M()})}function i(e){let r=document.getElementById("filter-form-block"),a=r.querySelector("#filter-program"),o=r.querySelector("#datepicker-input");$(o).attr("autocomplete","off"),$(o).datepicker({startDate:new Date,format:"dd/mm/yyyy",language:"en",orientation:"bottom auto"});function s(){return E(this,null,function*(){let l=yield S(G,"GET",!1,e);if(l.isFetchOk!==void 0&&!l.isFetchOk){console.error(l.message),h(`${D}?reason=NOT_SIGNED_IN`);return}let{sessions:_}=l;B(a,0),_.forEach(p=>{var d=document.createElement("option");d.value=p.name,d.innerHTML=p.name,a.appendChild(d)}),a.removeEventListener("focus",s)})}a.addEventListener("focus",s)}function n(e){document.getElementById("user_name").innerText=e.name,document.getElementById("gym-location").innerText=e.location,e.profile_picture&&(document.getElementById("profile-avatar").style.backgroundImage=`url(${e.profile_picture.url})`)}function c(e){return E(this,null,function*(){let r=document.getElementById("booked-sessions-container"),a=r.querySelector("#booked-sessions-item");e.sort((s,l)=>l.time-s.time).forEach(s=>{let l=a.cloneNode(!0);l.setAttribute("id",""),l.querySelector("#booked-session-name").innerText=s.session_name,l.querySelector("#booked-time").innerText=f(s.time,!0,!0),l.querySelector("#booked-duration").innerText=O(s.duration);let _=(s.users.length/s.capacity).toFixed(2);l.querySelector("#booked-capacity").innerText=`${_>=1?"Full":_>.85?"Few Slots Left":_>.6?"Filling Fast!":(_*100).toFixed(2)+"%"}`,l.querySelector("#booked-session-slot-bar").style.width=_*100+"%",T({baseElement:l,TriggerBtn:"cancel-booked-session-btn",_modalWindow:"cancel-booked-session-popout"},()=>{let p=document.getElementById("cancel-booked-session-popout");p.querySelector("#session-name").innerText=s.session_name,p.querySelector("#date").innerText=new Date(s.time).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"}),p.querySelector("#time").innerText=f(s.time),p.querySelector("#duration").innerText=O(s.duration);let d=(s.users.length/s.capacity).toFixed(2);p.querySelector("#capacity").innerHTML=d*100+"%";let N=p.querySelector("#confirm-cancel-booking-popout-btn");N.onclick=()=>E(this,null,function*(){N.disabled=!0;let x=R(),A={session_id:s.id},u=yield S(H+s.id,"POST",A,x);if(u.isFetchOk!==void 0&&!u.isFetchOk){let g=p.querySelector("#warning_block");g.innerText=u.message,g.style.display="flex",N.disabled=!1;return}U()})}),r.prepend(l)}),L({TriggerBtn:"close-cancel-booked-session-modal-btn",_modalWindow:"cancel-booked-session-popout"}),r.classList.remove("off"),a.remove()})}function m(e,r){return E(this,null,function*(){let a=document.getElementById("view-sessions-container"),o=a.querySelector("#view-sessions-item");r.sort((l,_)=>_.time-l.time).forEach(l=>{let _=o.cloneNode(!0);_.setAttribute("id",""),_.querySelector("#session-name").innerText=l.session_name,_.querySelector("#time").innerText=f(l.time,!1,!0),_.querySelector("#duration").innerText=O(l.duration);let p=(l.users.length/l.capacity).toFixed(2);_.querySelector("#capacity").innerText=`${p>=1?"Full":p>.85?"Few Slots Left":p>.6?"Filling Fast!":(p*100).toFixed(2)+"%"}`,_.querySelector("#session-slot-bar").style.width=p*100+"%",T({baseElement:_,TriggerBtn:"book-session-btn",_modalWindow:"book-session-popout"},()=>{let d=document.getElementById("book-session-popout");d.querySelector("#name").innerText=l.session_name,d.querySelector("#date").innerText=new Date(l.time).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"}),d.querySelector("#time").innerText=f(l.time),d.querySelector("#duration").innerText=O(l.duration);let N=((l.users.length/l.capacity).toFixed(2)*100).toFixed(2);if(d.querySelector("#capacity").innerText=`${N}%`,e!=null&&e.membership_end_date){console.log(e==null?void 0:e.membership_end_date);let A=e==null?void 0:e.membership_end_date.split("-"),u=k[A[1]-1];e!=null&&e.tokens&&(e==null?void 0:e.tokens)>0?d.querySelector("#remaining_sessions").innerText=`${e==null?void 0:e.tokens} (ends on ${A[2]}-${u}-${A[0]})`:d.querySelector("#remaining_sessions").innerText=`Your membership ends on ${A[2]}-${u}-${A[0]}`}else e!=null&&e.tokens&&(e==null?void 0:e.tokens)>0?d.querySelector("#remaining_sessions").innerText=e==null?void 0:e.tokens.toString().padStart(3,"0"):d.querySelector("#remaining_sessions").innerText="Please contact an admin for a membership";let x=d.querySelector("#confirm-booking-popout-btn");x.onclick=()=>E(this,null,function*(){x.disabled=!0;let A=R(),u={session_id:l.id},g=yield S(K+l.id,"POST",u,A);if(g.isFetchOk!==void 0&&!g.isFetchOk){let w=d.querySelector("#warning_block");w.innerText=g.message,w.style.display="flex",x.disabled=!1;return}U()})}),a.prepend(_)}),L({TriggerBtn:"close-cancel-booking-session-modal-btn",_modalWindow:"book-session-popout"}),a.classList.remove("off"),o.remove()})}})();var Y=v||[];Y.push(function(){$(document).off("submit"),$("form").submit(function(t){return E(this,null,function*(){t.preventDefault();let i=$(this);if(R()){let c=i[0][0].value,m=i[0][1].value,e=P;if((c&&c!=="Select Program"||m)&&(e+="?",c!=="Select Program"&&c!=="Loading..."&&(e+=`session_name=${c}&`),m)){let r=m.split("/"),a=new Date(+r[2],r[1]-1,+r[0]).toISOString(),o=new Date((typeof a=="string"?new Date(a):a).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}));e+=`time=${o.getTime()+1e7}`}h(e)}})})});
