var N=(e,t,n)=>new Promise((l,_)=>{var a=o=>{try{s(n.next(o))}catch(r){_(r)}},i=o=>{try{s(n.throw(o))}catch(r){_(r)}},s=o=>o.done?l(o.value):Promise.resolve(o.value).then(a,i);s((n=n.apply(e,t)).next())});var C=["January","February","March","April","May","June","July","August","September","October","November","December"];function R(e,t="GET",n=!1,l=!1,_=!1,a=!0){try{let i={"Content-Type":"application/json"};_&&(i={}),l&&(i.Authorization=`Bearer ${l}`);let s={method:t,headers:i};return n&&(a?s.body=JSON.stringify(n):s.body=n),fetch(e,s).then(o=>o.ok?o.json():o.json().then(r=>(Promise.reject(r.message),{isFetchOk:!1,status:o.status,message:r.message,payload:r&&r.payload?r.payload:null}))).then(o=>o).catch(o=>(console.error("Error in fetch",o),o))}catch(i){return console.error("Error!: "+i),i}}function w(e=null,t="nammax_auth",n=60*60*24){e&&(document.cookie=`${t}=${e}; path=/; max-age=${n}`)}function O(e="nammax_auth"){let n=`; ${document.cookie}`.split(`; ${e}=`);return n.length===2?n.pop().split(";").shift():null}function h(e="/",t=2e3){setTimeout(()=>{window.location.href=e},t)}function U(e=1e3){setTimeout(()=>{window.location.reload()},e)}function E(e=null,t=!1,n=!1,l=!1){if(e==null)return"NaN";let _=new Date,a=new Date(e),i=a.getHours(),s="";if(l||(s=i>=12?"PM":"AM",i=i%12||12),t){let o=a.getMinutes();return o=o<10?`0${o}`:o,n?`${_.getDate()===a.getDate()?"Today At":_.getDate()+1===a.getDate()?"Tomorrow At":_.getDate()+2===a.getDate()?"Day After Tomorrow At":T(e)} ${i}:${o} ${s}`:`${i}:${o} ${s}`}else return n?`${_.getDate()===a.getDate()?"Today At":_.getDate()+1===a.getDate()?"Tomorrow At":_.getDate()+2===a.getDate()?"Day After Tomorrow At":T(e)} ${i} ${s}`:`${T(e)} ${i} ${s}`}function T(e=null){if(e==null)return"NaN";let t=new Date(e);return`${t.getDate()}/${t.getMonth()+1}/${t.getFullYear()}`}function y(e=null){if(e==null)return"NaN";e=e*60;let t=`${e/60^0}`.slice(-2),n=("0"+e%60).slice(-2);return t!="0"?n!="00"?`${t} HR ${n} M`:t+" HR":n+" Mins"}function v(e,t=null){if(e!=null){var n,l=e.options.length-1;for(n=l;n>=0;n--)n!==t&&e.remove(n)}}function k(e="/sign-in"){window.localStorage.removeItem("auth"),h(`${e}`)}function D(e=!1,t=!0,n="current-time"){let l=document.getElementById(n);l&&t?(l.innerText=`${new Date().toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"})} | ${E(new Date().getTime(),!0,!1,e)}`,setTimeout(()=>D(e,t,n),2e4)):l&&!t&&(l.innerText=E(new Date().getTime(),!0,!1,e),setTimeout(()=>D(e,t,n),2e4))}function j(){let e=document.getElementById("loading-screen");e?e.remove():console.log("did not find loading screen")}function M(e){let t=new Date(e);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t}function P(e,t,n=!1){let l=864e5;return Math.round((M(t)-M(e))/l)}function L({single:e=!0,baseElement:t="",TriggerBtn:n="jsModalOpen",_modalWindow:l="jsModal"},_){if(e){var a=t.querySelector("#"+n);a.onclick=function(){var o=document.getElementById(l);_&&_(),o.classList?o.classList.add("open"):o.className+=" open"}}else for(var i=document.getElementsByClassName(n),s=0;s<i.length;s++)i[s].onclick=function(){var o=this.getAttribute("href").substr(1),r=document.getElementById(o);r.classList?r.classList.add("open"):r.className+=" open"}}function b({TriggerBtn:e="jsModalClose",_modalWindow:t="jsModal"},n){var l=document.getElementById(e),_=document.getElementById(t);l.onclick=function(){_.classList?_.classList.remove("open"):_.className=_.className.replace(new RegExp("(^|\\b)"+"open".split(" ").join("|")+"(\\b|$)","gi")," ")},n&&n()}var X=Webflow||[];var I="/sign-in",z="/sign-up-2";var F="/user/dashboard";var K="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/user/dashboard",H="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/user/dashboard/book_session/",G="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/user/dashboard/cancel_session/",q="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/user/dashboard/filters";var Y=[],W=[];function J(e){var t=new URL("https://xoxo-jnzf-s0on.m2.xano.io/api:ocRzyo-e/oauth/google/continue");t.searchParams.set("REDIRECT_URL","https://nammacrossfit.com/user/dashboard"),t.searchParams.set("code",e),t=t.toString();var n=new URL(document.location.href);n.searchParams.delete("code"),n.searchParams.delete("scope"),n.searchParams.delete("authuser"),n.searchParams.delete("hd"),n.searchParams.delete("prompt"),history.replaceState(null,"",n.toString()),fetch(t,{headers:Y,method:"GET"}).then(l=>l.json()).then(l=>W=l).then(()=>w(W.token)).catch(l=>{console.error("Error:",l)})}(()=>{window.onload=function(){var a=new URL(document.location.href),i=a.searchParams.get("code");if(i)J(i);else{let s=O(),o=document.querySelector("#navbar-logout-btn");o&&(o.onclick=()=>{k()}),s?(D(),e(s),t(s)):h(`${I}?reason=NOT_SIGNED_IN`)}};function e(a){return N(this,null,function*(){var i=new URL(document.location.href),s=i.searchParams.get("session_name"),o=i.searchParams.get("time");let r=K;if(s&&s!=="Select Program"||o){r+="?",s&&(r+=`session_name=${s}&`),o&&(r+=`time=${o}`);let d=document.getElementById("on-a-filter-container");d.style.display="flex"}let c=yield R(r,"GET",!1,a);if(c.isFetchOk!==void 0&&!c.isFetchOk){console.error(c.message),h(`${I}?reason=NOT_SIGNED_IN`);return}let{users:m,sessions:p}=c;if(m.gym_id===0||m.height===0||m.weight===0||m.date_of_birth===""||m.date_of_birth===null)h(`${z}?reason=UNSET_DETAILS`);else{n(m);let d=[],A=[];p.forEach(x=>{x.users.some(f=>f&&m&&f.user_id===m.id?(d.push(x),!0):!1)||A.push(x)}),l(d),_(m,A)}j()})}function t(a){let i=document.getElementById("filter-form-block"),s=i.querySelector("#filter-program"),o=i.querySelector("#datepicker-input");$(o).attr("autocomplete","off"),$(o).datepicker({startDate:new Date,format:"dd/mm/yyyy",language:"en",orientation:"bottom auto"});function r(){return N(this,null,function*(){let c=yield R(q,"GET",!1,a);if(c.isFetchOk!==void 0&&!c.isFetchOk){console.error(c.message),h(`${I}?reason=NOT_SIGNED_IN`);return}let{sessions:m}=c;v(s,0),m.forEach(p=>{var d=document.createElement("option");d.value=p.name,d.innerHTML=p.name,s.appendChild(d)}),s.removeEventListener("focus",r)})}s.addEventListener("focus",r)}function n(a){document.getElementById("user_name").innerText=a.name,document.getElementById("gym-location").innerText=a.location,a.profile_picture&&(document.getElementById("profile-avatar").style.backgroundImage=`url(${a.profile_picture.url})`)}function l(a){return N(this,null,function*(){let i=document.getElementById("booked-sessions-container"),s=i.querySelector("#booked-sessions-item");a.sort((r,c)=>c.time-r.time).forEach(r=>{let c=s.cloneNode(!0);c.setAttribute("id",""),c.querySelector("#booked-session-name").innerText=r.session_name,c.querySelector("#booked-time").innerText=E(r.time,!0,!0),c.querySelector("#booked-duration").innerText=y(r.duration);let m=(r.users.length/r.capacity).toFixed(2);c.querySelector("#booked-capacity").innerText=`${m>=1?"Full":m>.85?"Few Slots Left":m>.6?"Filling Fast!":(m*100).toFixed(2)+"%"}`,c.querySelector("#booked-session-slot-bar").style.width=m*100+"%",L({baseElement:c,TriggerBtn:"cancel-booked-session-btn",_modalWindow:"cancel-booked-session-popout"},()=>{let p=document.getElementById("cancel-booked-session-popout");p.querySelector("#session-name").innerText=r.session_name,p.querySelector("#date").innerText=new Date(r.time).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"}),p.querySelector("#time").innerText=E(r.time,!0),p.querySelector("#duration").innerText=y(r.duration);let d=(r.users.length/r.capacity).toFixed(2);p.querySelector("#capacity").innerHTML=d*100+"%";let A=p.querySelector("#confirm-cancel-booking-popout-btn");A.onclick=()=>N(this,null,function*(){A.disabled=!0;let x=p.innerText;A.innerText="Cancelling";let u=O(),f={session_id:r.id},S=yield R(G+r.id,"POST",f,u);if(S.isFetchOk!==void 0&&!S.isFetchOk){let g=p.querySelector("#warning_block");g.innerText=S.message,g.style.display="flex",A.disabled=!1,A.innerText=x;return}U()})}),i.prepend(c)}),b({TriggerBtn:"close-cancel-booked-session-modal-btn",_modalWindow:"cancel-booked-session-popout"}),i.classList.remove("off"),s.remove()})}function _(a,i){return N(this,null,function*(){let s=document.getElementById("view-sessions-container"),o=s.querySelector("#view-sessions-item");i.sort((c,m)=>m.time-c.time).forEach(c=>{let m=o.cloneNode(!0);m.setAttribute("id",""),m.querySelector("#session-name").innerText=c.session_name,m.querySelector("#time").innerText=E(c.time,!0,!0),m.querySelector("#duration").innerText=y(c.duration);let p=(c.users.length/c.capacity).toFixed(2);m.querySelector("#capacity").innerText=`${p>=1?"Full":p>.85?"Few Slots Left":p>.6?"Filling Fast!":(p*100).toFixed(2)+"%"}`,m.querySelector("#session-slot-bar").style.width=p*100+"%",L({baseElement:m,TriggerBtn:"book-session-btn",_modalWindow:"book-session-popout"},()=>{let d=document.getElementById("book-session-popout");d.querySelector("#name").innerText=c.session_name,d.querySelector("#date").innerText=new Date(c.time).toLocaleDateString("en-us",{weekday:"short",month:"short",day:"numeric"}),d.querySelector("#gym_location").innerText=a.location,d.querySelector("#time").innerText=E(c.time,!0),d.querySelector("#duration").innerText=y(c.duration);let A=((c.users.length/c.capacity).toFixed(2)*100).toFixed(2);if(d.querySelector("#capacity").innerText=`${A}%`,a!=null&&a.tokens&&(a==null?void 0:a.tokens)>0){let u=a==null?void 0:a.membership_end_date.split("-"),f=C[u[1]-1];P(new Date(u[0],u[1]-1,u[2]),new Date)>=1?d.querySelector("#remaining_sessions").innerText=`Your membership ended on ${u[2]}-${f}-${u[0]})`:d.querySelector("#remaining_sessions").innerText=`${a==null?void 0:a.tokens} tokens. (ends on ${u[2]}-${f}-${u[0]})`}else d.querySelector("#remaining_sessions").innerText="Membership Expired. Please contact an admin for a membership";let x=d.querySelector("#confirm-booking-popout-btn");x.onclick=()=>N(this,null,function*(){x.disabled=!0;let u=x.innerText;x.innerText="Confirming...";let f=O(),S={session_id:c.id},g=yield R(H+c.id,"POST",S,f);if(g.isFetchOk!==void 0&&!g.isFetchOk){let B=d.querySelector("#warning_block");B.innerText=g.message,B.style.display="flex",x.disabled=!1,x.innerText=u;return}U()})}),s.prepend(m)}),b({TriggerBtn:"close-cancel-booking-session-modal-btn",_modalWindow:"book-session-popout"}),s.classList.remove("off"),o.remove()})}})();var V=X||[];V.push(function(){$(document).off("submit"),$("form").submit(function(e){return N(this,null,function*(){e.preventDefault();let t=$(this);if(O()){let l=t[0][0].value,_=t[0][1].value,a=t[0][2];a.disabled=!0,a.value="Applying Filter";let i=F;if((l&&l!=="Select Program"||_)&&(i+="?",l!=="Select Program"&&l!=="Loading..."&&(i+=`session_name=${l}&`),_)){let s=_.split("/"),o=new Date(+s[2],s[1]-1,+s[0]).toISOString(),r=new Date((typeof o=="string"?new Date(o):o).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}));i+=`time=${r.getTime()+1e7}`}h(i)}})})});
