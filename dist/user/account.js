var u=(t,e,n)=>new Promise((i,c)=>{var l=a=>{try{m(n.next(a))}catch(o){c(o)}},r=a=>{try{m(n.throw(a))}catch(o){c(o)}},m=a=>a.done?i(a.value):Promise.resolve(a.value).then(l,r);m((n=n.apply(t,e)).next())});var h=["Male","Female","Other","Prefer not to say"];function A(t,e="GET",n=!1,i=!1,c=!1,l=!0){try{let r={"Content-Type":"application/json"};c&&(r={}),i&&(r.Authorization=`Bearer ${i}`);let m={method:e,headers:r};return n&&(l?m.body=JSON.stringify(n):m.body=n),fetch(t,m).then(a=>a.ok?a.json():a.json().then(o=>(Promise.reject(o.message),{isFetchOk:!1,status:a.status,message:o.message,payload:o&&o.payload?o.payload:null}))).then(a=>a).catch(a=>(console.error("Error in fetch",a),a))}catch(r){return console.error("Error!: "+r),r}}function N(t="nammax_auth"){let n=`; ${document.cookie}`.split(`; ${t}=`);return n.length===2?n.pop().split(";").shift():null}function _(t="/",e=0){setTimeout(()=>{window.location.href=t},e)}function g(t=1e3){setTimeout(()=>{window.location.reload()},t)}function f(t=null){if(t==null)return"NaN";let e=new Date(t);return`${e.getDate()}/${e.getMonth()+1}/${e.getFullYear()}`}function d(t,e=null){if(t!=null){var n,i=t.options.length-1;for(n=i;n>=0;n--)n!==e&&t.remove(n)}}function I(t="/sign-in"){window.localStorage.removeItem("auth"),_(`${t}`)}var p="/sign-in",R="/sign-up-2";var x="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/account",S="https://x8ki-letl-twmt.n7.xano.io/api:Kml2N_BA/user/upload/image";var E;window.onload=function(){let t=document.querySelector("#navbar-logout-btn");t&&(t.onclick=()=>{I()});let e=N();e?y(e):_(`${p}?reason=NOT_SIGNED_IN`)};function y(t){return u(this,null,function*(){let e=yield A(x,"GET",!1,t);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),_(`${p}?reason=NOT_SIGNED_IN`);return}E=e.user.id,$("#account-submit-btn").prop("disabled",!0),e.gym_id===0?_(`${R}?reason=UNSET_DETAILS`):(U(e),D())})}function U(t){let{user:e,gyms:n}=t;e.profile_picture&&(document.getElementById("profile_avatar").style.backgroundImage=`url(${e.profile_picture.url})`);let i=e.name.split(new RegExp("(?<=^\\S+)\\s"));document.getElementById("full-name").innerText=e.name||"",document.getElementById("firstname").value=i[0]||"",document.getElementById("lastname").value=i[1]||"",document.getElementById("email").value=e.email||"",document.getElementById("date_of_birth").innerText=e.date_of_birth||"",document.getElementById("phone_number").value=e.contact_number||"",document.getElementById("height").value=e.height||"",document.getElementById("weight").value=e.weight||"";let c=document.getElementById("fitness_level");c&&(c.value=e.level||"Unevaluated"),e.membership_end_date?(document.getElementById("active-membership").classList.remove("off"),document.getElementById("membership-end-date").innerText=f(e.membership_end_date)):document.getElementById("inactive-membership").classList.remove("off");let l=document.getElementById("gender_select");d(l),h.forEach(o=>{var s=document.createElement("option");s.value=o,s.text=o,o===e.gender&&(s.selected=!0),l.appendChild(s)});let r=document.getElementById("gym_select");d(r),n.forEach(o=>{var s=document.createElement("option");s.value=o.id,s.text=o.location,o.id===e.gym_id&&(s.selected=!0),r.appendChild(s)});let m=document.getElementById("injury_select");d(m),["None","Bone","Muscle","Tissue"].forEach(o=>{var s=document.createElement("option");s.value=o,s.text=o,o===e.injury&&(s.selected=!0),m.appendChild(s)});let a=document.getElementById("severity_select");d(a),[{text:"None",severity:"0"},{text:"1 (Low)",severity:"1"},{text:"2",severity:"2"},{text:"3",severity:"3"},{text:"4",severity:"4"},{text:"5 (high)",severity:"5"}].forEach(o=>{var s=document.createElement("option");s.value=o.severity,s.text=o.text,o.severity===e.severity&&(s.selected=!0),a.appendChild(s)})}function D(){let t=document.getElementById("pfp_input"),e=document.getElementById("profile_avatar");t.addEventListener("change",function(n){n.target&&n.target.files.length>0&&n.target.files[0]&&(e.style.backgroundImage=`url(${URL.createObjectURL(n.target.files[0])})`,$("#wf-form-user-data").data("changed",!0),$("#account-submit-btn").prop("disabled",!1),$("#account-submit-btn").removeClass("disabled"))})}function w(t,e){return u(this,null,function*(){let n=document.getElementById("pfp_input"),i=n.files[0];if(i!==void 0){if(i.size>2097152){alert("File too big. Max size is 2MB");return}if(i.type!=="image/jpg"&&i.type!=="image/jpeg"&&i.type!=="image/png"){alert("Incorrect file type. Acceptable types: .png, .jpg, .jpeg");return}let c=new FormData;c.append("content",i);let l=yield A(S,"POST",c,t,!0,!1);if(l.isFetchOk!==void 0&&!l.isFetchOk){console.error(l.message),e.siblings(".w-form-done").hide().siblings(".w-form-fail").show();return}n.value="",document.getElementById("profile_avatar").style.backgroundImage=`url(https://x8ki-letl-twmt.n7.xano.io${l.path})`}return!0})}var O=O||[];O.push(function(){$(document).off("submit"),$("form").on("change",function(){$("#account-submit-btn").prop("disabled",!1),$("#account-submit-btn").removeClass("disabled"),$("form").data("changed",!0)}),$("form").submit(function(t){return u(this,null,function*(){t.preventDefault();let e=$(this);if(!e.data("changed")&&document.getElementById("pfp_input").files[0]===void 0)return;let n=N();if(n){let i=!1;if(e.data("changed")){E||_(`${p}?reason=NOT_SIGNED_IN`);let l={name:document.getElementById("firstname").value+" "+document.getElementById("lastname").value,email:document.getElementById("email").value,gender:document.getElementById("gender_select").value,height:document.getElementById("height").value,weight:document.getElementById("weight").value,contact_number:document.getElementById("phone_number").value.replace("+",""),gym_id:document.getElementById("gym_select").value,injury:document.getElementById("injury_select").value,severity:document.getElementById("severity_select").value},r=yield A(`${x}/${E}`,"POST",l,n);r.isFetchOk!==void 0&&!r.isFetchOk?e.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("There was an error updating your account details, please refresh and try again - Err:",r.message):e.siblings(".w-form-done").show().siblings(".w-form-fail").hide().text("Your sessions have been updated successfully"),i=!0}let c=w(n,e);i&&c&&g(2e3)}else _(`${p}?reason=NOT_SIGNED_IN`)})})});
