var d=(t,e,n)=>new Promise((s,l)=>{var c=a=>{try{m(n.next(a))}catch(o){l(o)}},r=a=>{try{m(n.throw(a))}catch(o){l(o)}},m=a=>a.done?s(a.value):Promise.resolve(a.value).then(c,r);m((n=n.apply(t,e)).next())});var N=["Male","Female","Other","Prefer not to say"];function p(t,e="GET",n=!1,s=!1,l=!1,c=!0){try{let r={"Content-Type":"application/json"};l&&(r={}),s&&(r.Authorization=`Bearer ${s}`);let m={method:e,headers:r};return n&&(c?m.body=JSON.stringify(n):m.body=n),fetch(t,m).then(a=>a.ok?a.json():a.json().then(o=>(Promise.reject(o.message),{isFetchOk:!1,status:a.status,message:o.message,payload:o&&o.payload?o.payload:null}))).then(a=>a).catch(a=>(console.error("Error in fetch",a),a))}catch(r){return console.error("Error!: "+r),r}}function A(t="nammax_auth"){let n=`; ${document.cookie}`.split(`; ${t}=`);return n.length===2?n.pop().split(";").shift():null}function _(t="/",e=2e3){setTimeout(()=>{window.location.href=t},e)}function E(t=1e3){setTimeout(()=>{window.location.reload()},t)}function g(t=null){if(t==null)return"NaN";let e=new Date(t);return`${e.getDate()}/${e.getMonth()+1}/${e.getFullYear()}`}function u(t,e=null){if(t!=null){var n,s=t.options.length-1;for(n=s;n>=0;n--)n!==e&&t.remove(n)}}function y(t="/sign-in"){window.localStorage.removeItem("auth"),_(`${t}`)}function h(){let t=document.getElementById("loading-screen");t?t.remove():console.error("did not find loading screen")}function I(t,e){let n=document.getElementById(t);n&&(n.onclick=()=>{y(e)})}var O=Webflow||[];var U="https://www.nammacrossfit.com",R=U,x="/sign-in",S="/sign-up-2",K=`${R}/sign-up-2`;var P=`${R}/user/dashboard`;var f="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/user/account",D="https://xoxo-jnzf-s0on.m2.xano.io/api:Kml2N_BA/user/upload/image";window.onload=function(){I("navbar-logout-btn","/sign-in");let t=A();t?L(t):_(`${x}?reason=NOT_SIGNED_IN`)};function L(t){return d(this,null,function*(){let e=yield p(f,"GET",!1,t);if(e.isFetchOk!==void 0&&!e.isFetchOk){console.error(e.message),_(`${x}?reason=NOT_SIGNED_IN`);return}$("#account-submit-btn").prop("disabled",!0),e.gym_id===0?_(`${S}?reason=UNSET_DETAILS`):(B(e),T()),h()})}function B(t){let{user:e,gyms:n}=t;e.profile_picture&&(document.getElementById("profile_avatar").style.backgroundImage=`url(${e.profile_picture.url})`);let s=e.name.split(new RegExp("(?<=^\\S+)\\s"));document.getElementById("full-name").innerText=e.name||"",document.getElementById("firstname").value=s[0]||"",document.getElementById("lastname").value=s[1]||"",document.getElementById("email").value=e.email||"",document.getElementById("date_of_birth").innerText=e.date_of_birth||"",document.getElementById("phone_number").value=e.contact_number||"",document.getElementById("height").value=e.height||"",document.getElementById("weight").value=e.weight||"";let l=document.getElementById("fitness_level");l&&(l.value=e.level||"Unevaluated"),e.membership_end_date?(document.getElementById("active-membership").classList.remove("off"),document.getElementById("membership-end-date").innerText=g(e.membership_end_date)):document.getElementById("inactive-membership").classList.remove("off");let c=document.getElementById("gender_select");u(c),N.forEach(o=>{var i=document.createElement("option");i.value=o,i.text=o,o===e.gender&&(i.selected=!0),c.appendChild(i)});let r=document.getElementById("gym_select");u(r),n.forEach(o=>{var i=document.createElement("option");i.value=o.id,i.text=o.location,o.id===e.gym_id&&(i.selected=!0),r.appendChild(i)});let m=document.getElementById("injury_select");u(m),["None","Bone","Muscle","Tissue"].forEach(o=>{var i=document.createElement("option");i.value=o,i.text=o,o===e.injury&&(i.selected=!0),m.appendChild(i)});let a=document.getElementById("severity_select");u(a),[{text:"None",severity:"0"},{text:"1 (Low)",severity:"1"},{text:"2",severity:"2"},{text:"3",severity:"3"},{text:"4",severity:"4"},{text:"5 (high)",severity:"5"}].forEach(o=>{var i=document.createElement("option");i.value=o.severity,i.text=o.text,o.severity===e.severity&&(i.selected=!0),a.appendChild(i)})}function T(){let t=document.getElementById("pfp_input"),e=document.getElementById("profile_avatar");t.addEventListener("change",function(n){n.target&&n.target.files.length>0&&n.target.files[0]&&(e.style.backgroundImage=`url(${URL.createObjectURL(n.target.files[0])})`,$("#wf-form-user-data").data("changed",!0),$("#account-submit-btn").prop("disabled",!1),$("#account-submit-btn").removeClass("disabled"))})}function b(t,e){return d(this,null,function*(){let n=document.getElementById("pfp_input"),s=n.files[0];if(s!==void 0){if(s.size>2097152){alert("File too big. Max size is 2MB");return}if(s.type!=="image/jpg"&&s.type!=="image/jpeg"&&s.type!=="image/png"){alert("Incorrect file type. Acceptable types: .png, .jpg, .jpeg");return}let l=new FormData;l.append("content",s);let c=yield p(D,"POST",l,t,!0,!1);if(c.isFetchOk!==void 0&&!c.isFetchOk){console.error(c.message),e.siblings(".w-form-done").hide().siblings(".w-form-fail").show();let r=document.getElementById("account-submit-btn");r&&(r.disabled=!1);return}n.value="",document.getElementById("profile_avatar").style.backgroundImage=`url(https://xoxo-jnzf-s0on.m2.xano.io${c.path})`}return!0})}var C=O||[];C.push(function(){$(document).off("submit"),$("form").on("change",function(){$("#account-submit-btn").prop("disabled",!1),$("#account-submit-btn").removeClass("disabled"),$("form").data("changed",!0)}),$("form").submit(function(t){return d(this,null,function*(){t.preventDefault();let e=document.getElementById("account-submit-btn"),n;e&&(e.disabled=!0,n=e.value,e.value="Updating...");let s=$(this);if(!s.data("changed")&&document.getElementById("pfp_input").files[0]===void 0){e&&(e.disabled=!1,e.value=n);return}let l=A();if(l){let c=!1;if(s.data("changed")){let m={name:document.getElementById("firstname").value+" "+document.getElementById("lastname").value,email:document.getElementById("email").value,gender:document.getElementById("gender_select").value,height:document.getElementById("height").value,weight:document.getElementById("weight").value,contact_number:document.getElementById("phone_number").value.replace("+",""),gym_id:document.getElementById("gym_select").value,injury:document.getElementById("injury_select").value,severity:document.getElementById("severity_select").value},a=yield p(f,"POST",m,l);a.isFetchOk!==void 0&&!a.isFetchOk?(s.siblings(".w-form-done").hide().siblings(".w-form-fail").show().text("There was an error updating your account details, please refresh and try again - Err:",a.message),e&&(e.disabled=!1,e.value=n)):s.siblings(".w-form-done").show().siblings(".w-form-fail").hide().text("Your account has been updated successfully"),c=!0}let r=b(l,s);c&&r&&E(2e3)}else _(`${x}?reason=NOT_SIGNED_IN`)})})});
